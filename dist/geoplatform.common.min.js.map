{"version":3,"sources":["geoplatform.common.js","module.js","directives/card-details.js","directives/colorpicker.js","directives/datepicker.js","directives/geolocation.js","directives/header-menu.js","directives/iframe.js","directives/image.js","directives/notifications.js","directives/pagination.js","directives/progress-circle.js","directives/responsive.js","directives/slick-forms.js","directives/social.js","directives/sort.js","directives/string-array.js","filters/filters.js","kg/module.js","kg/section.js","services/browse.service.js","services/socket.js","services/uuid.js","auth.js","lang.js"],"names":["_classCallCheck","instance","Constructor","TypeError","_typeof","Symbol","iterator","obj","constructor","prototype","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","jQuery","angular","module","constant","GeoPlatform","idspUrl","idmUrl","value","directive","compile","$element","append","ACTIVATORS_HTML","controller","$scope","hasPrevious","find","prevAll","hasNext","nextAll","previousDetails","pane","removeClass","element","addClass","nextDetails","invalidRGB","rgb","error","r","parseInt","g","b","x","componentToHex","c","hex","toString","result","isNaN","rgbToHex","validHex","exec","hexToRgb","shorthandRegex","replace","m","component","bindings","ngModel","onChange","$timeout","$q","this","changeRGB","rgbError","self","changeHex","hexError","$onInit","template","scope","label","format","date","join","$attrs","toggle","event","preventDefault","stopPropagation","opened","promise","debounce","cancel","$watch","listener","$on","$window","restrict","btnLabel","loading","available","navigator","geolocation","geolocate","getCurrentPosition","position","$apply","$emit","coords","latitude","longitude","code","Config","AuthenticationService","brand","showHomeLink","transclude","link","ctrl","transcludeFn","portalUrl","getUserQ","then","user","replaceWith","$location","update","path","homeLink","substring","menu","dd","closest","parent","each","a","$a","$","href","attr","indexOf","homeHref","$rootScope","$root","callback","attrs","on","off","Constants","jqEl","onImgFail","mapThumbnail","buildThumbnail","map","thumbnail","contentData","style","mediaType","width","height","url","getUrl","ualUrl","id","$promise","$resolved","catch","e","item","fallback","elName","isLink","resolve","type","assetType","assetId","hasThumbnail","service","Service","items","getItems","addItem","push","$broadcast","removeItem","bind","index","splice","msg","dismiss","message","canDismiss","success","info","NotificationService","expiration","timer","removeOldest","oldest","$watchCollection","PaginationController","_this","options","getPagination","pageSizeDropdown","useSelect","pageSize","size","pageSizeOptions","sizeOptions","o","eventKey","start","Math","max","min","total","lastPage","floor","setPage","arg","page","dashArray","PI","$onChanges","changes","offset","provider","$windowProvider","Helper","window","$get","getWidth","innerWidth","outerWidth","isXS","isSM","isMD","isLG","helper","responsiveHelper","el","resizeFn","w","$attr","hh","offsetHeight","tp","top","css","inputLinkFunction","ngModelController","validate","input","isDirty","hasClass","newValue","$setViewValue","$render","required","elId","ceil","random","innerValue","$viewValue","displayValue","placeholder","isReadOnly","t","readOnly","toLowerCase","edit","editing","focus","select","done","save","onKeyPress","$event","undefined","which","onKeyUp","$destroy","require","help","pattern","icon","INPUT_TEMPLATE","TEXTAREA_TEMPLATE","$filter","DATE_TEMPLATE","inline","$modelValue","copy","open","uibopts","codeList","SELECT_TEMPLATE","getSelect","$select","selectOptions","opt","onTypeaheadSelection","$item","$model","$label","onTypeaheadKeyUp","func","wait","immediate","timeout","context","args","arguments","later","apply","callNow","clearTimeout","setTimeout","twttr","className","renderTwitterButton","innerHTML","widgets","createShareButton","count","text","via","hashtags","dnt","$observe","$viewChangeListeners","$eval","ngChange","fromInput","split","trim","toInput","arr","$parsers","$formatters","filter","charAt","toUpperCase","slice","endsWith","facetName","f","startsWith","delimiter","emptyValue","defVal","keys","str","name","idx","statistics","reliability","KGFields","RecommenderServiceFactory","calculate","kg","forEach","prop","getService","$resource","baseUrl","query","isArray","queryTypes","querySources","factory","for","KGHelper","_this2","classifiers","$onDestroy","SectionController","RecommenderService","noResults","displayOptions","fetching","showSuggested","paging","updateCache","eventHandlers","clearOptions","selected","onActivate","data","handler","_this3","params","q","response","totalResults","notify","suggested","results","_selected","isSelected","finally","fetchOptions","removed","uri","found","it","values","description","BrowseObjectsService","eventName","dirty","delay","resetStart","doReset","_dirtyPromise","_doUpdate","_options","_isLoading","opts","PARAM_OPTIONS","po","parameter","option","isSet","isArr","k","facets","hasOwnProperty","_selectedFacets","sort","bust","Date","getTime","includeFacet","_requestFacets","fields","_fields","svc","_results","_facets","_id","JSON","parse","setOption","fire","_pageSizeBase","PAGE_SIZE_BASE_10","pageSizeBase","PAGE_SIZE_BASE_12","FIELDS","FACETS","_onSelectFn","onSelect","events","LOADING","RESULTS","PAGINATION","SELECTED","ERROR","SELECTED_ADDED","SELECTED_REMOVED","getLoadingStatus","trigger","getResults","getFacetNames","getFacets","getFacet","facet","addFacet","applyConstraints","p","applyOption","applyOptions","setQuery","fireUpdate","VAR_QUERY","setTypes","types","VAR_TYPES","getTypes","setUser","userId","VAR_USER","setCreatedBy","creators","VAR_CREATED_BY","setThemes","themes","VAR_THEMES","getThemes","setAgencies","publishers","VAR_PUBLISHERS","getAgencies","setServiceTypes","svcTypes","VAR_SERVICE_TYPES","getServiceTypes","setSchemes","schemes","VAR_SCHEMES","setVisibility","visibility","VAR_VISIBILITY","setModified","beforeOrAfter","VAR_MODIFIED_BEFORE","VAR_MODIFIED_AFTER","dir","oppProp","getModified","setExtent","bboxStr","VAR_EXTENT","getExtent","getSelected","setSelected","finder","l","existing","err","unshift","selectAll","_this4","clearSelected","clear","refresh","setFacet","category","setFields","andUpdate","getSortOptions","SORT_OPTIONS","getSortValue","getQueryOptions","extend","hasQueryOptions","reset","order","destroy","BrowseServiceFactory","SocketService","_this5","socket","tracking","CREATED","UPDATED","DELETED","EDITING","STATUS","io","console","log","connect","evt","socketId","_this6","emit","_this7","tracks","end","close","objId","_this8","room","_this9","leave","UUID","cache","onClose","onbeforeunload","cacheRef","closeDelegate","call","onDelegate","handle","emitDelegate","s","hexDigits","substr","isDEV","location","hostname","$http","User","username","toJSON","email","org","roles","clone","compare","isAuthorized","role","env","ENV","NODE_ENV","parseCookie","cookie","decodeURIComponent","parts","part","kvp","groups","getRoles","document","TEST_USER","_user","TEST_NO_AUTH","NONE","INITIALIZING","INITIALIZED","status","deferred","defer","getUser","check","getCurrentLocation","onBeforeLogin","beforeLoginFn","login","_this10","current","encodeURIComponent","onBeforeLogout","beforeLogoutFn","logout","_this11","curfalse","get","content","reject","Success","mail","first_name","last_name","organization","headers","minimal","idpUrl","watcher","newUser","Array","indexOfObj","comparatorFn","len","String","plus","offsetMS","d","threshold"],"mappings":"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","file":"geoplatform.common.min.js","sourcesContent":["\"use strict\";\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n(function (jQuery, angular) {\n\n    \"use strict\";\n\n    angular.module(\"gp-common\", [])\n\n    //Assumes a global has been set\n    // Don't use these... deprecated\n    .constant('idspBaseUrl', GeoPlatform.idspUrl).constant('idmBaseUrl', GeoPlatform.idmUrl)\n\n    //Assumes a global object containing configuration values for GeoPlatform exists \n    // prior to this module being declared\n    // (using 'value' since config might change)\n    .value('GPConfig', GeoPlatform);\n})(jQuery, angular);\n(function (angular) {\n\n    \"use strict\";\n\n    var ACTIVATORS_HTML = \"\\n            <div class=\\\"gp-ui-card__details-activator--left\\\" title=\\\"Show previous details\\\"\\n                ng-class=\\\"{disabled:!hasPrevious()}\\\" ng-click=\\\"previousDetails()\\\">\\n                <span class=\\\"glyphicon glyphicon-chevron-left\\\"></span>\\n            </div>\\n            <div class=\\\"gp-ui-card__details-activator--right\\\" title=\\\"Show next details\\\"\\n                ng-class=\\\"{disabled:!hasNext()}\\\" ng-click=\\\"nextDetails()\\\">\\n                <span class=\\\"glyphicon glyphicon-chevron-right\\\"></span>\\n            </div>\\n        \";\n\n    /*\n     * Appends carousel-like activators onto a card section\n     * Usage: \n     *\n     *  <div class=\"text--supporting\" card-details-carousel-activator>\n     *      <div class=\"gp-ui-card__details active\" id=\"description\">...</div>    \n     *      <div class=\"gp-ui-card__details\" id=\"author\">...</div>        \n     *  </div>\n     */\n    angular.module(\"gp-common\").directive('cardDetailsCarouselActivator', function () {\n\n        return {\n\n            compile: function compile($element) {\n                $element.append(ACTIVATORS_HTML);\n            },\n\n            controller: function controller($scope, $element) {\n\n                $scope.hasPrevious = function () {\n                    var pane = $element.find('.gp-ui-card__details.active');\n                    return pane.prevAll('.gp-ui-card__details').length;\n                };\n\n                $scope.hasNext = function () {\n                    var pane = $element.find('.gp-ui-card__details.active');\n                    return pane.nextAll('.gp-ui-card__details').length;\n                };\n\n                $scope.previousDetails = function () {\n                    if (!$scope.hasPrevious()) return;\n                    var pane = $element.find('.gp-ui-card__details.active');\n                    pane.removeClass('active');\n                    pane = pane.prevAll('.gp-ui-card__details');\n                    if (pane.length) angular.element(pane[0]).addClass('active');\n                };\n\n                $scope.nextDetails = function () {\n                    if (!$scope.hasNext()) return;\n                    var pane = $element.find('.gp-ui-card__details.active');\n                    pane.removeClass('active');\n                    pane = pane.nextAll('.gp-ui-card__details');\n                    if (pane.length) angular.element(pane[0]).addClass('active');\n                };\n            }\n        };\n    });\n})(angular);\n(function (jQuery, angular) {\n\n    'use strict';\n\n    /**\n     * determines whether an rgb value is invalid\n     * the value starts as false (the rbg value is valid)\n     * and is invalidated if the value(s) are empty, greater than 255 or less than 0\n     *\n     * @param rgb either an object { r: 0, g: 0, b: 0 } or a single value\n     * @returns {boolean} whether the rgb value is invalid\n     */\n\n    function invalidRGB(rgb) {\n        var error = false;\n\n        if (rgb instanceof Object) {\n            var r = parseInt(rgb.r, 10);\n            var g = parseInt(rgb.g, 10);\n            var b = parseInt(rgb.b, 10);\n\n            if (r > 255 || r < 0 || !r && r !== 0) error = true;\n            if (g > 255 || g < 0 || !g && g !== 0) error = true;\n            if (b > 255 || b < 0 || !b && b !== 0) error = true;\n        } else {\n            var x = parseInt(rgb, 10);\n            if (x > 255 || x < 0 || !x && x !== 0) error = true;\n        }\n\n        return error;\n    }\n\n    /**\n     * converts a decimal (base 10) number to hex (base 16) string\n     *\n     * @param c base 10 number\n     * @returns {*} base 16 string\n     */\n    function componentToHex(c) {\n        var hex = c.toString(16),\n            result = null;\n\n        if (!isNaN(c) && !invalidRGB(c)) result = hex.length == 1 ? '0' + hex : hex;\n\n        return result;\n    }\n\n    /**\n     * converts an rgb object to a hexadecimal string\n     *\n     * @param rgb object { r: 0, g: 0, b: 0 }\n     * @returns {*} hexadecimal string\n     */\n    function rgbToHex(rgb) {\n        var result = null;\n\n        var r = componentToHex(parseInt(rgb.r, 10));\n        var g = componentToHex(parseInt(rgb.g, 10));\n        var b = componentToHex(parseInt(rgb.b, 10));\n\n        if (r && g && b) result = '#' + r + g + b;\n\n        return result;\n    }\n\n    /**\n     * determines whether a hex value is valid\n     *\n     * @param hex string value\n     * @returns hex value or null if hex is invalid\n     */\n    function validHex(hex) {\n        return (/^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex) || null\n        );\n    }\n\n    /**\n     * converts a hex string to rgb object\n     *\n     * @param hex string\n     * @returns {*} rgb object { r: 0, g: 0, b: 0 }\n     */\n    function hexToRgb(hex) {\n        // Expand shorthand form (e.g. '03F') to full form (e.g. '0033FF')\n        var shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n        hex = hex.replace(shorthandRegex, function (m, r, g, b) {\n            return r + r + g + g + b + b;\n        });\n\n        var result = validHex(hex);\n        return result ? {\n            r: parseInt(result[1], 16),\n            g: parseInt(result[2], 16),\n            b: parseInt(result[3], 16)\n        } : null;\n    }\n\n    /**\n     * Advanced Color Picker Directive (advanced-color-picker)\n     * This color picker is meant to augment the functionality in angular-bootstrap-colorpicker\n     * It adds the ability to change the color with RGB and Hex\n     * It needs to be used in a container that has at least 160px of vertical real estate\n     *\n     * You must pass in the following:\n     *   - ngModel  (a hexadecimal string color value)\n     *   - onChange (the event to be fired when the value changes)\n     *\n     * Usage Example:\n     * <div advanced-color-picker ng-model=\"hexColor\" ng-change=\"changeEvent()\"></div>\n     */\n    angular.module('gp-common').component('gpColorPicker', {\n\n        bindings: {\n            ngModel: '=',\n            onChange: '&'\n        },\n\n        controller: function controller($timeout, $q) {\n\n            // fired when an rgb value is changed\n            this.changeRGB = function () {\n\n                // make sure rgb color value is correct\n                this.rgbError = invalidRGB(this.rgb);\n\n                // parse it anyways leaving hex value blank until valid rbg\n                this.ngModel = rgbToHex(this.rgb);\n\n                // have to use timeout to make sure ngModel is set before\n                // firing change event upstream\n                var self = this;\n                $timeout(function () {\n                    self.onChange({ value: self.ngModel });\n                });\n            };\n\n            // fired when a hex value is changed\n            this.changeHex = function () {\n\n                // make sure the hex color value is correct\n                if (!validHex(this.ngModel)) this.hexError = 'Invalid hex color value';else this.hexError = false;\n\n                // parse it anyway leaving rgb values blank until it's a valid hex\n                this.rgb = hexToRgb(this.ngModel);\n\n                // have to use timeout to make sure ngModel is set before\n                // firing change event upstream\n                var self = this;\n                $timeout(function () {\n                    self.onChange({ value: self.ngModel });\n                });\n            };\n\n            this.$onInit = function () {\n                this.rgb = hexToRgb(this.ngModel);\n            };\n        },\n\n        template: \"\\n            <div class=\\\"gp-colorpicker\\\">\\n                <div class=\\\"form-group hex-form-group\\\" ng-class=\\\"{'has-error':$ctrl.hexError}\\\">\\n                    <input type=\\\"text\\\" class=\\\"form-control\\\"\\n                        ng-model=\\\"$ctrl.ngModel\\\" ng-keyup=\\\"$ctrl.changeHex()\\\">\\n                </div>\\n                <div class=\\\"gp-colorpicker__wrapper\\\">\\n                    <div colorpicker colorpicker-inline=\\\"true\\\" colorpicker-parent=\\\"true\\\" \\n                        ng-model=\\\"$ctrl.ngModel\\\" ng-change=\\\"$ctrl.changeHex()\\\"></div>\\n                </div>\\n                <div class=\\\"form-group rgb-form-group\\\" ng-class=\\\"{'has-error':$ctrl.rgbError}\\\">\\n                    <input type=\\\"text\\\" class=\\\"form-control\\\"\\n                        placeholder=\\\"R\\\" ng-model=\\\"$ctrl.rgb.r\\\" ng-keyup=\\\"$ctrl.changeRGB()\\\" title=\\\"R\\\">\\n                    <input type=\\\"text\\\" class=\\\"form-control\\\"\\n                        placeholder=\\\"G\\\" ng-model=\\\"$ctrl.rgb.g\\\" ng-keyup=\\\"$ctrl.changeRGB()\\\" title=\\\"G\\\">\\n                    <input type=\\\"text\\\" class=\\\"form-control\\\"\\n                        placeholder=\\\"B\\\" ng-model=\\\"$ctrl.rgb.b\\\" ng-keyup=\\\"$ctrl.changeRGB()\\\" title=\\\"B\\\">\\n                </div>\\n            </div>\\n        \"\n    });\n})(jQuery, angular);\n(function (jQuery, angular) {\n\n    'use strict';\n\n    angular.module('gp-common').directive('gpDatePicker', ['$timeout', function ($timeout) {\n\n        return {\n            scope: {\n                label: '@',\n                format: '@',\n                date: '=',\n                onChange: '&?'\n            },\n            template: ['<div class=\"input-group-slick\">', '    <input type=\"text\" class=\"form-control\" placeholder=\"{{::label}}\"', '        datepicker-popup=\"{{format}}\" ng-model=\"date\" is-open=\"opened\" />', '    <span class=\"glyphicon glyphicon-calendar\" ng-click=\"toggle($event)\"></span>', '</div>', '<p class=\"help-block\"><small><em>Ex: \"2015-01-31\" or \"Jan 31 2015\"</em></small></p>'].join(' '),\n\n            controller: function controller($scope, $element, $attrs) {\n\n                //toggle date picker\n                $scope.toggle = function (event) {\n                    event.preventDefault();\n                    event.stopPropagation();\n                    this.opened = !this.opened;\n                };\n\n                if (!$scope.format) $scope.format = 'MMM dd yyyy';\n\n                var promise = null;\n\n                $scope.debounce = function () {\n                    if (promise) $timeout.cancel(promise);\n                    promise = $timeout(function () {\n                        promise = null;\n                        if ($scope.onChange) $scope.onChange();\n                    }, 200);\n                };\n\n                $scope.$watch('date', function () {\n                    $scope.debounce();\n                });\n\n                var listener = $scope.$on('$destroy', function () {\n\n                    listener(); //deregister listener\n\n                    if (promise) $timeout.cancel(promise);\n                    promise = null;\n\n                    $scope.opened = false; //close picker if open\n                    $scope.onChange = null;\n                    $scope.format = null;\n                    $scope.debounce = null;\n                });\n            }\n        };\n    }]);\n})(jQuery, angular);\n(function (jQuery, angular) {\n\n    \"use strict\";\n\n    angular.module(\"gp-common\")\n\n    /**\n     * Geolocation directive\n     */\n    .directive('gpGeolocation', ['$window', function ($window) {\n\n        var defaultBtnLabel = \"Locate\";\n\n        return {\n            scope: {\n                label: '=?'\n            },\n            restrict: \"EA\",\n            template: ['<a class=\"btn btn-primary\" ng-click=\"geolocate()\" ng-if=\"available\">', '  <span class=\"glyphicon glyphicon-screenshot\" ng-if=\"!loading\"></span>', '  <span class=\"glyphicon glyphicon-hourglass glyphicon-spin\" ng-if=\"loading\"></span>', '  {{btnLabel}}', '</a>', '<div ng-if=\"error\">{{error}}</div>'].join(' '),\n            controller: function controller($scope) {\n\n                $scope.btnLabel = $scope.label || defaultBtnLabel;\n                $scope.loading = false;\n                $scope.available = $window.navigator && $window.navigator.geolocation;\n\n                if (!$scope.available) $scope.error = \"Your browser does not support determining location\";\n\n                $scope.geolocate = function () {\n\n                    $scope.loading = true;\n                    $window.navigator.geolocation.getCurrentPosition(function (position) {\n\n                        $scope.$apply(function () {\n                            $scope.loading = false;\n                        });\n                        $scope.$emit('map:geolocation', position.coords.latitude, position.coords.longitude);\n                    }, function (error) {\n                        switch (error.code) {\n                            case 1:\n                                $scope.error = \"Permission was denied while attempting to determine location\";\n                                break;\n                            case 2:\n                                $scope.error = \"Unable to determine your location\";\n                                break;\n                            case 3:\n                                $scope.error = \"Unable to determine location in a reasonable amount of time\";\n                                break;\n                        }\n                    });\n                };\n            }\n        };\n    }]);\n})(jQuery, angular);\n(function (jQuery, angular) {\n\n    \"use strict\";\n\n    angular.module(\"gp-common\")\n\n    /**\n     * Header directive for GeoPlatform Angular-based web applications\n     * \n     * Uses transclusion to inject links into the nav-menu which floats to the right.\n     * The menu already provides a \"Home\" link (to app home) and Sign In/User Info button.\n     * The home link is not enabled by default but can be shown using 'show-home-link=\"true\"' \n     * parameter on the directive.\n     *\n     * Note: any links transcluded should reference '$parent.user' to access authenticated user info\n     * \n     * ex:\n     * \n     *   <div gp-header brand=\"Map Manager\" show-home-link=\"true\" class=\"navbar-fixed-top\">\n     *     <li><a href=\"#/maps\">Maps</a></li>\n     *     <li><a href=\"#/galleries\">Galleries</a></li>\n     *     <li><a ng-if=\"$parent.user!==null\" href=\"#/agol\">AGOL</a></li>\n     *     <li><a href=\"#/help\">Help</a></li>\n     *   </div>\n     */\n    .directive('gpHeader', ['GPConfig', 'AuthenticationService', function (Config, AuthenticationService) {\n\n        return {\n\n            scope: {\n                brand: \"@\",\n                showHomeLink: \"@\"\n            },\n            restrict: \"AE\",\n            transclude: true,\n            replace: true,\n            template: ['<header>', '  <div class=\"container-fluid\">', '    <div class=\"row\">', '      <div class=\"col-md-12\">', '        <ul role=\"menu\" class=\"header__menu\" gp-header-menu>', '          <li ng-if=\"showHomeLink\">', '            <a href=\"#/goHome\">', '                <span class=\"glyphicon glyphicon-home\"></span> ', '                <span class=\"hidden-xs hidden-sm\">Home</span>', '            </a>', '          </li>', '          <div class=\"transcluded\"></div>', '          <li><span gp-login-button></span></li>', '        </ul>', '        <h4 class=\"brand\">', '          <a href=\"{{portalUrl}}\" title=\"Go to the GeoPlatform Home Page\">', '            <span class=\"icon-gp\"></span>', '            <span class=\"hidden-xs\">GeoPlatform</span>', '          </a>', '          {{brand}}', '        </h4>', '      </div>', '    </div>', '  </div>', '</header>'].join(' '),\n\n            // controller: function($rootScope, $scope, $element) {\n            //     $scope.portalUrl = $rootScope.portalUrl;\n            // }, \n\n            link: function link($scope, $element, $attrs, ctrl, transcludeFn) {\n\n                $scope.showHomeLink = $scope.showHomeLink === 'true' || false;\n\n                $scope.portalUrl = Config.portalUrl;\n\n                AuthenticationService.getUserQ().then(function (user) {\n                    $scope.user = user;\n                });\n\n                $element.find('.transcluded').replaceWith(transcludeFn());\n            }\n\n        };\n    }])\n\n    /**\n     * Header Menu\n     *\n     * Monitors the current page URL and updates the header links \n     * to highlight whichever one is associated with the current page\n     *\n     * Usage: \n     *\n     *  <ul role=\"menu\" class=\"header__menu\" gp-header-menu>\n     *      <li><a href=\"#/maps\">Maps</a></li>\n     *      <li><a href=\"#/galleries\">Galleries</a></li>\n     *      ...\n     *  </ul>\n     *\n     */\n    .directive('gpHeaderMenu', ['$location', function ($location) {\n\n        //default href for \"home\" link in header__menu\n        //uses 'goHome' to avoid angular-route issues with empty hash not \n        // triggering a page reload. Relies upon the \"otherwise\" condition\n        // being configured inside a routeProvider within the application.\n        var homeLink = 'goHome';\n\n        function update($element) {\n\n            var path = $location.path();\n\n            if (path === '/' || path === '/#' || path === '/#/') path = homeLink;\n\n            if (path[0] === '/') path = path.substring(1);\n\n            var menu = $element;\n            menu.find('li.active').removeClass('active');\n\n            var link = menu.find('li > a[href=\"#/' + path + '\"]');\n            if (link.length) {\n                //check if link is within a dropdown in the header menu\n                var dd = link.closest('.dropdown-menu');\n                if (dd.length) {\n                    //find next ancestor that is a list element and mark it active\n                    dd.closest('li').addClass('active');\n                } else {\n                    //not in a dropdown, mark this link active\n                    link.parent().addClass('active');\n                }\n            }\n\n            menu.find('li > a').each(function (i, a) {\n                var $a = $(a),\n                    href = $a.attr('href');\n                if (!href) return;\n                href = href.replace('#/', '');\n                if (path.indexOf(href) === 0) $a.parent().addClass('active');\n            });\n        }\n\n        return {\n            scope: {\n                homeHref: '@'\n            },\n            restrict: \"A\",\n\n            controller: function controller($rootScope, $scope, $element) {\n                if ($scope.homeHref) homeLink = $scope.homeHref;\n            },\n\n            link: function link($scope, $element) {\n\n                update($element);\n\n                $scope.$root.$on('$locationChangeSuccess', function () {\n                    update($element);\n                });\n            }\n        };\n    }])\n\n    /**\n     *\n     * Usage: \n     *\n     *    <div ng-cloak gp-flex-header show-home-link=\"true\" brand=\"Application Name\">\n     *      <li><a>Menu Item</a></li>\n     *      <li><a>Menu Item</a></li>\n     *      <li><a>Menu Item</a></li>\n     *      <li><a>Menu Item</a></li>\n     *    </div>\n     *\n     */\n    .directive('gpFlexHeader', ['GPConfig', 'AuthenticationService', function (Config, AuthenticationService) {\n\n        return {\n\n            scope: {\n                brand: \"@\",\n                showHomeLink: \"@\"\n            },\n            restrict: \"AE\",\n            transclude: true,\n            replace: true,\n            template: \"\\n                <header>\\n                    <h4 class=\\\"brand\\\">\\n                        <a href=\\\"{{portalUrl}}\\\" title=\\\"Go to the GeoPlatform Home Page\\\">\\n                            <span class=\\\"icon-gp\\\"></span>\\n                            <span class=\\\"hidden-xs\\\">GeoPlatform</span>\\n                        </a>\\n                        {{brand}}\\n                    </h4>\\n                    <ul role=\\\"menu\\\" class=\\\"header__menu\\\" gp-header-menu>\\n                        <li ng-if=\\\"showHomeLink\\\">\\n                            <a href=\\\"/\\\">\\n                                <span class=\\\"glyphicon glyphicon-home\\\"></span> \\n                                <span class=\\\"hidden-xs hidden-sm\\\">Home</span>\\n                            </a>\\n                        </li>\\n                        <div class=\\\"transcluded\\\"></div>\\n                        <li><span gp-login-button></span></li>\\n                    </ul>\\n                </header>\\n            \",\n\n            link: function link($scope, $element, $attrs, ctrl, transcludeFn) {\n\n                $scope.showHomeLink = $scope.showHomeLink === 'true' || false;\n\n                $scope.portalUrl = Config.portalUrl;\n\n                AuthenticationService.getUserQ().then(function (user) {\n                    $scope.user = user;\n                });\n\n                $element.find('.transcluded').replaceWith(transcludeFn());\n            }\n\n        };\n    }]);\n})(jQuery, angular);\n\n(function (angular) {\n\n    \"use strict\";\n\n    angular.module('gp-common').directive('iframeOnload', function () {\n        return {\n            scope: {\n                callback: '&iframeOnload'\n            },\n            link: function link(scope, element, attrs) {\n                element.on('load', function (event) {\n                    element.off('load');\n                    return scope.callback(event);\n                });\n            }\n        };\n    });\n})(angular);\n(function (angular, Constants) {\n\n    \"use strict\";\n\n    angular.module(\"gp-common\").directive('onImgFail', function () {\n        return {\n            restrict: \"A\",\n            link: function link($scope, $element, $attrs) {\n                var jqEl = jQuery($element);\n                jqEl.on('error', function () {\n                    jqEl.off('error');\n                    jqEl.attr('src', $attrs.onImgFail);\n                });\n            }\n        };\n    }).directive('mapThumbnail', [function () {\n        return {\n            restrict: \"A\",\n            scope: {\n                mapThumbnail: '='\n            },\n            link: function link($scope, $element, $attrs) {\n\n                var map = $scope.mapThumbnail;\n\n                if (map.$promise && !map.$resolved) {\n\n                    map.$promise.then(function (m) {\n                        if (typeof m.thumbnail === 'string') //old map model\n                            $element.attr('src', getUrl(m));else buildThumbnail(m); //open map model\n                    }).catch(function (e) {\n                        $element.attr('src', null);\n                    });\n                } else {\n                    if (typeof map.thumbnail === 'string') //old map model\n                        $element.attr('src', getUrl(map));else buildThumbnail(map);\n                }\n\n                function buildThumbnail(map) {\n                    if (!map.thumbnail) {\n                        $element.attr('src', null);\n                    } else if (map.thumbnail.contentData) {\n\n                        var style = 'background-size:contain;' + 'background-repeat:no-repeat;' + 'background-image: url(data:' + (map.thumbnail.mediaType || 'image/png') + ';base64,' + map.thumbnail.contentData + ');';\n\n                        //if directive is on a responsive item (aka, in a gp-ui-card), \n                        // ignore thumbnail dimensions. Otherwise, use them\n                        if ($element.attr('class').indexOf('embed-responsive-item') < 0) {\n                            style += 'width:' + (map.thumbnail.width || '32') + 'px;' + 'height:' + (map.thumbnail.height || '32') + 'px;';\n                        }\n\n                        $element.attr('style', style);\n                    } else if (map.thumbnail.url) {\n                        $element.attr('src', map.thumbnail.url);\n                    } else $element.attr('src', null);\n                }\n\n                function getUrl(map) {\n                    var url = map.thumbnail;\n                    if (!url || !url.length) url = Constants.ualUrl + '/api/maps/' + map.id + '/thumbnail';else if (url.indexOf(\"http\") !== 0) {\n                        if (url[0] !== '/') url = Constants.ualUrl + '/' + url;else url = Constants.ualUrl + url;\n                    }\n                    return url;\n                }\n            }\n        };\n    }]).directive('itemThumbnail', ['$q', function ($q) {\n        return {\n            restrict: \"E\",\n            replace: true,\n            scope: {\n                item: '=',\n                fallback: '@',\n                link: '@'\n            },\n            template: \"\\n                <a ng-show=\\\"hasThumbnail\\\" class=\\\"media embed-responsive embed-responsive-16by9\\\">\\n                    <img class=\\\"embed-responsive-item\\\" on-img-error=\\\"{{fallback||'/img/img-404.jpg'}}\\\">\\n                </a>\\n            \",\n            controller: function controller($scope) {\n                $scope.elName = 'div';\n\n                $scope.isLink = !!$scope.link;\n                if ($scope.isLink) {\n                    $scope.elName = 'a';\n                }\n            },\n            link: function link($scope, $element, $attrs) {\n\n                var item = $scope.item;\n                (item.$promise || $q.resolve(item)).then(function (obj) {\n\n                    var url = $scope.fallback;\n\n                    //maps\n                    if (obj.type && obj.type === 'Map') url = Constants.ualUrl + \"/api/maps/\" + obj.id + \"/thumbnail\";\n                    //maps as gallery items\n                    else if (obj.assetType && obj.assetType === 'Map') url = Constants.ualUrl + \"/api/maps/\" + obj.assetId + \"/thumbnail\";\n                        //other thumbnail'ed items with URLs\n                        else if (obj.thumbnail && obj.thumbnail.url) url = obj.thumbnail.url;\n                            //other thumbnail'ed items with base64 content\n                            else if (obj.thumbnail && obj.thumbnail.contentData) {\n\n                                    var style = 'background-size:contain;' + 'background-repeat:no-repeat;' + 'background-image: url(data:' + (obj.thumbnail.mediaType || 'image/png') + ';base64,' + obj.thumbnail.contentData + ');';\n\n                                    //if directive is on a responsive item (aka, in a gp-ui-card), \n                                    // ignore thumbnail dimensions. Otherwise, use them\n                                    if ($element.attr('class').indexOf('embed-responsive-item') < 0) {\n                                        style += 'width:' + (obj.thumbnail.width || '32') + 'px;' + 'height:' + (obj.thumbnail.height || '32') + 'px;';\n                                    }\n\n                                    $element.find('img').attr('style', style);\n                                }\n\n                    $scope.hasThumbnail = !!url;\n                    $element.find('img').attr('src', url);\n\n                    if ($scope.isLink) {\n                        //$element is a.media because of 'replace:true'\n                        $element.attr('href', $scope.link).attr('target', '_blank');\n                    }\n                }).catch(function (e) {\n                    $element.find('img').attr('src', $scope.fallback);\n                });\n            }\n        };\n    }]);\n})(angular, GeoPlatform);\n(function (angular) {\n\n    \"use strict\";\n\n    angular.module('gp-common')\n\n    //\n    .service('NotificationService', ['$rootScope', function ($rootScope) {\n        var Service = function Service() {\n            this.items = [];\n        };\n        Service.prototype = {\n            getItems: function getItems() {\n                return this.items;\n            },\n            /**\n             * @param item object\n             * @return function to cancel the notification\n             */\n            addItem: function addItem(item) {\n                this.items.push(item);\n                $rootScope.$broadcast('gp:notifications:new', item);\n\n                var fn = function fn(item) {\n                    this.removeItem(item);\n                };\n                return fn.bind(this, item);\n            },\n            removeItem: function removeItem(item) {\n                var index = this.items.indexOf(item);\n                if (index >= 0) return this.items.splice(index, 1);\n                return null;\n            },\n            error: function error(label, msg, dismiss) {\n                return this.addItem({ type: 'error', label: label, message: msg, canDismiss: dismiss });\n            },\n            success: function success(label, msg, dismiss) {\n                return this.addItem({ type: 'success', label: label, message: msg, canDismiss: dismiss });\n            },\n            info: function info(label, msg, dismiss) {\n                return this.addItem({ type: 'info', label: label, message: msg, canDismiss: dismiss });\n            }\n        };\n        return new Service();\n    }])\n\n    // Usage: <gp-notifications />\n    .directive('gpNotifications', ['$timeout', 'NotificationService', function ($timeout, NotificationService) {\n        return {\n            scope: {\n                expiration: '@'\n            },\n            template: ['<div class=\"notifications ng-hide\" ng-show=\"items.length\">', '  <div class=\"notification\" ng-repeat=\"item in items\"', '    ng-class=\"{\\'notification--success\\':item.type===\\'success\\', \\'notification--error\\':item.type===\\'error\\', \\'notification--info\\':item.type===\\'info\\'}\">', '    <h5 class=\"notification__title\">', '        <span class=\"pull-right glyphicon\" ', '            ng-class=\"{\\'glyphicon-ok-sign\\':item.type===\\'success\\',\\'glyphicon-exclamation-sign\\':item.type===\\'error\\',\\'glyphicon-info-sign\\':item.type===\\'info\\'}\">', '        </span>', '        {{item.label}}', '    </h5>', '    <p class=\"notification__content\" ng-bind-html=\"item.message\"></p>', '    <div class=\"notification__actions\" ng-if=\"item.canDismiss\">', '        <button type=\"button\" class=\"btn btn-link\" ng-click=\"dismiss(item)\">dismiss</button>', '    </div>', '  </div>', '</div>'].join(' '),\n\n            link: function link($scope, $element, $attrs) {\n\n                $scope.expiration = ($scope.expiration || 2000) * 1;\n\n                $scope.items = [];\n\n                function update() {\n                    $scope.items = NotificationService.getItems();\n\n                    //if updated before timer expired, reset timer\n                    if ($scope.timer) {\n                        $timeout.cancel($scope.timer);\n                        $scope.timer = null;\n                    }\n\n                    //set timer to kill earliest item after time\n                    $scope.timer = $timeout(function () {\n                        $scope.timer = null;\n                        //will ultimately call update() and thus trigger timeout again\n                        $scope.removeOldest();\n                    }, $scope.expiration);\n                }\n                update();\n\n                $scope.removeOldest = function () {\n                    //find oldest that can be removed\n                    var oldest = $scope.items.find(function (item) {\n                        return item.canDismiss;\n                    });\n                    if (oldest) NotificationService.removeItem(oldest);\n                };\n\n                $scope.dismiss = function (item) {\n                    //remove item using service\n                    NotificationService.removeItem(item);\n                };\n\n                $scope.$watchCollection(function () {\n                    return NotificationService.getItems();\n                }, update);\n\n                // $scope.$on('gp:notifications:new', function(event, item) { update(); });\n            }\n        };\n    }]);\n})(angular);\n(function (jQuery, angular) {\n\n    \"use strict\";\n\n    /*\n     * Usage:\n     * \n     *      <gp-pagination service=\"$ctrl.service\" event-key=\"maps\"></gp-pagination>\n     *\n     *  Expects a BrowseObjService instance for the 'service' binding, or at least \n     * one that provides the same pagination and options API.\n     */\n\n    /**\n     * Requires a service which exposes the following methods:\n     *   - getPagination() : returns {object} defining 'start', 'size', and 'total'\n     *   - start(int) : takes {int} defining which index to start requesting\n     *   - size(int) : takes {int} defining how many items to request\n     *   - on(eventName, listener) : must support event \"gp:browse:<key>:pagination\" where 'key' may be 'objects' or a custom key\n     */\n\n    var PaginationController = function () {\n        function PaginationController() {\n            'ngInject';\n\n            _classCallCheck(this, PaginationController);\n        }\n\n        _createClass(PaginationController, [{\n            key: \"$onInit\",\n            value: function $onInit() {\n                var _this = this;\n\n                if (!this.service) return;\n\n                this.options = this.service.getPagination();\n\n                //support using a traditional select instead of a uib dropdown menu\n                // in case the pagination control itself is wrapped in a dropdown menu.\n                //in this case, we use objects with labels and values in order to display\n                // the 'per page' text along with whatever the page size is.\n\n                this.pageSizeDropdown = true;\n                this.useSelect = typeof this.useSelect !== 'undefined' && (this.useSelect === true || this.useSelect === 'true' || this.useSelect === 1);\n                if (this.useSelect) {\n                    this.pageSizeDropdown = false;\n                    this.pageSize = this.options.size;\n                    this.pageSizeOptions = (this.options.sizeOptions || [5, 10, 20, 50]).map(function (o) {\n                        return { label: o + ' per page', value: o };\n                    });\n                }\n\n                var event = 'gp:browse:';\n                if (this.eventKey) event = 'gp:browse:' + this.eventKey + \":\";else event = 'gp:browse:objects:';\n\n                this.listener = this.service.on(event + 'pagination', function () {\n                    _this.options = _this.service.getPagination();\n                });\n            }\n        }, {\n            key: \"$onDestroy\",\n            value: function $onDestroy() {\n\n                //remove listener from service if exists\n                if (this.listener) this.listener();\n\n                this.service = null;\n            }\n        }, {\n            key: \"previous\",\n            value: function previous() {\n                if (this.service && this.hasPrevious()) {\n                    this.service.start(Math.max(0, this.options.start * 1 - this.options.size * 1), true);\n                }\n            }\n        }, {\n            key: \"next\",\n            value: function next() {\n                if (this.service && this.hasNext()) {\n                    this.service.start(Math.min(this.options.total, this.options.start * 1 + this.options.size * 1), true);\n                }\n            }\n        }, {\n            key: \"first\",\n            value: function first() {\n                if (this.service && this.hasPrevious()) {\n                    this.service.start(0, true);\n                }\n            }\n        }, {\n            key: \"last\",\n            value: function last() {\n                if (this.service && this.hasNext()) {\n                    var lastPage = Math.floor(this.options.total / this.options.size);\n                    this.setPage(lastPage);\n                }\n            }\n        }, {\n            key: \"setPage\",\n            value: function setPage(arg) {\n                if (this.service) {\n                    var page = arg * 1;\n                    this.service.start(page * (this.options.size * 1), true);\n                }\n            }\n        }, {\n            key: \"setPageSize\",\n            value: function setPageSize(size) {\n                if (this.service) {\n                    this.service.size(size * 1, true);\n                }\n            }\n        }, {\n            key: \"hasPrevious\",\n            value: function hasPrevious() {\n                return this.options && this.options.start > 0;\n            }\n        }, {\n            key: \"hasNext\",\n            value: function hasNext() {\n                return this.options && this.options.start + this.options.size < this.options.total;\n            }\n        }]);\n\n        return PaginationController;\n    }();\n\n    angular.module('gp-common').component('gpPagination', {\n\n        bindings: {\n            service: '=',\n            eventKey: '@',\n            useSelect: '@'\n        },\n\n        controller: PaginationController,\n\n        template: \"\\n            <div class=\\\"c-pagination\\\">\\n                <div class=\\\"c-pagination__total\\\">{{$ctrl.options.total||0}} results</div>\\n                <div class=\\\"c-pagination__page-size\\\" ng-if=\\\"$ctrl.pageSizeDropdown\\\">\\n                    <span uib-dropdown>\\n                        <a href=\\\"\\\" uib-dropdown-toggle title=\\\"Change the number of results returned\\\">\\n                            {{$ctrl.options.size}} per page <span class=\\\"caret\\\"></span>\\n                        </a>\\n                        <ul class=\\\"dropdown-menu\\\" role=\\\"menu\\\">\\n                            <li ng-repeat=\\\"size in $ctrl.options.sizeOptions track by $index\\\">\\n                                <a ng-click=\\\"$ctrl.setPageSize(size)\\\">{{size}} per page</a>\\n                            </li>\\n                        </ul>\\n                    </span>\\n                </div>\\n                <div class=\\\"c-pagination__page-size\\\" ng-if=\\\"!$ctrl.pageSizeDropdown\\\">\\n                    <select class=\\\"form-control\\\" \\n                        ng-model=\\\"$ctrl.pageSize\\\" ng-change=\\\"$ctrl.setPageSize($ctrl.pageSize)\\\"\\n                        ng-options=\\\"opt.value as opt.label for opt in $ctrl.pageSizeOptions\\\">\\n                    </select>\\n                </div>\\n                <div class=\\\"c-pagination__pages\\\">\\n                    <div class=\\\"c-pagination__button\\\" \\n                        ng-class=\\\"{'is-disabled':!$ctrl.hasPrevious()}\\\"\\n                        ng-click=\\\"$ctrl.first()\\\">\\n                        <span class=\\\"glyphicon glyphicon-fast-backward\\\"></span>\\n                    </div>\\n                    <div class=\\\"c-pagination__button\\\" \\n                        ng-class=\\\"{'is-disabled':!$ctrl.hasPrevious()}\\\"\\n                        ng-click=\\\"$ctrl.previous()\\\">\\n                        <span class=\\\"glyphicon glyphicon-backward\\\"></span>\\n                    </div>\\n                    <div class=\\\"c-pagination__page\\\">\\n                        {{$ctrl.options.start+1}} - {{$ctrl.options.start+$ctrl.options.size}}\\n                    </div>\\n                    <div class=\\\"c-pagination__button\\\" \\n                        ng-class=\\\"{'is-disabled':!$ctrl.hasNext()}\\\"\\n                        ng-click=\\\"$ctrl.next()\\\">\\n                        <span class=\\\"glyphicon glyphicon-forward\\\"></span>\\n                    </div>\\n                    <div class=\\\"c-pagination__button\\\" \\n                        ng-class=\\\"{'is-disabled':!$ctrl.hasNext()}\\\"\\n                        ng-click=\\\"$ctrl.last()\\\">\\n                        <span class=\\\"glyphicon glyphicon-fast-forward\\\"></span>\\n                    </div>\\n                </div>\\n            </div>\\n        \"\n\n    });\n})(jQuery, angular);\n(function (angular) {\n\n    \"use strict\";\n\n    /**\n     * Usage: \n     *  <gp-progress-circle ng-model=\"$ctrl.amount\"></gp-progress-circle>\n     */\n\n    angular.module('gp-common').component('gpProgressCircle', {\n\n        bindings: {\n            ngModel: '<' //amount out of 100\n        },\n\n        controller: function controller() {\n\n            this.$onInit = function () {\n                this.dashArray = 2 * Math.PI * 45 /*radius*/;\n                if (!this.ngModel) this.ngModel = 0;\n                this.update();\n            };\n\n            this.$onChanges = function (changes) {\n                if (changes.ngModel) this.update();\n            };\n\n            this.update = function () {\n                var offset = 2 * Math.PI * 45 * (1 - this.ngModel / 100);\n                this.value = offset;\n            };\n        },\n\n        template: \"\\n            <svg class=\\\"c-progress--circle\\\" viewBox=\\\"0 0 100 100\\\">\\n                <circle class=\\\"c-progress__meter\\\" cx=\\\"50\\\" cy=\\\"50\\\" r=\\\"45\\\" stroke-width=\\\"10\\\" />\\n                <circle class=\\\"c-progress__value\\\" cx=\\\"50\\\" cy=\\\"50\\\" r=\\\"45\\\" stroke-width=\\\"10\\\" \\n                    stroke-dasharray=\\\"{{$ctrl.dashArray}}\\\" stroke-dashoffset=\\\"{{$ctrl.value}}\\\"/>\\n                <text class=\\\"c-progress__label\\\" x=\\\"50\\\" y=\\\"-40\\\" text-anchor=\\\"middle\\\">{{$ctrl.ngModel}}%</text>\\n            </svg>\\n        \"\n    });\n})(angular);\n(function (jQuery, angular) {\n\n    \"use strict\";\n\n    angular.module('gp-common')\n\n    //helper to determine size of window for responsive breakpoint purposes\n    .provider('responsiveHelper', [\"$windowProvider\", function ($windowProvider) {\n\n        var $window = $windowProvider.$get();\n\n        function Helper($window) {\n            this.window = $window;\n        }\n        Helper.prototype = {\n            getWidth: function getWidth() {\n                return $window.innerWidth || $window.outerWidth;\n            },\n            isXS: function isXS() {\n                var width = this.getWidth();return width < 768;\n            },\n            isSM: function isSM() {\n                var width = this.getWidth();return width >= 768 && width < 992;\n            },\n            isMD: function isMD() {\n                var width = this.getWidth();return width >= 992 && width < 1200;\n            },\n            isLG: function isLG() {\n                var width = this.getWidth();return width >= 1200;\n            }\n        };\n\n        var helper = new Helper($window);\n\n        this.$get = function () {\n            return helper;\n        };\n    }])\n\n    //directive which appends appropriate responsive breakpoint classNames to the element\n    // on which it's set\n    .directive('gpResponsive', ['$window', 'responsiveHelper', function ($window, responsiveHelper) {\n\n        return {\n            restrict: \"A\",\n            link: function link($scope, $element, $attrs) {\n\n                function update(el, helper) {\n                    if (helper.isXS()) el.addClass('gp-responsive-xs');else el.removeClass('gp-responsive-xs');\n\n                    if (helper.isSM()) el.addClass('gp-responsive-sm');else el.removeClass('gp-responsive-sm');\n\n                    if (helper.isMD()) el.addClass('gp-responsive-md');else el.removeClass('gp-responsive-md');\n\n                    if (helper.isLG()) el.addClass('gp-responsive-lg');else el.removeClass('gp-responsive-lg');\n                }\n\n                update($element, responsiveHelper);\n\n                var resizeFn = function resizeFn() {\n                    update($element, responsiveHelper);\n                };\n\n                var w = angular.element($window);\n                var listener = w.on('resize', resizeFn);\n\n                $scope.$on('$destroy', function () {\n                    w.off('resize', resizeFn);\n                });\n            }\n        };\n    }]).directive('gpResize', function ($window, $timeout) {\n        return function ($scope, $element, $attr) {\n\n            var resizeFn = function resizeFn() {\n                var hh = jQuery('header')[0].offsetHeight;\n                // var fh = jQuery('footer')[0].offsetHeight;\n                // console.log('hh & fh', hh, fh);                    \n\n                var tp = hh + 2;\n                // var bt = fh + 2;\n                // console.log('tp & bt', tp, bt);                \n\n                var changes = {\n                    // bottom: bt + 'px',\n                    top: tp + 'px'\n                };\n                $element.css(changes);\n                $scope.$apply();\n            };\n\n            var w = angular.element($window);\n            w.on('resize', resizeFn);\n\n            $timeout(resizeFn, 200);\n\n            $scope.$on('$destroy', function () {\n                w.off('resize', resizeFn);\n            });\n        };\n    });\n})(jQuery, angular);\n(function (jQuery, angular) {\n\n    \"use strict\";\n\n    function inputLinkFunction($scope, $element, $attrs, ngModelController, $timeout) {\n\n        if (!$scope.type) $scope.type = \"text\";\n        if ($scope.required === 'true') $scope.required = true;else $scope.required = false;\n\n        $scope.elId = 'input_' + Math.ceil(Math.random() * 9999);\n        $scope.size = $scope.size || 'medium';\n        $scope.type = $scope.type || 'text';\n\n        //listen for changes to the inner value by way of the form-control\n        $element.find('.form-control').on('change', function onChange() {\n            validate($scope.innerValue);\n        });\n\n        /* ------------- private methods --------------- */\n\n        function validate() {\n\n            //check form-control for ng-invalid\n            var input = $element.find('.form-control');\n\n            $scope.isDirty = input.hasClass('ng-dirty');\n\n            if (input.hasClass('ng-invalid')) {\n                if (input.hasClass(\"ng-empty\")) $scope.error = \"This field requires a value\";else $scope.error = \"Invalid value provided\";\n            } else $scope.error = null;\n        }\n\n        function update(newValue) {\n            // call $parsers pipeline then update $modelValue\n            ngModelController.$setViewValue(newValue);\n            // update the local view\n            ngModelController.$render();\n        }\n\n        // when model change, update our view (just update the div content)\n        ngModelController.$render = function () {\n\n            var value = ngModelController.$viewValue;\n\n            //create copy of passed in model value that can be used\n            // by the controls here allowing us to cancel and \n            // commit changes at our own leisure\n            $scope.innerValue = value;\n\n            $scope.displayValue = value || $scope.placeholder || \"No value provided\";\n\n            validate(value);\n        };\n\n        /* ------------- private methods --------------- */\n\n        $scope.isReadOnly = function () {\n            var t = _typeof(this.readOnly);\n            if (t === 'undefined') return false;\n            if (t === 'string') return this.readOnly.toLowerCase() === 'true';\n            if (t === 'number') return this.readOnly === 1;\n            if (t === 'boolean') return this.readOnly;\n            return false;\n        };\n\n        //enter edit mode\n        $scope.edit = function () {\n            if ($scope.isReadOnly()) return;\n            $scope.editing = true;\n            //auto-focus on form-control when entering edit mode\n            $timeout(function () {\n                $element.find('.form-control').focus().select();\n            }, 200);\n        };\n        //leave edit mode (regardless of save() or cancel())\n        $scope.done = function () {\n            $scope.editing = false;\n            $scope.error = null;\n        };\n\n        $scope.save = function () {\n            //update display with new value\n            update($scope.innerValue);\n            $scope.done();\n        };\n        $scope.cancel = function () {\n            //reset inner value\n            $scope.innerValue = ngModelController.$viewValue;\n            $scope.done();\n        };\n\n        $scope.onKeyPress = function ($event, code) {\n            // console.log(\"Pressed \" + code);\n            if ((code === undefined || code === 0) && $event.which !== undefined) code = $event.which;\n            if ($scope.type === 'number') {\n\n                //NOTE: Chrome does not catch Backspace onKeyPress, so it \n                // skips this handler. FF does, so we need to watch for \n                // backspace, delete, and numbers\n\n                if (code === 8 || //backspace\n                code === 46 || //delete  \n                code >= 44 && code <= 57) //comma, hyphen, period and numbers (0-9)\n                    return;\n\n                //NOTE: keyPress period is 46. keyDown it is 190\n\n                $event.preventDefault();\n                return false; //ignore key\n            }\n        };\n        $scope.onKeyUp = function ($event, code) {\n            // console.log(\"Up \" + code);\n            if ((code === undefined || code === 0) && $event.which !== undefined) code = $event.which;\n            if (code === 13 && !$scope.error) $scope.done(); //enter\n            else if (code === 27) $scope.cancel(); //esc\n                else {\n\n                        if (code !== 8 && //backspace\n                        code !== 46 && //delete\n                        code !== 190 && ( //period\n                        code < 48 || code > 90) && ( //letters and numbers (a-z, 0-9)\n                        code < 106 || code > 111) && code < 186) return;\n\n                        validate();\n                    }\n        };\n\n        $scope.$destroy = function () {\n            $element.off('change');\n        };\n    }\n\n    angular.module(\"gp-common\").directive('gpSlickFormInput', ['$timeout', function ($timeout) {\n\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                placeholder: '@',\n                help: '=',\n                // validator: '&',\n                // validationExpr: '@',\n                type: '@',\n                pattern: \"@\",\n                required: '@',\n                readOnly: '@',\n                size: '@',\n                icon: '@'\n            },\n            template: INPUT_TEMPLATE,\n            link: function link($scope, $element, $attrs, ngModelController) {\n                inputLinkFunction($scope, $element, $attrs, ngModelController, $timeout);\n            }\n        };\n    }]).directive('gpSlickFormTextarea', ['$timeout', function ($timeout) {\n\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                placeholder: '@',\n                help: \"@\",\n                readOnly: \"@\",\n                size: \"@\",\n                icon: \"@\"\n            },\n            template: TEXTAREA_TEMPLATE,\n            link: function link($scope, $element, $attrs, ngModelController) {\n                inputLinkFunction($scope, $element, $attrs, ngModelController, $timeout);\n            }\n        };\n    }])\n\n    /**\n     *\n     * Notes:\n     *  - use 'form form-inline' classes for editable date so the field doesn't take up whole line\n     */\n    .directive('gpSlickFormDate', ['$timeout', '$filter', function ($timeout, $filter) {\n\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                format: \"@\",\n                placeholder: '@',\n                required: \"@\",\n                readOnly: \"@\",\n                size: '@',\n                icon: '@'\n            },\n            template: DATE_TEMPLATE,\n\n            controller: function controller($scope, $element) {\n                if (!$scope.format || $scope.format.length < 3) $scope.format = \"mediumDate\";\n                $scope.inline = $element.hasClass(\"inline\");\n            },\n\n            /**\n             *\n             */\n            link: function link($scope, $element, $attrs, ngModelController) {\n\n                if ($scope.required === 'true') $scope.required = true;else $scope.required = false;\n\n                $scope.elId = 'input_' + Math.ceil(Math.random() * 9999);\n                $scope.size = $scope.size || 'medium';\n                $scope.type = $scope.type || 'text';\n\n                function validate(value) {\n                    // console.log(\"Validating '\" + value + \"'\");\n\n                    //check form-control for ng-invalid\n                    var input = $element.find('.form-control');\n                    if (input.hasClass('ng-invalid')) {\n                        if (input.hasClass(\"ng-empty\")) $scope.error = \"This field requires a value\";else $scope.error = \"Invalid value provided\";\n                    } else $scope.error = null;\n                }\n\n                function update(newValue) {\n                    // call $parsers pipeline then update $modelValue\n                    ngModelController.$setViewValue(newValue);\n                    // update the local view\n                    ngModelController.$render();\n                }\n\n                // when model change, update our view (just update the div content)\n                ngModelController.$render = function () {\n\n                    var value = ngModelController.$viewValue;\n\n                    //create copy of passed in model value that can be used\n                    // by the controls here allowing us to cancel and \n                    // commit changes at our own leisure\n                    $scope.innerValue = value;\n\n                    $scope.displayValue = value ? $filter('date')(ngModelController.$modelValue, $scope.format) : $scope.placeholder || \"No value provided\";\n\n                    validate(value);\n                };\n\n                $scope.isReadOnly = function () {\n                    var t = _typeof(this.readOnly);\n                    if (t === 'undefined') return false;\n                    if (t === 'string') return this.readOnly.toLowerCase() === 'true';\n                    if (t === 'number') return this.readOnly === 1;\n                    if (t === 'boolean') return this.readOnly;\n                    return false;\n                };\n\n                //enter edit mode\n                $scope.edit = function () {\n                    if ($scope.isReadOnly()) return;\n\n                    $scope.editing = true;\n\n                    //auto-focus on form-control when entering edit mode\n                    // $timeout(function() { $element.find('.form-control').focus().select(); }, 200);\n                };\n                //leave edit mode (regardless of save() or cancel())\n                $scope.done = function () {\n                    $scope.opened = false;\n                    $scope.editing = false;\n                    $scope.error = null;\n                };\n\n                $scope.save = function () {\n                    //update display with new value\n                    update($scope.innerValue);\n                    $scope.done();\n                };\n                $scope.cancel = function () {\n                    //reset inner value\n                    $scope.innerValue = angular.copy(ngModelController.$modelValue);\n                    $scope.done();\n                };\n\n                $scope.open = function () {\n                    //must wrap 'opened' variable in an object for \n                    // angular to properly track its value changes\n                    // from within children scope (ie, the date picker)\n                    if (typeof $scope.uibopts === 'undefined') {\n                        $scope.uibopts = {};\n                    }\n                    $scope.uibopts.opened = true;\n                };\n\n                $scope.onKeyUp = function (code) {\n                    if (code === 13) {\n                        //enter\n                        $scope.done();\n                    } else if (code === 27) {\n                        //esc\n                        $scope.cancel();\n                    }\n                };\n                $scope.onChange = function (date) {\n                    if (isNaN(ngModelController.$modelValue) && $scope.required) {\n                        $scope.error = \"This field requires a value\";\n                    } else $scope.error = null;\n                };\n            }\n        };\n    }]).directive('gpSlickFormSelect', ['$timeout', function ($timeout) {\n\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                codeList: \"=\",\n                help: '=',\n                required: \"@\",\n                readOnly: \"@\",\n                size: '@',\n                icon: '@'\n            },\n            template: SELECT_TEMPLATE,\n            link: function link($scope, $element, $attrs, ngModelController) {\n\n                if (!$scope.type) $scope.type = \"text\";\n                if ($scope.required === 'true') $scope.required = true;else $scope.required = false;\n\n                $scope.elId = 'input_' + Math.ceil(Math.random() * 9999);\n                $scope.size = $scope.size || 'medium';\n                $scope.type = $scope.type || 'text';\n\n                var $select = null;\n\n                function getSelect() {\n                    if (!$select || !$select.length) $select = $element.find('.form-control');\n                    return $select;\n                }\n\n                if ($scope.codeList) {\n                    $scope.selectOptions = $scope.codeList.map(function (item) {\n                        if ((typeof item === \"undefined\" ? \"undefined\" : _typeof(item)) !== 'object' || !item.value) return { value: item, label: item };else if (!item.label) return { value: item.value, label: item.value };\n                        return item;\n                    });\n                } else $scope.selectOptions = [];\n\n                //listen for changes to the inner value by way of the form-control\n                // $element.find('.form-control').on('change', function onChange() { \n                //     validate($scope.innerValue); \n                // });\n\n\n                /* ------------- private methods --------------- */\n\n                function validate() {\n\n                    //check form-control for ng-invalid\n                    var select = getSelect();\n\n                    $scope.isDirty = select.hasClass('ng-dirty');\n\n                    if (select.hasClass('ng-invalid')) {\n                        if (select.hasClass(\"ng-empty\")) $scope.error = \"This field requires a value\";else $scope.error = \"Invalid value provided\";\n                    } else $scope.error = null;\n                }\n\n                function update(newValue) {\n                    // call $parsers pipeline then update $modelValue\n                    ngModelController.$setViewValue(newValue);\n                    // update the local view\n                    ngModelController.$render();\n                }\n\n                // when model change, update our view (just update the div content)\n                ngModelController.$render = function () {\n\n                    var value = ngModelController.$viewValue;\n\n                    //@see https://github.com/angular/angular.js/commit/7fda214c4f65a6a06b25cf5d5aff013a364e9cef\n\n                    //create copy of passed in model value that can be used\n                    // by the controls here allowing us to cancel and \n                    // commit changes at our own leisure\n                    $scope.innerValue = value;\n\n                    $scope.displayValue = $scope.placeholder || \"No value provided\";\n\n                    if (value) {\n                        //values are objects, not literals\n                        var opt = $scope.selectOptions.find(function (o) {\n                            return o.value == value;\n                        });\n                        $scope.displayValue = opt.label;\n                    }\n\n                    validate();\n                };\n\n                /* ------------- private methods --------------- */\n\n                $scope.onChange = function (value) {\n\n                    // console.log(\"Changing value \" + value + \" vs \" + $scope.innerValue);\n                    $scope.innerValue = value;\n                    $timeout(function () {\n                        validate();\n                    }, 200);\n                };\n\n                $scope.onTypeaheadSelection = function ($item, $model, $label, $event) {\n\n                    $scope.innerValue = $item ? $item.value : null;\n                    $timeout(function () {\n                        validate();\n                    }, 200);\n                };\n\n                $scope.isReadOnly = function () {\n                    var t = _typeof(this.readOnly);\n                    if (t === 'undefined') return false;\n                    if (t === 'string') return this.readOnly.toLowerCase() === 'true';\n                    if (t === 'number') return this.readOnly === 1;\n                    if (t === 'boolean') return this.readOnly;\n                    return false;\n                };\n\n                //enter edit mode\n                $scope.edit = function () {\n                    if ($scope.isReadOnly()) return;\n                    $scope.editing = true;\n                    //auto-focus on form-control when entering edit mode\n                    $timeout(function () {\n                        $select.focus().select();\n                    }, 200);\n                };\n                //leave edit mode (regardless of save() or cancel())\n                $scope.done = function () {\n                    $scope.editing = false;\n                    $scope.error = null;\n                };\n\n                $scope.save = function () {\n                    //update display with new value\n                    update($scope.innerValue);\n                    $scope.done();\n                };\n                $scope.cancel = function () {\n                    //reset inner value\n                    $scope.innerValue = ngModelController.$viewValue;\n                    $scope.done();\n                };\n\n                $scope.onKeyUp = function (code) {\n                    if (code === 13 && !$scope.error) {\n                        //enter\n                        $scope.save();\n                    } else if (code === 27) {\n                        //esc\n                        $scope.cancel();\n                    }\n                };\n\n                $scope.onTypeaheadKeyUp = function (code) {\n                    validate();\n                };\n\n                $scope.$destroy = function () {\n                    // $element.off('change');\n                };\n            }\n        };\n    }]);\n\n    var INPUT_TEMPLATE = ['<div class=\"form-group form-group-slick\">', '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>', '   <div class=\"input__display\" ', '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error,\\'text-lg\\':size===\\'large\\'}\" ', '       ng-show=\"!editing\" ng-click=\"edit()\" ', '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">', '      {{displayValue}}', '   </div>', '   <div ng-show=\"editing\">', '      <div class=\"input-group\" ng-class=\"{\\'input-group-lg\\':size===\\'large\\'}\">', '           <div class=\"input-group-slick\" ng-class=\"{\\'input-group-slick--lg\\':size===\\'large\\'}\">', '               <span ng-if=\"icon\" class=\"{{::icon}}\"></span>', '               <input id=\"{{::elId}}\" type=\"{{::type}}\" class=\"form-control\" ', '                   pattern=\"{{pattern}}\" ', '                   ng-model=\"innerValue\" ', '                   ng-required=\"{{required}}\" ', '                   ng-keypress=\"onKeyPress($event, $event.keyCode)\" ', '                   ng-keyup=\"onKeyUp($event, $event.keyCode)\" >', '               <span class=\"indicators\">', '                   <span class=\"is-valid glyphicon glyphicon-ok-sign\"></span>', '                  <span class=\"is-invalid glyphicon glyphicon-exclamation-sign\"></span>', '              </span>', '           </div>', '          <span class=\"input-group-btn\">', '               <button type=\"button\" class=\"btn btn-default\" ', '                   ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"', '                   ng-click=\"cancel()\" title=\"Cancel changes\">', '                   <span class=\"glyphicon glyphicon-ban-circle\"></span>', '              </button>', '               <button type=\"button\" class=\"btn btn-default\" ', '                   ng-class=\"{disabled:!!error||!isDirty,\\'btn-lg\\':size===\\'large\\'}\"', '                   ng-disabled=\"{{!!error}}\" ', '                   ng-click=\"save()\" title=\"Save changes\">', '                  <span class=\"glyphicon glyphicon-ok\"></span>', '               </button>', '           </span>', '       </div>', '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>', '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>', '   </div>', '</div>'].join(' ');\n\n    var TEXTAREA_TEMPLATE = ['<div class=\"form-group form-group-slick\">', '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>', '   <div class=\"input__display\" ', '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error,\\'text-lg\\':size===\\'large\\'}\" ', '       ng-show=\"!editing\" ng-click=\"edit()\" ', '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">', '      {{displayValue}}', '   </div>', '   <div ng-show=\"editing\">', '      <div class=\"input-group\" ng-class=\"{\\'input-group-lg\\':size===\\'large\\'}\">', '           <div class=\"input-group-slick\" ng-class=\"{\\'input-group-slick--lg\\':size===\\'large\\'}\">', '               <span ng-if=\"icon\" class=\"{{::icon}}\"></span>', '               <textarea rows=\"3\" id=\"{{::elId}}\" class=\"form-control\" ', '                   ng-required=\"{{required}}\" ng-model=\"innerValue\"', '                   ng-keypress=\"onKeyPress($event, $event.keyCode)\" ', '                   ng-keyup=\"onKeyUp($event, $event.keyCode)\"></textarea>', '               <span class=\"indicators\">', '                   <span class=\"is-valid glyphicon glyphicon-ok-sign\"></span>', '                  <span class=\"is-invalid glyphicon glyphicon-exclamation-sign\"></span>', '              </span>', '           </div>', '          <span class=\"input-group-btn\">', '               <button type=\"button\" class=\"btn btn-default\" ', '                   ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"', '                   ng-click=\"cancel()\" title=\"Cancel changes\">', '                   <span class=\"glyphicon glyphicon-ban-circle\"></span>', '              </button>', '               <button type=\"button\" class=\"btn btn-default\" ', '                   ng-class=\"{disabled:!!error||!isDirty,\\'btn-lg\\':size===\\'large\\'}\"', '                   ng-disabled=\"{{!!error}}\" ', '                   ng-click=\"save()\" title=\"Save changes\">', '                  <span class=\"glyphicon glyphicon-ok\"></span>', '               </button>', '           </span>', '       </div>', '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>', '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>', '   </div>', '</div>'].join(' ');\n\n    var DATE_TEMPLATE = ['<div class=\"form-group form-group-slick\">', '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>', '   <div class=\"input__display\" ', '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error}\" ', '       ng-show=\"!editing\" ng-click=\"edit()\" ', '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">', '      {{displayValue}}', '   </div>', '   <div ng-show=\"editing\">', '       <div uib-datepicker ng-required=\"{{required}}\" ng-model=\"innerValue\" datepicker-options=\"{showWeeks:false}\"></div>', '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>', '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>', '       <button type=\"button\" class=\"btn btn-default\" ', '           ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"', '           ng-click=\"cancel()\" title=\"Cancel changes\">', '           <span class=\"glyphicon glyphicon-ban-circle\"></span>', '      </button>', '      <button type=\"button\" class=\"btn btn-default\" ', '           ng-class=\"{disabled:!!error,\\'btn-lg\\':size===\\'large\\'}\"', '          ng-disabled=\"{{!!error}}\" ', '           ng-click=\"save()\" title=\"Save changes\">', '           <span class=\"glyphicon glyphicon-ok\"></span>', '      </button>', '   </div>', '</div>'].join(' ');\n\n    var SELECT_TEMPLATE = ['<div class=\"form-group form-group-slick\">', '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>', '   <div class=\"input__display\" ', '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error}\" ', '       ng-show=\"!editing\" ng-click=\"edit()\" ', '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">', '      {{displayValue}}', '   </div>', '   <div ng-show=\"editing\">', '      <div class=\"input-group\" ng-class=\"{\\'input-group-lg\\':size===\\'large\\'}\">', '           <div class=\"input-group-slick\" ng-class=\"{\\'input-group-slick--lg\\':size===\\'large\\'}\">', '               <span ng-if=\"icon\" class=\"{{::icon}}\"></span>', '               <select class=\"form-control input__field\" ', '                   ng-if=\"codeList.length<=12\" ', '                   ng-model=\"innerValue\" ', '                   ng-options=\"opt.value as opt.label for opt in selectOptions\" ', '                   ng-required=\"{{required}}\" ', '                   ng-change=\"onChange(innerValue)\" ', '                   ng-keyUp=\"onKeyUp($event.keyCode)\" >', '                   <option value=\"\">Select One</option>', '               </select>', '               <input type=\"text\" class=\"form-control input__field\" ng-if=\"codeList.length>12\" ', '                   ng-model=\"innerValue\" ', '                   ng-required=\"{{required}}\" ', '                   ng-keyUp=\"onTypeaheadKeyUp($event.keyCode)\" ', '                   typeahead-on-select=\"onTypeaheadSelection($item, $model, $label, $event)\" ', '                   uib-typeahead=\"opt.value as opt.label for opt in selectOptions | filter:{value:$viewValue} | limitTo:12\" ', '                   typeahead-min-length=\"0\" ', '                   typeahead-editable=\"false\">', '               <span class=\"indicators\">', '                   <span class=\"is-valid glyphicon glyphicon-ok-sign\"></span>', '                  <span class=\"is-invalid glyphicon glyphicon-exclamation-sign\"></span>', '              </span>', '           </div>', '          <span class=\"input-group-btn\">', '               <button type=\"button\" class=\"btn btn-default\" ', '                   ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"', '                   ng-click=\"cancel()\" title=\"Cancel changes\">', '                   <span class=\"glyphicon glyphicon-ban-circle\"></span>', '              </button>', '               <button type=\"button\" class=\"btn btn-default\" ', '                   ng-class=\"{disabled:!!error||!isDirty,\\'btn-lg\\':size===\\'large\\'}\"', '                   ng-disabled=\"{{!!error}}\" ', '                   ng-click=\"save()\" title=\"Save changes\">', '                  <span class=\"glyphicon glyphicon-ok\"></span>', '               </button>', '           </span>', '       </div>', '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>', '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>', '   </div>', '</div>'].join(' ');\n})(jQuery, angular);\n(function (angular) {\n\n    \"use strict\";\n\n    angular.module(\"gp-common\").directive('gpTweetButton', ['$timeout', function ($timeout) {\n\n        function debounce(func, wait, immediate) {\n            var timeout;\n            return function () {\n                var context = this,\n                    args = arguments;\n                var later = function later() {\n                    timeout = null;\n                    if (!immediate) func.apply(context, args);\n                };\n                var callNow = immediate && !timeout;\n                clearTimeout(timeout);\n                timeout = setTimeout(later, wait);\n                if (callNow) func.apply(context, args);\n            };\n        }\n\n        return {\n            link: function link(scope, element, attr) {\n\n                if (typeof twttr === 'undefined') {\n                    element.className += ' disabled';\n                    return;\n                }\n\n                var renderTwitterButton = debounce(function () {\n                    if (attr.url) {\n                        $timeout(function () {\n                            element[0].innerHTML = '';\n                            twttr.widgets.createShareButton(attr.url, element[0], function () {}, {\n                                count: attr.count,\n                                text: attr.text,\n                                via: attr.via,\n                                size: attr.size,\n                                hashtags: attr.hashtags,\n                                dnt: attr.dnt\n                            });\n                        });\n                    }\n                }, 75);\n                attr.$observe('url', renderTwitterButton);\n                attr.$observe('text', renderTwitterButton);\n            }\n        };\n    }]);\n})(angular);\n(function (angular) {\n\n    \"use strict\";\n\n    angular.module(\"gp-common\").directive('sortOrder', function () {\n        return {\n\n            replace: true,\n            require: 'ngModel',\n\n            template: ['<div>', '<a class=\"btn btn-default\" title=\"Click to sort in ascending order\" href ng-if=\"value===\\'dsc\\'\" ng-click=\"toggle()\">', '    <span class=\"glyphicon glyphicon-sort-by-attributes-alt\"></span>', '</a>', '<a class=\"btn btn-default\" title=\"Click to sort in descending order\" href ng-if=\"value===\\'asc\\'\" ng-click=\"toggle()\">', '    <span class=\"glyphicon glyphicon-sort-by-attributes\"></span>', '</a>', '</div>'].join(' '),\n\n            link: function link($scope, element, attrs, ngModel) {\n                ngModel.$viewChangeListeners.push(function () {\n                    $scope.$eval(attrs.ngChange);\n                });\n                ngModel.$render = function () {\n                    $scope.value = ngModel.$modelValue;\n                };\n                $scope.toggle = function () {\n                    $scope.value = $scope.value === 'asc' ? 'dsc' : 'asc';\n                    ngModel.$setViewValue($scope.value);\n                };\n            }\n        };\n    });\n})(angular);\n(function (angular) {\n\n    'use strict';\n\n    /** \n     * directive used in conjunction with ng-model to map arrays of strings\n     * to form field controls for editing.\n     *\n     * Usage:  <input ng-model=\"arrOfStr\" string-array-input></input>\n     *\n     */\n\n    angular.module('gp-common').directive('stringArrayInput', function () {\n        return {\n            restrict: 'A',\n            require: 'ngModel',\n            link: function link(scope, element, attr, ngModel) {\n\n                function fromInput(text) {\n                    var result = null;\n                    if (text && text.length) result = text.split(',').map(function (i) {\n                        return i.trim();\n                    });\n                    return result;\n                }\n\n                function toInput(arr) {\n                    var result = null;\n                    if (arr && typeof arr.push !== 'undefined') result = arr.join(', ');\n                    return result;\n                }\n\n                ngModel.$parsers.push(fromInput);\n                ngModel.$formatters.push(toInput);\n            }\n        };\n    });\n})(angular);\n(function (jQuery, angular) {\n\n    \"use strict\";\n\n    angular.module(\"gp-common\")\n\n    /**\n     * Custom filter to make label values visually helpful by \n     * replacing bad characters with spaces or meaningful equivalents\n     */\n    .filter('fixLabel', function () {\n        return function (value) {\n            if (!value || typeof value !== 'string' || !value.length) return 'Untitled';\n            var result = value.replace(/([a-z])([A-Z])/g, \"$1 $2\").replace(/_/g, \" \").trim();\n            return result.charAt(0).toUpperCase() + result.slice(1);\n        };\n    }).filter('pluralize', function () {\n        return function (text) {\n            if (!text || !text.length) return \"\";\n            if (text.endsWith('ss')) return text + 'es'; //classes, etc\n            if (text.endsWith('s')) return text; //already plural\n            return text + 's';\n            //TODO support irregular words like \"foot\" -> \"feet\"\n            // and words that need duplicate letters: \"quiz\" -> \"quizzes\"\n        };\n    }).filter('capitalize', function () {\n        return function (text) {\n            return text[0].toUpperCase() + text.substring(1);\n        };\n    }).filter('facets', function () {\n\n        return function (arr, facetName) {\n            if (!facetName) return arr;\n            if (!arr || !arr.length) return [];\n            return arr.filter(function (f) {\n                return f.toLowerCase().startsWith(facetName + \":\");\n            }).map(function (f) {\n                return f.substring(f.indexOf(':') + 1, f.length);\n            });\n        };\n    }).filter('joinBy', function () {\n        return function (input, delimiter, emptyValue) {\n            if (input && typeof input.push !== 'undefined' && input.length) return input.join(delimiter || ', ');else return emptyValue || '';\n        };\n    }).filter('defaultValue', function () {\n        return function (text, defVal) {\n            if (typeof text === 'undefined' || !text.length) return defVal;\n            return text;\n        };\n    }).filter('count', function () {\n        return function (input) {\n            if (typeof input !== 'undefined') {\n                if (typeof input.push === 'function') return input.length;\n                if ((typeof input === \"undefined\" ? \"undefined\" : _typeof(input)) === 'object') {\n                    if (typeof Object.keys !== 'undefined') {\n                        return Object.keys(input);\n                    }\n                }\n            }\n            return 0;\n        };\n    })\n\n    /**\n     *\n     */\n    .filter('gpObjTypeMapper', function () {\n        return function (str) {\n            if (!str || typeof str !== 'string' || str.length === 0) return str;\n\n            var name = str;\n\n            var idx = str.indexOf(\":\");\n            if (~idx) name = str.substring(idx + 1);\n\n            if ('VCard' === name) return 'Contact';\n            return name;\n        };\n    }).filter('gpReliabilityGrade', function () {\n\n        return function (arg) {\n\n            var o = arg;\n            if ((typeof o === \"undefined\" ? \"undefined\" : _typeof(o)) === 'object') {\n                if (o.statistics) o = o.statistics.reliability || null;else if (o.reliability) o = o.reliability;else o = null;\n            }\n\n            if (!isNaN(o)) {\n\n                o = o * 1;\n\n                if (o === null || typeof o === 'undefined') return 'X';else if (o > 90) return 'A';else if (o > 80) return 'B';else if (o > 70) return 'C';else if (o > 60) return 'D';else return 'F';\n\n                // if (value >= 97) letter = 'A+';\n                // else if (value >= 93) letter = 'A';\n                // else if (value >= 90) letter = 'A-';\n                // else if (value >= 87) letter = 'B+';\n                // else if (value >= 83) letter = 'B';\n                // else if (value >= 80) letter = 'B-';\n                // else if (value >= 77) letter = 'C+';\n                // else if (value >= 73) letter = 'C';\n                // else if (value >= 70) letter = 'C-';\n                // else if (value >= 67) letter = 'D+';\n                // else if (value >= 63) letter = 'D';\n                // else if (value >= 60) letter = 'D-';\n            }\n\n            return \"X\";\n        };\n    });\n})(jQuery, angular);\n\n/**\n * \n * KnowledgeGraph property on RIM Asset renamed to Classifiers\n *\n */\n\n(function (jQuery, angular, Constants) {\n    'use strict';\n\n    angular.module('gp-common-kg', []).constant('KGFields', ['purposes', 'functions', 'primaryTopics', 'secondaryTopics', 'primarySubjects', 'secondarySubjects', 'communities', 'audiences', 'places', 'categories']).service('KGHelper', ['KGFields', 'RecommenderServiceFactory', function (KGFields, RecommenderServiceFactory) {\n\n        return {\n            calculate: function calculate(kg) {\n                if (!kg) return 0;\n                var result = 0;\n                angular.forEach(KGFields, function (prop) {\n                    if (kg[prop] && kg[prop].length) result += 7 + Math.floor((kg[prop].length - 1) / 2);\n                    // result += kg[prop] ? kg[prop].length*5 : 0;\n                });\n                return result;\n            },\n\n            getService: function getService(type) {\n                return RecommenderServiceFactory(type);\n            }\n\n        };\n    }])\n\n    /**\n     * Service that queries the recommendation service endpoint \n     * exposed by UAL \n     */\n    .service(\"RecommenderService\", function ($resource) {\n\n        var baseUrl = Constants.ualUrl + '/api/recommender';\n        return $resource(baseUrl, {}, {\n\n            query: {\n                url: baseUrl + '/suggest',\n                isArray: false\n            },\n            queryTypes: {\n                url: baseUrl + '/types',\n                isArray: false\n            },\n            querySources: {\n                url: baseUrl + '/sources',\n                isArray: false\n            }\n\n        });\n    })\n\n    /**\n     * Factory for creating services that query the recommendation \n     * service endpoint exposed by UAL and includes object type\n     * parameter based upon owner of KG\n     */\n    .factory(\"RecommenderServiceFactory\", function ($resource) {\n\n        return function (type) {\n\n            var baseUrl = Constants.ualUrl + '/api/recommender';\n            return $resource(baseUrl, { 'for': type }, {\n\n                query: {\n                    url: baseUrl + '/suggest',\n                    isArray: false\n                },\n                queryTypes: {\n                    url: baseUrl + '/types',\n                    isArray: false\n                },\n                querySources: {\n                    url: baseUrl + '/sources',\n                    isArray: false\n                }\n\n            });\n        };\n    })\n\n    /** \n     * Component for rendering a brief % of completion\n     *\n     */\n    .component('kgCompletionDisplay', {\n\n        bindings: {\n            ngModel: '<' // the Asset containing the knowledge graph ('classifiers') property\n        },\n\n        controller: function controller($rootScope, KGHelper) {\n\n            this.$onInit = function () {\n                var _this2 = this;\n\n                this.update();\n\n                this.listener = $rootScope.$on('gp:kg:updated', function (event, item) {\n                    if (item && item.id === _this2.id) {\n                        //in case kg didn't exist, \n                        if (!_this2.ngModel.classifiers) _this2.ngModel.classifiers = item.classifiers;\n                        _this2.value = KGHelper.calculate(_this2.ngModel.classifiers);\n                    }\n                });\n            };\n\n            this.$onChanges = function () {\n                this.update();\n            };\n\n            this.$onDestroy = function () {\n                this.listener();\n                this.listener = null;\n            };\n\n            this.update = function () {\n                this.id = this.ngModel ? this.ngModel.id : null;\n                this.value = KGHelper.calculate(this.ngModel.classifiers);\n            };\n        },\n\n        template: \"\\n            <span>{{$ctrl.value||0}}%</span>\\n            <span class=\\\"glyphicon glyphicon-dashboard\\\"></span>\\n        \"\n\n    });\n})(jQuery, angular, GeoPlatform);\n\n(function (angular, Constants) {\n\n    'use strict';\n\n    var SectionController = function () {\n        function SectionController($timeout, RecommenderService) {\n            'ngInject';\n\n            _classCallCheck(this, SectionController);\n\n            this.$timeout = $timeout;\n            this.service = RecommenderService;\n        }\n\n        _createClass(SectionController, [{\n            key: \"$onInit\",\n            value: function $onInit() {\n                this.noResults = false;\n                this.query = '';\n                this.displayOptions = {\n                    fetching: false,\n                    showSuggested: false\n                };\n                this.paging = {\n                    start: 0,\n                    size: 5,\n                    sizeOptions: [5, 10, 20]\n                };\n                this.updateCache();\n            }\n\n            /**\n             * Update cache when bound 'ngModel' is actually assigned in the component lifecycle\n             */\n\n        }, {\n            key: \"$onChanges\",\n            value: function $onChanges() {\n                this.updateCache();\n            }\n        }, {\n            key: \"$onDestroy\",\n            value: function $onDestroy() {\n                this.eventHandlers = null;\n                this.clearOptions();\n                this.selected = null;\n                this.service = null;\n                this.$timeout = null;\n            }\n\n            /**\n             * \n             * @param {object} item - selected value being activated (clicked on for navigation)\n             */\n\n        }, {\n            key: \"activate\",\n            value: function activate(item) {\n                if (this.onActivate) this.onActivate({ value: item });\n            }\n        }, {\n            key: \"on\",\n            value: function on(event, callback) {\n                this.eventHandlers = this.eventHandlers || {};\n                this.eventHandlers[event] = this.eventHandlers[event] || [];\n                this.eventHandlers[event].push(callback);\n            }\n        }, {\n            key: \"notify\",\n            value: function notify(event, data) {\n                if (!this.eventHandlers || !this.eventHandlers[event]) return;\n                angular.forEach(this.eventHandlers[event], function (handler) {\n                    try {\n                        handler(data);\n                    } catch (e) {}\n                });\n            }\n\n            /**\n             * @param {string} query - keywords provided by user input\n             * @return {Promise} resolving an array of results\n             */\n\n        }, {\n            key: \"fetchOptions\",\n            value: function fetchOptions(query) {\n                var _this3 = this;\n\n                //need this timeout or else 'this.query' isn't being \n                // seen as having the same value as 'query'\n                this.$timeout(function () {\n                    _this3.query = query;\n                }, 10);\n\n                this.displayOptions.fetching = true;\n                var params = {\n                    type: this.type,\n                    q: query,\n                    page: Math.floor(this.paging.start / this.paging.size),\n                    size: this.paging.size\n                };\n                // if(this.forType)\n                //     params['for'] = this.forType;\n\n                return this.service.query(params).$promise.then(function (response) {\n                    _this3.paging.total = response.totalResults;\n                    _this3.notify('gp:browse:suggestions:pagination', _this3.paging);\n                    _this3.suggested = response.results.map(function (result) {\n                        result._selected = _this3.isSelected(result);\n                        return result;\n                    });\n                    _this3.displayOptions.showSuggested = true;\n                    return _this3.suggested;\n                }).catch(function (e) {\n                    _this3.paging.total = 0;\n                    _this3.notify('gp:browse:suggestions:pagination', _this3.paging);\n                    _this3.suggested = [];\n                    return _this3.suggested;\n                }).finally(function () {\n                    return _this3.displayOptions.fetching = false;\n                });\n            }\n        }, {\n            key: \"clearQuery\",\n            value: function clearQuery() {\n                this.query = '';\n                this.fetchOptions(this.query);\n            }\n        }, {\n            key: \"clearOptions\",\n            value: function clearOptions() {\n\n                //clear query and available options\n                this.query = '';\n                this.suggested = null;\n\n                //reset paging\n                this.paging.start = 0;\n                this.paging.total = 0;\n                // this.notify('gp:browse:suggestions:pagination', this.paging);\n\n                //hide available options\n                this.displayOptions.showSuggested = false;\n            }\n\n            /**\n             * @param {integer} index - position in selected array of item removed\n             */\n\n        }, {\n            key: \"remove\",\n            value: function remove(index) {\n\n                var removed = this.ngModel[index].uri;\n                this.ngModel.splice(index, 1);\n\n                //remove from suggested list if one is populated (being shown)\n                if (this.suggested && this.suggested.length) {\n                    var found = this.suggested.find(function (it) {\n                        return it.uri === removed;\n                    });\n                    if (found) found._selected = false;\n                }\n                this.updateCache(); //update cache of selected ids\n\n                if (this.onChange) this.onChange({ values: this.ngModel }); //notify others of change\n            }\n\n            /**\n             * @param {object} value - item being checked for selection\n             * @return {boolean}\n             */\n\n        }, {\n            key: \"isSelected\",\n            value: function isSelected(value) {\n                return value._selected || ~this.selected.indexOf(value.uri);\n            }\n\n            /**\n             * @param {object} value - item being selected\n             */\n\n        }, {\n            key: \"selectValue\",\n            value: function selectValue(value) {\n                if (value._selected) return; //already selected\n\n                value._selected = true;\n\n                this.ngModel = this.ngModel || [];\n                this.ngModel.push(value);\n                this.updateCache();\n\n                if (this.onChange) this.onChange({ values: this.ngModel });\n            }\n        }, {\n            key: \"updateCache\",\n            value: function updateCache() {\n                this.selected = (this.ngModel || []).map(function (o) {\n                    return o.uri;\n                });\n            }\n        }, {\n            key: \"onDropdownToggled\",\n            value: function onDropdownToggled(open) {\n                if (!open) this.clearOptions();\n            }\n\n            /* -------- pagination methods ----------- */\n\n        }, {\n            key: \"getPagination\",\n            value: function getPagination() {\n                return this.paging;\n            }\n        }, {\n            key: \"start\",\n            value: function start(index) {\n                this.paging.start = index;\n                this.fetchOptions(this.query);\n            }\n        }, {\n            key: \"size\",\n            value: function size(value) {\n                this.paging.size = value;\n                this.fetchOptions(this.query);\n            }\n        }]);\n\n        return SectionController;\n    }();\n\n    angular.module('gp-common-kg').component('kgSection', {\n\n        bindings: {\n            ngModel: '<',\n            service: '<', //recommender service instance to use\n            label: '@',\n            description: '@',\n            type: '@', //type of KG property\n            onChange: '&?', //fire when value(s) change\n            onActivate: '&?' //fire when selected value link is clicked\n        },\n\n        controller: SectionController,\n\n        template: \"\\n            <h5>{{$ctrl.label}}</h5>\\n            <p>{{$ctrl.description}}</p>\\n\\n            <div class=\\\"list-group list-group-sm\\\">\\n                <div ng-repeat=\\\"item in $ctrl.ngModel track by $index\\\" class=\\\"list-group-item\\\">\\n                    <button type=\\\"button\\\" class=\\\"btn btn-link\\\" ng-click=\\\"$ctrl.remove($index)\\\">\\n                        <span class=\\\"glyphicon glyphicon-remove-circle t-fg--danger\\\"></span> \\n                    </button>\\n                    <div class=\\\"flex-1 u-pd--md\\\">\\n                        <div class=\\\"u-pd-bottom--sm t-text--strong\\\">\\n                            <a ng-click=\\\"$ctrl.activate(item)\\\" ng-if=\\\"$ctrl.onActivate\\\">{{item.label}}</a>\\n                            <span ng-if=\\\"!$ctrl.onActivate\\\">{{item.label}}</span>\\n                        </div>\\n                        <div class=\\\"u-text--sm t-text--italic\\\">\\n                            <a href=\\\"{{item.uri}}\\\" target=\\\"_blank\\\" title=\\\"Open source info in new window\\\">{{item.uri}}</a>\\n                        </div>\\n                        <div class=\\\"description\\\">{{item.description||\\\"No description provided\\\"}}</div>\\n                    </div>\\n                </div>\\n            </div>\\n\\n            <div class=\\\"t-fg--gray-md\\\" ng-if=\\\"!$ctrl.ngModel.length\\\"><em>No values specified</em></div>            \\n\\n            <hr>\\n\\n            <div uib-dropdown is-open=\\\"$ctrl.displayOptions.showSuggested\\\" \\n                auto-close=\\\"outsideClick\\\" on-toggle=\\\"$ctrl.onDropdownToggled(open)\\\">\\n\\n                <div class=\\\"l-flex-container flex-justify-between flex-align-center\\\">\\n                    <div class=\\\"input-group-slick flex-1\\\">\\n                        <span class=\\\"glyphicon\\\"\\n                            ng-class=\\\"{'glyphicon-search':!$ctrl.displayOptions.fetching, 'glyphicon-hourglass spin':$ctrl.displayOptions.fetching}\\\"></span>\\n                        <input type=\\\"text\\\" class=\\\"form-control\\\" \\n                            ng-model=\\\"$ctrl.query\\\" \\n                            ng-model-options=\\\"{ debounce: 250 }\\\"\\n                            ng-change=\\\"$ctrl.fetchOptions($ctrl.query)\\\"\\n                            placeholder=\\\"Find values to add...\\\">\\n                    </div>\\n                </div>\\n                \\n                <div class=\\\"dropdown-menu\\\" uib-dropdown-menu>\\n                    \\n                    <div class=\\\"form-group l-flex-container flex-justify-between flex-align-center\\\">\\n                        <div class=\\\"input-group-slick flex-1\\\">\\n                            <span class=\\\"glyphicon\\\"\\n                                ng-class=\\\"{'glyphicon-search':!$ctrl.displayOptions.fetching, 'glyphicon-hourglass spin':$ctrl.displayOptions.fetching}\\\"></span>\\n                            <input type=\\\"text\\\" class=\\\"form-control\\\" \\n                                ng-model=\\\"$ctrl.query\\\" \\n                                ng-model-options=\\\"{ debounce: 250 }\\\"\\n                                ng-change=\\\"$ctrl.fetchOptions($ctrl.query)\\\"\\n                                placeholder=\\\"Find values to add...\\\">\\n                            <span class=\\\"glyphicon glyphicon-remove\\\"\\n                                ng-if=\\\"$ctrl.query.length\\\"\\n                                ng-click=\\\"$event.stopPropagation();$ctrl.clearQuery()\\\"></span>\\n                        </div>\\n                        <button type=\\\"button\\\" class=\\\"btn btn-info u-mg-left--xlg animated-show\\\"\\n                            ng-click=\\\"$ctrl.clearOptions();\\\">\\n                            Done\\n                        </button>\\n                    </div>\\n                    \\n                    <gp-pagination service=\\\"$ctrl\\\" event-key=\\\"suggestions\\\" use-select=\\\"true\\\"></gp-pagination>\\n\\n                    <div class=\\\"list-group list-group-sm u-text--sm\\\">\\n                        <div ng-repeat=\\\"item in $ctrl.suggested track by $index\\\" class=\\\"list-group-item\\\">\\n                            <button type=\\\"button\\\" class=\\\"btn btn-link\\\" ng-click=\\\"$ctrl.selectValue(item)\\\"\\n                                ng-class=\\\"{disabled:item._selected}\\\">\\n                                <span class=\\\"glyphicon glyphicon-ok t-fg--gray-md\\\" ng-show=\\\"item._selected\\\"></span> \\n                                <span class=\\\"glyphicon glyphicon-plus-sign t-fg--success\\\" ng-show=\\\"!item._selected\\\"></span> \\n                            </button>\\n                            <div class=\\\"flex-1 u-pd--md\\\">\\n                                <div class=\\\"t-text--strong u-pd-bottom--sm\\\">{{item.prefLabel}}</div>\\n                                <a href=\\\"{{item.uri}}\\\" target=\\\"_blank\\\" class=\\\"u-text--sm t-text--italic\\\"\\n                                    title=\\\"Open source info in new window\\\">\\n                                    {{item.uri}}\\n                                </a>\\n                                <div class=\\\"description\\\">{{item.description||\\\"No description provided\\\"}}</div>\\n                            </div>\\n                        </div>\\n                        <div ng-if=\\\"!$ctrl.suggested.length\\\" class=\\\"list-group-item disabled u-pd--md\\\">\\n                            No results match your query\\n                        </div>\\n                    </div>\\n                </div>\\n            </div>\\n        \"\n    });\n})(angular, GeoPlatform);\n\n(function (angular, Constants) {\n\n    \"use strict\";\n\n    //fields list sent to MDR in order to have these properties for display in search results\n\n    var FIELDS = ['created', 'modified', 'publishers', 'themes', 'description', 'extent'];\n\n    //facets list sent to MDR in order to get aggregation numbers\n    var FACETS = ['types', 'themes', 'publishers', 'serviceTypes', 'schemes', 'visibility', 'createdBy'];\n\n    var SORT_OPTIONS = [{ value: \"label,asc\", label: \"Name (A-Z)\" }, { value: \"label,desc\", label: \"Name (Z-A)\" }, { value: \"type,asc\", label: \"Type (A-Z)\" }, { value: \"type,desc\", label: \"Type (Z-A)\" }, { value: \"modified,desc\", label: \"Most recently modified\" }, { value: \"modified,asc\", label: \"Least recently modified\" }];\n\n    //list of _options variables for mapping to parameters\n    var VAR_TYPES = 'types';\n    var VAR_THEMES = 'themes';\n    var VAR_PUBLISHERS = 'publishers';\n    var VAR_USER = 'user';\n    var VAR_CREATED_BY = 'createdBy';\n    var VAR_SERVICE_TYPES = 'serviceTypes';\n    var VAR_SCHEMES = 'schemes';\n    var VAR_VISIBILITY = \"visibility\";\n    var VAR_QUERY = 'query';\n    var VAR_EXTENT = 'extent';\n    var VAR_MODIFIED_BEFORE = 'modified.max';\n    var VAR_MODIFIED_AFTER = 'modified.min';\n\n    //parameter names for various query constraints used in requests to MDR for results\n    var PARAMETER_TYPE = 'type';\n    var PARAMETER_THEME = 'theme.id';\n    var PARAMETER_PUBLISHER = 'publisher.id';\n    var PARAMETER_CREATED_BY = 'createdBy';\n    var PARAMETER_CONTRIBUTED_BY = 'contributedBy';\n    var PARAMETER_CREATOR = 'creator.id';\n    var PARAMETER_SVC_TYPE = 'serviceType.id';\n    var PARAMETER_IN_SCHEME = 'scheme.id';\n    var PARAMETER_VISIBILITY = 'visibility';\n    var PARAMETER_QUERY = 'q';\n    var PARAMETER_EXTENT = 'bbox';\n    var PARAMETER_MODIFIED_BEFORE = 'modified.max';\n    var PARAMETER_MODIFIED_AFTER = 'modified.min';\n    // const PARAMETER_CONTRIBUTOR     = 'contributor.id';\n\n\n    var PARAM_OPTIONS = [{ option: VAR_TYPES, parameter: PARAMETER_TYPE }, { option: VAR_THEMES, parameter: PARAMETER_THEME }, { option: VAR_PUBLISHERS, parameter: PARAMETER_PUBLISHER }, { option: VAR_USER, parameter: PARAMETER_CREATOR }, { option: VAR_CREATED_BY, parameter: PARAMETER_CREATED_BY }, { option: VAR_SERVICE_TYPES, parameter: PARAMETER_SVC_TYPE }, { option: VAR_SCHEMES, parameter: PARAMETER_IN_SCHEME }, { option: VAR_VISIBILITY, parameter: PARAMETER_VISIBILITY }, { option: VAR_QUERY, parameter: PARAMETER_QUERY }, { option: VAR_EXTENT, parameter: PARAMETER_EXTENT }, { option: VAR_MODIFIED_BEFORE, parameter: PARAMETER_MODIFIED_BEFORE }, { option: VAR_MODIFIED_AFTER, parameter: PARAMETER_MODIFIED_AFTER }];\n\n    var PAGE_SIZE_BASE_10 = [10, 20, 50, 100];\n    var PAGE_SIZE_BASE_12 = [12, 24, 48, 96];\n\n    /**\n     *\n     *\n     */\n    function BrowseObjectsService($rootScope, $timeout, $resource, options) {\n\n        /* -------- private data ----------- */\n\n        var url = options && options.url ? options.url + \"/:id\" : Constants.ualUrl + '/api/items/:id';\n\n        var eventKey = 'gp:browse:' + (options && options.key ? options.key : 'objects') + \":\";\n\n        var svc = $resource(url, { id: '@id' }, {\n            query: {\n                isArray: false\n            }\n        });\n\n        var _pageSizeBase = PAGE_SIZE_BASE_10.slice(0);\n        if (options && options.pageSizeBase && options.pageSizeBase === 12) _pageSizeBase = PAGE_SIZE_BASE_12.slice(0);\n\n        var _options = {\n            start: 0,\n            size: _pageSizeBase[0],\n            total: 0,\n            sort: options && options.sort ? options.sort : \"modified,desc\",\n            facets: {}\n        };\n\n        //list of field names to request in response\n        var _fields = options && options.fields ? options.fields : FIELDS.slice(0);\n\n        //list of facet names to request\n        var _requestFacets = options && options.facets ? options.facets : FACETS.slice(0);\n\n        var _facets = [];\n        var _selectedFacets = [];\n\n        var _results = [];\n\n        var _dirtyPromise = null;\n\n        var _isLoading = false;\n\n        var _selected = [];\n\n        var _onSelectFn = options && options.onSelect ? options.onSelect : null;\n\n        /**\n         *\n         */\n        function notify(eventName, arg) {\n            // console.log(\"Notifying of \" + eventName + \" with \" + arg);\n            $rootScope.$broadcast(eventName, arg);\n        }\n\n        /**\n         * when marked as dirty, debounce for rapid fire events like onKeyUp\n         */\n        function dirty(delay, resetStart) {\n\n            var doReset = typeof resetStart === 'undefined' || resetStart === true;\n\n            if (_dirtyPromise) $timeout.cancel(_dirtyPromise);\n            _dirtyPromise = $timeout(function () {\n                _dirtyPromise = null;\n                _doUpdate(doReset);\n            }, delay || 100);\n        }\n\n        /**\n         *\n         */\n        function _doUpdate(resetStart) {\n\n            if (resetStart) _options.start = 0;\n\n            _isLoading = true;\n            notify(eventKey + 'querying');\n\n            var params = {};\n\n            // -------- QUERY FILTERS --------\n\n            //create a temporary options object\n            var opts = angular.copy(_options);\n\n            //apply options as parameters\n            angular.forEach(PARAM_OPTIONS, function (po) {\n                var name = po.parameter;\n                var value = opts[po.option];\n\n                var isSet = value !== null && typeof value !== 'undefined';\n                var isArr = isSet && typeof value.push !== 'undefined';\n\n                if (isSet && (!isArr || value.length)) {\n                    params[name] = isArr ? value.join(',') : value;\n                } else {\n                    delete params[name];\n                }\n                delete opts[po.option]; //remove from temp opts\n            });\n\n            //apply remaining options to query\n            // these are not keyed with specific parameters (ie, custom params)\n            angular.forEach(opts, function (value, name) {\n                if (value !== null && typeof value !== 'undefined') {\n                    var isArr = typeof value.push !== 'undefined';\n                    params[name] = isArr ? value.join(',') : value;\n                } else {\n                    //make sure it doesn't get sent if no value provided\n                    delete params[name];\n                }\n            });\n\n            // -------- QUERY FILTERS --------\n\n\n            var arr = [];\n            for (var k in _options.facets) {\n                if (_options.facets.hasOwnProperty(k)) {\n                    //encode commas in facet name since it's used to separate multiple \n                    // facet values\n                    arr.push(k + \":\" + _options.facets[k].replace(/,/g, '%2C'));\n                }\n            }\n            _selectedFacets = arr;\n\n            var start = _options.start;\n            if (isNaN(start)) start = 0;else start = start * 1;\n\n            params.page = Math.floor(start / _options.size);\n            params.size = _options.size;\n            params.sort = _options.sort;\n\n            if (arr.length) params.facets = arr.join(',');\n\n            //prevent CORS cache bug in Chrome\n            params.bust = new Date().getTime();\n\n            //request facets\n            params.includeFacet = _requestFacets.join(',');\n\n            //request fields\n            params.fields = _fields.join(',');\n\n            svc.query(params).$promise.then(function (response) {\n\n                _results = response.results;\n                _facets = response.facets || [];\n\n                //auto select objects if user has marked it as selected previously\n                // this is needed to maintain selections across pagination pages\n                _selected.each(function (id) {\n                    var map = _results.find(function (map) {\n                        return map._id === id;\n                    });\n                    if (map) map.selected = true;\n                });\n\n                //will trigger update on pagination directive\n                _options.total = response.totalResults;\n\n                _isLoading = false;\n                notify(eventKey + 'results');\n                notify(eventKey + 'pagination');\n            }).catch(function (response) {\n                _isLoading = false;\n\n                //fallback\n                var obj = { error: \"An Error Occurred\", message: \"No details provided\" };\n\n                //http response error\n                if (response && response.data) obj = response.data;\n                //normal error\n                else if (response && response.message) obj = response;\n\n                //serialized json\n                if (typeof obj === 'string') {\n                    try {\n                        obj = JSON.parse(obj);\n                    } catch (e) {\n                        obj.message = \"Bad response from server\";\n                    }\n                }\n\n                var error = {\n                    label: obj.error || \"An Error Occurred\",\n                    message: obj.message || \"No details provided\"\n                };\n                notify(eventKey + 'error', error);\n            });\n        }\n\n        function setOption(name, value, fire) {\n            _options[name] = value;\n            if (typeof fire === 'undefined' || !!fire) {\n                var delay = 500;\n                if (value === null || value === undefined) delay = 0;\n                if (value && typeof value.push !== 'undefined' && value.length) delay = 0; //arrays\n                else if (value && value.length) delay = 0; //strings\n                dirty(delay);\n            }\n        }\n\n        /* ------------ public api ------------- */\n\n        return {\n\n            events: {\n                LOADING: eventKey + 'querying',\n                RESULTS: eventKey + 'results',\n                PAGINATION: eventKey + 'pagination',\n                SELECTED: eventKey + 'selected',\n                ERROR: eventKey + 'error',\n                SELECTED_ADDED: eventKey + 'selected:added',\n                SELECTED_REMOVED: eventKey + 'selected:removed'\n            },\n\n            /**\n             * @return {bool}\n             */\n            getLoadingStatus: function getLoadingStatus() {\n                return _isLoading;\n            },\n\n            /**\n             * NOTE: Make sure event names are prefixed with\n             *  eventKey + ''\n             * @param {string} eventName\n             * @param {function} listener\n             */\n            on: function on(eventName, listener) {\n                // if(eventName.indexOf(eventKey + \":\") !== 0)\n                //     eventName = eventKey + '' + eventName;\n                return $rootScope.$on(eventName, listener);\n            },\n\n            /**\n             * @param {string} eventName\n             * @param {*} args\n             */\n            trigger: function trigger(eventName, args) {\n                notify(eventName, args);\n            },\n\n            /**\n             * @return {array[object]}\n             */\n            getResults: function getResults() {\n                return _results;\n            },\n\n            /** \n             * @return {array[string]} list of facet names\n             */\n            getFacetNames: function getFacetNames() {\n                return FACETS.slice(0);\n            },\n\n            /**\n             * @return {object} in form of <facet>: [<values>]\n             */\n            getFacets: function getFacets() {\n                return _facets;\n            },\n\n            /**\n             * @param {string} name\n             * @return {object|null}\n             */\n            getFacet: function getFacet(name) {\n                if (_facets) {\n                    return _facets.find(function (facet) {\n                        return facet.name === name;\n                    });\n                }\n                return null;\n            },\n\n            addFacet: function addFacet(name) {\n                _requestFacets.push(name);\n            },\n\n            applyConstraints: function applyConstraints(obj) {\n                // _options[VAR_QUERY] = obj.query;\n                // _options[VAR_TYPES] = obj.types;\n                // _options[VAR_THEMES] = obj.themes;\n                // _options[VAR_PUBLISHERS] = obj.publishers;\n                // _options[VAR_USER] = obj.user;\n                // _options[VAR_CREATED_BY] = obj.createdBy;\n                // _options[VAR_SERVICE_TYPES] = obj.serviceTypes;\n                // _options[VAR_SCHEMES] = obj.schemes;\n                // _options[VAR_VISIBILITY] = obj.visibility;\n                // //do we need to set extent here too?\n\n                for (var p in obj) {\n                    if (obj.hasOwnProperty(p)) {\n                        _options[p] = obj[p];\n                    }\n                }\n\n                _doUpdate(true);\n            },\n\n            applyOption: function applyOption(key, value, fire) {\n                setOption(key, value, fire);\n            },\n\n            applyOptions: function applyOptions(opts, fire) {\n                angular.forEach(opts, function (value, key) {\n                    setOption(key, value, false);\n                });\n                if (fire) _doUpdate(true);\n            },\n\n            /**\n             * @param {string} text - free text query\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setQuery: function setQuery(text, fireUpdate) {\n                setOption(VAR_QUERY, text, fireUpdate);\n            },\n\n            /**\n             * @param {array[string]} types - name of class(es) to request\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setTypes: function setTypes(types, fireUpdate) {\n                setOption(VAR_TYPES, types, fireUpdate);\n            },\n\n            getTypes: function getTypes() {\n                return _options[VAR_TYPES];\n            },\n\n            /** \n             * @param {string} userId - identifier of user\n             * @param {boolean} fireUpdate -\n             */\n            setUser: function setUser(userId, fireUpdate) {\n                setOption(VAR_USER, userId, fireUpdate);\n            },\n\n            /**\n             * @param {array[string]} creators - ids of creators\n             * @param {boolean} fireUpdate - \n             */\n            setCreatedBy: function setCreatedBy(creators, fireUpdate) {\n                setOption(VAR_CREATED_BY, creators, fireUpdate);\n            },\n\n            /**\n             * @param {array[string]} themes - name of class(es) to request\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setThemes: function setThemes(themes, fireUpdate) {\n                setOption(VAR_THEMES, themes, fireUpdate);\n            },\n\n            getThemes: function getThemes() {\n                return _options[VAR_THEMES];\n            },\n\n            /**\n             * @param {array[string]} publishers - name of class(es) to request\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setAgencies: function setAgencies(publishers, fireUpdate) {\n                setOption(VAR_PUBLISHERS, publishers, fireUpdate);\n            },\n\n            getAgencies: function getAgencies() {\n                return _options[VAR_PUBLISHERS];\n            },\n\n            /**\n             * @param {array[string]} svcTypes - ids\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setServiceTypes: function setServiceTypes(svcTypes, fireUpdate) {\n                setOption(VAR_SERVICE_TYPES, svcTypes, fireUpdate);\n            },\n\n            getServiceTypes: function getServiceTypes() {\n                return _options[VAR_SERVICE_TYPES];\n            },\n\n            /**\n             * @param {array[string]} schemes - ids\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setSchemes: function setSchemes(schemes, fireUpdate) {\n                setOption(VAR_SCHEMES, schemes, fireUpdate);\n            },\n\n            /**\n             * @param {string} visibility - one of 'public' or 'private'\n             * @param {boolean} fireUpdate\n             */\n            setVisibility: function setVisibility(visibility, fireUpdate) {\n                setOption(VAR_VISIBILITY, visibility, fireUpdate);\n            },\n\n            /** \n             * @param {Date} date - date to compare against\n             * @param {boolean} beforeOrAfter - flag specifying which boundary condition (true = before, false = after)\n             * @param {boolean} fireUpdate - flag specifying whether to trigger update automatically\n             */\n            setModified: function setModified(date, beforeOrAfter, fireUpdate) {\n\n                //if no date was supplied, consider it \"unset\" for both properties\n                if (!date) {\n                    setOption(VAR_MODIFIED_BEFORE, null, false);\n                    setOption(VAR_MODIFIED_AFTER, null, true);\n                    return;\n                }\n\n                var dir = beforeOrAfter && (beforeOrAfter === true || beforeOrAfter === \"true\");\n                var prop = dir ? VAR_MODIFIED_BEFORE : VAR_MODIFIED_AFTER; //property being set\n                var oppProp = dir ? VAR_MODIFIED_AFTER : VAR_MODIFIED_BEFORE; //unset opposite property\n                var arg = date && date.getTime ? date.getTime() : date;\n\n                setOption(oppProp, null, false);\n                setOption(prop, arg, true);\n            },\n\n            getModified: function getModified() {\n                return this._options[VAR_MODIFIED_BEFORE] || this._options[VAR_MODIFIED_AFTER];\n            },\n\n            /**\n             * @param {string} bboxStr - form of \"minx,miny,maxx,maxy\"\n             * @param {boolean} fireUpdate\n             */\n            setExtent: function setExtent(bboxStr) {\n                setOption(VAR_EXTENT, bboxStr, true);\n            },\n\n            /**\n             * @return {string} bbox string or null if not set\n             */\n            getExtent: function getExtent() {\n                return _options[VAR_EXTENT];\n            },\n\n            /**\n             * @return {array} list of selected items from current search results\n             */\n            getSelected: function getSelected() {\n                return _selected;\n            },\n\n            /**\n             * @param {array} arr - list of items to select in current search results\n             */\n            setSelected: function setSelected(arr) {\n                _selected = arr;\n                notify(this.events.SELECTED, _selected);\n            },\n\n            /**\n             * @param {string} id - identifier of item in current search results to add to selected list\n             */\n            select: function select(id) {\n\n                var finder = function finder(l) {\n                    return l.id === id;\n                };\n\n                var existing = _selected.find(finder);\n                if (existing) {\n                    //already selected, deselect it\n\n                    var idx = _selected.indexOf(existing);\n                    if (idx >= 0) {\n                        _selected.splice(idx, 1);\n                        notify(eventKey + 'selected:removed', existing);\n                    }\n                } else {\n                    //not selected, select it\n\n                    var obj = _results.find(finder);\n                    if (obj) {\n\n                        if (_onSelectFn) {\n                            _onSelectFn(id, function (err, item) {\n                                if (item) {\n                                    _selected.unshift(item);\n                                    notify(eventKey + 'selected:added', item);\n                                }\n                            });\n                        } else {\n                            _selected.unshift(obj);\n                            notify(eventKey + 'selected:added', obj);\n                        }\n                    }\n                }\n\n                notify(this.events.SELECTED, _selected);\n            },\n\n            /** \n             * @param {string} id - identifier of item to check\n             * @return {boolean} true if selected, false otherwise\n             */\n            isSelected: function isSelected(id) {\n                return _selected.find(function (obj) {\n                    return obj.id === id;\n                });\n            },\n\n            /**\n             * select all items in current page of results\n             */\n            selectAll: function selectAll() {\n                var _this4 = this;\n\n                angular.forEach(_results, function (obj) {\n                    if (!_this4.isSelected(obj.id)) _selected.unshift(obj);\n                });\n                notify(this.events.SELECTED, _selected);\n            },\n\n            /**\n             * empty list of selected items\n             */\n            clearSelected: function clearSelected() {\n                _selected = [];\n                notify(this.events.SELECTED, []);\n            },\n\n            /**\n             *\n             */\n            clear: function clear(refresh) {\n\n                for (var prop in _options) {\n                    if (!_options.hasOwnProperty(prop)) continue;\n                    if ('start' === prop) _options[prop] = 0;else if ('size' === prop) {} else if ('sort' === prop) _options[prop] = 'modified,desc';else if ('facets' === prop) _options[prop] = {};else _options[prop] = null;\n                }\n\n                if (refresh || typeof refresh === 'undefined') _doUpdate(true);\n            },\n\n            /*\n             * @param {string} category - name of facet\n             * @param {string} value - value of facet\n             */\n            setFacet: function setFacet(category, value) {\n\n                var f = _options.facets[category];\n                if (!f) //this facet category not set yet\n                    _options.facets[category] = value;else {\n                    //this facet category already set\n                    if (f === value) {\n                        //this facet value already set\n                        //unset it\n                        delete _options.facets[category];\n                    } else {\n                        //this facet value not set\n                        //set it\n                        _options.facets[category] = value;\n                    }\n                }\n\n                _doUpdate(true);\n            },\n\n            /**\n             * @param {array[string]} fields - list of field names to request for each search result\n             */\n            setFields: function setFields(fields) {\n                if (fields && typeof fields.push !== 'undefined') _fields = fields;\n            },\n\n            /**\n             * @param {int} start - beginning index of results to request\n             * @param {bool} andUpdate - trigger update (default is true)\n             */\n            start: function start(_start, andUpdate) {\n                _options.start = _start;\n                if (andUpdate && andUpdate === true) _doUpdate(false);\n            },\n\n            /**\n             * @param {int} size - page size to request\n             * @param {bool} andUpdate - trigger update (default is true)\n             */\n            size: function size(_size, andUpdate) {\n\n                _options.size = _size;\n\n                //find out which page in the new scheme the current first-result of current page\n                // will show up in, and set start so that it shows up with the new page size\n                var page = Math.floor(_options.start * 1 / _options.size * 1);\n                _options.start = page * (_options.size * 1);\n\n                if (andUpdate && andUpdate === true) _doUpdate(false);\n            },\n\n            /**\n             * @param {int} size - number of items to return in each page of results\n             */\n            pageSize: function pageSize(size) {\n                this.size(size, true);\n            },\n\n            /**\n             * @param {string} sort - form of <field>,<dir>\n             */\n            sort: function sort(_sort) {\n                _options.sort = _sort;\n                _doUpdate(false);\n            },\n\n            /**\n             * return {object} containing start index, page size, and total results\n             */\n            getPagination: function getPagination() {\n                return {\n                    start: _options.start,\n                    size: _options.size,\n                    pageSize: _options.size,\n                    total: _options.total,\n                    sizeOptions: _pageSizeBase\n                };\n            },\n\n            /**\n             * @return {array} list of key-value pairs of sort options\n             */\n            getSortOptions: function getSortOptions() {\n                return SORT_OPTIONS.slice(0);\n            },\n\n            /**\n             * @return {string} sorting parameter (field,order)\n             */\n            getSortValue: function getSortValue() {\n                return _options.sort;\n            },\n\n            /**\n             * @return {object} clone of the current set of query options\n             */\n            getQueryOptions: function getQueryOptions() {\n                return jQuery.extend({}, _options);\n            },\n\n            /**\n             *\n             */\n            hasQueryOptions: function hasQueryOptions() {\n                var result = false;\n                for (var k in _options) {\n                    if (_options.hasOwnProperty(k)) {\n\n                        if ('start' === k || 'size' === k || 'total' === k || 'sort' === k || 'order' === k || 'within' === k || 'facets' === k) continue;\n\n                        if (_selectedFacets.length) result = true;\n\n                        if (typeof _options[k] !== 'undefined' && _options[k] !== null) {\n                            result = true;\n                        }\n                    }\n                }\n                return result;\n            },\n\n            /** \n             * Triggers a refresh of current search results\n             * @param {boolean} resetStart - reset 'start' to 0 flag\n             */\n            update: function update(resetStart) {\n                dirty(0, resetStart);\n            },\n\n            reset: function reset() {\n                _options = {\n                    start: 0,\n                    size: _pageSizeBase[0],\n                    total: 0,\n                    sort: \"modified,desc\", order: \"asc\",\n                    facets: {}\n                };\n\n                _facets = [];\n                _selectedFacets = [];\n                _results = [];\n                _isLoading = false;\n                _selected = [];\n\n                if (_dirtyPromise) $timeout.cancel(_dirtyPromise);\n                _dirtyPromise = null;\n            },\n\n            destroy: function destroy() {\n                if (_dirtyPromise) $timeout.cancel(_dirtyPromise);\n            }\n        };\n    }\n\n    /**\n     * Factory for creating instances of BrowseObjectsService\n     */\n    function BrowseServiceFactory($rootScope, $timeout, $resource) {\n\n        return function (options) {\n            var svc = BrowseObjectsService($rootScope, $timeout, $resource, options);\n            if (options && options.params) svc.applyOptions(options.params);\n            return svc;\n        };\n    }\n\n    angular.module('gp-common')\n\n    //generic browse service\n    .service(\"BrowseObjectsService\", ['$rootScope', '$timeout', '$resource', BrowseObjectsService])\n\n    //factory for creating specific browse services\n    .factory(\"BrowseServiceFactory\", ['$rootScope', '$timeout', '$resource', 'BrowseObjectsService', BrowseServiceFactory]);\n\n    /* \n        Example of how to use the factory to customize a service\n    \n        //layer-specific browse service\n        .service('BrowseLayerObjService', ['BrowseServiceFactory', function(BrowseServiceFactory) {\n            let service = BrowseServiceFactory({ \n                key: 'layers',\n                url: Constants.ualUrl + '/api/layers' \n            });\n            \n            //add custom methods here\n    \n            return service;\n        }])\n    */\n})(angular, GeoPlatform);\n(function (angular) {\n\n    'use strict';\n\n    /* *********************************************\n     * Requires socket.io be in the global namespace\n     * tested with version 2.x\n     * ********************************************* */\n\n    /*\n       Usage:\n        let service = ...\n        let svcId = service.getId();\n        //listen to events from the server\n       service.on('testing', (event) => { \n           if(event.clientId === svcId) return; //ignore our own events\n           ... do something ...\n       });\n       \n       //sends out a message to others\n       service.emit( service.events.CREATED, 'test');\n        //sends out a message to others\n       service.begin(service.events.EDITING, 'test');\n        //sends out a message to others\n       service.end(service.events.EDITING, 'test');\n        //stop listening and close the socket\n       service.close();\n      */\n\n    /**\n     *\n     */\n\n    var SocketService = function () {\n        function SocketService(url, options) {\n            'ngInject';\n\n            var _this5 = this;\n\n            _classCallCheck(this, SocketService);\n\n            var opts = (typeof options === \"undefined\" ? \"undefined\" : _typeof(options)) === 'object' ? options : {};\n            for (var key in opts) {\n                this[key] = opts[key];\n            }this.socket = null;\n\n            //list of ids of things being tracked, such as \n            // items edited, in order to send messages\n            // about the things lifecycle\n            this.tracking = {};\n\n            //events supported.\n            // Note that lifecycles can be added by using the \n            // begin() and end() methods on the service,\n            // which appends '_start' and '_end' respectively\n            this.events = {\n                CREATED: 'created',\n                UPDATED: 'updated',\n                DELETED: 'deleted',\n                EDITING: 'editing',\n                STATUS: 'status'\n            };\n\n            if (typeof io === 'undefined') {\n                console.log(\"Socket.IO not found in global namespace\");\n                return;\n            }\n\n            if (!url) {\n                //TODO validate URL with regex?\n                console.log(\"No web socket URL configured for this app to communicate with\");\n                return;\n            }\n\n            //make connection\n            this.socket = io.connect(url);\n\n            //listen for the init event indicating connection has been made\n            // and to get the socket's id from the server\n            this.socket.on(\"init\", function (evt) {\n                _this5.socketId = evt.id;\n            });\n\n            //if unable to connect\n            this.socket.on('error', function () {\n                console.log(\"Unable to connect to \" + url + \" with websockets\");\n            });\n        }\n\n        /**\n         *\n         */\n\n\n        _createClass(SocketService, [{\n            key: \"getId\",\n            value: function getId() {\n                return this.socketId;\n            }\n\n            /**\n             * @param {string} eventName\n             * @param {Function} callback\n             * @return {Function} to remove the listener\n             */\n\n        }, {\n            key: \"on\",\n            value: function on(eventName, callback) {\n                var _this6 = this;\n\n                if (!this.socket) return function () {};\n                //add the listener to the socket\n                this.socket.on(eventName, callback);\n                //return an 'off' function to remove the listener\n                return function () {\n                    _this6.socket.off(eventName, callback);\n                };\n            }\n\n            /**\n             *\n             */\n\n        }, {\n            key: \"emit\",\n            value: function emit(eventName, data, callback) {\n                if (!this.socket) return;\n                this.socket.emit(eventName, data, callback);\n            }\n\n            /**\n             * Closes this service's socket\n             */\n\n        }, {\n            key: \"close\",\n            value: function close() {\n                var _this7 = this;\n\n                //if this app was tracking an obj, \n                // notify listeners that it is no longer\n                for (var event in this.tracking) {\n                    if (this.tracking.hasOwnProperty(event)) {\n                        var tracks = this.tracking[event];\n                        if (tracks && tracks.length) {\n                            /* jshint ignore:start */\n                            angular.forEach(tracks, function (id) {\n                                _this7.end(event, id);\n                            });\n                            /* jshint ignore:end */\n                        }\n                    }\n                }\n\n                if (this.socket) {\n                    this.socket.close();\n                    this.socket = null;\n                }\n\n                return null;\n            }\n\n            /**\n             * @param {string} event - name of the event being started\n             * @param {string} objId - identifier of the item being tracked\n             */\n\n        }, {\n            key: \"begin\",\n            value: function begin(event, objId) {\n                var _this8 = this;\n\n                this.tracking[event] = this.tracking[event] || [];\n                this.tracking[event].push(objId);\n\n                var room = objId + \"_\" + event.toLowerCase();\n\n                this.join(room, function () {\n                    _this8.socket.emit(event, room, _this8.socketId, true);\n                });\n            }\n\n            /**\n             * @param {string} event - name of the event being ended\n             * @param {string} objId - identifier of the item being tracked\n             */\n\n        }, {\n            key: \"end\",\n            value: function end(event, objId) {\n                var _this9 = this;\n\n                this.tracking[event] = this.tracking[event] || [];\n                if (!this.tracking[event].length) return; //empty, ignore request\n\n                var idx = this.tracking[event].indexOf(objId);\n                if (idx < 0) //not found, ignore request\n\n                    //remove tracker\n                    this.tracking[event].splice(idx, 1);\n\n                //send event to server about client stopping it's tracking\n                var room = objId + \"_\" + event.toLowerCase();\n                this.socket.emit(event, room, this.socketId, false, function () {\n                    _this9.leave(room);\n                });\n            }\n\n            /**\n             *\n             */\n\n        }, {\n            key: \"join\",\n            value: function join(objId, callback) {\n                this.emit('join', objId, callback);\n            }\n\n            /**\n             *\n             */\n\n        }, {\n            key: \"leave\",\n            value: function leave(objId, callback) {\n                this.emit('leave', objId, callback);\n            }\n        }]);\n\n        return SocketService;\n    }();\n\n    /** \n     * Factory to get a Service used to listen for WebSocket messages from a server\n     *\n     * Usage: \n     *\n     * let wsUrl = ...\n     * let service = SocketServiceFactory(wsUrl);\n     *\n     */\n\n\n    angular.module('gp-common').factory('SocketServiceFactory', function ($rootScope, $window, UUID) {\n\n        var cache = {};\n\n        //disconnect whenever the app is closed\n        var onClose = function onClose(e) {\n            for (var key in cache) {\n                if (cache.hasOwnProperty(key)) {\n                    cache[key].close();\n                    cache[key] = null;\n                }\n            }\n            cache = null;\n            return null;\n        };\n\n        //needed for reload/backbtn\n        if ($window.onbeforeunload === 'function') {\n            var existing = $window.onbeforeunload;\n            $window.onbeforeunload = function (e) {\n                onClose(e);\n                return existing(e);\n            };\n        } else {\n            $window.onbeforeunload = onClose;\n        }\n\n        $rootScope.$on('$destroy', onClose);\n        //-------------------\n\n\n        return function (url) {\n\n            // if(!url) return null;\n            // if(cache[url]) return cache[url];\n\n            var cacheRef = UUID();\n            var service = new SocketService(url, $rootScope, { cacheRef: cacheRef });\n            var closeDelegate = service.close;\n            service.close = function () {\n                var id = service.cacheRef;\n                closeDelegate.call(service); //have service disconnect and clean up itself\n                //then clean up cache reference\n                delete cache[id];\n            };\n\n            var onDelegate = service.on;\n            service.on = function (event, callback) {\n\n                if (typeof callback === 'function') {\n                    //have to use old-school refs instead of arrow functions\n                    // or else the arguments get scrambled\n                    var handle = function handle() {\n                        var args = arguments;\n                        $rootScope.$apply(function () {\n                            callback.apply(service.socket, args);\n                        });\n                    };\n                    return onDelegate.call(service, event, handle);\n                } else {\n                    return onDelegate.call(service, event);\n                }\n            };\n\n            var emitDelegate = service.emit;\n            service.emit = function (event, data, callback) {\n\n                if (typeof callback === 'function') {\n                    //have to use old-school refs instead of arrow functions\n                    // or else the arguments get scrambled\n                    var handle = function handle() {\n                        var args = arguments;\n                        $rootScope.$apply(function () {\n                            callback.apply(service.socket, args);\n                        });\n                    };\n                    emitDelegate.call(service, event, data, handle);\n                } else {\n                    emitDelegate.call(service, event, data);\n                }\n            };\n\n            // cache[url] = service;\n            cache[cacheRef] = service;\n            return service;\n        };\n    });\n})(angular);\n(function (angular) {\n\n    'use strict';\n\n    angular.module(\"gp-common\").factory('UUID', function () {\n\n        function s4() {\n            return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);\n        }\n\n        /*\n        return function() {\n                return s4() + s4() + '-' + s4() + '-' + s4() + '-' +\n                    s4() + '-' + s4() + s4() + s4();\n            }\n         */\n\n        return function () {\n            // http://www.ietf.org/rfc/rfc4122.txt\n            var s = [];\n            var hexDigits = \"0123456789abcdef\";\n            for (var i = 0; i < 36; i++) {\n                s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);\n            }\n            s[14] = \"4\"; // bits 12-15 of the time_hi_and_version field to 0010\n            s[19] = hexDigits.substr(s[19] & 0x3 | 0x8, 1); // bits 6-7 of the clock_seq_hi_and_reserved to 01\n            s[8] = s[13] = s[18] = s[23] = \"-\";\n            return s.join(\"\");\n        };\n    });\n})(angular);\n(function (angular) {\n\n    'use strict';\n\n    //flag on whether we're in dev env\n\n    function isDEV() {\n        return \"localhost\" === window.location.hostname || ~window.location.hostname.indexOf(\"192.168\") || ~window.location.hostname.indexOf(\"10.0\");\n    }\n\n    /** \n     * GeoPlatform Common Module Authentication Support\n     *\n     * Contains re-usable services, directives, and other angular components\n     *\n     * \n     * NOTE: This module uses certain variables in $rootScope in order to \n     * perform actions like authentication.  The following variables should be\n     * set before using any service/directive in this file:\n     *\n     *   - idspUrl : the url to the identity service provider server\n     *   - idmUrl : the url to the identity management server\n     *   - portalUrl : the url to the main landing page of GeoPlatform (www.geoplatform.gov in production) \n     */\n    angular.module('gp-common')\n\n    /**\n     * Authentication Service\n     * \n     * Because the auth service redirects the page to the IDM portal\n     * and WMV is reloaded once the login/logout processes are complete,\n     * there's no need to bind listeners informing other components of \n     * an auth change.\n     *\n     * Inside \"DEV\", you should close and re-open any components' widgets\n     * to get current auth status.\n     */\n    .service('AuthenticationService', ['$q', '$http', 'GPConfig', function ($q, $http, Config) {\n\n        // console.log(\"IDSP Base Url: \" + Config.idspUrl);\n\n        function User(opts) {\n            for (var p in opts) {\n                this[p] = opts[p];\n            }\n            if (!this.id && this.username) this.id = this.username;\n\n            this.toJSON = function () {\n                return {\n                    id: this.id,\n                    username: this.username,\n                    name: this.name,\n                    email: this.email,\n                    org: this.org,\n                    roles: this.roles\n                };\n            };\n            this.clone = function () {\n                return new User(this.toJSON());\n            };\n            this.compare = function (arg) {\n                if (arg instanceof User) {\n                    return this.id === arg.id;\n                } else if ((typeof arg === \"undefined\" ? \"undefined\" : _typeof(arg)) === 'object') {\n                    return typeof arg.id !== 'undefined' && arg.id === this.id;\n                }\n                return false;\n            };\n            this.isAuthorized = function (role) {\n                var env = Config.env || Config.ENV || Config.NODE_ENV;\n                if (env === 'dev' || env === 'development') return true;\n                return this.roles && ~this.roles.indexOf(role);\n            };\n        }\n\n        var TEST_USER = new User({\n            id: \"tester\",\n            username: \"tester\",\n            email: \"tester@geoplatform.us\",\n            name: \"John Test\",\n            org: \"Other\"\n        });\n\n        var _user = null;\n\n        if (isDEV()) {\n\n            /*\n             * If testing when user is not logged in, inject the following before\n             *  this ng-common library is included in the page:\n             * \n             *     GeoPlatform.TEST_NO_AUTH = true;\n             * \n             *  but be sure to inject AFTER the GeoPlatform configuration object exists!\n             */\n            if (GeoPlatform && GeoPlatform.TEST_NO_AUTH) _user = null;else _user = TEST_USER.clone();\n        }\n\n        var STATUS = {\n            NONE: 0,\n            INITIALIZING: -1, //auth check in progress\n            INITIALIZED: 1 //auth check completed\n        };\n\n        /** \n         * @param {string} cookie - a concatenated string of user info\n         * @return {object|null} user info\n         */\n        function parseCookie(cookie) {\n\n            // console.log(cookie);\n            if (!cookie || !cookie.length) return null;\n\n            var data = {};\n\n            var str = decodeURIComponent(cookie);\n            var parts = str.split('+');\n            parts = parts.map(function (part) {\n                var kvp = part.split(':');\n                data[kvp[0]] = kvp.slice(1).join(':');\n            });\n\n            data.groups = data.groups ? data.groups.split(',') : [];\n            // console.log(data.groups);\n\n            return data;\n        }\n\n        function getRoles() {\n            var cookie = document.cookie.replace(/(?:(?:^|.*;\\s*)AUTHENTICATEDGEOSAML\\s*\\=\\s*([^;]*).*$)|^.*$/, \"$1\");\n            var user = parseCookie(cookie);\n            return user ? user.groups : [];\n        }\n\n        /**\n         * Authentication Service\n         */\n        var Service = function Service() {\n\n            var self = this;\n\n            this.status = STATUS.NONE;\n\n            //$q version of getUser\n            this.getUserQ = function () {\n                var deferred = $q.defer();\n                this.getUser(function (user) {\n                    deferred.resolve(user);\n                });\n                return deferred.promise;\n            };\n\n            /**\n             * If the callback parameter is specified, this method\n             * will return undefined. Otherwise, it returns the user (or null).\n             *\n             * @param callback optional function to invoke with the user\n             * @return object representing current user\n             */\n            this.getUser = function (callback) {\n                if (callback && typeof callback === 'function') {\n\n                    // console.log(\"Getting user info: \" + self.status + \", \" + JSON.stringify(_user||{empty:true}));\n\n                    //if already checked, return what we have\n                    if (self.status === STATUS.INITIALIZED) callback(_user);\n                    //if not in process of checking, check\n                    else if (self.status !== STATUS.INITIALIZING) {\n                            //if hasn't been checked for auth yet, do that now\n                            self.check().then(function (_user) {\n                                self.status = STATUS.INITIALIZED;\n                                callback(_user);\n                            }, function () {\n                                self.status = STATUS.INITIALIZED;\n                                callback(null);\n                            });\n                        }\n                        //if in process of checking, wait until it finishes\n                        else {\n                                setTimeout(function () {\n                                    self.getUser(callback);\n                                }, 500);\n                            }\n                    return;\n                }\n                return _user;\n            };\n\n            /**\n             * @return {string} current HREF of the application\n             */\n            this.getCurrentLocation = function () {\n                return window.location.href;\n            };\n\n            /**\n             * @param {function} callback - callbackFn( doneFn ) { ... doneFn(); }\n             */\n            this.onBeforeLogin = function (callback) {\n                if (callback) {\n                    this.beforeLoginFn = function () {\n                        var deferred = $q.defer();\n                        callback(function () {\n                            deferred.resolve();\n                        });\n                        return deferred.promise;\n                    };\n                } else {\n                    this.beforeLoginFn = null;\n                }\n            };\n\n            /**\n             * Redirects the page to the login site\n             */\n            this.login = function () {\n                var _this10 = this;\n\n                var promise = this.beforeLoginFn ? this.beforeLoginFn() : $q.resolve();\n                promise.then(function () {\n\n                    if (isDEV() && !(GeoPlatform && GeoPlatform.TEST_NO_AUTH)) {\n                        _user = TEST_USER.clone();\n                        return _user;\n                    }\n                    var current = _this10.getCurrentLocation();\n                    window.location = Config.idspUrl + '/module.php/core/as_login.php?AuthId=geosaml&ReturnTo=' + encodeURIComponent(current);\n                });\n            };\n\n            /**\n             * @param {function} callback - callbackFn( doneFn ) { ... doneFn(); }\n             */\n            this.onBeforeLogout = function (callback) {\n                if (callback) {\n                    this.beforeLogoutFn = function () {\n                        var promise = $q.defer();\n                        callback(function () {\n                            promise.resolve();\n                        });\n                        return promise;\n                    };\n                } else {\n                    this.beforeLogoutFn = null;\n                }\n            };\n\n            /**\n             * Redirects the page to the logout site\n             */\n            this.logout = function () {\n                var _this11 = this;\n\n                var promise = this.beforeLogoutFn ? this.beforeLogoutFn() : $q.resolve();\n                promise.then(function () {\n\n                    if (isDEV()) {\n                        _user = null;\n                        return _user;\n                    }\n                    var current = _this11.getCurrentLocation();\n                    window.location = Config.idspUrl + '/module.php/core/as_logout.php?AuthId=geosaml&ReturnTo=' + encodeURIComponent(curfalse);\n                });\n            };\n\n            /**\n             * Queries simplesamlphp if the current session is authenticated\n             * @return promise - then(function(user) {}, function(response){})\n             */\n            this.check = function () {\n\n                var deferred = $q.defer();\n\n                if (isDEV()) {\n                    // console.log(\"Dev env\");\n                    setTimeout(function () {\n                        deferred.resolve(_user);\n                    }, 1000);\n                    return deferred.promise;\n                }\n\n                self.status = STATUS.INITIALIZING;\n\n                //check authentication on load\n                var promise = $http.get(Config.idspUrl + '/authenticategeosaml.php?as=geosaml');\n                promise.then(function (response) {\n\n                    var content = response.data ? response.data : response;\n\n                    // console.log(\"Received from SP: \" + content);\n                    if (typeof content === 'string') {\n                        try {\n                            content = JSON.parse(content);\n                        } catch (e) {\n                            deferred.reject(e);\n                            return;\n                        }\n                    }\n\n                    if (content.Success) {\n                        //authenticated\n                        _user = new User({\n                            id: content.name[0],\n                            username: content.name[0],\n                            email: content.mail[0],\n                            name: content.first_name[0] + ' ' + content.last_name[0],\n                            org: content.organization[0],\n                            roles: getRoles()\n                        });\n                        // console.log(\"Authenticated user: \" + JSON.stringify(_user));\n                    } else {\n                        _user = null; //not authenticated\n                        // console.log(\"Failed to authenticate user\");\n                    }\n\n                    deferred.resolve(_user);\n                }, function (data, status, headers) {\n                    // failed check\n                    // console.log(\"Authentication call failed\");\n                    deferred.reject(data);\n                }).catch(function (e) {\n                    // console.log(\"Authentication check caught an error: \" + e.message);\n                    deferred.reject(e.message);\n                });\n\n                return deferred.promise;\n            };\n\n            //=====================================================\n\n            //initialize with auth check\n            this.check().then(function (user) {\n                self.status = STATUS.INITIALIZED;\n            }, function (err) {\n                self.status = STATUS.INITIALIZED;\n            }).catch(function (e) {\n                // console.log(\"Initial auth check errored\");\n            });\n        };\n\n        return new Service();\n    }]).directive('gpLoginButton', ['$timeout', 'AuthenticationService', 'GPConfig', function ($timeout, AuthenticationService, Config) {\n        return {\n            scope: {\n                minimal: '@'\n            },\n            replace: true,\n            template: ['<div class=\"btn-account btn-group\">' +\n\n            //not logged in\n            '  <a class=\"btn btn-link\" ng-click=\"login()\" ng-if=\"!user\">Sign In</a>' +\n\n            //logged in\n            '  <button type=\"button\" class=\"btn btn-link dropdown-toggle\" data-toggle=\"dropdown\" ' + '   aria-expanded=\"false\" ng-if=\"user\">' + '     <span class=\"glyphicon glyphicon-user\"></span> ' + '     <span class=\"hidden-xs\">{{::user.name}}</span> ' + '     <span class=\"caret\"></span>' + '  </button>' + '  <ul class=\"dropdown-menu dropdown-menu-right\" role=\"menu\" ng-if=\"user\">' + '    <li class=\"account-details\">' + '      <div class=\"media\">' + '        <div class=\"media-left\">' + '          <div class=\"media-object\">' + '            <span class=\"glyphicon glyphicon-user glyphicon-xlg\"></span>' + '          </div>' + '        </div>' + '        <div class=\"media-body\">' + '          <div class=\"media-heading\">{{::user.name}}</div>' + '          <div><em>{{::user.username}}</em></div>' + '          <div>{{::user.email}}</div>' + '          <div>{{::user.org}}</div>' + '        </div>' + '      </div>' + '    </li>' + '    <li class=\"divider\"></li>' + '    <li><a href=\"{{::idpUrl}}/modifyuser.html\">Edit Info</a></li>' + '    <li><a href=\"{{::idpUrl}}/changepassword.html\">Change Password</a></li>' + '    <li><a href ng-click=\"logout()\">Sign Out</a></li>' + '  </ul>' + '</div>'].join(' '),\n            controller: function controller($scope, $element) {\n\n                if ($scope.minimal === 'true') $scope.minimal = true;\n                if ($scope.minimal !== true) $scope.minimal = false;\n\n                $scope.idpUrl = Config.idmUrl;\n                // console.log(\"IDM Base Url: \" + Config.idmUrl);\n\n                AuthenticationService.getUser(function (user) {\n                    $timeout(function () {\n                        $scope.user = user;\n                    }, 100);\n                });\n\n                $scope.login = function () {\n                    $scope.user = AuthenticationService.login();\n                };\n\n                $scope.logout = function () {\n                    $scope.user = AuthenticationService.logout();\n                };\n\n                //watch user for changes (timeouts)\n                var watcher = $scope.$watch(function () {\n                    return AuthenticationService.getUser();\n                }, function (newUser) {\n                    $scope.user = newUser;\n                });\n\n                $scope.$on('$destroy', function () {\n                    watcher(); //destroy watcher\n                });\n            }\n        };\n    }]).directive('gpAccountDetails', ['$timeout', 'AuthenticationService', 'GPConfig', function ($timeout, AuthenticationService, Config) {\n\n        return {\n            scope: {},\n            replace: true,\n            template: ['<div>' + '  <div class=\"media\">', '    <div class=\"media-left\">', '        <div class=\"media-object\">', '            <span class=\"glyphicon glyphicon-user glyphicon-xlg\"></span>', '        </div>', '    </div>', '    <div class=\"media-body\" ng-if=\"user\">', '       <div class=\"media-heading\">{{::user.name}}</div>' + '       <div><small><em>{{::user.username}}</em></small></div>' + '       <div><small>{{::user.email}}</small></div>' + '       <div><small>{{::user.org}}</small></div>' + '    </div>', '    <div class=\"media-body\" ng-if=\"!user\">', '       <div class=\"media-heading\">Please Sign In</div>' + '       <div><small>Sign in to your GeoPlatform account or register a new account.</small></div>' + '    </div>', '  </div>', '  <hr/>', '  <div ng-if=\"user\">', '    <button type=\"button\" class=\"btn btn-sm btn-accent pull-right\" ng-click=\"logout()\">Sign Out</button>' + '    <a class=\"btn btn-sm btn-default\" href=\"{{::idpUrl}}/modifyuser.html\">Edit Details</a>' + '  </div>', '  <div ng-if=\"!user\">', '    <button type=\"button\" class=\"btn btn-sm btn-accent pull-right\" ng-click=\"login()\">Sign In</button>' + '    <a class=\"btn btn-sm btn-default\" href=\"{{::idpUrl}}/registeruser.html\">Register</a>' + '  </div>', '</div>'].join(' '),\n            controller: function controller($scope, $element) {\n\n                $scope.idpUrl = Config.idmUrl;\n\n                AuthenticationService.getUser(function (user) {\n                    $timeout(function () {\n                        $scope.user = user;\n                    }, 100);\n                });\n\n                $scope.login = function () {\n                    $scope.user = AuthenticationService.login();\n                };\n\n                $scope.logout = function () {\n                    $scope.user = AuthenticationService.logout();\n                };\n\n                //watch user for changes (timeouts)\n                var watcher = $scope.$watch(function () {\n                    return AuthenticationService.getUser();\n                }, function (newUser) {\n                    $scope.user = newUser;\n                });\n\n                $scope.$on('$destroy', function () {\n                    watcher(); //destroy watcher\n                });\n            }\n        };\n    }]);\n})(angular);\n(function () {\n\n    \"use strict\";\n\n    if (typeof Array.prototype.find === 'undefined') {\n        Array.prototype.find = function (callback) {\n            for (var i = 0; i < this.length; ++i) {\n                if (callback(this[i], i, this)) return this[i];\n            }\n            return null;\n        };\n    }\n    if (typeof Array.prototype.filter === 'undefined') {\n        Array.prototype.filter = function (callback) {\n            var results = [];\n            for (var i = 0; i < this.length; ++i) {\n                if (callback(this[i], i, this)) results.push(this[i]);\n            }\n            return results;\n        };\n    }\n    if (typeof Array.prototype.each === 'undefined') {\n        Array.prototype.each = function (callback) {\n            for (var i = 0; i < this.length; ++i) {\n                callback(this[i], i, this);\n            }\n        };\n    }\n    if (typeof Array.prototype.indexOfObj === 'undefined') {\n        Array.prototype.indexOfObj = function (obj, comparatorFn) {\n\n            var arr = this,\n                len = arr.length;\n\n            if (typeof comparatorFn !== 'function') comparatorFn = function comparatorFn(a, b) {\n                return a === b;\n            };\n\n            for (var i = 0; i < len; ++i) {\n                if (comparatorFn(obj, arr[i])) return i;\n            }\n            return -1;\n        };\n    }\n    if (typeof String.prototype.startsWith === 'undefined') {\n        String.prototype.startsWith = function (value) {\n            var str = this;\n            if (!str.length) return false;\n            if (!value.length) return false;\n            if (str.length < value.length) return false;\n            return str.indexOf(value) === 0;\n        };\n    }\n    if (typeof String.prototype.endsWith === 'undefined') {\n        String.prototype.endsWith = function (value) {\n            var str = this;\n            if (!str.length) return false;\n            if (!value.length) return false;\n            if (str.length < value.length) return false;\n            var substr = str.substring(str.length - value.length, str.length);\n            return substr == value;\n        };\n    }\n\n    if (typeof Date.prototype.plus === 'undefined') {\n        Date.prototype.plus = function (offset) {\n\n            var type = typeof offset === \"undefined\" ? \"undefined\" : _typeof(offset);\n            if (type === 'undefined') return this;\n\n            var offsetMS = 0;\n            if (type === 'string') {\n                switch (offset) {\n                    case 'hour':\n                        offsetMS = 1000 * 60 * 60;break;\n                    case 'day':\n                        offsetMS = 1000 * 60 * 60 * 24;break;\n                    case 'week':\n                        offsetMS = 1000 * 60 * 60 * 24 * 7;break;\n                    case 'month':\n                        offsetMS = 1000 * 60 * 60 * 24 * 31;break;\n                    case 'year':\n                        offsetMS = 1000 * 60 * 60 * 24 * 365;break;\n                }\n            } else if (type === 'number') {\n                offsetMS = offset;\n            } else return this;\n\n            var d = this;\n            return new Date(d.getTime() + offsetMS);\n        };\n    }\n\n    if (typeof Date.prototype.random === 'undefined') {\n        Date.prototype.random = function (threshold) {\n\n            var type = typeof threshold === \"undefined\" ? \"undefined\" : _typeof(threshold);\n            if (type === 'undefined') return this;\n\n            var offsetMS = 0;\n            if (type === 'string') {\n                switch (threshold) {\n                    case 'hour':\n                        offsetMS = 1000 * 60 * 60;break;\n                    case 'day':\n                        offsetMS = 1000 * 60 * 60 * 24;break;\n                    case 'week':\n                        offsetMS = 1000 * 60 * 60 * 24 * 7;break;\n                    case 'month':\n                        offsetMS = 1000 * 60 * 60 * 24 * 31;break;\n                    case 'year':\n                        offsetMS = 1000 * 60 * 60 * 24 * 365;break;\n                }\n            } else if (type === 'number') {\n                offsetMS = threshold;\n            } else return this;\n\n            var d = this;\n            return new Date(d.getTime() + Math.floor(Math.random() * offsetMS));\n        };\n    }\n})();","(function(jQuery, angular) {\n    \n    \"use strict\"; \n    \n    angular.module(\"gp-common\", [])\n\n    //Assumes a global has been set\n    // Don't use these... deprecated\n    .constant('idspBaseUrl', GeoPlatform.idspUrl)\n    .constant('idmBaseUrl', GeoPlatform.idmUrl)\n\n    //Assumes a global object containing configuration values for GeoPlatform exists \n    // prior to this module being declared\n    // (using 'value' since config might change)\n    .value('GPConfig', GeoPlatform)\n\n    ;\n\n})(jQuery, angular);","(function(angular) {\n    \n    \"use strict\";\n\n    const ACTIVATORS_HTML = \n        `\n            <div class=\"gp-ui-card__details-activator--left\" title=\"Show previous details\"\n                ng-class=\"{disabled:!hasPrevious()}\" ng-click=\"previousDetails()\">\n                <span class=\"glyphicon glyphicon-chevron-left\"></span>\n            </div>\n            <div class=\"gp-ui-card__details-activator--right\" title=\"Show next details\"\n                ng-class=\"{disabled:!hasNext()}\" ng-click=\"nextDetails()\">\n                <span class=\"glyphicon glyphicon-chevron-right\"></span>\n            </div>\n        `;\n\n\n\n    /*\n     * Appends carousel-like activators onto a card section\n     * Usage: \n     *\n     *  <div class=\"text--supporting\" card-details-carousel-activator>\n     *      <div class=\"gp-ui-card__details active\" id=\"description\">...</div>    \n     *      <div class=\"gp-ui-card__details\" id=\"author\">...</div>        \n     *  </div>\n     */\n    angular.module(\"gp-common\").directive('cardDetailsCarouselActivator', function() {\n\n        return {\n\n            compile: function($element) {\n                $element.append(ACTIVATORS_HTML);\n            },\n\n            controller: function($scope, $element) {\n\n                $scope.hasPrevious = function() {\n                    let pane = $element.find('.gp-ui-card__details.active');\n                    return pane.prevAll('.gp-ui-card__details').length;\n                };\n\n                $scope.hasNext = function() {\n                    let pane = $element.find('.gp-ui-card__details.active');\n                    return pane.nextAll('.gp-ui-card__details').length;\n                };\n\n                $scope.previousDetails = function() {\n                    if(!$scope.hasPrevious()) return;\n                    let pane = $element.find('.gp-ui-card__details.active');\n                    pane.removeClass('active');\n                    pane = pane.prevAll('.gp-ui-card__details');\n                    if(pane.length)\n                        angular.element(pane[0]).addClass('active');\n                };\n\n                $scope.nextDetails = function() {\n                    if(!$scope.hasNext()) return;\n                    let pane = $element.find('.gp-ui-card__details.active');\n                    pane.removeClass('active');\n                    pane = pane.nextAll('.gp-ui-card__details');\n                    if(pane.length)\n                        angular.element(pane[0]).addClass('active');\n                };\n\n            }\n        };\n    });\n\n}) (angular);","(function(jQuery, angular) {\n\n    'use strict';\n\n\n\n    /**\n     * determines whether an rgb value is invalid\n     * the value starts as false (the rbg value is valid)\n     * and is invalidated if the value(s) are empty, greater than 255 or less than 0\n     *\n     * @param rgb either an object { r: 0, g: 0, b: 0 } or a single value\n     * @returns {boolean} whether the rgb value is invalid\n     */\n    function invalidRGB(rgb) {\n        var error = false;\n\n        if(rgb instanceof Object) {\n            var r = parseInt(rgb.r, 10);\n            var g = parseInt(rgb.g, 10);\n            var b = parseInt(rgb.b, 10);\n\n            if(r > 255 || r < 0 || (!r && r !== 0)) error = true;\n            if(g > 255 || g < 0 || (!g && g !== 0)) error = true;\n            if(b > 255 || b < 0 || (!b && b !== 0)) error = true;\n        } else {\n            var x = parseInt(rgb, 10);\n            if(x > 255 || x < 0 || (!x && x !== 0)) error = true;\n        }\n\n        return error;\n    }\n\n    /**\n     * converts a decimal (base 10) number to hex (base 16) string\n     *\n     * @param c base 10 number\n     * @returns {*} base 16 string\n     */\n    function componentToHex(c) {\n        var hex = c.toString(16), result = null;\n\n        if(!isNaN(c) && !invalidRGB(c))\n            result = hex.length == 1 ? '0' + hex : hex;\n\n        return result;\n    }\n\n    /**\n     * converts an rgb object to a hexadecimal string\n     *\n     * @param rgb object { r: 0, g: 0, b: 0 }\n     * @returns {*} hexadecimal string\n     */\n    function rgbToHex(rgb) {\n        var result = null;\n\n        var r = componentToHex(parseInt(rgb.r, 10));\n        var g = componentToHex(parseInt(rgb.g, 10));\n        var b = componentToHex(parseInt(rgb.b, 10));\n\n        if(r && g && b) result = '#' + r + g + b;\n\n        return result;\n    }\n\n    /**\n     * determines whether a hex value is valid\n     *\n     * @param hex string value\n     * @returns hex value or null if hex is invalid\n     */\n    function validHex(hex) {\n        return  (/^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i).exec(hex) || null;\n    }\n\n    /**\n     * converts a hex string to rgb object\n     *\n     * @param hex string\n     * @returns {*} rgb object { r: 0, g: 0, b: 0 }\n     */\n    function hexToRgb(hex) {\n        // Expand shorthand form (e.g. '03F') to full form (e.g. '0033FF')\n        var shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n        hex = hex.replace(shorthandRegex, function(m, r, g, b) {\n            return r + r + g + g + b + b;\n        });\n\n        var result = validHex(hex);\n        return result ? {\n            r: parseInt(result[1], 16),\n            g: parseInt(result[2], 16),\n            b: parseInt(result[3], 16)\n        } : null;\n    }\n\n\n\n\n    /**\n     * Advanced Color Picker Directive (advanced-color-picker)\n     * This color picker is meant to augment the functionality in angular-bootstrap-colorpicker\n     * It adds the ability to change the color with RGB and Hex\n     * It needs to be used in a container that has at least 160px of vertical real estate\n     *\n     * You must pass in the following:\n     *   - ngModel  (a hexadecimal string color value)\n     *   - onChange (the event to be fired when the value changes)\n     *\n     * Usage Example:\n     * <div advanced-color-picker ng-model=\"hexColor\" ng-change=\"changeEvent()\"></div>\n     */\n     angular.module('gp-common').component('gpColorPicker', {\n\n        bindings: {\n            ngModel : '=',\n            onChange: '&'\n        },\n\n        controller: function($timeout, $q) {\n            \n            // fired when an rgb value is changed\n            this.changeRGB = function() {\n                \n                // make sure rgb color value is correct\n                this.rgbError = invalidRGB(this.rgb);\n\n                // parse it anyways leaving hex value blank until valid rbg\n                this.ngModel = rgbToHex(this.rgb);\n\n                // have to use timeout to make sure ngModel is set before\n                // firing change event upstream\n                var self = this;\n                $timeout(function() {\n                    self.onChange({value: self.ngModel});\n                });\n\n            };\n\n            // fired when a hex value is changed\n            this.changeHex = function() {\n            \n                // make sure the hex color value is correct\n                if(!validHex(this.ngModel))\n                    this.hexError = 'Invalid hex color value';\n                else this.hexError = false;\n\n                // parse it anyway leaving rgb values blank until it's a valid hex\n                this.rgb = hexToRgb(this.ngModel);\n\n                // have to use timeout to make sure ngModel is set before\n                // firing change event upstream\n                var self = this;\n                $timeout(function() {\n                    self.onChange({value: self.ngModel});\n                });\n\n            };\n\n\n            this.$onInit = function() {\n                this.rgb = hexToRgb(this.ngModel);\n            };\n\n                \n        },\n\n        template: \n        `\n            <div class=\"gp-colorpicker\">\n                <div class=\"form-group hex-form-group\" ng-class=\"{'has-error':$ctrl.hexError}\">\n                    <input type=\"text\" class=\"form-control\"\n                        ng-model=\"$ctrl.ngModel\" ng-keyup=\"$ctrl.changeHex()\">\n                </div>\n                <div class=\"gp-colorpicker__wrapper\">\n                    <div colorpicker colorpicker-inline=\"true\" colorpicker-parent=\"true\" \n                        ng-model=\"$ctrl.ngModel\" ng-change=\"$ctrl.changeHex()\"></div>\n                </div>\n                <div class=\"form-group rgb-form-group\" ng-class=\"{'has-error':$ctrl.rgbError}\">\n                    <input type=\"text\" class=\"form-control\"\n                        placeholder=\"R\" ng-model=\"$ctrl.rgb.r\" ng-keyup=\"$ctrl.changeRGB()\" title=\"R\">\n                    <input type=\"text\" class=\"form-control\"\n                        placeholder=\"G\" ng-model=\"$ctrl.rgb.g\" ng-keyup=\"$ctrl.changeRGB()\" title=\"G\">\n                    <input type=\"text\" class=\"form-control\"\n                        placeholder=\"B\" ng-model=\"$ctrl.rgb.b\" ng-keyup=\"$ctrl.changeRGB()\" title=\"B\">\n                </div>\n            </div>\n        `\n    });\n\n})(jQuery, angular);","(function(jQuery, angular) {\n    \n    'use strict';\n\n    angular.module('gp-common').directive('gpDatePicker', ['$timeout', function($timeout) {\n\n        return {\n            scope: {\n                label: '@',\n                format: '@',\n                date: '=',\n                onChange: '&?'\n            },\n            template: [\n                '<div class=\"input-group-slick\">',\n                '    <input type=\"text\" class=\"form-control\" placeholder=\"{{::label}}\"',\n                '        datepicker-popup=\"{{format}}\" ng-model=\"date\" is-open=\"opened\" />',\n                '    <span class=\"glyphicon glyphicon-calendar\" ng-click=\"toggle($event)\"></span>',\n                '</div>',\n                '<p class=\"help-block\"><small><em>Ex: \"2015-01-31\" or \"Jan 31 2015\"</em></small></p>'\n            ].join(' '),\n\n            controller: function($scope, $element, $attrs) {\n\n                //toggle date picker\n                $scope.toggle = function(event) {\n                    event.preventDefault();\n                    event.stopPropagation();\n                    this.opened = !this.opened;\n                };\n\n                if(!$scope.format)\n                    $scope.format = 'MMM dd yyyy';\n\n                var promise = null;\n\n                $scope.debounce = function() {\n                    if(promise) $timeout.cancel(promise);\n                    promise = $timeout(function() { \n                        promise = null;\n                        if($scope.onChange)\n                            $scope.onChange();\n                    }, 200);\n                };\n\n                $scope.$watch('date', function() {\n                    $scope.debounce();\n                });\n\n                var listener = $scope.$on('$destroy', function() {\n                    \n                    listener();             //deregister listener\n                    \n                    if(promise) $timeout.cancel(promise);\n                    promise = null;\n\n                    $scope.opened = false;    //close picker if open\n                    $scope.onChange = null;\n                    $scope.format = null;\n                    $scope.debounce = null;\n                });\n\n            }\n        };\n\n    }]);\n\n})(jQuery, angular);","(function(jQuery, angular) {\n    \n    \"use strict\"; \n    \n    angular.module(\"gp-common\")\n\n    /**\n     * Geolocation directive\n     */\n    .directive('gpGeolocation', ['$window',function ($window) {\n        \n        var defaultBtnLabel = \"Locate\";\n\n        return {\n            scope: {\n                label: '=?'\n            },\n            restrict: \"EA\",\n            template: [\n                '<a class=\"btn btn-primary\" ng-click=\"geolocate()\" ng-if=\"available\">',\n                '  <span class=\"glyphicon glyphicon-screenshot\" ng-if=\"!loading\"></span>',\n                '  <span class=\"glyphicon glyphicon-hourglass glyphicon-spin\" ng-if=\"loading\"></span>',\n                '  {{btnLabel}}',\n                '</a>',\n                '<div ng-if=\"error\">{{error}}</div>'\n            ].join(' '),\n            controller: function($scope) {\n\n                $scope.btnLabel = $scope.label || defaultBtnLabel;\n                $scope.loading = false;\n                $scope.available = ($window.navigator && $window.navigator.geolocation);\n\n                if(!$scope.available) \n                    $scope.error = \"Your browser does not support determining location\";\n\n                $scope.geolocate = function() {\n\n                    $scope.loading = true;\n                    $window.navigator.geolocation.getCurrentPosition(function(position){\n\n                        $scope.$apply(function() {$scope.loading = false;});\n                        $scope.$emit('map:geolocation', position.coords.latitude, position.coords.longitude);\n\n                    }, function(error) {\n                        switch (error.code) {\n                          case 1:\n                            $scope.error = \"Permission was denied while attempting to determine location\";\n                            break;\n                          case 2:\n                            $scope.error = \"Unable to determine your location\";\n                            break;\n                          case 3:\n                            $scope.error = \"Unable to determine location in a reasonable amount of time\";\n                            break;\n                        }\n                    });\n                }; \n            }\n        };\n\n    }])\n\n    ;\n\n})(jQuery, angular);","(function(jQuery, angular) {\n    \n    \"use strict\"; \n    \n    angular.module(\"gp-common\")\n\n\n    /**\n     * Header directive for GeoPlatform Angular-based web applications\n     * \n     * Uses transclusion to inject links into the nav-menu which floats to the right.\n     * The menu already provides a \"Home\" link (to app home) and Sign In/User Info button.\n     * The home link is not enabled by default but can be shown using 'show-home-link=\"true\"' \n     * parameter on the directive.\n     *\n     * Note: any links transcluded should reference '$parent.user' to access authenticated user info\n     * \n     * ex:\n     * \n     *   <div gp-header brand=\"Map Manager\" show-home-link=\"true\" class=\"navbar-fixed-top\">\n     *     <li><a href=\"#/maps\">Maps</a></li>\n     *     <li><a href=\"#/galleries\">Galleries</a></li>\n     *     <li><a ng-if=\"$parent.user!==null\" href=\"#/agol\">AGOL</a></li>\n     *     <li><a href=\"#/help\">Help</a></li>\n     *   </div>\n     */\n    .directive('gpHeader', ['GPConfig', 'AuthenticationService', function(Config, AuthenticationService) {\n\n        return {\n\n            scope: {\n                brand: \"@\",\n                showHomeLink: \"@\"\n            },\n            restrict: \"AE\",\n            transclude: true,\n            replace: true,\n            template: [\n                '<header>',\n                '  <div class=\"container-fluid\">',\n                '    <div class=\"row\">',\n                '      <div class=\"col-md-12\">',\n                '        <ul role=\"menu\" class=\"header__menu\" gp-header-menu>',\n                '          <li ng-if=\"showHomeLink\">',\n                '            <a href=\"#/goHome\">',\n                '                <span class=\"glyphicon glyphicon-home\"></span> ',\n                '                <span class=\"hidden-xs hidden-sm\">Home</span>',\n                '            </a>',\n                '          </li>',\n                '          <div class=\"transcluded\"></div>',\n                '          <li><span gp-login-button></span></li>',\n                '        </ul>',\n                '        <h4 class=\"brand\">',\n                '          <a href=\"{{portalUrl}}\" title=\"Go to the GeoPlatform Home Page\">',\n                '            <span class=\"icon-gp\"></span>',\n                '            <span class=\"hidden-xs\">GeoPlatform</span>',\n                '          </a>',\n                '          {{brand}}',\n                '        </h4>',\n                '      </div>',\n                '    </div>',\n                '  </div>',\n                '</header>'\n            ].join(' '),\n\n            // controller: function($rootScope, $scope, $element) {\n            //     $scope.portalUrl = $rootScope.portalUrl;\n            // }, \n\n            link: function($scope, $element, $attrs, ctrl, transcludeFn) {\n\n                $scope.showHomeLink = $scope.showHomeLink === 'true' || false;\n\n                $scope.portalUrl = Config.portalUrl;\n\n                AuthenticationService.getUserQ().then(function(user) {\n                    $scope.user = user;    \n                });\n                \n                $element.find('.transcluded').replaceWith(transcludeFn());\n            }            \n\n        };\n\n    }])\n\n\n    \n    /**\n     * Header Menu\n     *\n     * Monitors the current page URL and updates the header links \n     * to highlight whichever one is associated with the current page\n     *\n     * Usage: \n     *\n     *  <ul role=\"menu\" class=\"header__menu\" gp-header-menu>\n     *      <li><a href=\"#/maps\">Maps</a></li>\n     *      <li><a href=\"#/galleries\">Galleries</a></li>\n     *      ...\n     *  </ul>\n     *\n     */\n    .directive('gpHeaderMenu', ['$location', function($location) {\n\n        //default href for \"home\" link in header__menu\n        //uses 'goHome' to avoid angular-route issues with empty hash not \n        // triggering a page reload. Relies upon the \"otherwise\" condition\n        // being configured inside a routeProvider within the application.\n        var homeLink = 'goHome';\n\n        function update($element) {\n\n            var path = $location.path();\n            \n            if(path === '/' || path === '/#' || path === '/#/')\n                path = homeLink;\n\n            if(path[0] === '/') \n                path = path.substring(1);\n\n            var menu = $element;\n            menu.find('li.active').removeClass('active');\n            \n            var link = menu.find('li > a[href=\"#/' + path + '\"]');\n            if(link.length) {\n                //check if link is within a dropdown in the header menu\n                var dd = link.closest('.dropdown-menu');\n                if(dd.length) {\n                    //find next ancestor that is a list element and mark it active\n                    dd.closest('li').addClass('active');\n                } else {\n                    //not in a dropdown, mark this link active\n                    link.parent().addClass('active');\n                }\n            }\n            \n            menu.find('li > a').each(function(i,a) {\n                var $a = $(a), href = $a.attr('href');\n                if(!href) return;\n                href = href.replace('#/', '');\n                if(path.indexOf(href) === 0)\n                    $a.parent().addClass('active');\n            });\n        }\n\n        return {\n            scope: {\n                homeHref: '@'\n            },\n            restrict: \"A\",\n            \n            controller: function($rootScope, $scope, $element) {\n                if($scope.homeHref)\n                    homeLink = $scope.homeHref;\n            },\n\n            link: function($scope, $element) {\n\n                update($element);\n\n                $scope.$root.$on('$locationChangeSuccess', function() {\n                    update($element);\n                });\n\n            }\n        };\n    }])\n\n\n\n\n    /**\n     *\n     * Usage: \n     *\n     *    <div ng-cloak gp-flex-header show-home-link=\"true\" brand=\"Application Name\">\n     *      <li><a>Menu Item</a></li>\n     *      <li><a>Menu Item</a></li>\n     *      <li><a>Menu Item</a></li>\n     *      <li><a>Menu Item</a></li>\n     *    </div>\n     *\n     */\n    .directive('gpFlexHeader', ['GPConfig', 'AuthenticationService', function(Config, AuthenticationService) {\n\n        return {\n\n            scope: {\n                brand: \"@\",\n                showHomeLink: \"@\"\n            },\n            restrict: \"AE\",\n            transclude: true,\n            replace: true,\n            template: \n            `\n                <header>\n                    <h4 class=\"brand\">\n                        <a href=\"{{portalUrl}}\" title=\"Go to the GeoPlatform Home Page\">\n                            <span class=\"icon-gp\"></span>\n                            <span class=\"hidden-xs\">GeoPlatform</span>\n                        </a>\n                        {{brand}}\n                    </h4>\n                    <ul role=\"menu\" class=\"header__menu\" gp-header-menu>\n                        <li ng-if=\"showHomeLink\">\n                            <a href=\"/\">\n                                <span class=\"glyphicon glyphicon-home\"></span> \n                                <span class=\"hidden-xs hidden-sm\">Home</span>\n                            </a>\n                        </li>\n                        <div class=\"transcluded\"></div>\n                        <li><span gp-login-button></span></li>\n                    </ul>\n                </header>\n            `,\n\n            link: function($scope, $element, $attrs, ctrl, transcludeFn) {\n\n                $scope.showHomeLink = $scope.showHomeLink === 'true' || false;\n\n                $scope.portalUrl = Config.portalUrl;\n\n                AuthenticationService.getUserQ().then(function(user) {\n                    $scope.user = user;    \n                });\n                \n                $element.find('.transcluded').replaceWith(transcludeFn());\n            }            \n\n        };\n\n    }]);\n\n\n})(jQuery, angular);\n","(function(angular) {\n\n\n    \"use strict\";\n\n    angular.module('gp-common').directive('iframeOnload', function(){\n        return {\n            scope: {\n                callback: '&iframeOnload'\n            },\n            link: function(scope, element, attrs){\n                element.on('load', function(event){\n                    element.off('load');\n                    return scope.callback(event);\n                });\n            }\n        };\n    });\n\n}) (angular);","(function(angular, Constants) {\n    \n    \"use strict\";\n\n    angular.module(\"gp-common\")\n\n\n    .directive('onImgFail', function() {\n        return {\n            restrict: \"A\",\n            link: function($scope, $element, $attrs) {\n                var jqEl = jQuery($element);\n                jqEl.on('error', function() {\n                    jqEl.off('error');\n                    jqEl.attr('src', $attrs.onImgFail);\n                });\n            }\n        };\n    })\n\n\n    .directive('mapThumbnail', [function() {\n        return {\n            restrict: \"A\",\n            scope: {\n                mapThumbnail: '='\n            },\n            link: function($scope, $element, $attrs) {\n\n                let map = $scope.mapThumbnail;\n\n                if(map.$promise && !map.$resolved) {\n\n                    map.$promise\n                    .then(  (m) => { \n                        if(typeof(m.thumbnail) === 'string')    //old map model\n                            $element.attr('src', getUrl(m)); \n                        else \n                            buildThumbnail(m);                  //open map model\n                    })\n                    .catch( (e) => { $element.attr('src', null); });\n\n                } else {\n                    if(typeof(map.thumbnail) === 'string')    //old map model\n                        $element.attr('src', getUrl(map));\n                    else \n                        buildThumbnail(map);\n                }\n\n                function buildThumbnail(map) {\n                    if(!map.thumbnail) {\n                        $element.attr('src', null);\n\n                    } else if(map.thumbnail.contentData) {\n\n                        var style = \n                            'background-size:contain;' + \n                            'background-repeat:no-repeat;' + \n                            'background-image: url(data:' + \n                                (map.thumbnail.mediaType||'image/png') + ';base64,' + \n                                map.thumbnail.contentData + ');';\n\n                        //if directive is on a responsive item (aka, in a gp-ui-card), \n                        // ignore thumbnail dimensions. Otherwise, use them\n                        if($element.attr('class').indexOf('embed-responsive-item') < 0) {\n                            style += 'width:' + (map.thumbnail.width||'32') + 'px;' +\n                                     'height:' + (map.thumbnail.height||'32') + 'px;';\n                        }\n\n                        $element.attr('style', style);\n\n                    } else if(map.thumbnail.url) {\n                        $element.attr('src', map.thumbnail.url);\n                    } else \n                        $element.attr('src', null);\n\n                }\n\n\n                function getUrl(map) {\n                    var url = map.thumbnail;\n                    if(!url || !url.length)\n                        url = Constants.ualUrl + '/api/maps/' + map.id + '/thumbnail';\n                    else if(url.indexOf(\"http\") !== 0) {\n                        if(url[0] !== '/')\n                            url = Constants.ualUrl + '/' + url;\n                        else \n                            url = Constants.ualUrl + url;\n                    }\n                    return url;\n                }\n            }\n        };\n\n    }])\n\n\n    \n    .directive('itemThumbnail', ['$q', function($q) {\n        return {\n            restrict: \"E\",\n            replace: true,\n            scope: {\n                item    : '=',\n                fallback: '@',\n                link:     '@'\n            },\n            template:\n            `\n                <a ng-show=\"hasThumbnail\" class=\"media embed-responsive embed-responsive-16by9\">\n                    <img class=\"embed-responsive-item\" on-img-error=\"{{fallback||'/img/img-404.jpg'}}\">\n                </a>\n            `,\n            controller: function($scope) {\n                $scope.elName = 'div';\n\n                $scope.isLink = !!$scope.link;\n                if($scope.isLink) {\n                    $scope.elName = 'a';\n                }\n            }, \n            link: function($scope, $element, $attrs) {\n\n                let item = $scope.item;\n                (item.$promise || $q.resolve(item)).then( (obj) => {\n\n                    let url = $scope.fallback;\n                \n                    //maps\n                    if(obj.type && obj.type === 'Map')\n                        url = Constants.ualUrl + \"/api/maps/\" + obj.id + \"/thumbnail\";\n                    //maps as gallery items\n                    else if(obj.assetType && obj.assetType === 'Map')\n                        url = Constants.ualUrl + \"/api/maps/\" + obj.assetId + \"/thumbnail\";\n                    //other thumbnail'ed items with URLs\n                    else if(obj.thumbnail && obj.thumbnail.url)\n                        url = obj.thumbnail.url;\n                    //other thumbnail'ed items with base64 content\n                    else if(obj.thumbnail && obj.thumbnail.contentData) {\n                        \n                        var style = \n                            'background-size:contain;' + \n                            'background-repeat:no-repeat;' + \n                            'background-image: url(data:' + \n                                (obj.thumbnail.mediaType||'image/png') + ';base64,' + \n                                obj.thumbnail.contentData + ');';\n\n                        //if directive is on a responsive item (aka, in a gp-ui-card), \n                        // ignore thumbnail dimensions. Otherwise, use them\n                        if($element.attr('class').indexOf('embed-responsive-item') < 0) {\n                            style += 'width:' + (obj.thumbnail.width||'32') + 'px;' +\n                                     'height:' + (obj.thumbnail.height||'32') + 'px;';\n                        }\n\n                        $element.find('img').attr('style', style);\n                    }\n                    \n                    $scope.hasThumbnail = !!url;\n                    $element.find('img').attr('src', url);\n\n                    if($scope.isLink) {\n                        //$element is a.media because of 'replace:true'\n                        $element.attr('href', $scope.link).attr('target', '_blank');\n                    }\n            \n                })\n                .catch( (e) => { \n                    $element.find('img').attr('src', $scope.fallback); \n                });\n            }\n        };\n\n    }])\n\n    ;\n\n}) (angular, GeoPlatform);","(function(angular) {\n    \n    \"use strict\";\n\n\n    angular.module('gp-common')\n\n\n    //\n    .service('NotificationService', ['$rootScope', function($rootScope) {\n        var Service = function() {\n            this.items = [];\n        };\n        Service.prototype = {\n            getItems: function() { return this.items; },\n            /**\n             * @param item object\n             * @return function to cancel the notification\n             */\n            addItem: function(item) { \n                this.items.push(item); \n                $rootScope.$broadcast('gp:notifications:new', item);\n\n                var fn = function(item) { this.removeItem(item); };\n                return fn.bind(this, item);\n            },\n            removeItem: function(item) {\n                var index = this.items.indexOf(item);\n                if(index >= 0)\n                    return this.items.splice(index, 1);\n                return null;\n            },\n            error: function(label, msg, dismiss) { \n                return this.addItem({ type: 'error', label: label, message: msg, canDismiss: dismiss });\n            },\n            success: function(label, msg, dismiss) { \n                return this.addItem({ type: 'success', label: label, message: msg, canDismiss: dismiss });\n            },\n            info: function(label, msg, dismiss) { \n                return this.addItem({ type: 'info', label: label, message: msg, canDismiss: dismiss });\n            }\n        };\n        return new Service();\n    }])\n\n\n    // Usage: <gp-notifications />\n    .directive('gpNotifications', ['$timeout', 'NotificationService', function($timeout, NotificationService) {\n        return {\n            scope: {\n                expiration: '@'\n            },\n            template: [\n                '<div class=\"notifications ng-hide\" ng-show=\"items.length\">',\n                '  <div class=\"notification\" ng-repeat=\"item in items\"',\n                '    ng-class=\"{\\'notification--success\\':item.type===\\'success\\', \\'notification--error\\':item.type===\\'error\\', \\'notification--info\\':item.type===\\'info\\'}\">',\n                '    <h5 class=\"notification__title\">',\n                '        <span class=\"pull-right glyphicon\" ',\n                '            ng-class=\"{\\'glyphicon-ok-sign\\':item.type===\\'success\\',\\'glyphicon-exclamation-sign\\':item.type===\\'error\\',\\'glyphicon-info-sign\\':item.type===\\'info\\'}\">',\n                '        </span>',\n                '        {{item.label}}',\n                '    </h5>',\n                '    <p class=\"notification__content\" ng-bind-html=\"item.message\"></p>',\n                '    <div class=\"notification__actions\" ng-if=\"item.canDismiss\">',\n                '        <button type=\"button\" class=\"btn btn-link\" ng-click=\"dismiss(item)\">dismiss</button>',\n                '    </div>',\n                '  </div>',\n                '</div>'\n            ].join(' '),\n\n            link: function($scope, $element, $attrs) {\n\n                $scope.expiration = ($scope.expiration || 2000)*1;\n\n                $scope.items = [];\n\n\n                function update() {\n                    $scope.items = NotificationService.getItems();\n\n                    //if updated before timer expired, reset timer\n                    if($scope.timer) {\n                        $timeout.cancel($scope.timer);\n                        $scope.timer = null;\n                    }\n\n                    //set timer to kill earliest item after time\n                    $scope.timer = $timeout(function() {\n                        $scope.timer = null;\n                        //will ultimately call update() and thus trigger timeout again\n                        $scope.removeOldest();\n                    }, $scope.expiration);\n                }\n                update();\n\n                $scope.removeOldest = function() {\n                    //find oldest that can be removed\n                    var oldest = $scope.items.find(function(item) {return item.canDismiss;});\n                    if(oldest)\n                        NotificationService.removeItem(oldest);\n                };\n\n                $scope.dismiss = function(item) {\n                    //remove item using service\n                    NotificationService.removeItem(item);\n                };\n\n                $scope.$watchCollection(function() {\n                    return NotificationService.getItems();\n                }, update);\n\n                // $scope.$on('gp:notifications:new', function(event, item) { update(); });\n\n            }\n        };\n    }]);\n\n\n})(angular);","(function(jQuery, angular) {\n    \n    \"use strict\";\n\n\n\n    /*\n     * Usage:\n     * \n     *      <gp-pagination service=\"$ctrl.service\" event-key=\"maps\"></gp-pagination>\n     *\n     *  Expects a BrowseObjService instance for the 'service' binding, or at least \n     * one that provides the same pagination and options API.\n     */\n\n\n\n\n\n\n    /**\n     * Requires a service which exposes the following methods:\n     *   - getPagination() : returns {object} defining 'start', 'size', and 'total'\n     *   - start(int) : takes {int} defining which index to start requesting\n     *   - size(int) : takes {int} defining how many items to request\n     *   - on(eventName, listener) : must support event \"gp:browse:<key>:pagination\" where 'key' may be 'objects' or a custom key\n     */\n    class PaginationController {\n\n        constructor () {\n            'ngInject';\n        }\n\n        $onInit () {\n            \n            if(!this.service) return;\n\n            this.options = this.service.getPagination();\n            \n            //support using a traditional select instead of a uib dropdown menu\n            // in case the pagination control itself is wrapped in a dropdown menu.\n            //in this case, we use objects with labels and values in order to display\n            // the 'per page' text along with whatever the page size is.\n            \n            this.pageSizeDropdown = true;\n            this.useSelect = typeof(this.useSelect) !== 'undefined' && \n                (this.useSelect === true || this.useSelect === 'true' || this.useSelect === 1);\n            if(this.useSelect) {\n                this.pageSizeDropdown = false;\n                this.pageSize = this.options.size;\n                this.pageSizeOptions = (this.options.sizeOptions||[5,10,20,50]).map(o=> {\n                    return { label: o +' per page', value: o };\n                });\n            } \n\n            let event = 'gp:browse:';\n            if(this.eventKey)\n                event = 'gp:browse:' + this.eventKey + \":\";\n            else\n                event = 'gp:browse:objects:';\n\n            this.listener = this.service.on(event + 'pagination', () => { \n                this.options = this.service.getPagination();\n            });\n        }\n\n        $onDestroy () {\n\n            //remove listener from service if exists\n            if(this.listener) \n                this.listener();\n\n            this.service = null;\n        }\n\n        \n        previous () { \n            if(this.service && this.hasPrevious()) {\n                this.service.start(Math.max(0, this.options.start*1 - this.options.size*1), true);\n            }\n        }\n\n        next () {\n            if(this.service && this.hasNext()) {\n                this.service.start(Math.min(this.options.total, this.options.start*1 + this.options.size*1), true);\n            }\n        }\n\n        first () {\n            if(this.service && this.hasPrevious()) {\n                this.service.start(0, true);\n            }\n        }\n\n        last () {\n            if(this.service && this.hasNext()) {\n                var lastPage = Math.floor(this.options.total / this.options.size);\n                this.setPage(lastPage);\n            }\n        }\n\n        setPage (arg) {\n            if(this.service) {\n                var page = arg*1;\n                this.service.start(page * (this.options.size*1), true);\n            }\n        }\n\n        setPageSize (size) {\n            if(this.service) {\n                this.service.size(size*1, true);\n            }\n        }\n\n        hasPrevious () {\n            return this.options && this.options.start > 0;\n        }\n\n        hasNext () {\n            return this.options && (this.options.start+this.options.size) < this.options.total;\n        }\n\n    }\n\n\n\n\n\n    angular.module('gp-common').component('gpPagination', {\n\n        bindings: {\n            service: '=',\n            eventKey: '@',\n            useSelect: '@'\n        },\n\n        controller: PaginationController,\n\n        template: \n        `\n            <div class=\"c-pagination\">\n                <div class=\"c-pagination__total\">{{$ctrl.options.total||0}} results</div>\n                <div class=\"c-pagination__page-size\" ng-if=\"$ctrl.pageSizeDropdown\">\n                    <span uib-dropdown>\n                        <a href=\"\" uib-dropdown-toggle title=\"Change the number of results returned\">\n                            {{$ctrl.options.size}} per page <span class=\"caret\"></span>\n                        </a>\n                        <ul class=\"dropdown-menu\" role=\"menu\">\n                            <li ng-repeat=\"size in $ctrl.options.sizeOptions track by $index\">\n                                <a ng-click=\"$ctrl.setPageSize(size)\">{{size}} per page</a>\n                            </li>\n                        </ul>\n                    </span>\n                </div>\n                <div class=\"c-pagination__page-size\" ng-if=\"!$ctrl.pageSizeDropdown\">\n                    <select class=\"form-control\" \n                        ng-model=\"$ctrl.pageSize\" ng-change=\"$ctrl.setPageSize($ctrl.pageSize)\"\n                        ng-options=\"opt.value as opt.label for opt in $ctrl.pageSizeOptions\">\n                    </select>\n                </div>\n                <div class=\"c-pagination__pages\">\n                    <div class=\"c-pagination__button\" \n                        ng-class=\"{'is-disabled':!$ctrl.hasPrevious()}\"\n                        ng-click=\"$ctrl.first()\">\n                        <span class=\"glyphicon glyphicon-fast-backward\"></span>\n                    </div>\n                    <div class=\"c-pagination__button\" \n                        ng-class=\"{'is-disabled':!$ctrl.hasPrevious()}\"\n                        ng-click=\"$ctrl.previous()\">\n                        <span class=\"glyphicon glyphicon-backward\"></span>\n                    </div>\n                    <div class=\"c-pagination__page\">\n                        {{$ctrl.options.start+1}} - {{$ctrl.options.start+$ctrl.options.size}}\n                    </div>\n                    <div class=\"c-pagination__button\" \n                        ng-class=\"{'is-disabled':!$ctrl.hasNext()}\"\n                        ng-click=\"$ctrl.next()\">\n                        <span class=\"glyphicon glyphicon-forward\"></span>\n                    </div>\n                    <div class=\"c-pagination__button\" \n                        ng-class=\"{'is-disabled':!$ctrl.hasNext()}\"\n                        ng-click=\"$ctrl.last()\">\n                        <span class=\"glyphicon glyphicon-fast-forward\"></span>\n                    </div>\n                </div>\n            </div>\n        `\n\n    });\n\n})(jQuery, angular);","(function(angular) {\n    \n    \"use strict\";\n\n\n    /**\n     * Usage: \n     *  <gp-progress-circle ng-model=\"$ctrl.amount\"></gp-progress-circle>\n     */\n    angular.module('gp-common').component('gpProgressCircle', {\n\n        bindings: {\n            ngModel: '<'    //amount out of 100\n        },\n\n        controller: function() {\n\n            this.$onInit = function() {\n                this.dashArray = 2 * Math.PI * 45 /*radius*/;\n                if(!this.ngModel)\n                    this.ngModel = 0;\n                this.update();\n            };\n\n            this.$onChanges = function(changes) {\n                if(changes.ngModel)\n                    this.update();\n            };\n\n            this.update = function() {\n                let offset = 2 * Math.PI * 45 * (1 - ( this.ngModel / 100) );\n                this.value = offset;\n            };\n\n        },\n\n        template: \n        `\n            <svg class=\"c-progress--circle\" viewBox=\"0 0 100 100\">\n                <circle class=\"c-progress__meter\" cx=\"50\" cy=\"50\" r=\"45\" stroke-width=\"10\" />\n                <circle class=\"c-progress__value\" cx=\"50\" cy=\"50\" r=\"45\" stroke-width=\"10\" \n                    stroke-dasharray=\"{{$ctrl.dashArray}}\" stroke-dashoffset=\"{{$ctrl.value}}\"/>\n                <text class=\"c-progress__label\" x=\"50\" y=\"-40\" text-anchor=\"middle\">{{$ctrl.ngModel}}%</text>\n            </svg>\n        `\n    });\n\n\n}) (angular);","(function(jQuery, angular) {\n\n    \"use strict\";\n\n\n    angular.module('gp-common')\n\n\n    //helper to determine size of window for responsive breakpoint purposes\n    .provider('responsiveHelper', [\"$windowProvider\", function ($windowProvider) {\n        \n        var $window  = $windowProvider.$get();\n\n        function Helper($window) {\n            this.window = $window;\n        }\n        Helper.prototype = {\n            getWidth: function() { return $window.innerWidth || $window.outerWidth; },\n            isXS: function () { var width = this.getWidth(); return width < 768; },\n            isSM: function () { var width = this.getWidth(); return width >= 768 && width < 992; },\n            isMD: function () { var width = this.getWidth(); return width >= 992 && width < 1200; },\n            isLG: function () { var width = this.getWidth(); return width >= 1200; }\n        };\n\n        var helper = new Helper($window);\n\n        this.$get = function() {\n            return helper;\n        };\n    }])\n\n\n    //directive which appends appropriate responsive breakpoint classNames to the element\n    // on which it's set\n    .directive('gpResponsive', ['$window', 'responsiveHelper', function($window, responsiveHelper) {\n\n        return {\n            restrict: \"A\",\n            link: function($scope, $element, $attrs) {\n\n                function update(el, helper) {\n                    if(helper.isXS())\n                        el.addClass('gp-responsive-xs');\n                    else\n                        el.removeClass('gp-responsive-xs');\n\n                    if(helper.isSM())\n                        el.addClass('gp-responsive-sm');\n                    else \n                        el.removeClass('gp-responsive-sm');\n\n                    if(helper.isMD())\n                        el.addClass('gp-responsive-md');\n                    else \n                        el.removeClass('gp-responsive-md');\n\n                    if(helper.isLG())\n                        el.addClass('gp-responsive-lg');\n                    else \n                        el.removeClass('gp-responsive-lg');\n                }\n\n                update($element, responsiveHelper);\n\n                var resizeFn = function() {\n                    update($element, responsiveHelper);\n                };\n\n                var w = angular.element($window);\n                var listener = w.on('resize', resizeFn);\n\n                $scope.$on('$destroy', function() {\n                    w.off('resize', resizeFn);\n                });\n\n            }\n        };\n\n    }])\n\n\n    .directive('gpResize', function($window, $timeout) {\n        return function($scope, $element, $attr) {\n\n            var resizeFn = function() {\n                var hh = jQuery('header')[0].offsetHeight;\n                // var fh = jQuery('footer')[0].offsetHeight;\n                // console.log('hh & fh', hh, fh);                    \n\n                var tp = hh + 2;\n                // var bt = fh + 2;\n                // console.log('tp & bt', tp, bt);                \n                \n                var changes = {\n                    // bottom: bt + 'px',\n                    top: tp + 'px',\n                };\n                $element.css(changes);\n                $scope.$apply();\n            };\n\n            var w = angular.element($window);\n            w.on('resize', resizeFn);\n\n            $timeout(resizeFn, 200);\n\n            $scope.$on('$destroy', function() {\n                w.off('resize', resizeFn);\n            });\n\n        };\n    });\n\n})(jQuery, angular);","(function(jQuery, angular) {\n    \n    \"use strict\";\n\n\n\n    function inputLinkFunction($scope, $element, $attrs, ngModelController, $timeout) {\n\n        if(!$scope.type) $scope.type = \"text\";\n        if($scope.required === 'true')\n            $scope.required = true;\n        else $scope.required = false;\n\n        $scope.elId = 'input_' + Math.ceil(Math.random()*9999);\n        $scope.size = $scope.size || 'medium';\n        $scope.type = $scope.type || 'text';\n\n\n\n        //listen for changes to the inner value by way of the form-control\n        $element.find('.form-control').on('change', function onChange() { \n            validate($scope.innerValue); \n        });\n        \n        \n\n        /* ------------- private methods --------------- */\n\n        function validate() {\n\n            //check form-control for ng-invalid\n            var input = $element.find('.form-control');\n\n            $scope.isDirty = input.hasClass('ng-dirty');\n\n            if(input.hasClass('ng-invalid')) {\n                if(input.hasClass(\"ng-empty\"))\n                    $scope.error = \"This field requires a value\";\n                else\n                    $scope.error = \"Invalid value provided\";\n            } else\n                $scope.error = null;\n\n        }\n\n        function update(newValue) {\n            // call $parsers pipeline then update $modelValue\n            ngModelController.$setViewValue(newValue);\n            // update the local view\n            ngModelController.$render();\n        }\n\n\n\n        // when model change, update our view (just update the div content)\n        ngModelController.$render = function() {\n                \n            var value = ngModelController.$viewValue;\n\n            //create copy of passed in model value that can be used\n            // by the controls here allowing us to cancel and \n            // commit changes at our own leisure\n            $scope.innerValue = value;\n            \n            $scope.displayValue = value || $scope.placeholder || \"No value provided\";\n\n            validate(value);\n        };\n\n\n        /* ------------- private methods --------------- */\n\n        $scope.isReadOnly = function() {\n            var t = typeof(this.readOnly);\n            if(t === 'undefined') return false;\n            if(t === 'string') return this.readOnly.toLowerCase() === 'true';\n            if(t === 'number') return this.readOnly === 1;\n            if(t === 'boolean') return this.readOnly;\n            return false;\n        };\n\n        //enter edit mode\n        $scope.edit = function() {\n            if($scope.isReadOnly()) return;\n            $scope.editing=true;\n            //auto-focus on form-control when entering edit mode\n            $timeout(function() { $element.find('.form-control').focus().select(); }, 200);\n        };\n        //leave edit mode (regardless of save() or cancel())\n        $scope.done = function() {\n            $scope.editing=false;\n            $scope.error = null;\n        };\n\n\n        $scope.save = function() {\n            //update display with new value\n            update($scope.innerValue);\n            $scope.done();\n        };\n        $scope.cancel = function() {\n            //reset inner value\n            $scope.innerValue = ngModelController.$viewValue;\n            $scope.done();\n        };\n\n\n        $scope.onKeyPress = function($event, code) {\n            // console.log(\"Pressed \" + code);\n            if((code === undefined || code === 0) && $event.which !== undefined)\n                code = $event.which;\n            if($scope.type === 'number') {\n                \n                //NOTE: Chrome does not catch Backspace onKeyPress, so it \n                // skips this handler. FF does, so we need to watch for \n                // backspace, delete, and numbers\n\n                if (code === 8  ||   //backspace\n                    code === 46 ||  //delete  \n                    (code >= 44 && code <= 57))    //comma, hyphen, period and numbers (0-9)\n                    return;\n                \n                //NOTE: keyPress period is 46. keyDown it is 190\n\n                $event.preventDefault();\n                return false;               //ignore key\n            }\n        };\n        $scope.onKeyUp = function($event, code) {\n            // console.log(\"Up \" + code);\n            if((code === undefined || code === 0) && $event.which !== undefined)\n                code = $event.which;\n            if(code === 13 && !$scope.error) $scope.done();  //enter\n            else if(code === 27)             $scope.cancel();//esc\n            else {\n            \n                if(code !== 8 &&                //backspace\n                    code !== 46 &&              //delete\n                    code !== 190 &&             //period\n                    (code < 48 || code > 90) && //letters and numbers (a-z, 0-9)\n                    (code < 106 || code > 111) && \n                    (code < 186)) \n                    return;\n\n                validate();\n            }\n        };\n\n\n        $scope.$destroy = function() {\n            $element.off('change');\n        };\n    }\n\n\n\n    angular.module(\"gp-common\")\n\n    .directive('gpSlickFormInput', ['$timeout', function($timeout) {\n\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                placeholder: '@',\n                help: '=',\n                // validator: '&',\n                // validationExpr: '@',\n                type: '@',\n                pattern: \"@\",\n                required: '@',\n                readOnly: '@',\n                size: '@',\n                icon: '@'\n            },\n            template: INPUT_TEMPLATE,\n            link: function($scope, $element, $attrs, ngModelController) {\n                inputLinkFunction($scope, $element, $attrs, ngModelController, $timeout);\n            }\n        };\n\n    }])\n\n\n    .directive('gpSlickFormTextarea', ['$timeout', function($timeout) {\n\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                placeholder: '@',\n                help: \"@\",\n                readOnly: \"@\",\n                size: \"@\",\n                icon: \"@\"\n            },\n            template: TEXTAREA_TEMPLATE,\n            link: function($scope, $element, $attrs, ngModelController) {\n                inputLinkFunction($scope, $element, $attrs, ngModelController, $timeout);\n            }\n        };\n\n    }])\n\n\n    /**\n     *\n     * Notes:\n     *  - use 'form form-inline' classes for editable date so the field doesn't take up whole line\n     */\n    .directive('gpSlickFormDate', ['$timeout', '$filter', function($timeout, $filter) {\n\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                format: \"@\",\n                placeholder: '@',\n                required: \"@\",\n                readOnly: \"@\",\n                size: '@',\n                icon: '@'\n            },\n            template: DATE_TEMPLATE,\n\n            controller: function($scope, $element) {\n                if(!$scope.format || $scope.format.length < 3) $scope.format = \"mediumDate\";\n                $scope.inline = $element.hasClass(\"inline\");\n            },\n\n            /**\n             *\n             */\n            link: function($scope, $element, $attrs, ngModelController) {\n\n                if($scope.required === 'true')\n                    $scope.required = true;\n                else $scope.required = false;\n                \n                $scope.elId = 'input_' + Math.ceil(Math.random()*9999);\n                $scope.size = $scope.size || 'medium';\n                $scope.type = $scope.type || 'text';\n\n\n                function validate(value) {\n                    // console.log(\"Validating '\" + value + \"'\");\n\n                    //check form-control for ng-invalid\n                    var input = $element.find('.form-control');\n                    if(input.hasClass('ng-invalid')) {\n                        if(input.hasClass(\"ng-empty\"))\n                            $scope.error = \"This field requires a value\";\n                        else\n                            $scope.error = \"Invalid value provided\";\n                    } else\n                        $scope.error = null;\n                }\n\n                function update(newValue) {\n                    // call $parsers pipeline then update $modelValue\n                    ngModelController.$setViewValue(newValue);\n                    // update the local view\n                    ngModelController.$render();\n                }\n\n\n                // when model change, update our view (just update the div content)\n                ngModelController.$render = function() {\n\n                    var value = ngModelController.$viewValue;\n\n                    //create copy of passed in model value that can be used\n                    // by the controls here allowing us to cancel and \n                    // commit changes at our own leisure\n                    $scope.innerValue = value;\n                    \n                    $scope.displayValue = value ? $filter('date')(ngModelController.$modelValue, $scope.format) :\n                        $scope.placeholder || \"No value provided\";\n\n                    validate(value);\n\n                };\n\n\n\n\n                $scope.isReadOnly = function() {\n                    var t = typeof(this.readOnly);\n                    if(t === 'undefined') return false;\n                    if(t === 'string') return this.readOnly.toLowerCase() === 'true';\n                    if(t === 'number') return this.readOnly === 1;\n                    if(t === 'boolean') return this.readOnly;\n                    return false;\n                };\n\n\n                //enter edit mode\n                $scope.edit = function() {\n                    if($scope.isReadOnly()) return;\n                    \n                    $scope.editing=true;\n                    \n                    //auto-focus on form-control when entering edit mode\n                    // $timeout(function() { $element.find('.form-control').focus().select(); }, 200);\n                };\n                //leave edit mode (regardless of save() or cancel())\n                $scope.done = function() {\n                    $scope.opened = false;\n                    $scope.editing=false;\n                    $scope.error = null;\n                };\n\n\n                $scope.save = function() {\n                    //update display with new value\n                    update($scope.innerValue);\n                    $scope.done();\n                };\n                $scope.cancel = function() {\n                    //reset inner value\n                    $scope.innerValue = angular.copy(ngModelController.$modelValue);\n                    $scope.done();\n                };\n\n\n                \n                \n\n                $scope.open = function() {\n                    //must wrap 'opened' variable in an object for \n                    // angular to properly track its value changes\n                    // from within children scope (ie, the date picker)\n                    if (typeof($scope.uibopts) === 'undefined'){\n                       $scope.uibopts = {};\n                    }\n                    $scope.uibopts.opened = true;\n                };\n\n                $scope.onKeyUp = function(code) {\n                    if(code === 13) {   //enter\n                        $scope.done();\n                    } else if(code === 27) {    //esc\n                        $scope.cancel();\n                    }\n                };\n                $scope.onChange = function(date) {\n                    if(isNaN(ngModelController.$modelValue) && $scope.required) {\n                        $scope.error = \"This field requires a value\";\n                    } else $scope.error = null;\n                };\n            }\n        };\n\n    }])\n\n\n\n    .directive('gpSlickFormSelect', ['$timeout', function($timeout) {\n\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                codeList: \"=\",\n                help: '=',\n                required: \"@\",\n                readOnly: \"@\",\n                size: '@',\n                icon: '@'\n            },\n            template: SELECT_TEMPLATE,\n            link: function($scope, $element, $attrs, ngModelController) {\n\n                if(!$scope.type) $scope.type = \"text\";\n                if($scope.required === 'true')\n                    $scope.required = true;\n                else $scope.required = false;\n\n                $scope.elId = 'input_' + Math.ceil(Math.random()*9999);\n                $scope.size = $scope.size || 'medium';\n                $scope.type = $scope.type || 'text';\n\n                var $select = null;\n\n                function getSelect() {\n                    if(!$select || !$select.length)\n                        $select = $element.find('.form-control');\n                    return $select;\n                }\n\n\n                if($scope.codeList) {\n                    $scope.selectOptions = $scope.codeList.map(function(item) {\n                        if(typeof(item) !== 'object' || !item.value)\n                            return {value: item, label: item};\n                        else if(!item.label)\n                            return {value: item.value, label: item.value};\n                        return item;\n                    });\n                } else \n                    $scope.selectOptions = [];\n\n\n\n                //listen for changes to the inner value by way of the form-control\n                // $element.find('.form-control').on('change', function onChange() { \n                //     validate($scope.innerValue); \n                // });\n                \n                \n\n                /* ------------- private methods --------------- */\n\n                function validate() {\n\n                    //check form-control for ng-invalid\n                    var select = getSelect();\n\n                    $scope.isDirty = select.hasClass('ng-dirty');\n\n                    if(select.hasClass('ng-invalid')) {\n                        if(select.hasClass(\"ng-empty\"))\n                            $scope.error = \"This field requires a value\";\n                        else\n                            $scope.error = \"Invalid value provided\";\n                    } else\n                        $scope.error = null;\n\n                }\n\n                function update(newValue) {\n                    // call $parsers pipeline then update $modelValue\n                    ngModelController.$setViewValue(newValue);\n                    // update the local view\n                    ngModelController.$render();\n                }\n\n\n\n                // when model change, update our view (just update the div content)\n                ngModelController.$render = function() {\n                        \n                    var value = ngModelController.$viewValue;\n\n                    //@see https://github.com/angular/angular.js/commit/7fda214c4f65a6a06b25cf5d5aff013a364e9cef\n\n                    //create copy of passed in model value that can be used\n                    // by the controls here allowing us to cancel and \n                    // commit changes at our own leisure\n                    $scope.innerValue = value;\n\n                    $scope.displayValue = $scope.placeholder || \"No value provided\";\n\n                    if(value) {\n                        //values are objects, not literals\n                        var opt = $scope.selectOptions.find(function(o){return o.value==value;});\n                        $scope.displayValue = opt.label;\n                    }\n                    \n                    validate();\n                };\n\n\n                /* ------------- private methods --------------- */\n\n                $scope.onChange = function(value) {\n                    \n                    // console.log(\"Changing value \" + value + \" vs \" + $scope.innerValue);\n                    $scope.innerValue = value;                \n                    $timeout(function() { validate(); }, 200);\n\n                };\n\n                $scope.onTypeaheadSelection = function($item, $model, $label, $event) {\n\n                    $scope.innerValue = $item ? $item.value : null;\n                    $timeout(function() { validate(); }, 200);\n\n                };\n\n                $scope.isReadOnly = function() {\n                    var t = typeof(this.readOnly);\n                    if(t === 'undefined') return false;\n                    if(t === 'string') return this.readOnly.toLowerCase() === 'true';\n                    if(t === 'number') return this.readOnly === 1;\n                    if(t === 'boolean') return this.readOnly;\n                    return false;\n                };\n\n                //enter edit mode\n                $scope.edit = function() {\n                    if($scope.isReadOnly()) return;\n                    $scope.editing=true;\n                    //auto-focus on form-control when entering edit mode\n                    $timeout(function() { $select.focus().select(); }, 200);\n                };\n                //leave edit mode (regardless of save() or cancel())\n                $scope.done = function() {\n                    $scope.editing=false;\n                    $scope.error = null;\n                };\n\n\n                $scope.save = function() {\n                    //update display with new value\n                    update($scope.innerValue);\n                    $scope.done();\n                };\n                $scope.cancel = function() {\n                    //reset inner value\n                    $scope.innerValue = ngModelController.$viewValue;\n                    $scope.done();\n                };\n\n                $scope.onKeyUp = function(code) {\n                    if(code === 13 && !$scope.error) {   //enter\n                        $scope.save();\n                    } else if(code === 27) {    //esc\n                        $scope.cancel();\n                    }\n                };\n\n                $scope.onTypeaheadKeyUp = function(code) {\n                    validate();\n                };\n\n\n                $scope.$destroy = function() {\n                    // $element.off('change');\n                };\n            }\n        };\n\n    }])\n\n\n\n    ;\n\n\n    var INPUT_TEMPLATE = [\n        \n        '<div class=\"form-group form-group-slick\">',\n        \n        '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>',\n        \n        '   <div class=\"input__display\" ',\n        '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error,\\'text-lg\\':size===\\'large\\'}\" ',\n        '       ng-show=\"!editing\" ng-click=\"edit()\" ',\n        '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">',\n        '      {{displayValue}}',\n        '   </div>',\n        \n        '   <div ng-show=\"editing\">',\n        '      <div class=\"input-group\" ng-class=\"{\\'input-group-lg\\':size===\\'large\\'}\">',\n        '           <div class=\"input-group-slick\" ng-class=\"{\\'input-group-slick--lg\\':size===\\'large\\'}\">',\n        \n        '               <span ng-if=\"icon\" class=\"{{::icon}}\"></span>',\n        \n        '               <input id=\"{{::elId}}\" type=\"{{::type}}\" class=\"form-control\" ',\n        '                   pattern=\"{{pattern}}\" ',\n        '                   ng-model=\"innerValue\" ',\n        '                   ng-required=\"{{required}}\" ',\n        '                   ng-keypress=\"onKeyPress($event, $event.keyCode)\" ',\n        '                   ng-keyup=\"onKeyUp($event, $event.keyCode)\" >',\n        \n        '               <span class=\"indicators\">',\n        '                   <span class=\"is-valid glyphicon glyphicon-ok-sign\"></span>',\n        '                  <span class=\"is-invalid glyphicon glyphicon-exclamation-sign\"></span>',\n        '              </span>',\n        \n        '           </div>',\n        \n        '          <span class=\"input-group-btn\">',\n        \n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '                   ng-click=\"cancel()\" title=\"Cancel changes\">',\n        '                   <span class=\"glyphicon glyphicon-ban-circle\"></span>',\n        '              </button>',\n        \n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{disabled:!!error||!isDirty,\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '                   ng-disabled=\"{{!!error}}\" ',\n        '                   ng-click=\"save()\" title=\"Save changes\">',\n        '                  <span class=\"glyphicon glyphicon-ok\"></span>',\n        '               </button>',\n        \n        '           </span>',\n        \n        '       </div>', \n\n        '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>',\n        '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>',\n        \n        '   </div>',\n        \n        '</div>'\n\n    ].join(' ');\n\n    var TEXTAREA_TEMPLATE = [\n        '<div class=\"form-group form-group-slick\">',\n        \n        '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>',\n        \n        '   <div class=\"input__display\" ',\n        '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error,\\'text-lg\\':size===\\'large\\'}\" ',\n        '       ng-show=\"!editing\" ng-click=\"edit()\" ',\n        '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">',\n        '      {{displayValue}}',\n        '   </div>',\n        \n        '   <div ng-show=\"editing\">',\n        '      <div class=\"input-group\" ng-class=\"{\\'input-group-lg\\':size===\\'large\\'}\">',\n        '           <div class=\"input-group-slick\" ng-class=\"{\\'input-group-slick--lg\\':size===\\'large\\'}\">',\n        \n        '               <span ng-if=\"icon\" class=\"{{::icon}}\"></span>',\n        \n        '               <textarea rows=\"3\" id=\"{{::elId}}\" class=\"form-control\" ',\n        '                   ng-required=\"{{required}}\" ng-model=\"innerValue\"',\n        '                   ng-keypress=\"onKeyPress($event, $event.keyCode)\" ',\n        '                   ng-keyup=\"onKeyUp($event, $event.keyCode)\"></textarea>',\n        \n        '               <span class=\"indicators\">',\n        '                   <span class=\"is-valid glyphicon glyphicon-ok-sign\"></span>',\n        '                  <span class=\"is-invalid glyphicon glyphicon-exclamation-sign\"></span>',\n        '              </span>',\n        \n        '           </div>',\n        \n        '          <span class=\"input-group-btn\">',\n        \n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '                   ng-click=\"cancel()\" title=\"Cancel changes\">',\n        '                   <span class=\"glyphicon glyphicon-ban-circle\"></span>',\n        '              </button>',\n        \n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{disabled:!!error||!isDirty,\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '                   ng-disabled=\"{{!!error}}\" ',\n        '                   ng-click=\"save()\" title=\"Save changes\">',\n        '                  <span class=\"glyphicon glyphicon-ok\"></span>',\n        '               </button>',\n        \n        '           </span>',\n        \n        '       </div>', \n\n        '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>',\n        '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>',\n        \n        '   </div>',\n        \n        '</div>'\n    ].join(' ');\n\n    var DATE_TEMPLATE = [\n\n        \n        '<div class=\"form-group form-group-slick\">',\n        \n        '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>',\n\n        '   <div class=\"input__display\" ',\n        '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error}\" ',\n        '       ng-show=\"!editing\" ng-click=\"edit()\" ',\n        '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">',\n        '      {{displayValue}}',\n        '   </div>',\n        \n        '   <div ng-show=\"editing\">',\n        '       <div uib-datepicker ng-required=\"{{required}}\" ng-model=\"innerValue\" datepicker-options=\"{showWeeks:false}\"></div>',\n        \n        '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>',\n        '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>',\n        \n        '       <button type=\"button\" class=\"btn btn-default\" ',\n        '           ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '           ng-click=\"cancel()\" title=\"Cancel changes\">',\n        '           <span class=\"glyphicon glyphicon-ban-circle\"></span>',\n        '      </button>',\n        \n        '      <button type=\"button\" class=\"btn btn-default\" ',\n        '           ng-class=\"{disabled:!!error,\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '          ng-disabled=\"{{!!error}}\" ',\n        '           ng-click=\"save()\" title=\"Save changes\">',\n        '           <span class=\"glyphicon glyphicon-ok\"></span>',\n        '      </button>',\n\n        '   </div>',\n\n        '</div>'\n\n    ].join(' ');\n\n    var SELECT_TEMPLATE = [\n        \n        '<div class=\"form-group form-group-slick\">',\n        \n        '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>',\n        \n        '   <div class=\"input__display\" ',\n        '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error}\" ',\n        '       ng-show=\"!editing\" ng-click=\"edit()\" ',\n        '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">',\n        '      {{displayValue}}',\n        '   </div>',\n        \n        '   <div ng-show=\"editing\">',\n\n        '      <div class=\"input-group\" ng-class=\"{\\'input-group-lg\\':size===\\'large\\'}\">',\n        \n        '           <div class=\"input-group-slick\" ng-class=\"{\\'input-group-slick--lg\\':size===\\'large\\'}\">',\n        \n        '               <span ng-if=\"icon\" class=\"{{::icon}}\"></span>',\n        \n        '               <select class=\"form-control input__field\" ',\n        '                   ng-if=\"codeList.length<=12\" ',\n        '                   ng-model=\"innerValue\" ',\n        '                   ng-options=\"opt.value as opt.label for opt in selectOptions\" ',\n        '                   ng-required=\"{{required}}\" ',\n        '                   ng-change=\"onChange(innerValue)\" ',\n        '                   ng-keyUp=\"onKeyUp($event.keyCode)\" >',\n        '                   <option value=\"\">Select One</option>',\n        '               </select>',\n\n        '               <input type=\"text\" class=\"form-control input__field\" ng-if=\"codeList.length>12\" ',\n        '                   ng-model=\"innerValue\" ',\n        '                   ng-required=\"{{required}}\" ',\n        '                   ng-keyUp=\"onTypeaheadKeyUp($event.keyCode)\" ',\n        '                   typeahead-on-select=\"onTypeaheadSelection($item, $model, $label, $event)\" ',\n        '                   uib-typeahead=\"opt.value as opt.label for opt in selectOptions | filter:{value:$viewValue} | limitTo:12\" ',\n        '                   typeahead-min-length=\"0\" ',\n        '                   typeahead-editable=\"false\">',\n        \n        '               <span class=\"indicators\">',\n        '                   <span class=\"is-valid glyphicon glyphicon-ok-sign\"></span>',\n        '                  <span class=\"is-invalid glyphicon glyphicon-exclamation-sign\"></span>',\n        '              </span>',\n        \n        '           </div>',\n        \n        '          <span class=\"input-group-btn\">',\n        \n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '                   ng-click=\"cancel()\" title=\"Cancel changes\">',\n        '                   <span class=\"glyphicon glyphicon-ban-circle\"></span>',\n        '              </button>',\n        \n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{disabled:!!error||!isDirty,\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '                   ng-disabled=\"{{!!error}}\" ',\n        '                   ng-click=\"save()\" title=\"Save changes\">',\n        '                  <span class=\"glyphicon glyphicon-ok\"></span>',\n        '               </button>',\n        \n        '           </span>',\n        \n        '       </div>',\n        \n        '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>',\n        '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>',\n        \n        '   </div>',\n        \n        '</div>'\n\n    ].join(' ');\n\n})(jQuery, angular);","(function(angular) {\n    \n    \"use strict\";\n\n    angular.module(\"gp-common\").directive('gpTweetButton', ['$timeout', function($timeout) {\n        \n        function debounce(func, wait, immediate) {\n            var timeout;\n            return function() {\n                var context = this,\n                    args = arguments;\n                var later = function() {\n                    timeout = null;\n                    if (!immediate) func.apply(context, args);\n                };\n                var callNow = immediate && !timeout;\n                clearTimeout(timeout);\n                timeout = setTimeout(later, wait);\n                if (callNow) func.apply(context, args);\n            };\n        }\n\n        return {\n            link: function(scope, element, attr) {\n\n                if(typeof(twttr) === 'undefined') {\n                    element.className += ' disabled';\n                    return;\n                }\n\n                var renderTwitterButton = debounce(function() {\n                    if (attr.url) {\n                        $timeout(function() {\n                            element[0].innerHTML = '';\n                            twttr.widgets.createShareButton(\n                                attr.url,\n                                element[0],\n                                function() {}, {\n                                    count: attr.count,\n                                    text: attr.text,\n                                    via: attr.via,\n                                    size: attr.size,\n                                    hashtags: attr.hashtags,\n                                    dnt: attr.dnt\n                                }\n                            );\n                        });\n                    }\n                }, 75);\n                attr.$observe('url', renderTwitterButton);\n                attr.$observe('text', renderTwitterButton);\n            }\n        };\n    }]);\n\n}) (angular);","(function(angular) {\n\n    \"use strict\";\n\n    angular.module(\"gp-common\").directive('sortOrder', function() {\n        return {\n            \n            replace: true,\n            require: 'ngModel',\n            \n            template: [\n                '<div>',\n                '<a class=\"btn btn-default\" title=\"Click to sort in ascending order\" href ng-if=\"value===\\'dsc\\'\" ng-click=\"toggle()\">',\n                '    <span class=\"glyphicon glyphicon-sort-by-attributes-alt\"></span>',\n                '</a>',\n                '<a class=\"btn btn-default\" title=\"Click to sort in descending order\" href ng-if=\"value===\\'asc\\'\" ng-click=\"toggle()\">',\n                '    <span class=\"glyphicon glyphicon-sort-by-attributes\"></span>',\n                '</a>',\n                '</div>'\n            ].join(' '),\n\n            link: function($scope, element, attrs, ngModel) {\n                ngModel.$viewChangeListeners.push(function() {\n                    $scope.$eval(attrs.ngChange);\n                });\n                ngModel.$render = function() {\n                    $scope.value = ngModel.$modelValue;\n                };\n                $scope.toggle = function() {\n                    $scope.value = $scope.value === 'asc' ? 'dsc' : 'asc';\n                    ngModel.$setViewValue($scope.value);\n                };\n            }\n        };\n    });\n\n})(angular);","(function(angular) {\n    \n    'use strict';\n\n    /** \n     * directive used in conjunction with ng-model to map arrays of strings\n     * to form field controls for editing.\n     *\n     * Usage:  <input ng-model=\"arrOfStr\" string-array-input></input>\n     *\n     */\n    angular.module('gp-common').directive('stringArrayInput', function() {\n        return {\n            restrict: 'A',\n            require: 'ngModel',\n            link: function(scope, element, attr, ngModel) {\n                \n                function fromInput(text) {\n                    let result = null;\n                    if(text && text.length)\n                        result = text.split(',').map( i => i.trim() );\n                    return result;\n                }\n\n                function toInput(arr) {\n                    let result = null;\n                    if(arr && typeof(arr.push) !== 'undefined')\n                        result = arr.join(', ');\n                    return result;\n                }\n\n                ngModel.$parsers.push(fromInput);\n                ngModel.$formatters.push(toInput);\n\n            }\n        };\n    });\n\n}) (angular);","(function(jQuery, angular) {\n    \n    \"use strict\"; \n    \n    angular.module(\"gp-common\")\n\n    /**\n     * Custom filter to make label values visually helpful by \n     * replacing bad characters with spaces or meaningful equivalents\n     */\n    .filter('fixLabel', function() {\n        return function(value) {\n            if(!value || typeof(value) !== 'string' || !value.length) return 'Untitled';\n            let result = value.replace(/([a-z])([A-Z])/g, \"$1 $2\").replace(/_/g, \" \").trim();\n            return result.charAt(0).toUpperCase() + result.slice(1);\n        };\n    })\n\n    .filter('pluralize', function() {\n        return function(text) {\n            if(!text || !text.length) return \"\";\n            if(text.endsWith('ss')) return text + 'es'; //classes, etc\n            if(text.endsWith('s')) return text;         //already plural\n            return text + 's';\n            //TODO support irregular words like \"foot\" -> \"feet\"\n            // and words that need duplicate letters: \"quiz\" -> \"quizzes\"\n        };\n    })    \n\n    .filter('capitalize', function() {\n        return function(text) {\n            return text[0].toUpperCase() + text.substring(1);\n        };\n    })\n\n\n    .filter('facets', function() {\n\n        return function(arr,facetName) {\n            if(!facetName) return arr;\n            if(!arr || !arr.length) return [];\n            return arr.filter(function(f){return f.toLowerCase().startsWith(facetName + \":\");})\n                .map(function(f) {return f.substring(f.indexOf(':')+1, f.length);});\n        };\n\n    })\n\n    .filter('joinBy', function () {\n        return function (input,delimiter,emptyValue) {\n            if(input && typeof(input.push) !== 'undefined' && input.length) \n                return input.join(delimiter || ', ');\n            else             return emptyValue || '';\n        };\n    })\n\n\n\n    .filter('defaultValue', function() {\n        return function(text, defVal) {\n            if(typeof(text)==='undefined' || !text.length) return defVal;\n            return text;\n        };\n    })\n\n    .filter('count', function() {\n        return function(input) {\n            if(typeof(input) !== 'undefined') {\n                if(typeof(input.push) === 'function') \n                    return input.length;\n                if(typeof(input) === 'object') {\n                    if(typeof(Object.keys) !== 'undefined') {\n                        return Object.keys(input);\n                    }\n                }\n            }\n            return 0;\n        };\n    })\n\n\n    /**\n     *\n     */\n    .filter('gpObjTypeMapper', function() {\n        return function(str) {\n            if(!str || typeof(str) !== 'string' || str.length === 0) \n                return str;\n            \n            var name = str;\n            \n            var idx = str.indexOf(\":\");\n            if(~idx) name = str.substring(idx+1);\n\n            if('VCard' === name) return 'Contact';\n            return name;\n            \n        };\n    })\n\n\n    .filter('gpReliabilityGrade', function() {\n\n        return function(arg) {\n\n            let o = arg;\n            if(typeof(o) === 'object') {\n                if(o.statistics)        o = o.statistics.reliability || null;\n                else if(o.reliability)  o = o.reliability;\n                else                    o = null;\n            }\n\n            if(!isNaN(o)) {\n\n                o = o*1;\n\n                if(o===null || typeof(o)==='undefined') \n                    return 'X';\n                else if(o > 90) return 'A';\n                else if(o > 80) return 'B';\n                else if(o > 70) return 'C';\n                else if(o > 60) return 'D';\n                else return 'F';\n\n                // if (value >= 97) letter = 'A+';\n                // else if (value >= 93) letter = 'A';\n                // else if (value >= 90) letter = 'A-';\n                // else if (value >= 87) letter = 'B+';\n                // else if (value >= 83) letter = 'B';\n                // else if (value >= 80) letter = 'B-';\n                // else if (value >= 77) letter = 'C+';\n                // else if (value >= 73) letter = 'C';\n                // else if (value >= 70) letter = 'C-';\n                // else if (value >= 67) letter = 'D+';\n                // else if (value >= 63) letter = 'D';\n                // else if (value >= 60) letter = 'D-';\n            }\n\n            return \"X\";\n        };\n    })\n\n    ;\n\n})(jQuery, angular);","\n/**\n * \n * KnowledgeGraph property on RIM Asset renamed to Classifiers\n *\n */\n\n\n(function(jQuery, angular, Constants) {\n    'use strict';\n\n    angular.module('gp-common-kg', [])\n\n\n    .constant('KGFields', [\n        'purposes', 'functions', 'primaryTopics', 'secondaryTopics', \n        'primarySubjects', 'secondarySubjects', 'communities', 'audiences', \n        'places', 'categories'\n    ])\n\n\n    .service('KGHelper', [ 'KGFields', 'RecommenderServiceFactory', \n        function(KGFields, RecommenderServiceFactory) {\n\n        return {\n            calculate: function(kg) {\n                if(!kg) return 0;\n                let result = 0;\n                angular.forEach(KGFields, prop => {\n                    if(kg[prop] && kg[prop].length)\n                        result += 7 + Math.floor( (kg[prop].length-1) / 2 );\n                    // result += kg[prop] ? kg[prop].length*5 : 0;\n                });\n                return result;\n            },\n\n            getService: function(type) {\n                return RecommenderServiceFactory(type);\n            }\n\n        };\n    }])\n\n\n\n    /**\n     * Service that queries the recommendation service endpoint \n     * exposed by UAL \n     */\n    .service(\"RecommenderService\", function($resource) {\n\n        let baseUrl = Constants.ualUrl + '/api/recommender';\n        return $resource(baseUrl, { }, {\n\n            query: {\n                url: baseUrl + '/suggest',\n                isArray: false\n            },\n            queryTypes: {\n                url: baseUrl + '/types',\n                isArray: false\n            },\n            querySources: {\n                url: baseUrl + '/sources',\n                isArray: false\n            }\n\n        });\n\n    })\n\n\n\n    /**\n     * Factory for creating services that query the recommendation \n     * service endpoint exposed by UAL and includes object type\n     * parameter based upon owner of KG\n     */\n    .factory(\"RecommenderServiceFactory\", function($resource) {\n\n        return function(type) {\n        \n            let baseUrl = Constants.ualUrl + '/api/recommender';\n            return $resource(baseUrl, { 'for': type }, {\n\n                query: {\n                    url: baseUrl + '/suggest',\n                    isArray: false\n                },\n                queryTypes: {\n                    url: baseUrl + '/types',\n                    isArray: false\n                },\n                querySources: {\n                    url: baseUrl + '/sources',\n                    isArray: false\n                }\n\n            });\n\n        };\n\n    })\n\n\n\n    /** \n     * Component for rendering a brief % of completion\n     *\n     */\n    .component('kgCompletionDisplay', {\n\n        bindings: {\n            ngModel: '<' // the Asset containing the knowledge graph ('classifiers') property\n        },\n\n        controller: function($rootScope, KGHelper) {\n\n            this.$onInit = function() {\n\n                this.update();\n\n                this.listener = $rootScope.$on('gp:kg:updated', (event, item) => {\n                    if(item && item.id === this.id) {\n                        //in case kg didn't exist, \n                        if(!this.ngModel.classifiers)\n                            this.ngModel.classifiers = item.classifiers;\n                        this.value = KGHelper.calculate(this.ngModel.classifiers);\n                    }\n                });\n\n            };\n\n            this.$onChanges = function() {\n                this.update();\n            };\n\n            this.$onDestroy = function() {\n                this.listener();\n                this.listener = null;\n            };\n\n            this.update = function() {\n                this.id = this.ngModel ? this.ngModel.id : null;\n                this.value = KGHelper.calculate(this.ngModel.classifiers);\n            };\n\n        },\n\n        template: \n        `\n            <span>{{$ctrl.value||0}}%</span>\n            <span class=\"glyphicon glyphicon-dashboard\"></span>\n        `\n\n    })\n    ;\n\n\n}) (jQuery, angular, GeoPlatform);\n\n","\n\n( function(angular, Constants) {\n    \n    'use strict';\n\n\n    class SectionController {\n\n        constructor($timeout, RecommenderService) {\n            'ngInject';\n            \n            this.$timeout = $timeout;\n            this.service = RecommenderService;\n        }\n\n        $onInit () {\n            this.noResults = false;\n            this.query = '';\n            this.displayOptions = {\n                fetching: false,\n                showSuggested: false\n            };\n            this.paging = {\n                start: 0,\n                size: 5,\n                sizeOptions: [5, 10, 20]\n            };\n            this.updateCache();\n        }\n\n        /**\n         * Update cache when bound 'ngModel' is actually assigned in the component lifecycle\n         */\n        $onChanges () {\n            this.updateCache();\n        }\n\n        $onDestroy() {\n            this.eventHandlers = null;\n            this.clearOptions();\n            this.selected = null;\n            this.service = null;\n            this.$timeout = null;\n        }\n\n        /**\n         * \n         * @param {object} item - selected value being activated (clicked on for navigation)\n         */\n        activate(item) {\n            if(this.onActivate)\n                this.onActivate({value: item});\n        }\n\n        on (event, callback) {\n            this.eventHandlers = this.eventHandlers || {};\n            this.eventHandlers[event] = this.eventHandlers[event] || [];\n            this.eventHandlers[event].push(callback);\n        }\n\n        notify(event, data) {\n            if(!this.eventHandlers || !this.eventHandlers[event]) return;\n            angular.forEach(this.eventHandlers[event], (handler) => { \n                try { handler(data); } catch(e) { } \n            });\n        }\n\n\n        /**\n         * @param {string} query - keywords provided by user input\n         * @return {Promise} resolving an array of results\n         */\n        fetchOptions (query) {\n            \n            //need this timeout or else 'this.query' isn't being \n            // seen as having the same value as 'query'\n            this.$timeout( () => { this.query = query; }, 10);\n\n            this.displayOptions.fetching = true;\n            let params = {\n                type:   this.type,\n                q:      query,\n                page:   Math.floor(this.paging.start/this.paging.size),\n                size:   this.paging.size\n            };\n            // if(this.forType)\n            //     params['for'] = this.forType;\n\n            return this.service.query(params).$promise\n            .then(  response => {\n                this.paging.total = response.totalResults;\n                this.notify('gp:browse:suggestions:pagination', this.paging);\n                this.suggested = response.results.map( result => {\n                    result._selected = this.isSelected(result);\n                    return result;\n                });\n                this.displayOptions.showSuggested = true;\n                return this.suggested;\n            })\n            .catch( e        => { \n                this.paging.total = 0;\n                this.notify('gp:browse:suggestions:pagination', this.paging);\n                this.suggested = [];\n                return this.suggested;\n            })\n            .finally( ()     => this.displayOptions.fetching = false );\n        }\n\n        clearQuery () {\n            this.query='';\n            this.fetchOptions(this.query);\n        }\n\n        clearOptions () {\n\n            //clear query and available options\n            this.query='';\n            this.suggested = null;\n\n            //reset paging\n            this.paging.start = 0;\n            this.paging.total = 0;\n            // this.notify('gp:browse:suggestions:pagination', this.paging);\n\n            //hide available options\n            this.displayOptions.showSuggested = false;\n        }\n        \n        /**\n         * @param {integer} index - position in selected array of item removed\n         */\n        remove (index) {\n            \n            let removed = this.ngModel[index].uri;\n            this.ngModel.splice(index, 1);\n\n            //remove from suggested list if one is populated (being shown)\n            if(this.suggested && this.suggested.length) {\n                let found = this.suggested.find( it => it.uri === removed );\n                if(found) found._selected = false;\n            }\n            this.updateCache();                       //update cache of selected ids\n            \n            if(this.onChange)\n                this.onChange({values: this.ngModel});  //notify others of change\n        }\n\n        /**\n         * @param {object} value - item being checked for selection\n         * @return {boolean}\n         */\n        isSelected (value) {\n            return value._selected || ~this.selected.indexOf( value.uri );\n        }\n\n        /**\n         * @param {object} value - item being selected\n         */\n        selectValue (value) {\n            if(value._selected) return; //already selected\n\n            value._selected = true;\n\n            this.ngModel = this.ngModel || [];\n            this.ngModel.push(value);\n            this.updateCache();\n\n            if(this.onChange)\n                this.onChange({values: this.ngModel});\n\n        }\n\n        updateCache () {\n            this.selected = (this.ngModel || []).map( o => o.uri );\n        }\n\n        onDropdownToggled (open) {\n            if(!open) this.clearOptions();\n        }\n\n\n        /* -------- pagination methods ----------- */\n\n        getPagination () {\n            return this.paging;\n        }\n\n        start (index) {\n            this.paging.start = index;\n            this.fetchOptions(this.query);\n        }\n\n        size (value) {\n            this.paging.size = value;\n            this.fetchOptions(this.query);\n        }\n        \n    }\n\n\n\n\n    angular.module('gp-common-kg').component('kgSection', {\n\n        bindings: {\n            ngModel: '<',\n            service: '<',       //recommender service instance to use\n            label: '@',\n            description: '@',\n            type: '@',          //type of KG property\n            onChange: '&?',     //fire when value(s) change\n            onActivate: '&?'    //fire when selected value link is clicked\n        },\n\n        controller: SectionController,\n\n        template: \n        `\n            <h5>{{$ctrl.label}}</h5>\n            <p>{{$ctrl.description}}</p>\n\n            <div class=\"list-group list-group-sm\">\n                <div ng-repeat=\"item in $ctrl.ngModel track by $index\" class=\"list-group-item\">\n                    <button type=\"button\" class=\"btn btn-link\" ng-click=\"$ctrl.remove($index)\">\n                        <span class=\"glyphicon glyphicon-remove-circle t-fg--danger\"></span> \n                    </button>\n                    <div class=\"flex-1 u-pd--md\">\n                        <div class=\"u-pd-bottom--sm t-text--strong\">\n                            <a ng-click=\"$ctrl.activate(item)\" ng-if=\"$ctrl.onActivate\">{{item.label}}</a>\n                            <span ng-if=\"!$ctrl.onActivate\">{{item.label}}</span>\n                        </div>\n                        <div class=\"u-text--sm t-text--italic\">\n                            <a href=\"{{item.uri}}\" target=\"_blank\" title=\"Open source info in new window\">{{item.uri}}</a>\n                        </div>\n                        <div class=\"description\">{{item.description||\"No description provided\"}}</div>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"t-fg--gray-md\" ng-if=\"!$ctrl.ngModel.length\"><em>No values specified</em></div>            \n\n            <hr>\n\n            <div uib-dropdown is-open=\"$ctrl.displayOptions.showSuggested\" \n                auto-close=\"outsideClick\" on-toggle=\"$ctrl.onDropdownToggled(open)\">\n\n                <div class=\"l-flex-container flex-justify-between flex-align-center\">\n                    <div class=\"input-group-slick flex-1\">\n                        <span class=\"glyphicon\"\n                            ng-class=\"{'glyphicon-search':!$ctrl.displayOptions.fetching, 'glyphicon-hourglass spin':$ctrl.displayOptions.fetching}\"></span>\n                        <input type=\"text\" class=\"form-control\" \n                            ng-model=\"$ctrl.query\" \n                            ng-model-options=\"{ debounce: 250 }\"\n                            ng-change=\"$ctrl.fetchOptions($ctrl.query)\"\n                            placeholder=\"Find values to add...\">\n                    </div>\n                </div>\n                \n                <div class=\"dropdown-menu\" uib-dropdown-menu>\n                    \n                    <div class=\"form-group l-flex-container flex-justify-between flex-align-center\">\n                        <div class=\"input-group-slick flex-1\">\n                            <span class=\"glyphicon\"\n                                ng-class=\"{'glyphicon-search':!$ctrl.displayOptions.fetching, 'glyphicon-hourglass spin':$ctrl.displayOptions.fetching}\"></span>\n                            <input type=\"text\" class=\"form-control\" \n                                ng-model=\"$ctrl.query\" \n                                ng-model-options=\"{ debounce: 250 }\"\n                                ng-change=\"$ctrl.fetchOptions($ctrl.query)\"\n                                placeholder=\"Find values to add...\">\n                            <span class=\"glyphicon glyphicon-remove\"\n                                ng-if=\"$ctrl.query.length\"\n                                ng-click=\"$event.stopPropagation();$ctrl.clearQuery()\"></span>\n                        </div>\n                        <button type=\"button\" class=\"btn btn-info u-mg-left--xlg animated-show\"\n                            ng-click=\"$ctrl.clearOptions();\">\n                            Done\n                        </button>\n                    </div>\n                    \n                    <gp-pagination service=\"$ctrl\" event-key=\"suggestions\" use-select=\"true\"></gp-pagination>\n\n                    <div class=\"list-group list-group-sm u-text--sm\">\n                        <div ng-repeat=\"item in $ctrl.suggested track by $index\" class=\"list-group-item\">\n                            <button type=\"button\" class=\"btn btn-link\" ng-click=\"$ctrl.selectValue(item)\"\n                                ng-class=\"{disabled:item._selected}\">\n                                <span class=\"glyphicon glyphicon-ok t-fg--gray-md\" ng-show=\"item._selected\"></span> \n                                <span class=\"glyphicon glyphicon-plus-sign t-fg--success\" ng-show=\"!item._selected\"></span> \n                            </button>\n                            <div class=\"flex-1 u-pd--md\">\n                                <div class=\"t-text--strong u-pd-bottom--sm\">{{item.prefLabel}}</div>\n                                <a href=\"{{item.uri}}\" target=\"_blank\" class=\"u-text--sm t-text--italic\"\n                                    title=\"Open source info in new window\">\n                                    {{item.uri}}\n                                </a>\n                                <div class=\"description\">{{item.description||\"No description provided\"}}</div>\n                            </div>\n                        </div>\n                        <div ng-if=\"!$ctrl.suggested.length\" class=\"list-group-item disabled u-pd--md\">\n                            No results match your query\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `\n    });\n\n}) (angular, GeoPlatform);\n\n","\n(function(angular, Constants) {\n    \n    \"use strict\";\n\n\n    //fields list sent to MDR in order to have these properties for display in search results\n    const FIELDS = [ 'created','modified','publishers','themes','description','extent' ];\n\n    //facets list sent to MDR in order to get aggregation numbers\n    const FACETS = [ 'types','themes','publishers', 'serviceTypes', 'schemes', 'visibility', 'createdBy' ];\n\n    const SORT_OPTIONS = [\n        { value:\"label,asc\",       label: \"Name (A-Z)\"              }, \n        { value:\"label,desc\",      label: \"Name (Z-A)\"              }, \n        { value:\"type,asc\",        label: \"Type (A-Z)\"              }, \n        { value:\"type,desc\",       label: \"Type (Z-A)\"              }, \n        { value:\"modified,desc\",   label: \"Most recently modified\"  }, \n        { value:\"modified,asc\",    label: \"Least recently modified\" } \n    ];\n\n    //list of _options variables for mapping to parameters\n    const VAR_TYPES                 = 'types';\n    const VAR_THEMES                = 'themes';\n    const VAR_PUBLISHERS            = 'publishers';\n    const VAR_USER                  = 'user';\n    const VAR_CREATED_BY            = 'createdBy';\n    const VAR_SERVICE_TYPES         = 'serviceTypes';\n    const VAR_SCHEMES               = 'schemes';\n    const VAR_VISIBILITY            = \"visibility\";\n    const VAR_QUERY                 = 'query';\n    const VAR_EXTENT                = 'extent';\n    const VAR_MODIFIED_BEFORE       = 'modified.max';\n    const VAR_MODIFIED_AFTER        = 'modified.min';\n\n    //parameter names for various query constraints used in requests to MDR for results\n    const PARAMETER_TYPE            = 'type';\n    const PARAMETER_THEME           = 'theme.id';\n    const PARAMETER_PUBLISHER       = 'publisher.id';\n    const PARAMETER_CREATED_BY      = 'createdBy';\n    const PARAMETER_CONTRIBUTED_BY  = 'contributedBy';\n    const PARAMETER_CREATOR         = 'creator.id';\n    const PARAMETER_SVC_TYPE        = 'serviceType.id';\n    const PARAMETER_IN_SCHEME       = 'scheme.id';\n    const PARAMETER_VISIBILITY      = 'visibility';\n    const PARAMETER_QUERY           = 'q';\n    const PARAMETER_EXTENT          = 'bbox';\n    const PARAMETER_MODIFIED_BEFORE = 'modified.max';\n    const PARAMETER_MODIFIED_AFTER  = 'modified.min';\n    // const PARAMETER_CONTRIBUTOR     = 'contributor.id';\n    \n\n    const PARAM_OPTIONS = [\n        { option: VAR_TYPES,            parameter: PARAMETER_TYPE           },\n        { option: VAR_THEMES,           parameter: PARAMETER_THEME          },\n        { option: VAR_PUBLISHERS,       parameter: PARAMETER_PUBLISHER      },\n        { option: VAR_USER,             parameter: PARAMETER_CREATOR        },\n        { option: VAR_CREATED_BY,       parameter: PARAMETER_CREATED_BY     },\n        { option: VAR_SERVICE_TYPES,    parameter: PARAMETER_SVC_TYPE       },\n        { option: VAR_SCHEMES,          parameter: PARAMETER_IN_SCHEME      },\n        { option: VAR_VISIBILITY,       parameter: PARAMETER_VISIBILITY     },\n        { option: VAR_QUERY,            parameter: PARAMETER_QUERY          },\n        { option: VAR_EXTENT,           parameter: PARAMETER_EXTENT         },\n        { option: VAR_MODIFIED_BEFORE,  parameter: PARAMETER_MODIFIED_BEFORE },\n        { option: VAR_MODIFIED_AFTER,   parameter: PARAMETER_MODIFIED_AFTER }\n    ];\n    \n\n    const PAGE_SIZE_BASE_10 = [ 10, 20, 50, 100 ];\n    const PAGE_SIZE_BASE_12 = [ 12, 24, 48, 96 ];\n\n\n    /**\n     *\n     *\n     */\n    function BrowseObjectsService($rootScope, $timeout, $resource, options) {\n            \n\n        /* -------- private data ----------- */\n\n        let url = options && options.url ? options.url + \"/:id\" : Constants.ualUrl + '/api/items/:id';\n\n        let eventKey = 'gp:browse:' + (options && options.key ? options.key : 'objects') + \":\";\n\n        var svc = $resource(url, {id: '@id'}, {\n            query: {\n                isArray: false\n            }\n        });\n\n        var _pageSizeBase = PAGE_SIZE_BASE_10.slice(0);\n        if(options && options.pageSizeBase && options.pageSizeBase === 12)\n            _pageSizeBase = PAGE_SIZE_BASE_12.slice(0); \n\n        var _options = {\n            start: 0, \n            size: _pageSizeBase[0], \n            total: 0,\n            sort: (options && options.sort) ? options.sort : \"modified,desc\", \n            facets: {}\n        };\n\n        //list of field names to request in response\n        var _fields = options && options.fields ? options.fields : FIELDS.slice(0);  \n\n        //list of facet names to request\n        var _requestFacets = options && options.facets ? options.facets : FACETS.slice(0);\n        \n\n        var _facets = [];\n        var _selectedFacets = [];\n        \n        var _results = [];\n        \n        var _dirtyPromise = null;\n\n        var _isLoading = false;\n\n        var _selected = [];\n\n        var _onSelectFn = options && options.onSelect ? options.onSelect : null;\n        \n\n        /**\n         *\n         */\n        function notify(eventName, arg) {\n            // console.log(\"Notifying of \" + eventName + \" with \" + arg);\n            $rootScope.$broadcast(eventName, arg);\n        }\n\n        /**\n         * when marked as dirty, debounce for rapid fire events like onKeyUp\n         */\n        function dirty(delay, resetStart) {\n\n            var doReset = typeof(resetStart) === 'undefined' || resetStart === true;\n\n            if(_dirtyPromise) \n                $timeout.cancel(_dirtyPromise);\n            _dirtyPromise = $timeout(function() { \n                _dirtyPromise = null;\n                _doUpdate(doReset); \n            }, delay || 100);\n\n        }\n\n        /**\n         *\n         */\n        function _doUpdate(resetStart) {\n\n            if(resetStart)\n                _options.start = 0;\n\n            _isLoading = true;\n            notify(eventKey + 'querying');\n\n            let params = {};\n\n\n            // -------- QUERY FILTERS --------\n\n            //create a temporary options object\n            let opts = angular.copy(_options);\n\n            //apply options as parameters\n            angular.forEach(PARAM_OPTIONS, po => {\n                let name = po.parameter;\n                let value = opts[po.option];\n\n                let isSet = value !== null && typeof(value) !== 'undefined';\n                let isArr = isSet && typeof(value.push) !== 'undefined';\n                    \n                if(isSet && (!isArr||value.length)) {\n                    params[name] = isArr ? value.join(',') : value;\n                } else {\n                    delete params[name];\n                }\n                delete opts[po.option]; //remove from temp opts\n            });\n\n            //apply remaining options to query\n            // these are not keyed with specific parameters (ie, custom params)\n            angular.forEach(opts, (value, name) => {\n                if(value !== null && typeof(value) !== 'undefined') {\n                    let isArr = typeof(value.push) !== 'undefined';\n                    params[name] = isArr ? value.join(',') : value;\n                } else {\n                    //make sure it doesn't get sent if no value provided\n                    delete params[name];\n                }\n            });\n            \n            // -------- QUERY FILTERS --------\n\n\n\n\n            let arr = [];\n            for(let k in _options.facets) {\n                if(_options.facets.hasOwnProperty(k)) {\n                    //encode commas in facet name since it's used to separate multiple \n                    // facet values\n                    arr.push(k+\":\"+_options.facets[k].replace(/,/g, '%2C'));\n                }\n            }\n            _selectedFacets = arr;\n\n\n            let start = _options.start;\n            if(isNaN(start)) start = 0;\n            else start = start*1;\n\n            params.page = Math.floor(start/_options.size);\n            params.size = _options.size;\n            params.sort = _options.sort;\n            \n            if(arr.length)\n                params.facets = arr.join(',');\n            \n\n\n            //prevent CORS cache bug in Chrome\n            params.bust = new Date().getTime();\n\n\n            //request facets\n            params.includeFacet=_requestFacets.join(',');\n\n            //request fields\n            params.fields=_fields.join(',');\n\n            svc.query(params).$promise.\n            then( function(response) {\n                \n                _results = response.results;\n                _facets = response.facets || [];\n\n                //auto select objects if user has marked it as selected previously\n                // this is needed to maintain selections across pagination pages\n                _selected.each(function(id) {\n                    var map = _results.find(function(map) {return map._id === id;});\n                    if(map) map.selected = true;\n                });\n\n                //will trigger update on pagination directive\n                _options.total = response.totalResults;\n                \n                _isLoading = false;\n                notify(eventKey + 'results');\n                notify(eventKey + 'pagination');\n\n            })\n            .catch( function(response) {\n                _isLoading = false;\n                \n                //fallback\n                let obj = { error: \"An Error Occurred\", message: \"No details provided\" }\n\n                //http response error\n                if(response && response.data) obj = response.data;\n                //normal error\n                else if(response && response.message) obj = response;\n\n                //serialized json\n                if(typeof(obj) === 'string') {\n                    try      { obj = JSON.parse(obj);  } \n                    catch(e) { obj.message = \"Bad response from server\"; }\n                }\n\n                var error = { \n                    label: obj.error || \"An Error Occurred\", \n                    message: obj.message || \"No details provided\"\n                };\n                notify(eventKey + 'error', error);\n            });\n            \n        }\n\n\n\n        function setOption(name, value, fire) {\n            _options[name] = value;\n            if(typeof(fire) === 'undefined' || !!fire) {\n                let delay = 500;\n                if(value === null || value === undefined) \n                    delay = 0;\n                if(value && typeof(value.push) !== 'undefined' && value.length) \n                    delay = 0;  //arrays\n                else if(value && value.length) \n                    delay = 0;   //strings\n                dirty(delay);\n            }\n        }\n\n\n    \n        /* ------------ public api ------------- */\n\n        return {\n\n            events: {\n                LOADING:            eventKey + 'querying',\n                RESULTS:            eventKey + 'results',\n                PAGINATION:         eventKey + 'pagination',\n                SELECTED:           eventKey + 'selected',\n                ERROR:              eventKey + 'error',\n                SELECTED_ADDED:     eventKey + 'selected:added',\n                SELECTED_REMOVED:   eventKey + 'selected:removed'\n            },\n\n            /**\n             * @return {bool}\n             */\n            getLoadingStatus: function() {\n                return _isLoading;\n            },\n\n            /**\n             * NOTE: Make sure event names are prefixed with\n             *  eventKey + ''\n             * @param {string} eventName\n             * @param {function} listener\n             */\n            on: function(eventName, listener) {\n                // if(eventName.indexOf(eventKey + \":\") !== 0)\n                //     eventName = eventKey + '' + eventName;\n                return $rootScope.$on(eventName, listener);\n            },\n\n            /**\n             * @param {string} eventName\n             * @param {*} args\n             */\n            trigger: function(eventName, args) { notify(eventName, args); },\n\n            /**\n             * @return {array[object]}\n             */\n            getResults: function() { return _results; },\n\n            /** \n             * @return {array[string]} list of facet names\n             */\n            getFacetNames: function() { return FACETS.slice(0); },\n\n            /**\n             * @return {object} in form of <facet>: [<values>]\n             */\n            getFacets: function() { return _facets; },\n\n            /**\n             * @param {string} name\n             * @return {object|null}\n             */\n            getFacet: function(name) {\n                if(_facets) {\n                    return _facets.find(function(facet) {return facet.name===name;});\n                }\n                return null;\n            },\n\n            addFacet: function(name) {\n                _requestFacets.push(name);\n            },\n\n            applyConstraints: function(obj) {\n                // _options[VAR_QUERY] = obj.query;\n                // _options[VAR_TYPES] = obj.types;\n                // _options[VAR_THEMES] = obj.themes;\n                // _options[VAR_PUBLISHERS] = obj.publishers;\n                // _options[VAR_USER] = obj.user;\n                // _options[VAR_CREATED_BY] = obj.createdBy;\n                // _options[VAR_SERVICE_TYPES] = obj.serviceTypes;\n                // _options[VAR_SCHEMES] = obj.schemes;\n                // _options[VAR_VISIBILITY] = obj.visibility;\n                // //do we need to set extent here too?\n\n                for(var p in obj) {\n                    if(obj.hasOwnProperty(p)) {\n                        _options[p] = obj[p];\n                    }\n                }\n\n                _doUpdate(true);\n            },\n\n            applyOption: function(key, value, fire) {setOption(key, value, fire); },\n\n            applyOptions: function(opts, fire) {\n                angular.forEach(opts, (value, key) => { setOption(key, value, false); });\n                if(fire) _doUpdate(true);\n            },\n\n            /**\n             * @param {string} text - free text query\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setQuery: function(text, fireUpdate) { setOption(VAR_QUERY, text, fireUpdate); },\n\n            /**\n             * @param {array[string]} types - name of class(es) to request\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setTypes: function(types, fireUpdate) { setOption(VAR_TYPES, types, fireUpdate); },\n\n            getTypes: function() { return _options[VAR_TYPES]; },\n\n            /** \n             * @param {string} userId - identifier of user\n             * @param {boolean} fireUpdate -\n             */\n            setUser: function(userId, fireUpdate) { setOption(VAR_USER, userId, fireUpdate); },\n\n            /**\n             * @param {array[string]} creators - ids of creators\n             * @param {boolean} fireUpdate - \n             */\n            setCreatedBy: function(creators, fireUpdate) { setOption(VAR_CREATED_BY, creators, fireUpdate); },\n\n            /**\n             * @param {array[string]} themes - name of class(es) to request\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setThemes: function(themes, fireUpdate) { setOption(VAR_THEMES, themes, fireUpdate); },\n\n            getThemes: function() { return _options[VAR_THEMES]; },\n\n            /**\n             * @param {array[string]} publishers - name of class(es) to request\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setAgencies: function(publishers, fireUpdate) { setOption(VAR_PUBLISHERS, publishers, fireUpdate); },\n\n            getAgencies: function() { return _options[VAR_PUBLISHERS]; },\n\n            /**\n             * @param {array[string]} svcTypes - ids\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setServiceTypes: function(svcTypes, fireUpdate) { setOption(VAR_SERVICE_TYPES, svcTypes, fireUpdate);  },\n\n            getServiceTypes: function() { return _options[VAR_SERVICE_TYPES]; },\n\n            /**\n             * @param {array[string]} schemes - ids\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setSchemes: function(schemes, fireUpdate) { setOption(VAR_SCHEMES, schemes, fireUpdate); },\n\n            /**\n             * @param {string} visibility - one of 'public' or 'private'\n             * @param {boolean} fireUpdate\n             */\n            setVisibility: function(visibility, fireUpdate) { setOption(VAR_VISIBILITY, visibility, fireUpdate); },\n\n            /** \n             * @param {Date} date - date to compare against\n             * @param {boolean} beforeOrAfter - flag specifying which boundary condition (true = before, false = after)\n             * @param {boolean} fireUpdate - flag specifying whether to trigger update automatically\n             */\n            setModified: function(date, beforeOrAfter, fireUpdate) {\n            \n                //if no date was supplied, consider it \"unset\" for both properties\n                if(!date) {\n                    setOption(VAR_MODIFIED_BEFORE, null, false);\n                    setOption(VAR_MODIFIED_AFTER, null, true);\n                    return;\n                }\n\n                let dir = beforeOrAfter && (beforeOrAfter === true || beforeOrAfter === \"true\");\n                let prop = dir ? VAR_MODIFIED_BEFORE : VAR_MODIFIED_AFTER;       //property being set\n                let oppProp = dir ? VAR_MODIFIED_AFTER : VAR_MODIFIED_BEFORE;    //unset opposite property\n                let arg = (date && date.getTime) ? date.getTime() : date;\n\n                setOption(oppProp, null, false);\n                setOption(prop, arg, true);\n            },\n            \n            getModified: function() {\n                return this._options[VAR_MODIFIED_BEFORE] || this._options[VAR_MODIFIED_AFTER];\n            },\n\n            /**\n             * @param {string} bboxStr - form of \"minx,miny,maxx,maxy\"\n             * @param {boolean} fireUpdate\n             */\n            setExtent: function(bboxStr) { setOption(VAR_EXTENT, bboxStr, true); },\n\n            /**\n             * @return {string} bbox string or null if not set\n             */\n            getExtent: function() { return _options[VAR_EXTENT]; },\n\n            /**\n             * @return {array} list of selected items from current search results\n             */\n            getSelected: function() { return _selected; },\n\n            /**\n             * @param {array} arr - list of items to select in current search results\n             */\n            setSelected: function(arr) { \n                _selected = arr; \n                notify(this.events.SELECTED, _selected);\n            },\n\n            /**\n             * @param {string} id - identifier of item in current search results to add to selected list\n             */\n            select: function(id) {\n                \n                var finder = function(l){ return l.id === id; };\n\n                var existing = _selected.find(finder);\n                if(existing) {  //already selected, deselect it\n\n                    var idx = _selected.indexOf(existing);\n                    if(idx >= 0) {\n                        _selected.splice(idx, 1);\n                        notify(eventKey + 'selected:removed', existing);\n                    }\n\n                } else {        //not selected, select it\n                    \n                    let obj = _results.find(finder);\n                    if(obj) {\n\n                        if(_onSelectFn) {\n                            _onSelectFn(id, function(err, item) {\n                                if(item) {\n                                    _selected.unshift(item);\n                                    notify(eventKey + 'selected:added', item);\n                                }\n                            });\n                        } else {\n                            _selected.unshift(obj);\n                            notify(eventKey + 'selected:added', obj);\n                        }\n                    }\n                    \n                }\n\n                notify(this.events.SELECTED, _selected);\n            },\n\n            /** \n             * @param {string} id - identifier of item to check\n             * @return {boolean} true if selected, false otherwise\n             */\n            isSelected: function(id) {\n                return _selected.find(function(obj) {return obj.id === id;});\n            },\n\n            /**\n             * select all items in current page of results\n             */\n            selectAll: function() {\n                angular.forEach(_results, (obj) => {\n                    if(!this.isSelected(obj.id))\n                        _selected.unshift(obj);\n                });\n                notify(this.events.SELECTED, _selected);\n            }, \n\n            /**\n             * empty list of selected items\n             */\n            clearSelected: function() {\n                _selected = [];\n                notify(this.events.SELECTED, []);\n            },\n\n\n            /**\n             *\n             */\n            clear: function(refresh) {\n\n                for(var prop in _options) {\n                    if(!_options.hasOwnProperty(prop)) continue;\n                    if('start' === prop) _options[prop] = 0;\n                    else if('size' === prop) { }\n                    else if('sort' === prop) _options[prop] = 'modified,desc';\n                    else if('facets' === prop) _options[prop] = {};\n                    else _options[prop] = null;\n                }\n\n                if(refresh || typeof(refresh) === 'undefined')\n                    _doUpdate(true);\n            },\n\n            /*\n             * @param {string} category - name of facet\n             * @param {string} value - value of facet\n             */\n            setFacet: function(category, value) {\n\n                var f = _options.facets[category];\n                if(!f)  //this facet category not set yet\n                    _options.facets[category] = value;\n                else {  //this facet category already set\n                    if(f === value) {   //this facet value already set\n                        //unset it\n                        delete _options.facets[category];\n                    } else {    //this facet value not set\n                        //set it\n                        _options.facets[category] = value;\n                    }\n                }\n\n                _doUpdate(true);\n            },\n\n            /**\n             * @param {array[string]} fields - list of field names to request for each search result\n             */\n            setFields: function(fields) {\n                if(fields && typeof(fields.push) !== 'undefined')\n                    _fields = fields;\n            },\n\n            /**\n             * @param {int} start - beginning index of results to request\n             * @param {bool} andUpdate - trigger update (default is true)\n             */\n            start: function(start, andUpdate) {\n                _options.start = start;\n                if(andUpdate && andUpdate === true)\n                    _doUpdate(false);\n            },\n\n            /**\n             * @param {int} size - page size to request\n             * @param {bool} andUpdate - trigger update (default is true)\n             */\n            size: function(size, andUpdate) {\n                \n                _options.size = size;\n\n                //find out which page in the new scheme the current first-result of current page\n                // will show up in, and set start so that it shows up with the new page size\n                var page = Math.floor(_options.start*1 / _options.size*1);\n                _options.start = page * (_options.size*1);\n\n                if(andUpdate && andUpdate === true)\n                    _doUpdate(false);\n\n            },\n\n            /**\n             * @param {int} size - number of items to return in each page of results\n             */\n            pageSize: function(size) {\n                this.size(size, true);\n            },\n\n            /**\n             * @param {string} sort - form of <field>,<dir>\n             */\n            sort: function(sort) {\n                _options.sort = sort;\n                _doUpdate(false);\n            },\n\n            /**\n             * return {object} containing start index, page size, and total results\n             */\n            getPagination: function() {\n                return {\n                    start: _options.start,\n                    size:  _options.size,\n                    pageSize: _options.size,\n                    total: _options.total,\n                    sizeOptions: _pageSizeBase\n                };\n            },\n\n            /**\n             * @return {array} list of key-value pairs of sort options\n             */\n            getSortOptions: function() { return SORT_OPTIONS.slice(0); },\n\n            /**\n             * @return {string} sorting parameter (field,order)\n             */\n            getSortValue: function () { return _options.sort; },\n\n            /**\n             * @return {object} clone of the current set of query options\n             */\n            getQueryOptions: function() { return jQuery.extend({}, _options); },\n\n            /**\n             *\n             */\n            hasQueryOptions: function() {\n                var result = false;\n                for(var k in _options) {\n                    if(_options.hasOwnProperty(k)) {\n\n                        if( 'start' === k || 'size' === k || 'total' === k ||\n                            'sort' === k || 'order' === k || 'within' === k ||\n                            'facets' === k) continue;\n\n                        if(_selectedFacets.length) \n                            result = true;\n\n                        if(typeof(_options[k]) !== 'undefined' && _options[k] !== null) {\n                            result = true;\n                        }\n                    }\n                }\n                return result;\n            },\n\n            /** \n             * Triggers a refresh of current search results\n             * @param {boolean} resetStart - reset 'start' to 0 flag\n             */\n            update: function(resetStart) {\n                dirty(0, resetStart);\n            },\n\n            \n            reset: function() {\n                _options = {\n                    start: 0, \n                    size: _pageSizeBase[0], \n                    total: 0,\n                    sort: \"modified,desc\", order: \"asc\", \n                    facets: {}\n                };\n\n                _facets = [];\n                _selectedFacets = [];                \n                _results = [];\n                _isLoading = false;\n                _selected = [];\n\n                if(_dirtyPromise) \n                    $timeout.cancel(_dirtyPromise);\n                _dirtyPromise = null;                \n            },\n\n            destroy: function() {\n                if(_dirtyPromise) \n                    $timeout.cancel(_dirtyPromise);\n            }\n        };\n    }\n    \n\n\n\n\n\n\n\n    /**\n     * Factory for creating instances of BrowseObjectsService\n     */\n    function BrowseServiceFactory($rootScope, $timeout, $resource) { \n\n        return function(options) {\n            let svc = BrowseObjectsService($rootScope, $timeout, $resource, options);\n            if(options && options.params)\n                svc.applyOptions(options.params);\n            return svc;\n        };\n    }\n\n\n\n\n    angular.module('gp-common')\n\n    //generic browse service\n    .service(\"BrowseObjectsService\", \n        ['$rootScope', '$timeout', '$resource', BrowseObjectsService])\n\n    //factory for creating specific browse services\n    .factory(\"BrowseServiceFactory\", \n        ['$rootScope', '$timeout', '$resource', 'BrowseObjectsService', BrowseServiceFactory]);\n\n/* \n    Example of how to use the factory to customize a service\n\n    //layer-specific browse service\n    .service('BrowseLayerObjService', ['BrowseServiceFactory', function(BrowseServiceFactory) {\n        let service = BrowseServiceFactory({ \n            key: 'layers',\n            url: Constants.ualUrl + '/api/layers' \n        });\n        \n        //add custom methods here\n\n        return service;\n    }])\n*/  \n    \n\n})(angular, GeoPlatform);","(function(angular) {\n    \n    'use strict';\n\n\n    /* *********************************************\n     * Requires socket.io be in the global namespace\n     * tested with version 2.x\n     * ********************************************* */\n\n\n\n     /*\n        Usage:\n\n        let service = ...\n\n        let svcId = service.getId();\n\n        //listen to events from the server\n        service.on('testing', (event) => { \n            if(event.clientId === svcId) return; //ignore our own events\n            ... do something ...\n        });\n        \n        //sends out a message to others\n        service.emit( service.events.CREATED, 'test');\n\n        //sends out a message to others\n        service.begin(service.events.EDITING, 'test');\n\n        //sends out a message to others\n        service.end(service.events.EDITING, 'test');\n\n        //stop listening and close the socket\n        service.close();\n\n      */\n\n\n\n\n    /**\n     *\n     */\n    class SocketService {\n\n        constructor (url, options) {\n            'ngInject';\n\n            let opts = typeof(options) === 'object' ? options : {};\n            for(var key in opts)\n                this[key] = opts[key];\n\n            this.socket = null;\n\n            //list of ids of things being tracked, such as \n            // items edited, in order to send messages\n            // about the things lifecycle\n            this.tracking = {};\n\n            //events supported.\n            // Note that lifecycles can be added by using the \n            // begin() and end() methods on the service,\n            // which appends '_start' and '_end' respectively\n            this.events = {\n                CREATED: 'created',\n                UPDATED: 'updated',\n                DELETED: 'deleted',\n                EDITING: 'editing',\n                STATUS: 'status'\n            };\n\n            if(typeof(io) === 'undefined') {\n                console.log(\"Socket.IO not found in global namespace\");\n                return;\n            }\n\n            if(!url) {   //TODO validate URL with regex?\n                console.log(\"No web socket URL configured for this app to communicate with\");\n                return;\n            }\n\n            //make connection\n            this.socket = io.connect(url);\n\n            //listen for the init event indicating connection has been made\n            // and to get the socket's id from the server\n            this.socket.on(\"init\", (evt) => { \n                this.socketId = evt.id; \n            });\n\n            //if unable to connect\n            this.socket.on('error', () => {\n                console.log(\"Unable to connect to \" + url + \" with websockets\");\n            });\n\n        }\n\n        /**\n         *\n         */\n        getId () { return this.socketId; }\n            \n        /**\n         * @param {string} eventName\n         * @param {Function} callback\n         * @return {Function} to remove the listener\n         */\n        on (eventName, callback) {\n            if(!this.socket) return function() { };\n            //add the listener to the socket\n            this.socket.on(eventName, callback);\n            //return an 'off' function to remove the listener\n            return () => { this.socket.off(eventName, callback); };\n        }\n\n        /**\n         *\n         */\n        emit ( eventName, data, callback ) {\n            if(!this.socket) return;\n            this.socket.emit(eventName, data, callback);\n        }\n\n        /**\n         * Closes this service's socket\n         */\n        close () { \n\n            //if this app was tracking an obj, \n            // notify listeners that it is no longer\n            for(var event in this.tracking) {\n                if(this.tracking.hasOwnProperty(event)) {\n                    let tracks = this.tracking[event];\n                    if(tracks && tracks.length) {\n                        /* jshint ignore:start */\n                        angular.forEach(tracks, (id) => { \n                            this.end(event, id); \n                        });\n                        /* jshint ignore:end */\n                    }        \n                }\n            }\n\n            if(this.socket) {\n                this.socket.close(); \n                this.socket = null;\n            }\n\n            return null;\n        }\n\n        /**\n         * @param {string} event - name of the event being started\n         * @param {string} objId - identifier of the item being tracked\n         */\n        begin (event, objId) {\n\n            this.tracking[event] = this.tracking[event] || [];\n            this.tracking[event].push(objId);\n\n            let room = objId + \"_\" + event.toLowerCase();\n\n            this.join(room, () => {\n                this.socket.emit(event, room, this.socketId, true);\n            });\n\n        }\n\n        /**\n         * @param {string} event - name of the event being ended\n         * @param {string} objId - identifier of the item being tracked\n         */\n        end (event, objId) {\n\n            this.tracking[event] = this.tracking[event] || [];\n            if(!this.tracking[event].length) return;    //empty, ignore request\n\n            let idx = this.tracking[event].indexOf(objId);\n            if(idx < 0) //not found, ignore request\n                \n            //remove tracker\n            this.tracking[event].splice(idx, 1);\n\n            //send event to server about client stopping it's tracking\n            let room = objId + \"_\" + event.toLowerCase();\n            this.socket.emit(event, room, this.socketId, false, () => {\n                this.leave(room);\n            });\n\n        }\n\n        /**\n         *\n         */\n        join (objId, callback) {\n            this.emit('join', objId, callback);\n        }\n\n        /**\n         *\n         */\n        leave (objId, callback) {\n            this.emit('leave', objId, callback);\n        }\n\n    }\n\n\n\n\n    /** \n     * Factory to get a Service used to listen for WebSocket messages from a server\n     *\n     * Usage: \n     *\n     * let wsUrl = ...\n     * let service = SocketServiceFactory(wsUrl);\n     *\n     */\n     angular.module('gp-common').factory('SocketServiceFactory', function ($rootScope, $window, UUID) {\n\n        var cache = {};\n\n        //disconnect whenever the app is closed\n        var onClose = (e) => { \n            for(var key in cache) {\n                if(cache.hasOwnProperty(key)) {\n                    cache[key].close();\n                    cache[key] = null;\n                }\n            }\n            cache = null;\n            return null;\n        };\n        \n        //needed for reload/backbtn\n        if($window.onbeforeunload === 'function') {\n            let existing = $window.onbeforeunload;\n            $window.onbeforeunload = function(e) {\n                onClose(e);\n                return existing(e);\n            };\n        } else {\n            $window.onbeforeunload = onClose;      \n        }\n\n        $rootScope.$on('$destroy', onClose);\n        //-------------------\n\n\n        return function(url) {\n\n            // if(!url) return null;\n            // if(cache[url]) return cache[url];\n\n            let cacheRef = UUID();\n            let service = new SocketService(url, $rootScope, {cacheRef: cacheRef});\n            let closeDelegate = service.close;\n            service.close = function() {\n                let id = service.cacheRef;\n                closeDelegate.call(service); //have service disconnect and clean up itself\n                //then clean up cache reference\n                delete cache[id];\n            };\n\n            let onDelegate = service.on;\n            service.on = function(event, callback) {\n\n                if(typeof(callback) === 'function') {\n                    //have to use old-school refs instead of arrow functions\n                    // or else the arguments get scrambled\n                    let handle = function() {\n                        var args = arguments;\n                        $rootScope.$apply(function() { \n                            callback.apply(service.socket, args); \n                        });\n                    };\n                    return onDelegate.call(service, event, handle);\n\n                } else {\n                    return onDelegate.call(service, event);\n                }\n            };\n\n            let emitDelegate = service.emit;\n            service.emit = function(event, data, callback) {\n                \n                if(typeof(callback) === 'function') {\n                    //have to use old-school refs instead of arrow functions\n                    // or else the arguments get scrambled\n                    let handle = function() {\n                        var args = arguments;\n                        $rootScope.$apply(function() { \n                            callback.apply(service.socket, args); \n                        });\n                    };\n                    emitDelegate.call(service, event, data, handle);\n\n                } else {\n                    emitDelegate.call(service, event, data);\n                }\n            };\n\n            // cache[url] = service;\n            cache[cacheRef] = service;\n            return service;\n\n        };\n\n    });\n\n}) (angular);","(function(angular) {\n    \n    'use strict';\n\n    angular.module(\"gp-common\").factory('UUID', function() {\n            \n        function s4() {\n            return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);\n        }\n\n        /*\n        return function() {\n                return s4() + s4() + '-' + s4() + '-' + s4() + '-' +\n                    s4() + '-' + s4() + s4() + s4();\n            }\n         */\n\n        return function() {\n            // http://www.ietf.org/rfc/rfc4122.txt\n            var s = [];\n            var hexDigits = \"0123456789abcdef\";\n            for (var i = 0; i < 36; i++) {\n                s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);\n            }\n            s[14] = \"4\"; // bits 12-15 of the time_hi_and_version field to 0010\n            s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1); // bits 6-7 of the clock_seq_hi_and_reserved to 01\n            s[8] = s[13] = s[18] = s[23] = \"-\";\n            return s.join(\"\");\n        }\n        \n    });\n\n})(angular);","(function(angular) {\n    \n    'use strict';\n\n    //flag on whether we're in dev env\n    function isDEV() {\n        return \"localhost\" === window.location.hostname || \n            ~window.location.hostname.indexOf(\"192.168\")||\n            ~window.location.hostname.indexOf(\"10.0\");\n    }\n\n\n\n    /** \n     * GeoPlatform Common Module Authentication Support\n     *\n     * Contains re-usable services, directives, and other angular components\n     *\n     * \n     * NOTE: This module uses certain variables in $rootScope in order to \n     * perform actions like authentication.  The following variables should be\n     * set before using any service/directive in this file:\n     *\n     *   - idspUrl : the url to the identity service provider server\n     *   - idmUrl : the url to the identity management server\n     *   - portalUrl : the url to the main landing page of GeoPlatform (www.geoplatform.gov in production) \n     */\n    angular.module('gp-common')\n\n    /**\n     * Authentication Service\n     * \n     * Because the auth service redirects the page to the IDM portal\n     * and WMV is reloaded once the login/logout processes are complete,\n     * there's no need to bind listeners informing other components of \n     * an auth change.\n     *\n     * Inside \"DEV\", you should close and re-open any components' widgets\n     * to get current auth status.\n     */\n    .service('AuthenticationService', ['$q', '$http', 'GPConfig', function($q, $http, Config) {\n\n        // console.log(\"IDSP Base Url: \" + Config.idspUrl);\n\n        function User(opts) {\n            for(var p in opts) {\n                this[p] = opts[p];\n            }\n            if(!this.id && this.username)\n                this.id = this.username;\n\n            this.toJSON = function() {\n                return {\n                    id: this.id,\n                    username: this.username, \n                    name: this.name, \n                    email: this.email,\n                    org: this.org,\n                    roles: this.roles\n                };\n            };\n            this.clone = function() {\n                return new User(this.toJSON());\n            };\n            this.compare = function(arg) {\n                if(arg instanceof User) {\n                    return this.id === arg.id;\n                } else if(typeof(arg) === 'object') {\n                    return typeof(arg.id) !== 'undefined' && \n                        arg.id === this.id;\n                }\n                return false;\n            };\n            this.isAuthorized = function(role) {\n                let env = Config.env || Config.ENV || Config.NODE_ENV;\n                if(env === 'dev' || env === 'development') return true;\n                return this.roles && ~this.roles.indexOf(role);\n            };\n        }\n\n\n        var TEST_USER = new User({\n            id: \"tester\",\n            username: \"tester\", \n            email: \"tester@geoplatform.us\",\n            name: \"John Test\", \n            org: \"Other\"\n        });\n\n\n        var _user = null;\n\n        if(isDEV()) {\n\n            /*\n             * If testing when user is not logged in, inject the following before\n             *  this ng-common library is included in the page:\n             * \n             *     GeoPlatform.TEST_NO_AUTH = true;\n             * \n             *  but be sure to inject AFTER the GeoPlatform configuration object exists!\n             */\n            if(GeoPlatform && GeoPlatform.TEST_NO_AUTH)\n                _user = null;\n            else \n                _user = TEST_USER.clone();\n        }    \n\n        var STATUS = {\n            NONE: 0,\n            INITIALIZING: -1,   //auth check in progress\n            INITIALIZED: 1      //auth check completed\n        };\n\n\n        /** \n         * @param {string} cookie - a concatenated string of user info\n         * @return {object|null} user info\n         */\n        function parseCookie(cookie) {\n\n            // console.log(cookie);\n            if(!cookie || !cookie.length) return null;\n\n            var data = {};\n\n            var str = decodeURIComponent(cookie);            \n            var parts = str.split('+');\n            parts = parts.map(function(part) {\n                var kvp = part.split(':');\n                data[kvp[0]] = kvp.slice(1).join(':');\n            });\n\n            data.groups = (data.groups) ? data.groups.split(',') : [];\n            // console.log(data.groups);\n\n            return data;\n        }\n\n        function getRoles() {\n            var cookie = document.cookie.replace(/(?:(?:^|.*;\\s*)AUTHENTICATEDGEOSAML\\s*\\=\\s*([^;]*).*$)|^.*$/, \"$1\");\n            var user = parseCookie(cookie);\n            return user ? user.groups : [];\n        }\n\n\n\n        /**\n         * Authentication Service\n         */\n        var Service = function() {\n\n            var self = this;\n\n            this.status = STATUS.NONE;\n\n\n            //$q version of getUser\n            this.getUserQ = function() {\n                var deferred = $q.defer();\n                this.getUser(function(user) { deferred.resolve(user); });\n                return deferred.promise;\n            };\n\n            /**\n             * If the callback parameter is specified, this method\n             * will return undefined. Otherwise, it returns the user (or null).\n             *\n             * @param callback optional function to invoke with the user\n             * @return object representing current user\n             */\n            this.getUser = function(callback) {\n                if(callback && typeof(callback) === 'function') {\n\n                    // console.log(\"Getting user info: \" + self.status + \", \" + JSON.stringify(_user||{empty:true}));\n\n                    //if already checked, return what we have\n                    if(self.status === STATUS.INITIALIZED) \n                        callback(_user);\n                    //if not in process of checking, check\n                    else if(self.status !== STATUS.INITIALIZING) {\n                        //if hasn't been checked for auth yet, do that now\n                        self.check().then(function(_user) {\n                            self.status = STATUS.INITIALIZED;\n                            callback(_user);\n                        }, function() {\n                             self.status = STATUS.INITIALIZED;\n                             callback(null);\n                        });\n                    } \n                    //if in process of checking, wait until it finishes\n                    else {\n                        setTimeout(function() {\n                            self.getUser(callback);\n                        }, 500);\n                    }\n                    return;\n                }\n                return _user;\n            };\n\n            /**\n             * @return {string} current HREF of the application\n             */\n            this.getCurrentLocation = function() {\n                return window.location.href;\n            };\n\n            /**\n             * @param {function} callback - callbackFn( doneFn ) { ... doneFn(); }\n             */\n            this.onBeforeLogin = function(callback) {\n                if(callback) {\n                    this.beforeLoginFn = () => {\n                        let deferred = $q.defer();\n                        callback( () => { deferred.resolve(); });\n                        return deferred.promise;\n                    };\n                } else {\n                    this.beforeLoginFn = null;\n                }\n            };\n\n            /**\n             * Redirects the page to the login site\n             */\n            this.login = function () {\n\n                let promise = this.beforeLoginFn ? this.beforeLoginFn() : $q.resolve();\n                promise.then( () => {\n                \n                    if(isDEV() && !(GeoPlatform && GeoPlatform.TEST_NO_AUTH)) {\n                        _user = TEST_USER.clone();\n                        return _user;\n                    }\n                    var current = this.getCurrentLocation();\n                    window.location = Config.idspUrl + '/module.php/core/as_login.php?AuthId=geosaml&ReturnTo=' + encodeURIComponent(current);\n\n                });\n            };\n\n            /**\n             * @param {function} callback - callbackFn( doneFn ) { ... doneFn(); }\n             */\n            this.onBeforeLogout = function(callback) {\n                if(callback) {\n                    this.beforeLogoutFn = () => {\n                        let promise = $q.defer();\n                        callback( () => { promise.resolve(); });\n                        return promise;\n                    };\n                } else {\n                    this.beforeLogoutFn = null;\n                }\n            };\n\n            /**\n             * Redirects the page to the logout site\n             */\n            this.logout = function() {\n                let promise = this.beforeLogoutFn ? this.beforeLogoutFn() : $q.resolve();\n                promise.then( () => {\n                \n                    if(isDEV()) {\n                        _user = null;\n                        return _user;\n                    }\n                    var current = this.getCurrentLocation();\n                    window.location = Config.idspUrl + '/module.php/core/as_logout.php?AuthId=geosaml&ReturnTo=' + encodeURIComponent(curfalse);\n\n                });\n            };\n\n\n            /**\n             * Queries simplesamlphp if the current session is authenticated\n             * @return promise - then(function(user) {}, function(response){})\n             */\n            this.check = function() {\n                \n                var deferred = $q.defer();\n                \n                if(isDEV()) {\n                    // console.log(\"Dev env\");\n                    setTimeout(function() {\n                        deferred.resolve(_user);\n                    }, 1000);\n                    return deferred.promise;\n                }\n\n                self.status = STATUS.INITIALIZING;\n\n                //check authentication on load\n                var promise = $http.get(Config.idspUrl + '/authenticategeosaml.php?as=geosaml');\n                promise.then(function(response) {\n                    \n                    var content = response.data ? response.data : response;\n\n                    // console.log(\"Received from SP: \" + content);\n                    if(typeof(content) === 'string') {\n                        try {\n                            content = JSON.parse(content);\n                        } catch(e) {\n                            deferred.reject(e);\n                            return;\n                        }\n                    }\n                    \n                    if(content.Success) {  //authenticated\n                        _user = new User({\n                            id       : content.name[0],\n                            username : content.name[0],\n                            email    : content.mail[0],\n                            name     : content.first_name[0] + ' ' + content.last_name[0],\n                            org      : content.organization[0],\n                            roles    : getRoles()\n                        });\n                        // console.log(\"Authenticated user: \" + JSON.stringify(_user));\n\n                    } else {\n                        _user = null;       //not authenticated\n                        // console.log(\"Failed to authenticate user\");\n                    }\n\n                    deferred.resolve(_user);\n                    \n                }, function(data, status, headers) {   // failed check\n                    // console.log(\"Authentication call failed\");\n                    deferred.reject(data);\n                }).catch(function(e) {\n                    // console.log(\"Authentication check caught an error: \" + e.message);\n                    deferred.reject(e.message);\n                });\n\n                return deferred.promise;\n            };\n\n            //=====================================================\n\n            //initialize with auth check\n            this.check().then(function(user) {\n                self.status = STATUS.INITIALIZED;\n            }, function(err) {\n                self.status = STATUS.INITIALIZED;\n            }).catch(function(e) {\n                // console.log(\"Initial auth check errored\");\n            });\n\n        };\n\n        return new Service();\n\n    }])\n\n    .directive('gpLoginButton', ['$timeout', 'AuthenticationService', 'GPConfig', \n        function($timeout, AuthenticationService, Config) {\n        return {\n            scope: {\n                minimal: '@'\n            },\n            replace: true,\n            template: [\n\n                '<div class=\"btn-account btn-group\">' + \n\n                //not logged in\n                '  <a class=\"btn btn-link\" ng-click=\"login()\" ng-if=\"!user\">Sign In</a>' + \n                \n                //logged in\n                '  <button type=\"button\" class=\"btn btn-link dropdown-toggle\" data-toggle=\"dropdown\" ' + \n                '   aria-expanded=\"false\" ng-if=\"user\">' + \n                '     <span class=\"glyphicon glyphicon-user\"></span> ' +\n                '     <span class=\"hidden-xs\">{{::user.name}}</span> ' + \n                '     <span class=\"caret\"></span>' + \n                '  </button>' + \n                '  <ul class=\"dropdown-menu dropdown-menu-right\" role=\"menu\" ng-if=\"user\">' + \n                '    <li class=\"account-details\">' + \n                '      <div class=\"media\">' + \n                '        <div class=\"media-left\">' + \n                '          <div class=\"media-object\">' + \n                '            <span class=\"glyphicon glyphicon-user glyphicon-xlg\"></span>' + \n                '          </div>' + \n                '        </div>' + \n                '        <div class=\"media-body\">' + \n                '          <div class=\"media-heading\">{{::user.name}}</div>' + \n                '          <div><em>{{::user.username}}</em></div>' + \n                '          <div>{{::user.email}}</div>' + \n                '          <div>{{::user.org}}</div>' + \n                '        </div>' + \n                '      </div>' + \n                '    </li>' + \n                '    <li class=\"divider\"></li>' + \n                '    <li><a href=\"{{::idpUrl}}/modifyuser.html\">Edit Info</a></li>' + \n                '    <li><a href=\"{{::idpUrl}}/changepassword.html\">Change Password</a></li>' + \n                '    <li><a href ng-click=\"logout()\">Sign Out</a></li>' + \n                '  </ul>' + \n\n\n                '</div>'\n            ].join(' '),\n            controller: function($scope, $element) {\n\n                if($scope.minimal === 'true') $scope.minimal = true;\n                if($scope.minimal !== true) $scope.minimal = false;\n\n                $scope.idpUrl = Config.idmUrl;\n                // console.log(\"IDM Base Url: \" + Config.idmUrl);\n                \n                AuthenticationService.getUser(function(user) {\n                    $timeout(function() {\n                        $scope.user = user;\n                    },100);\n                });\n                \n                $scope.login = function() {\n                    $scope.user = AuthenticationService.login();\n                };\n\n                $scope.logout = function() {\n                    $scope.user = AuthenticationService.logout();\n                };\n\n                //watch user for changes (timeouts)\n                var watcher = $scope.$watch(function() { return AuthenticationService.getUser(); }, function(newUser) {\n                    $scope.user = newUser;\n                });\n\n                $scope.$on('$destroy', function() {\n                    watcher();  //destroy watcher\n                });\n            }\n        };\n    }])\n\n\n    \n    .directive('gpAccountDetails', ['$timeout', 'AuthenticationService', 'GPConfig', \n        function($timeout, AuthenticationService, Config) {\n\n        return {\n            scope: {},\n            replace: true,\n            template: [\n                '<div>' + \n                '  <div class=\"media\">',\n                '    <div class=\"media-left\">',\n                '        <div class=\"media-object\">',\n                '            <span class=\"glyphicon glyphicon-user glyphicon-xlg\"></span>',\n                '        </div>',\n                '    </div>',\n                '    <div class=\"media-body\" ng-if=\"user\">',\n                '       <div class=\"media-heading\">{{::user.name}}</div>' + \n                '       <div><small><em>{{::user.username}}</em></small></div>' + \n                '       <div><small>{{::user.email}}</small></div>' + \n                '       <div><small>{{::user.org}}</small></div>' +  \n                '    </div>',\n                '    <div class=\"media-body\" ng-if=\"!user\">',\n                '       <div class=\"media-heading\">Please Sign In</div>' + \n                '       <div><small>Sign in to your GeoPlatform account or register a new account.</small></div>' + \n                '    </div>',\n                '  </div>',\n                '  <hr/>',\n                '  <div ng-if=\"user\">',\n                '    <button type=\"button\" class=\"btn btn-sm btn-accent pull-right\" ng-click=\"logout()\">Sign Out</button>' + \n                '    <a class=\"btn btn-sm btn-default\" href=\"{{::idpUrl}}/modifyuser.html\">Edit Details</a>' + \n                '  </div>',\n                '  <div ng-if=\"!user\">',\n                '    <button type=\"button\" class=\"btn btn-sm btn-accent pull-right\" ng-click=\"login()\">Sign In</button>' + \n                '    <a class=\"btn btn-sm btn-default\" href=\"{{::idpUrl}}/registeruser.html\">Register</a>' + \n                '  </div>',\n                '</div>'\n            ].join(' '),\n            controller: function($scope, $element) {\n                \n                $scope.idpUrl = Config.idmUrl;\n\n                AuthenticationService.getUser(function(user) {\n                    $timeout(function() {\n                        $scope.user = user;\n                    },100);\n                });\n                \n                $scope.login = function() {\n                    $scope.user = AuthenticationService.login();\n                };\n\n                $scope.logout = function() {\n                    $scope.user = AuthenticationService.logout();\n                };\n\n                //watch user for changes (timeouts)\n                var watcher = $scope.$watch(function() { return AuthenticationService.getUser(); }, function(newUser) {\n                    $scope.user = newUser;\n                });\n\n                $scope.$on('$destroy', function() {\n                    watcher();  //destroy watcher\n                });\n\n            }\n        };\n    }])\n\n;\n\n})(angular);","(function() {\n\n    \"use strict\";\n\n    if(typeof(Array.prototype.find) === 'undefined') {\n        Array.prototype.find = function(callback) {\n            for(var i=0; i<this.length; ++i) {\n                if(callback(this[i], i, this))\n                    return this[i];\n            }\n            return null;\n        };\n    }\n    if(typeof(Array.prototype.filter) === 'undefined') {\n        Array.prototype.filter = function(callback) {\n            var results = [];\n            for(var i=0; i<this.length; ++i) {\n                if(callback(this[i], i, this))\n                    results.push(this[i]);\n            }\n            return results;\n        };\n    }\n    if(typeof(Array.prototype.each) === 'undefined') {\n        Array.prototype.each = function(callback) {\n            for(var i=0; i<this.length; ++i) {\n                callback(this[i], i, this);\n            }\n        };\n    }\n    if(typeof(Array.prototype.indexOfObj) === 'undefined') {\n        Array.prototype.indexOfObj = function(obj, comparatorFn) {\n            \n            let arr = this, len = arr.length;\n            \n            if(typeof(comparatorFn) !== 'function')\n                comparatorFn = (a,b) => { return a===b; };\n\n            for(let i=0; i<len; ++i) {\n                if(comparatorFn(obj, arr[i]))\n                    return i;\n            }\n            return -1;\n        };\n    }\n    if(typeof(String.prototype.startsWith) === 'undefined') {\n        String.prototype.startsWith = function(value) {\n            var str = this;\n            if(!str.length)     return false;\n            if(!value.length)   return false;\n            if(str.length < value.length) return false;\n            return str.indexOf(value) === 0;\n        };\n    }\n    if(typeof(String.prototype.endsWith) === 'undefined') {\n        String.prototype.endsWith = function(value) {\n            var str = this;\n            if(!str.length)     return false;\n            if(!value.length)   return false;\n            if(str.length < value.length) return false;\n            var substr = str.substring(\n                str.length - value.length,\n                str.length\n            );\n            return substr == value;\n        };\n    }\n\n\n\n\n    if(typeof(Date.prototype.plus) === 'undefined') {\n        Date.prototype.plus = function(offset) {\n            \n            var type = typeof(offset);\n            if(type === 'undefined') return this;\n\n            var offsetMS = 0;\n            if(type === 'string') {\n                switch(offset) {\n                    case 'hour':    offsetMS = 1000*60*60; break;\n                    case 'day':     offsetMS = 1000*60*60*24; break;\n                    case 'week':    offsetMS = 1000*60*60*24*7; break;\n                    case 'month':   offsetMS = 1000*60*60*24*31; break;\n                    case 'year':    offsetMS = 1000*60*60*24*365; break;\n                }\n            } else if(type === 'number') {\n                offsetMS = offset;\n            } else return this;\n\n            var d = this;\n            return new Date(d.getTime() + offsetMS);\n        };\n    }\n\n    if(typeof(Date.prototype.random) === 'undefined') {\n        Date.prototype.random = function(threshold) {\n\n            var type = typeof(threshold);\n            if(type === 'undefined') return this;\n\n            var offsetMS = 0;\n            if(type === 'string') {\n                switch(threshold) {\n                    case 'hour':    offsetMS = 1000*60*60; break;\n                    case 'day':     offsetMS = 1000*60*60*24; break;\n                    case 'week':    offsetMS = 1000*60*60*24*7; break;\n                    case 'month':   offsetMS = 1000*60*60*24*31; break;\n                    case 'year':    offsetMS = 1000*60*60*24*365; break;\n                }\n            } else if(type === 'number') {\n                offsetMS = threshold;\n            } else return this;\n\n            var d = this;\n            return new Date(d.getTime() + Math.floor(Math.random()*offsetMS));\n        };\n    }\n\n})();"],"sourceRoot":"/source/"}