{"version":3,"sources":["geoplatform.common.js","module.js","auth.js","lang.js","directives/card-details.js","directives/colorpicker.js","directives/datepicker.js","directives/geolocation.js","directives/header-menu.js","directives/iframe.js","directives/image.js","directives/notifications.js","directives/pagination.js","directives/progress-circle.js","directives/responsive.js","directives/slick-forms.js","directives/social.js","directives/sort.js","directives/string-array.js","filters/filters.js","kg/editor.js","kg/section.js","query/createdBy.filter.js","query/publisher.filter.js","query/recommended.term.filter.js","query/similarity.filter.js","query/theme.filter.js","services/browse.service.js","services/socket.js","services/uuid.js"],"names":["_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","_typeof","Symbol","iterator","obj","constructor","jQuery","angular","module","value","GeoPlatform","Constants","constant","service","KGFields","RecommenderServiceFactory","calculate","kg","result","forEach","prop","Math","floor","getService","type","$resource","baseUrl","ualUrl","query","url","isArray","queryTypes","querySources","factory","for","component","bindings","ngModel","controller","$rootScope","KGHelper","this","$onInit","_this","update","listener","$on","event","item","id","classifiers","$onChanges","$onDestroy","_this2","$promise","$resolved","then","model","template","getJWTFromUrl","queryString","window","location","hash","href","res","match","$q","$http","$location","$window","Config","User","opts","p","username","toJSON","name","email","org","exp","clone","compare","arg","isAuthorized","role","env","ENV","NODE_ENV","roles","push","indexOf","Storage","setObject","setItem","btoa","JSON","stringify","getObject","atob","getItem","parse","_user","self","getUserQ","when","getUser","login","current","redirect","CALLBACK","AUTH_TYPE","Error","loginUrl","IDP_BASE_URL","APP_ID","encodeURIComponent","LOGIN_URL","logout","clearLocalStorageJWT","get","response","removeAuth","LOGOUT_URL","FORCE_LOGIN","PORTAL_URL","host","err","console","log","forceLogin","getOauthProfile","Q","defer","getJWTfromLocalStorage","resolve","data","reject","promise","setUser","user","check","jwt","getJWT","isExpired","setAuth","parseJwt","sub","cleanUrl","replace","callback","localStorage","gpoauthJWT","Date","getTime","token","parsed","base64Url","split","base64","validateJwt","now","defaults","headers","common","Authorization","useXDomain","$injector","resp","authHeader","AuthenticationService","config","$httpProvider","interceptors","directive","$timeout","scope","minimal","join","$scope","$element","idpUrl","idmUrl","Array","find","filter","results","each","indexOfObj","comparatorFn","arr","len","a","b","String","startsWith","str","endsWith","substring","plus","offset","offsetMS","d","random","threshold","compile","append","ACTIVATORS_HTML","hasPrevious","prevAll","hasNext","nextAll","previousDetails","pane","removeClass","element","addClass","nextDetails","invalidRGB","rgb","error","r","parseInt","g","x","componentToHex","c","hex","toString","isNaN","rgbToHex","validHex","exec","hexToRgb","shorthandRegex","m","onChange","changeRGB","rgbError","changeHex","hexError","label","format","date","$attrs","toggle","preventDefault","stopPropagation","opened","debounce","cancel","$watch","restrict","btnLabel","loading","available","navigator","geolocation","geolocate","getCurrentPosition","position","$apply","$emit","coords","latitude","longitude","code","brand","showHomeLink","transclude","link","ctrl","transcludeFn","portalUrl","replaceWith","path","homeLink","menu","dd","closest","parent","$a","$","attr","homeHref","$root","attrs","on","off","jqEl","onImgFail","mapThumbnail","buildThumbnail","map","thumbnail","contentData","style","mediaType","width","height","getUrl","catch","e","fallback","elName","isLink","assetType","assetId","hasThumbnail","Service","items","getItems","addItem","$broadcast","removeItem","bind","index","splice","msg","dismiss","message","canDismiss","success","info","NotificationService","expiration","timer","removeOldest","oldest","$watchCollection","PaginationController","_this3","options","getPagination","pageSizeDropdown","useSelect","pageSize","size","pageSizeOptions","sizeOptions","o","eventKey","start","max","min","total","lastPage","setPage","page","dashArray","PI","changes","provider","$windowProvider","Helper","$get","getWidth","innerWidth","outerWidth","isXS","isSM","isMD","isLG","helper","responsiveHelper","el","resizeFn","w","$attr","hh","offsetHeight","tp","top","css","inputLinkFunction","ngModelController","validate","input","isDirty","hasClass","newValue","$setViewValue","$render","required","elId","ceil","innerValue","$viewValue","displayValue","placeholder","isReadOnly","t","readOnly","toLowerCase","edit","editing","focus","select","done","save","onKeyPress","$event","undefined","which","onKeyUp","$destroy","require","help","pattern","icon","INPUT_TEMPLATE","TEXTAREA_TEMPLATE","$filter","DATE_TEMPLATE","inline","$modelValue","copy","open","uibopts","codeList","SELECT_TEMPLATE","getSelect","$select","selectOptions","opt","onTypeaheadSelection","$item","$model","$label","onTypeaheadKeyUp","func","wait","immediate","timeout","context","args","arguments","later","apply","callNow","clearTimeout","setTimeout","twttr","className","renderTwitterButton","innerHTML","widgets","createShareButton","count","text","via","hashtags","dnt","$observe","$viewChangeListeners","$eval","ngChange","fromInput","trim","toInput","$parsers","$formatters","charAt","toUpperCase","slice","facetName","f","delimiter","emptyValue","defVal","keys","idx","statistics","reliability","KGEditor","fields","displayOptions","completion","descriptions","purpose","function","audience","community","place","category","primarySubject","secondarySubject","primaryTopic","secondaryTopic","calculatePercentage","property","values","classifier","onActivate","ngModelCtrl","SectionController","RecommenderService","noResults","fetching","showSuggested","paging","updateCache","description","eventHandlers","clearOptions","selected","handler","_this4","params","q","totalResults","notify","suggested","_selected","isSelected","finally","fetchOptions","removed","uri","found","it","_this5","collapse","limitToUser","modelOptions","updateOn","default","blur","setCreatedBy","toggleLimitToUser","clear","updateValues","hasSelections","getAgencies","setAgencies","getCount","facet","getFacet","valObj","buckets","v","_this6","sort","bust","newValues","additionalValueCount","selections","existing","nv","concat","status","statusText","RecommendedTermFilter","termService","displayOpts","empty","suggest","termQuery","_this7","applyOption","_this8","getOptions","mapId","_this9","useMap","evtName","events","SIMILARITY","layer","clearValue","toggleCurrentMap","bool","getThemes","themes","setThemes","_this10","scheme.label","BrowseObjectsService","eventName","dirty","delay","resetStart","doReset","_dirtyPromise","_doUpdate","_options","_isLoading","PARAM_OPTIONS","po","parameter","option","isSet","isArr","k","facets","hasOwnProperty","_selectedFacets","includeFacet","_requestFacets","_fields","svc","_results","_facets","_id","setOption","fire","_pageSizeBase","PAGE_SIZE_BASE_10","pageSizeBase","PAGE_SIZE_BASE_12","FIELDS","FACETS","_onSelectFn","onSelect","LOADING","RESULTS","PAGINATION","SELECTED","ERROR","SELECTED_ADDED","SELECTED_REMOVED","getLoadingStatus","trigger","getResults","getFacetNames","getFacets","addFacet","applyConstraints","applyOptions","setQuery","fireUpdate","VAR_QUERY","setTypes","types","VAR_TYPES","getTypes","userId","VAR_USER","creators","VAR_CREATED_BY","VAR_THEMES","publishers","VAR_PUBLISHERS","setServiceTypes","svcTypes","VAR_SERVICE_TYPES","getServiceTypes","setSchemes","schemes","VAR_SCHEMES","setVisibility","visibility","VAR_VISIBILITY","setModified","beforeOrAfter","VAR_MODIFIED_BEFORE","VAR_MODIFIED_AFTER","dir","oppProp","getModified","setExtent","bboxStr","VAR_EXTENT","getExtent","getSelected","setSelected","finder","l","unshift","selectAll","_this11","clearSelected","refresh","setFacet","setFields","andUpdate","getSortOptions","SORT_OPTIONS","getSortValue","getQueryOptions","extend","hasQueryOptions","reset","order","destroy","BrowseServiceFactory","SocketService","_this12","socket","tracking","CREATED","UPDATED","DELETED","EDITING","STATUS","io","connect","evt","socketId","_this13","emit","_this14","tracks","end","close","objId","_this15","room","_this16","leave","UUID","cache","onClose","onbeforeunload","cacheRef","closeDelegate","call","onDelegate","handle","emitDelegate","s","hexDigits","substr"],"mappings":"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","file":"geoplatform.common.min.js","sourcesContent":["\"use strict\";\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n(function (jQuery, angular) {\n\n    \"use strict\";\n\n    angular.module(\"gp-common\", [])\n\n    //Assumes a global object containing configuration values for GeoPlatform exists \n    // prior to this module being declared\n    // (using 'value' since config might change)\n    .value('GPConfig', GeoPlatform);\n})(jQuery, angular);\n\n/**\n * \n * KnowledgeGraph property on RIM Asset renamed to Classifiers\n *\n */\n\n(function (jQuery, angular, Constants) {\n    'use strict';\n\n    angular.module('gp-common-kg', [])\n\n    // .constant('KGClassifiers', [\n    //     { \n    //         label: 'purpose', \n    //         description: 'The intended use or reason for the Object (i.e., layer, map, gallery) e.g., environmental impact of an oil spill.',\n    //         property: 'purposes',\n    //         section: 'Purpose' \n    //     },\n    //     { \n    //         label: 'primarySubject', \n    //         description: 'The selected things, events, or concepts forming part of or represented by the Object. e.g., Deep Water Horizon oil rig, oil slick extent, oil slick movement over time, predicted oil slick movement, impacted sites, impact severity.',\n    //         property: 'primarySubjects',\n    //         section: 'Scope' \n    //     },\n    //     { \n    //         label: 'secondarySubject', \n    //         description: 'Second-order subjects derived by machine processing/ analysis of the target Object',\n    //         property: 'secondarySubjects',\n    //         section: 'Scope' \n    //     },\n    //     { \n    //         label: 'primaryTopic', \n    //         description: 'The central branch of knowledge or theme pertaining to the thing, concept, situation, issue, or event of interest. e.g., environmental impact of oil spill.',\n    //         property: 'primaryTopics',\n    //         section: 'Scope' \n    //     },\n    //     { \n    //         label: 'secondaryTopic', \n    //         description: 'Second-order topics derived by machine processing/ analysis of the target Object',\n    //         property: 'secondaryTopics',\n    //         section: 'Scope' \n    //     },\n    //     { \n    //         label: 'category', \n    //         description: 'The type or category of the Object.  e.g., topographic map, elevation layer',\n    //         property: 'categories',\n    //         section: 'Scope' \n    //     },\n    //     { \n    //         label: 'community', \n    //         description: 'The GeoPlatform community this Object was produced for. e.g., \"Ecosystems and Biodiversity\" community',\n    //         property: 'communities',\n    //         section: 'Scope' \n    //     },\n    //     { \n    //         label: 'place', \n    //         description: 'The central locale or common names for the place where the Subjects of the Object occur. e.g.,  USA/Gulf Coast',\n    //         property: 'places',\n    //         section: 'Scope' \n    //     },\n    //     { \n    //         label: 'function', \n    //         description: 'The business actions, activities, or tasks this Object is intended to support (i.e., the role it plays in supporting an activity).  e.g., environmental impact assessment.',\n    //         property: 'functions',\n    //         section: 'Fitness for Use' \n    //     },\n    //     { \n    //         label: 'audience', \n    //         description: 'The group of people for which this Object was intended to be used. e.g., general public, disaster recovery personnel, Congress.',\n    //         property: 'audiences',\n    //         section: 'Social Context' \n    //     }\n    // ])\n\n    .constant('KGFields', ['purposes', 'functions', 'primaryTopics', 'secondaryTopics', 'primarySubjects', 'secondarySubjects', 'communities', 'audiences', 'places', 'categories']).service('KGHelper', ['KGFields', 'RecommenderServiceFactory', function (KGFields, RecommenderServiceFactory) {\n\n        return {\n            calculate: function calculate(kg) {\n                if (!kg) return 0;\n                var result = 0;\n                angular.forEach(KGFields, function (prop) {\n                    if (kg[prop] && kg[prop].length) result += 7 + Math.floor((kg[prop].length - 1) / 2);\n                    // result += kg[prop] ? kg[prop].length*5 : 0;\n                });\n                return result;\n            },\n\n            getService: function getService(type) {\n                return RecommenderServiceFactory(type);\n            }\n\n        };\n    }])\n\n    /**\n     * Service that queries the recommendation service endpoint \n     * exposed by UAL \n     */\n    .service(\"RecommenderService\", function ($resource) {\n\n        var baseUrl = Constants.ualUrl + '/api/recommender';\n        return $resource(baseUrl, {}, {\n\n            query: {\n                url: baseUrl + '/suggest',\n                isArray: false\n            },\n            queryTypes: {\n                url: baseUrl + '/types',\n                isArray: false\n            },\n            querySources: {\n                url: baseUrl + '/sources',\n                isArray: false\n            }\n\n        });\n    })\n\n    /**\n     * Factory for creating services that query the recommendation \n     * service endpoint exposed by UAL and includes object type\n     * parameter based upon owner of KG\n     */\n    .factory(\"RecommenderServiceFactory\", function ($resource) {\n\n        return function (type) {\n\n            var baseUrl = Constants.ualUrl + '/api/recommender';\n            return $resource(baseUrl, { 'for': type }, {\n\n                query: {\n                    url: baseUrl + '/suggest',\n                    isArray: false\n                },\n                queryTypes: {\n                    url: baseUrl + '/types',\n                    isArray: false\n                },\n                querySources: {\n                    url: baseUrl + '/sources',\n                    isArray: false\n                }\n\n            });\n        };\n    })\n\n    /** \n     * Component for rendering a brief % of completion\n     *\n     */\n    .component('kgCompletionDisplay', {\n\n        bindings: {\n            ngModel: '<' // the Asset containing the knowledge graph ('classifiers') property\n        },\n\n        controller: function controller($rootScope, KGHelper) {\n\n            this.$onInit = function () {\n                var _this = this;\n\n                this.update();\n\n                this.listener = $rootScope.$on('gp:kg:updated', function (event, item) {\n                    if (item && item.id === _this.id) {\n                        //in case kg didn't exist, \n                        if (!_this.ngModel.classifiers) _this.ngModel.classifiers = item.classifiers;\n                        _this.value = KGHelper.calculate(_this.ngModel.classifiers);\n                    }\n                });\n            };\n\n            this.$onChanges = function () {\n                this.update();\n            };\n\n            this.$onDestroy = function () {\n                this.listener();\n                this.listener = null;\n            };\n\n            this.update = function () {\n                var _this2 = this;\n\n                if (this.ngModel.$promise && !this.ngModel.$resolved) {\n                    this.ngModel.$promise.then(function (model) {\n                        _this2.update();\n                    });\n                    return;\n                }\n\n                this.id = this.ngModel ? this.ngModel.id : null;\n                this.value = KGHelper.calculate(this.ngModel.classifiers);\n            };\n        },\n\n        template: \"\\n            <span>{{$ctrl.value||0}}%</span>\\n            <span class=\\\"glyphicon glyphicon-dashboard\\\"></span>\\n        \"\n\n    });\n})(jQuery, angular, GeoPlatform);\n\n(function (angular) {\n\n    'use strict';\n\n    //flag on whether we're in dev env\n    // function isDEV() {\n    //     return \"localhost\" === window.location.hostname ||\n    //         ~window.location.hostname.indexOf(\"192.168\")||\n    //         ~window.location.hostname.indexOf(\"localhost\")||\n    //         ~window.location.hostname.indexOf(\"10.0\");\n    // }\n\n    /**\n     * Get token from query string\n     *\n     * Note:\n     *  Lifted outside of any Angular service to prevent cyclical service dependencies.\n     *\n     * @method getJWTFromUrl\n     * @returns {String} token - token in query string or undefined\n     */\n\n    function getJWTFromUrl() {\n        var queryString = window.location.hash ? window.location.hash : window.location.href;\n        var res = queryString.match(/access_token=([^\\&]*)/);\n        return res && res[1];\n    };\n\n    /**\n     * GeoPlatform Common Module Authentication Support\n     *\n     * Contains re-usable services, directives, and other angular components\n     *\n     *\n     * NOTE: This module uses certain variables in $rootScope in order to\n     * perform actions like authentication.  The following variables should be\n     * set before using any service/directive in this file:\n     *\n     *   - idspUrl : the url to the identity service provider server\n     *   - idmUrl : the url to the identity management server\n     *   - portalUrl : the url to the main landing page of GeoPlatform (www.geoplatform.gov in production)\n     */\n    angular.module('gp-common')\n\n    /**\n     * Authentication Service\n     *\n     * Because the auth service redirects the page to the IDM portal\n     * and WMV is reloaded once the login/logout processes are complete,\n     * there's no need to bind listeners informing other components of\n     * an auth change.\n     *\n     * Inside \"DEV\", you should close and re-open any components' widgets\n     * to get current auth status.\n     */\n    .service('AuthenticationService', ['$q', '$http', '$location', '$rootScope', '$window', 'GPConfig', function ($q, $http, $location, $rootScope, $window, Config) {\n\n        //extend Storage prototype\n        Storage.prototype.setObject = function (key, value) {\n            this.setItem(key, btoa(JSON.stringify(value)));\n        };\n\n        Storage.prototype.getObject = function (key) {\n            var value = atob(this.getItem(key));\n            return value && JSON.parse(value);\n        };\n\n        function User(opts) {\n            for (var p in opts) {\n                this[p] = opts[p];\n            }\n            if (!this.id && this.username) this.id = this.username;\n\n            this.toJSON = function () {\n                return {\n                    id: this.id,\n                    username: this.username,\n                    name: this.name,\n                    email: this.email,\n                    org: this.org,\n                    exp: this.exp\n                };\n            };\n\n            this.clone = function () {\n                return new User(this.toJSON());\n            };\n\n            this.compare = function (arg) {\n                if (arg instanceof User) {\n                    return this.id === arg.id;\n                } else if ((typeof arg === \"undefined\" ? \"undefined\" : _typeof(arg)) === 'object') {\n                    return typeof arg.id !== 'undefined' && arg.id === this.id;\n                }\n                return false;\n            };\n\n            this.isAuthorized = function (role) {\n                var env = Config.env || Config.ENV || Config.NODE_ENV;\n                if (env === 'dev' || env === 'development') return true;\n                if (!this.roles || !this.roles.length || typeof this.roles.push === 'undefined') return false;\n                return this.roles.indexOf(role) >= 0;exp: this.exp;\n            };\n        }\n\n        var _user = null;\n\n        /**\n         * Authentication Service\n         */\n        var Service = function Service() {\n\n            var self = this;\n\n            //$q version of getUser\n            this.getUserQ = function () {\n                return $q.when(self.getUser());\n            };\n\n            /**\n             * Redirects the page to the login site\n             */\n            this.login = function () {\n\n                //use current window\n                var current = window.location.href;\n                var redirect = Config.CALLBACK ? Config.CALLBACK : current;\n\n                if (Config.AUTH_TYPE !== 'grant' && Config.AUTH_TYPE !== 'token') {\n                    //fail this request\n                    throw new Error(\"Invalid authentication request type.  Must be 'token' or 'grant'.\");\n                }\n\n                //check auth type to set login URL: Implicit -> to IDP, Grant -> Resource Provider Login URL\n                var loginUrl = Config.AUTH_TYPE === 'token' ? Config.IDP_BASE_URL + '/auth/authorize?client_id=' + Config.APP_ID + '&response_type=' + Config.AUTH_TYPE + '&redirect_uri=' + encodeURIComponent(redirect) : Config.LOGIN_URL;\n\n                window.location = loginUrl;\n\n                //This could be writen to use an modal / pop-up for login so you don't have to lose your current page\n                //Logout already executes using a background call\n            };\n\n            /**\n             * Performs background logout and requests jwt revokation\n             */\n            this.logout = function () {\n                //implicitly remove incase the idp is down and the revoke call does not work\n                _user = null;\n                self.clearLocalStorageJWT();\n\n                $http.get(Config.IDP_BASE_URL + '/auth/revoke').then(function (response) {\n                    self.removeAuth();\n                    //goto logout page\n                    if (Config.LOGOUT_URL) {\n                        Config.FORCE_LOGIN = false;\n                        window.location = Config.LOGOUT_URL;\n                    } else {\n                        window.location.hash = '';\n                        window.location = Config.PORTAL_URL || window.location.host;\n                    }\n                }, function (err) {\n                    console.log(err);\n                });\n            };\n\n            /**\n             * Optional force redirect for non-public services\n             */\n            this.forceLogin = function () {\n                self.login();\n            };\n\n            /**\n             * Get protected user profile\n             */\n            this.getOauthProfile = function () {\n                var Q = $q.defer();\n                //check to make sure we can make called\n                if (self.getJWTfromLocalStorage()) {\n                    var url = Config.IDP_BASE_URL + '/api/profile';\n                    $http.get(url).then(function (response) {\n                        //when we get it, save it so we don't have to hit the IDP so many times\n                        Q.resolve(response.data);\n                    }, function (err) {\n                        console.log(err);\n                        Q.reject(err);\n                    });\n                }\n                return Q.promise;\n            };\n\n            /*\n             * Set the _user property in this scope\n             */\n            this.setUser = function (user) {\n                _user = user;\n            };\n\n            /**\n             * Unpacks JWT to see if session is valid.\n             *\n             * Side Effects:\n             *  - Sets the _user property\n             *  - Sets the Authorize header if valid user found (this.setAuth)\n             *  - Will redirect user to login url if FORCE_LOGIN is set an no valid user is found\n             *\n             * @return {User} - the authenticated user or undefined\n             */\n            this.check = function () {\n                // Pull user from either LocalStorage or the JWT (or the URL)\n                var jwt = self.getJWT();\n\n                // Save JWT in Auhorization Header\n                if (jwt && !self.isExpired(jwt)) {\n                    self.setAuth(jwt);\n                    var user = self.parseJwt(jwt);\n                    // slightly differnet mapping ;)\n                    self.setUser(new User({\n                        id: user.sub,\n                        username: user.username,\n                        email: user.email,\n                        name: user.name,\n                        org: user.org,\n                        exp: user.exp\n                    }));\n\n                    //clean hosturl on redirect from oauth\n                    var current = $window && $window.location && $window.location.hash ? $window.location.hash : $location.url();\n                    if (getJWTFromUrl()) {\n                        var cleanUrl = current.replace(/access_token=([^\\&]*)/, '');\n                        $window.location = cleanUrl;\n                    }\n\n                    // No valid userdata found\n                } else {\n                    self.removeAuth();\n                    // Redirect if settings set\n                    if (Config.FORCE_LOGIN === true) self.forceLogin();\n                }\n\n                // return the user\n                return _user;\n            };\n\n            /**\n             * If the callback parameter is specified, this method\n             * will return undefined. Otherwise, it returns the user (or null).\n             *\n             * Side Effects:\n             *  - This property sets the _user property for the enclosing scope\n             *  - Will redirect users if no valid JWT was found\n             *\n             * @param callback optional function to invoke with the user\n             * @return object representing current user\n             */\n            this.getUser = function (callback) {\n                // better check 'em first\n                self.check(); // Sideffects will redirect browser if JWT invalid\n\n                return callback && typeof callback === 'function' ? callback(_user) : _user;\n            };\n\n            //=====================================================\n\n            /**\n             * Extract token from current URL\n             *\n             * @method getJWTFromUrl\n             *\n             * @return {String | undefined} - JWT Token (raw string)\n             */\n            this.getJWTFromUrl = function () {\n                var queryString = $window && $window.location && $window.location.hash ? $window.location.hash : $location.url();\n                var res = queryString.match(/access_token=([^\\&]*)/);\n                return res && res[1];\n            };\n\n            /**\n             * Load the JWT stored in local storage.\n             *\n             * @method getJWTfromLocalStorage\n             *\n             * @return {JWT | undefined} An object wih the following format:\n             */\n            this.getJWTfromLocalStorage = function () {\n                return window.localStorage.gpoauthJWT;\n            };\n\n            /**\n             * Attempt and pull JWT from the following locations (in order):\n             *  - URL query parameter 'access_token' (returned from IDP)\n             *  - Browser local storage (saved from previous request)\n             *\n             * @method getJWT\n             *\n             * @return {JWT | undefined}\n             */\n            this.getJWT = function () {\n                return self.getJWTFromUrl() || self.getJWTfromLocalStorage();\n            };\n\n            /**\n             * Remove the JWT saved in local storge.\n             *\n             * @method clearLocalStorageJWT\n             *\n             * @return  {undefined}\n             */\n            this.clearLocalStorageJWT = function () {\n                delete window.localStorage.gpoauthJWT;\n            };\n\n            /**\n             * Is a token expired.\n             *\n             * @method isExpired\n             * @param {JWT} jwt - A JWT\n             *\n             * @return {boolean}\n             */\n            this.isExpired = function (jwt) {\n                var exp = jwt && self.parseJwt(jwt).exp;\n                var now = new Date().getTime() / 1000;\n                return now > exp;\n            };\n\n            /**\n             * Unsafe (signature not checked) unpacking of JWT.\n             *\n             * @param {string} token - Access Token (JWT)\n             *\n             * @return {Object} the parsed payload in the JWT\n             */\n            this.parseJwt = function (token) {\n                var parsed;\n                if (token) {\n                    var base64Url = token.split('.')[1];\n                    var base64 = base64Url.replace('-', '+').replace('_', '/');\n                    parsed = JSON.parse(atob(base64));\n                }\n                return parsed;\n            };\n\n            /**\n             *\n             */\n            this.validateJwt = function (token) {\n                var parsed = self.parseJwt(token);\n                var valid = parsed && parsed.exp && parsed.exp * 1000 > Date.now() ? true : false;\n                //TODO: chk jwt signature too\n                return valid;\n            };\n\n            this.setAuth = function (jwt) {\n                window.localStorage.gpoauthJWT = jwt;\n                $http.defaults.headers.common.Authorization = 'Bearer ' + jwt;\n                $http.defaults.useXDomain = true;\n                return;\n            };\n\n            this.removeAuth = function () {\n                _user = null;\n                delete window.localStorage.gpoauthJWT;\n                delete $http.defaults.headers.common.Authorization;\n                $http.defaults.useXDomain = false;\n                return;\n            };\n\n            //initialize with auth check\n            this.check();\n        };\n\n        return new Service();\n    }])\n\n    /**\n     * Interceptor that check for an updaed AccessToken coming from any request\n     * and will take it and set it as the token to use in future outgoing\n     * requests\n     */\n    .factory('ng-common-AuthenticationInterceptor', function ($injector, $window) {\n        // Interceptor\n        return {\n            response: function response(resp) {\n                var jwt = getJWTFromUrl();\n                var authHeader = resp.headers('Authorization');\n\n                if (jwt) {\n                    var AuthenticationService = $injector.get('AuthenticationService');\n                    AuthenticationService.setAuth(jwt);\n                } else if (authHeader) {\n                    var _AuthenticationService = $injector.get('AuthenticationService');\n                    _AuthenticationService.setAuth(authHeader.replace('Bearer ', ''));\n                }\n\n                return resp;\n            }\n        };\n    }).config(function myAppConfig($httpProvider) {\n        $httpProvider.interceptors.push('ng-common-AuthenticationInterceptor');\n    }).directive('gpLoginButton', ['$timeout', 'AuthenticationService', 'GPConfig', function ($timeout, AuthenticationService, Config) {\n        return {\n            scope: {\n                minimal: '@'\n            },\n            replace: true,\n            template: ['<div class=\"btn-account btn-group\">' +\n\n            //not logged in\n            '  <a class=\"btn btn-link\" ng-click=\"login()\" ng-if=\"!user\">Sign In</a>' +\n\n            //logged in\n            '  <button type=\"button\" class=\"btn btn-link dropdown-toggle\" data-toggle=\"dropdown\" ' + '   aria-expanded=\"false\" ng-if=\"user\">' + '     <span class=\"glyphicon glyphicon-user\"></span> ' + '     <span class=\"hidden-xs\">{{::user.name}}</span> ' + '     <span class=\"caret\"></span>' + '  </button>' + '  <ul class=\"dropdown-menu dropdown-menu-right\" role=\"menu\" ng-if=\"user\">' + '    <li class=\"account-details\">' + '      <div class=\"media\">' + '        <div class=\"media-left\">' + '          <div class=\"media-object\">' + '            <span class=\"glyphicon glyphicon-user glyphicon-xlg\"></span>' + '          </div>' + '        </div>' + '        <div class=\"media-body\">' + '          <div class=\"media-heading\">{{::user.name}}</div>' + '          <div><em>{{::user.username}}</em></div>' + '          <div>{{::user.email}}</div>' + '          <div>{{::user.org}}</div>' + '        </div>' + '      </div>' + '    </li>' + '    <li class=\"divider\"></li>' + '    <li><a href=\"{{::idpUrl}}/modifyuser.html\">Edit Info</a></li>' + '    <li><a href=\"{{::idpUrl}}/changepassword.html\">Change Password</a></li>' + '    <li><a href ng-click=\"logout()\">Sign Out</a></li>' + '  </ul>' + '</div>'].join(' '),\n            controller: function controller($scope, $element) {\n\n                if ($scope.minimal === 'true') $scope.minimal = true;\n                if ($scope.minimal !== true) $scope.minimal = false;\n\n                $scope.idpUrl = Config.idmUrl;\n                // console.log(\"IDM Base Url: \" + Config.idmUrl);\n\n                AuthenticationService.getUser(function (user) {\n                    $timeout(function () {\n                        $scope.user = user;\n                    }, 100);\n                });\n\n                $scope.login = function () {\n                    $scope.user = AuthenticationService.login();\n                };\n\n                $scope.logout = function () {\n                    $scope.user = AuthenticationService.logout();\n                };\n            }\n        };\n    }]).directive('gpAccountDetails', ['$timeout', 'AuthenticationService', 'GPConfig', function ($timeout, AuthenticationService, Config) {\n\n        return {\n            scope: {},\n            replace: true,\n            template: ['<div>' + '  <div class=\"media\">', '    <div class=\"media-left\">', '        <div class=\"media-object\">', '            <span class=\"glyphicon glyphicon-user glyphicon-xlg\"></span>', '        </div>', '    </div>', '    <div class=\"media-body\" ng-if=\"user\">', '       <div class=\"media-heading\">{{::user.name}}</div>' + '       <div><small><em>{{::user.username}}</em></small></div>' + '       <div><small>{{::user.email}}</small></div>' + '       <div><small>{{::user.org}}</small></div>' + '    </div>', '    <div class=\"media-body\" ng-if=\"!user\">', '       <div class=\"media-heading\">Please Sign In</div>' + '       <div><small>Sign in to your GeoPlatform account or register a new account.</small></div>' + '    </div>', '  </div>', '  <hr/>', '  <div ng-if=\"user\">', '    <button type=\"button\" class=\"btn btn-sm btn-accent pull-right\" ng-click=\"logout()\">Sign Out</button>' + '    <a class=\"btn btn-sm btn-default\" href=\"{{::idpUrl}}/modifyuser.html\">Edit Details</a>' + '  </div>', '  <div ng-if=\"!user\">', '    <button type=\"button\" class=\"btn btn-sm btn-accent pull-right\" ng-click=\"login()\">Sign In</button>' + '    <a class=\"btn btn-sm btn-default\" href=\"{{::idpUrl}}/registeruser.html\">Register</a>' + '  </div>', '</div>'].join(' '),\n            controller: function controller($scope, $element) {\n\n                $scope.idpUrl = Config.idmUrl;\n\n                AuthenticationService.getUser(function (user) {\n                    $timeout(function () {\n                        $scope.user = user;\n                    }, 100);\n                });\n\n                $scope.login = function () {\n                    $scope.user = AuthenticationService.login();\n                };\n\n                $scope.logout = function () {\n                    $scope.user = AuthenticationService.logout();\n                };\n            }\n        };\n    }]);\n})(angular);\n\n(function () {\n\n    \"use strict\";\n\n    if (typeof Array.prototype.find === 'undefined') {\n        Array.prototype.find = function (callback) {\n            for (var i = 0; i < this.length; ++i) {\n                if (callback(this[i], i, this)) return this[i];\n            }\n            return null;\n        };\n    }\n    if (typeof Array.prototype.filter === 'undefined') {\n        Array.prototype.filter = function (callback) {\n            var results = [];\n            for (var i = 0; i < this.length; ++i) {\n                if (callback(this[i], i, this)) results.push(this[i]);\n            }\n            return results;\n        };\n    }\n    if (typeof Array.prototype.each === 'undefined') {\n        Array.prototype.each = function (callback) {\n            for (var i = 0; i < this.length; ++i) {\n                callback(this[i], i, this);\n            }\n        };\n    }\n    if (typeof Array.prototype.indexOfObj === 'undefined') {\n        Array.prototype.indexOfObj = function (obj, comparatorFn) {\n\n            var arr = this,\n                len = arr.length;\n\n            if (typeof comparatorFn !== 'function') comparatorFn = function comparatorFn(a, b) {\n                return a === b;\n            };\n\n            for (var i = 0; i < len; ++i) {\n                if (comparatorFn(obj, arr[i])) return i;\n            }\n            return -1;\n        };\n    }\n    if (typeof String.prototype.startsWith === 'undefined') {\n        String.prototype.startsWith = function (value) {\n            var str = this;\n            if (!str.length) return false;\n            if (!value.length) return false;\n            if (str.length < value.length) return false;\n            return str.indexOf(value) === 0;\n        };\n    }\n    if (typeof String.prototype.endsWith === 'undefined') {\n        String.prototype.endsWith = function (value) {\n            var str = this;\n            if (!str.length) return false;\n            if (!value.length) return false;\n            if (str.length < value.length) return false;\n            var substr = str.substring(str.length - value.length, str.length);\n            return substr == value;\n        };\n    }\n\n    if (typeof Date.prototype.plus === 'undefined') {\n        Date.prototype.plus = function (offset) {\n\n            var type = typeof offset === \"undefined\" ? \"undefined\" : _typeof(offset);\n            if (type === 'undefined') return this;\n\n            var offsetMS = 0;\n            if (type === 'string') {\n                switch (offset) {\n                    case 'hour':\n                        offsetMS = 1000 * 60 * 60;break;\n                    case 'day':\n                        offsetMS = 1000 * 60 * 60 * 24;break;\n                    case 'week':\n                        offsetMS = 1000 * 60 * 60 * 24 * 7;break;\n                    case 'month':\n                        offsetMS = 1000 * 60 * 60 * 24 * 31;break;\n                    case 'year':\n                        offsetMS = 1000 * 60 * 60 * 24 * 365;break;\n                }\n            } else if (type === 'number') {\n                offsetMS = offset;\n            } else return this;\n\n            var d = this;\n            return new Date(d.getTime() + offsetMS);\n        };\n    }\n\n    if (typeof Date.prototype.random === 'undefined') {\n        Date.prototype.random = function (threshold) {\n\n            var type = typeof threshold === \"undefined\" ? \"undefined\" : _typeof(threshold);\n            if (type === 'undefined') return this;\n\n            var offsetMS = 0;\n            if (type === 'string') {\n                switch (threshold) {\n                    case 'hour':\n                        offsetMS = 1000 * 60 * 60;break;\n                    case 'day':\n                        offsetMS = 1000 * 60 * 60 * 24;break;\n                    case 'week':\n                        offsetMS = 1000 * 60 * 60 * 24 * 7;break;\n                    case 'month':\n                        offsetMS = 1000 * 60 * 60 * 24 * 31;break;\n                    case 'year':\n                        offsetMS = 1000 * 60 * 60 * 24 * 365;break;\n                }\n            } else if (type === 'number') {\n                offsetMS = threshold;\n            } else return this;\n\n            var d = this;\n            return new Date(d.getTime() + Math.floor(Math.random() * offsetMS));\n        };\n    }\n})();\n(function (angular) {\n\n    \"use strict\";\n\n    var ACTIVATORS_HTML = \"\\n            <div class=\\\"gp-ui-card__details-activator--left\\\" title=\\\"Show previous details\\\"\\n                ng-class=\\\"{disabled:!hasPrevious()}\\\" ng-click=\\\"previousDetails()\\\">\\n                <span class=\\\"glyphicon glyphicon-chevron-left\\\"></span>\\n            </div>\\n            <div class=\\\"gp-ui-card__details-activator--right\\\" title=\\\"Show next details\\\"\\n                ng-class=\\\"{disabled:!hasNext()}\\\" ng-click=\\\"nextDetails()\\\">\\n                <span class=\\\"glyphicon glyphicon-chevron-right\\\"></span>\\n            </div>\\n        \";\n\n    /*\n     * Appends carousel-like activators onto a card section\n     * Usage: \n     *\n     *  <div class=\"text--supporting\" card-details-carousel-activator>\n     *      <div class=\"gp-ui-card__details active\" id=\"description\">...</div>    \n     *      <div class=\"gp-ui-card__details\" id=\"author\">...</div>        \n     *  </div>\n     */\n    angular.module(\"gp-common\").directive('cardDetailsCarouselActivator', function () {\n\n        return {\n\n            compile: function compile($element) {\n                $element.append(ACTIVATORS_HTML);\n            },\n\n            controller: function controller($scope, $element) {\n\n                $scope.hasPrevious = function () {\n                    var pane = $element.find('.gp-ui-card__details.active');\n                    return pane.prevAll('.gp-ui-card__details').length;\n                };\n\n                $scope.hasNext = function () {\n                    var pane = $element.find('.gp-ui-card__details.active');\n                    return pane.nextAll('.gp-ui-card__details').length;\n                };\n\n                $scope.previousDetails = function () {\n                    if (!$scope.hasPrevious()) return;\n                    var pane = $element.find('.gp-ui-card__details.active');\n                    pane.removeClass('active');\n                    pane = pane.prevAll('.gp-ui-card__details');\n                    if (pane.length) angular.element(pane[0]).addClass('active');\n                };\n\n                $scope.nextDetails = function () {\n                    if (!$scope.hasNext()) return;\n                    var pane = $element.find('.gp-ui-card__details.active');\n                    pane.removeClass('active');\n                    pane = pane.nextAll('.gp-ui-card__details');\n                    if (pane.length) angular.element(pane[0]).addClass('active');\n                };\n            }\n        };\n    });\n})(angular);\n(function (jQuery, angular) {\n\n    'use strict';\n\n    /**\n     * determines whether an rgb value is invalid\n     * the value starts as false (the rbg value is valid)\n     * and is invalidated if the value(s) are empty, greater than 255 or less than 0\n     *\n     * @param rgb either an object { r: 0, g: 0, b: 0 } or a single value\n     * @returns {boolean} whether the rgb value is invalid\n     */\n\n    function invalidRGB(rgb) {\n        var error = false;\n\n        if (rgb instanceof Object) {\n            var r = parseInt(rgb.r, 10);\n            var g = parseInt(rgb.g, 10);\n            var b = parseInt(rgb.b, 10);\n\n            if (r > 255 || r < 0 || !r && r !== 0) error = true;\n            if (g > 255 || g < 0 || !g && g !== 0) error = true;\n            if (b > 255 || b < 0 || !b && b !== 0) error = true;\n        } else {\n            var x = parseInt(rgb, 10);\n            if (x > 255 || x < 0 || !x && x !== 0) error = true;\n        }\n\n        return error;\n    }\n\n    /**\n     * converts a decimal (base 10) number to hex (base 16) string\n     *\n     * @param c base 10 number\n     * @returns {*} base 16 string\n     */\n    function componentToHex(c) {\n        var hex = c.toString(16),\n            result = null;\n\n        if (!isNaN(c) && !invalidRGB(c)) result = hex.length == 1 ? '0' + hex : hex;\n\n        return result;\n    }\n\n    /**\n     * converts an rgb object to a hexadecimal string\n     *\n     * @param rgb object { r: 0, g: 0, b: 0 }\n     * @returns {*} hexadecimal string\n     */\n    function rgbToHex(rgb) {\n        var result = null;\n\n        var r = componentToHex(parseInt(rgb.r, 10));\n        var g = componentToHex(parseInt(rgb.g, 10));\n        var b = componentToHex(parseInt(rgb.b, 10));\n\n        if (r && g && b) result = '#' + r + g + b;\n\n        return result;\n    }\n\n    /**\n     * determines whether a hex value is valid\n     *\n     * @param hex string value\n     * @returns hex value or null if hex is invalid\n     */\n    function validHex(hex) {\n        return (/^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex) || null\n        );\n    }\n\n    /**\n     * converts a hex string to rgb object\n     *\n     * @param hex string\n     * @returns {*} rgb object { r: 0, g: 0, b: 0 }\n     */\n    function hexToRgb(hex) {\n        // Expand shorthand form (e.g. '03F') to full form (e.g. '0033FF')\n        var shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n        hex = hex.replace(shorthandRegex, function (m, r, g, b) {\n            return r + r + g + g + b + b;\n        });\n\n        var result = validHex(hex);\n        return result ? {\n            r: parseInt(result[1], 16),\n            g: parseInt(result[2], 16),\n            b: parseInt(result[3], 16)\n        } : null;\n    }\n\n    /**\n     * Advanced Color Picker Directive (advanced-color-picker)\n     * This color picker is meant to augment the functionality in angular-bootstrap-colorpicker\n     * It adds the ability to change the color with RGB and Hex\n     * It needs to be used in a container that has at least 160px of vertical real estate\n     *\n     * You must pass in the following:\n     *   - ngModel  (a hexadecimal string color value)\n     *   - onChange (the event to be fired when the value changes)\n     *\n     * Usage Example:\n     * <div advanced-color-picker ng-model=\"hexColor\" ng-change=\"changeEvent()\"></div>\n     */\n    angular.module('gp-common').component('gpColorPicker', {\n\n        bindings: {\n            ngModel: '=',\n            onChange: '&'\n        },\n\n        controller: function controller($timeout, $q) {\n\n            // fired when an rgb value is changed\n            this.changeRGB = function () {\n\n                // make sure rgb color value is correct\n                this.rgbError = invalidRGB(this.rgb);\n\n                // parse it anyways leaving hex value blank until valid rbg\n                this.ngModel = rgbToHex(this.rgb);\n\n                // have to use timeout to make sure ngModel is set before\n                // firing change event upstream\n                var self = this;\n                $timeout(function () {\n                    self.onChange({ value: self.ngModel });\n                });\n            };\n\n            // fired when a hex value is changed\n            this.changeHex = function () {\n\n                // make sure the hex color value is correct\n                if (!validHex(this.ngModel)) this.hexError = 'Invalid hex color value';else this.hexError = false;\n\n                // parse it anyway leaving rgb values blank until it's a valid hex\n                this.rgb = hexToRgb(this.ngModel);\n\n                // have to use timeout to make sure ngModel is set before\n                // firing change event upstream\n                var self = this;\n                $timeout(function () {\n                    self.onChange({ value: self.ngModel });\n                });\n            };\n\n            this.$onInit = function () {\n                this.rgb = hexToRgb(this.ngModel);\n            };\n        },\n\n        template: \"\\n            <div class=\\\"gp-colorpicker\\\">\\n                <div class=\\\"form-group hex-form-group\\\" ng-class=\\\"{'has-error':$ctrl.hexError}\\\">\\n                    <input type=\\\"text\\\" class=\\\"form-control\\\"\\n                        ng-model=\\\"$ctrl.ngModel\\\" ng-keyup=\\\"$ctrl.changeHex()\\\">\\n                </div>\\n                <div class=\\\"gp-colorpicker__wrapper\\\">\\n                    <div colorpicker colorpicker-inline=\\\"true\\\" colorpicker-parent=\\\"true\\\" \\n                        ng-model=\\\"$ctrl.ngModel\\\" ng-change=\\\"$ctrl.changeHex()\\\"></div>\\n                </div>\\n                <div class=\\\"form-group rgb-form-group\\\" ng-class=\\\"{'has-error':$ctrl.rgbError}\\\">\\n                    <input type=\\\"text\\\" class=\\\"form-control\\\"\\n                        placeholder=\\\"R\\\" ng-model=\\\"$ctrl.rgb.r\\\" ng-keyup=\\\"$ctrl.changeRGB()\\\" title=\\\"R\\\">\\n                    <input type=\\\"text\\\" class=\\\"form-control\\\"\\n                        placeholder=\\\"G\\\" ng-model=\\\"$ctrl.rgb.g\\\" ng-keyup=\\\"$ctrl.changeRGB()\\\" title=\\\"G\\\">\\n                    <input type=\\\"text\\\" class=\\\"form-control\\\"\\n                        placeholder=\\\"B\\\" ng-model=\\\"$ctrl.rgb.b\\\" ng-keyup=\\\"$ctrl.changeRGB()\\\" title=\\\"B\\\">\\n                </div>\\n            </div>\\n        \"\n    });\n})(jQuery, angular);\n(function (jQuery, angular) {\n\n    'use strict';\n\n    angular.module('gp-common').directive('gpDatePicker', ['$timeout', function ($timeout) {\n\n        return {\n            scope: {\n                label: '@',\n                format: '@',\n                date: '=',\n                onChange: '&?'\n            },\n            template: ['<div class=\"input-group-slick\">', '    <input type=\"text\" class=\"form-control\" placeholder=\"{{::label}}\"', '        datepicker-popup=\"{{format}}\" ng-model=\"date\" is-open=\"opened\" />', '    <span class=\"glyphicon glyphicon-calendar\" ng-click=\"toggle($event)\"></span>', '</div>', '<p class=\"help-block\"><small><em>Ex: \"2015-01-31\" or \"Jan 31 2015\"</em></small></p>'].join(' '),\n\n            controller: function controller($scope, $element, $attrs) {\n\n                //toggle date picker\n                $scope.toggle = function (event) {\n                    event.preventDefault();\n                    event.stopPropagation();\n                    this.opened = !this.opened;\n                };\n\n                if (!$scope.format) $scope.format = 'MMM dd yyyy';\n\n                var promise = null;\n\n                $scope.debounce = function () {\n                    if (promise) $timeout.cancel(promise);\n                    promise = $timeout(function () {\n                        promise = null;\n                        if ($scope.onChange) $scope.onChange();\n                    }, 200);\n                };\n\n                $scope.$watch('date', function () {\n                    $scope.debounce();\n                });\n\n                var listener = $scope.$on('$destroy', function () {\n\n                    listener(); //deregister listener\n\n                    if (promise) $timeout.cancel(promise);\n                    promise = null;\n\n                    $scope.opened = false; //close picker if open\n                    $scope.onChange = null;\n                    $scope.format = null;\n                    $scope.debounce = null;\n                });\n            }\n        };\n    }]);\n})(jQuery, angular);\n(function (jQuery, angular) {\n\n    \"use strict\";\n\n    angular.module(\"gp-common\")\n\n    /**\n     * Geolocation directive\n     */\n    .directive('gpGeolocation', ['$window', function ($window) {\n\n        var defaultBtnLabel = \"Locate\";\n\n        return {\n            scope: {\n                label: '=?'\n            },\n            restrict: \"EA\",\n            template: ['<a class=\"btn btn-primary\" ng-click=\"geolocate()\" ng-if=\"available\">', '  <span class=\"glyphicon glyphicon-screenshot\" ng-if=\"!loading\"></span>', '  <span class=\"glyphicon glyphicon-hourglass glyphicon-spin\" ng-if=\"loading\"></span>', '  {{btnLabel}}', '</a>', '<div ng-if=\"error\">{{error}}</div>'].join(' '),\n            controller: function controller($scope) {\n\n                $scope.btnLabel = $scope.label || defaultBtnLabel;\n                $scope.loading = false;\n                $scope.available = $window.navigator && $window.navigator.geolocation;\n\n                if (!$scope.available) $scope.error = \"Your browser does not support determining location\";\n\n                $scope.geolocate = function () {\n\n                    $scope.loading = true;\n                    $window.navigator.geolocation.getCurrentPosition(function (position) {\n\n                        $scope.$apply(function () {\n                            $scope.loading = false;\n                        });\n                        $scope.$emit('map:geolocation', position.coords.latitude, position.coords.longitude);\n                    }, function (error) {\n                        switch (error.code) {\n                            case 1:\n                                $scope.error = \"Permission was denied while attempting to determine location\";\n                                break;\n                            case 2:\n                                $scope.error = \"Unable to determine your location\";\n                                break;\n                            case 3:\n                                $scope.error = \"Unable to determine location in a reasonable amount of time\";\n                                break;\n                        }\n                    });\n                };\n            }\n        };\n    }]);\n})(jQuery, angular);\n(function (jQuery, angular) {\n\n    \"use strict\";\n\n    angular.module(\"gp-common\")\n\n    /**\n     * Header directive for GeoPlatform Angular-based web applications\n     * \n     * Uses transclusion to inject links into the nav-menu which floats to the right.\n     * The menu already provides a \"Home\" link (to app home) and Sign In/User Info button.\n     * The home link is not enabled by default but can be shown using 'show-home-link=\"true\"' \n     * parameter on the directive.\n     *\n     * Note: any links transcluded should reference '$parent.user' to access authenticated user info\n     * \n     * ex:\n     * \n     *   <div gp-header brand=\"Map Manager\" show-home-link=\"true\" class=\"navbar-fixed-top\">\n     *     <li><a href=\"#/maps\">Maps</a></li>\n     *     <li><a href=\"#/galleries\">Galleries</a></li>\n     *     <li><a ng-if=\"$parent.user!==null\" href=\"#/agol\">AGOL</a></li>\n     *     <li><a href=\"#/help\">Help</a></li>\n     *   </div>\n     */\n    .directive('gpHeader', ['GPConfig', 'AuthenticationService', function (Config, AuthenticationService) {\n\n        return {\n\n            scope: {\n                brand: \"@\",\n                showHomeLink: \"@\"\n            },\n            restrict: \"AE\",\n            transclude: true,\n            replace: true,\n            template: ['<header>', '  <div class=\"container-fluid\">', '    <div class=\"row\">', '      <div class=\"col-md-12\">', '        <ul role=\"menu\" class=\"header__menu\" gp-header-menu>', '          <li ng-if=\"showHomeLink\">', '            <a href=\"#/goHome\">', '                <span class=\"glyphicon glyphicon-home\"></span> ', '                <span class=\"hidden-xs hidden-sm\">Home</span>', '            </a>', '          </li>', '          <div class=\"transcluded\"></div>', '          <li><span gp-login-button></span></li>', '        </ul>', '        <h4 class=\"brand\">', '          <a href=\"{{portalUrl}}\" title=\"Go to the GeoPlatform Home Page\">', '            <span class=\"icon-gp\"></span>', '            <span class=\"hidden-xs\">GeoPlatform</span>', '          </a>', '          {{brand}}', '        </h4>', '      </div>', '    </div>', '  </div>', '</header>'].join(' '),\n\n            // controller: function($rootScope, $scope, $element) {\n            //     $scope.portalUrl = $rootScope.portalUrl;\n            // }, \n\n            link: function link($scope, $element, $attrs, ctrl, transcludeFn) {\n\n                $scope.showHomeLink = $scope.showHomeLink === 'true' || false;\n\n                $scope.portalUrl = Config.portalUrl;\n\n                AuthenticationService.getUserQ().then(function (user) {\n                    $scope.user = user;\n                });\n\n                $element.find('.transcluded').replaceWith(transcludeFn());\n            }\n\n        };\n    }])\n\n    /**\n     * Header Menu\n     *\n     * Monitors the current page URL and updates the header links \n     * to highlight whichever one is associated with the current page\n     *\n     * Usage: \n     *\n     *  <ul role=\"menu\" class=\"header__menu\" gp-header-menu>\n     *      <li><a href=\"#/maps\">Maps</a></li>\n     *      <li><a href=\"#/galleries\">Galleries</a></li>\n     *      ...\n     *  </ul>\n     *\n     */\n    .directive('gpHeaderMenu', ['$location', function ($location) {\n\n        //default href for \"home\" link in header__menu\n        //uses 'goHome' to avoid angular-route issues with empty hash not \n        // triggering a page reload. Relies upon the \"otherwise\" condition\n        // being configured inside a routeProvider within the application.\n        var homeLink = 'goHome';\n\n        function update($element) {\n\n            var path = $location.path();\n\n            if (path === '/' || path === '/#' || path === '/#/') path = homeLink;\n\n            if (path[0] === '/') path = path.substring(1);\n\n            var menu = $element;\n            menu.find('li.active').removeClass('active');\n\n            var link = menu.find('li > a[href=\"#/' + path + '\"]');\n            if (link.length) {\n                //check if link is within a dropdown in the header menu\n                var dd = link.closest('.dropdown-menu');\n                if (dd.length) {\n                    //find next ancestor that is a list element and mark it active\n                    dd.closest('li').addClass('active');\n                } else {\n                    //not in a dropdown, mark this link active\n                    link.parent().addClass('active');\n                }\n            }\n\n            menu.find('li > a').each(function (i, a) {\n                var $a = $(a),\n                    href = $a.attr('href');\n                if (!href) return;\n                href = href.replace('#/', '');\n                if (path.indexOf(href) === 0) $a.parent().addClass('active');\n            });\n        }\n\n        return {\n            scope: {\n                homeHref: '@'\n            },\n            restrict: \"A\",\n\n            controller: function controller($rootScope, $scope, $element) {\n                if ($scope.homeHref) homeLink = $scope.homeHref;\n            },\n\n            link: function link($scope, $element) {\n\n                update($element);\n\n                $scope.$root.$on('$locationChangeSuccess', function () {\n                    update($element);\n                });\n            }\n        };\n    }])\n\n    /**\n     *\n     * Usage: \n     *\n     *    <div ng-cloak gp-flex-header show-home-link=\"true\" brand=\"Application Name\">\n     *      <li><a>Menu Item</a></li>\n     *      <li><a>Menu Item</a></li>\n     *      <li><a>Menu Item</a></li>\n     *      <li><a>Menu Item</a></li>\n     *    </div>\n     *\n     */\n    .directive('gpFlexHeader', ['GPConfig', 'AuthenticationService', function (Config, AuthenticationService) {\n\n        return {\n\n            scope: {\n                brand: \"@\",\n                showHomeLink: \"@\"\n            },\n            restrict: \"AE\",\n            transclude: true,\n            replace: true,\n            template: \"\\n                <header>\\n                    <h4 class=\\\"brand\\\">\\n                        <a href=\\\"{{portalUrl}}\\\" title=\\\"Go to the GeoPlatform Home Page\\\">\\n                            <span class=\\\"icon-gp\\\"></span>\\n                            <span class=\\\"hidden-xs\\\">GeoPlatform</span>\\n                        </a>\\n                        {{brand}}\\n                    </h4>\\n                    <ul role=\\\"menu\\\" class=\\\"header__menu\\\" gp-header-menu>\\n                        <li ng-if=\\\"showHomeLink\\\">\\n                            <a href=\\\"/\\\">\\n                                <span class=\\\"glyphicon glyphicon-home\\\"></span> \\n                                <span class=\\\"hidden-xs hidden-sm\\\">Home</span>\\n                            </a>\\n                        </li>\\n                        <div class=\\\"transcluded\\\"></div>\\n                        <li><span gp-login-button></span></li>\\n                    </ul>\\n                </header>\\n            \",\n\n            link: function link($scope, $element, $attrs, ctrl, transcludeFn) {\n\n                $scope.showHomeLink = $scope.showHomeLink === 'true' || false;\n\n                $scope.portalUrl = Config.portalUrl;\n\n                AuthenticationService.getUserQ().then(function (user) {\n                    $scope.user = user;\n                });\n\n                $element.find('.transcluded').replaceWith(transcludeFn());\n            }\n\n        };\n    }]);\n})(jQuery, angular);\n\n(function (angular) {\n\n    \"use strict\";\n\n    angular.module('gp-common').directive('iframeOnload', function () {\n        return {\n            scope: {\n                callback: '&iframeOnload'\n            },\n            link: function link(scope, element, attrs) {\n                element.on('load', function (event) {\n                    element.off('load');\n                    return scope.callback(event);\n                });\n            }\n        };\n    });\n})(angular);\n(function (angular, Constants) {\n\n    \"use strict\";\n\n    angular.module(\"gp-common\").directive('onImgFail', function () {\n        return {\n            restrict: \"A\",\n            link: function link($scope, $element, $attrs) {\n                var jqEl = jQuery($element);\n                jqEl.on('error', function () {\n                    jqEl.off('error');\n                    jqEl.attr('src', $attrs.onImgFail);\n                });\n            }\n        };\n    }).directive('mapThumbnail', [function () {\n        return {\n            restrict: \"A\",\n            scope: {\n                mapThumbnail: '='\n            },\n            link: function link($scope, $element, $attrs) {\n\n                var map = $scope.mapThumbnail;\n\n                if (map.$promise && !map.$resolved) {\n\n                    map.$promise.then(function (m) {\n                        if (typeof m.thumbnail === 'string') //old map model\n                            $element.attr('src', getUrl(m));else buildThumbnail(m); //open map model\n                    }).catch(function (e) {\n                        $element.attr('src', null);\n                    });\n                } else {\n                    if (typeof map.thumbnail === 'string') //old map model\n                        $element.attr('src', getUrl(map));else buildThumbnail(map);\n                }\n\n                function buildThumbnail(map) {\n                    if (!map.thumbnail) {\n                        $element.attr('src', null);\n                    } else if (map.thumbnail.contentData) {\n\n                        var style = 'background-size:contain;' + 'background-repeat:no-repeat;' + 'background-image: url(data:' + (map.thumbnail.mediaType || 'image/png') + ';base64,' + map.thumbnail.contentData + ');';\n\n                        //if directive is on a responsive item (aka, in a gp-ui-card), \n                        // ignore thumbnail dimensions. Otherwise, use them\n                        if ($element.attr('class').indexOf('embed-responsive-item') < 0) {\n                            style += 'width:' + (map.thumbnail.width || '32') + 'px;' + 'height:' + (map.thumbnail.height || '32') + 'px;';\n                        }\n\n                        $element.attr('style', style);\n                    } else if (map.thumbnail.url) {\n                        $element.attr('src', map.thumbnail.url);\n                    } else $element.attr('src', null);\n                }\n\n                function getUrl(map) {\n                    var url = map.thumbnail;\n                    if (!url || !url.length) url = Constants.ualUrl + '/api/maps/' + map.id + '/thumbnail';else if (url.indexOf(\"http\") !== 0) {\n                        if (url[0] !== '/') url = Constants.ualUrl + '/' + url;else url = Constants.ualUrl + url;\n                    }\n                    return url;\n                }\n            }\n        };\n    }]).directive('itemThumbnail', ['$q', function ($q) {\n        return {\n            restrict: \"E\",\n            replace: true,\n            scope: {\n                item: '=',\n                fallback: '@',\n                link: '@'\n            },\n            template: \"\\n                <a ng-show=\\\"hasThumbnail\\\" class=\\\"media embed-responsive embed-responsive-16by9\\\">\\n                    <img class=\\\"embed-responsive-item\\\" on-img-error=\\\"{{fallback||'/img/img-404.jpg'}}\\\">\\n                </a>\\n            \",\n            controller: function controller($scope) {\n                $scope.elName = 'div';\n\n                $scope.isLink = !!$scope.link;\n                if ($scope.isLink) {\n                    $scope.elName = 'a';\n                }\n            },\n            link: function link($scope, $element, $attrs) {\n\n                var item = $scope.item;\n                (item.$promise || $q.resolve(item)).then(function (obj) {\n\n                    var url = $scope.fallback;\n\n                    //maps\n                    if (obj.type && obj.type === 'Map') url = Constants.ualUrl + \"/api/maps/\" + obj.id + \"/thumbnail\";\n                    //maps as gallery items\n                    else if (obj.assetType && obj.assetType === 'Map') url = Constants.ualUrl + \"/api/maps/\" + obj.assetId + \"/thumbnail\";\n                        //other thumbnail'ed items with URLs\n                        else if (obj.thumbnail && obj.thumbnail.url) url = obj.thumbnail.url;\n                            //other thumbnail'ed items with base64 content\n                            else if (obj.thumbnail && obj.thumbnail.contentData) {\n\n                                    var style = 'background-size:contain;' + 'background-repeat:no-repeat;' + 'background-image: url(data:' + (obj.thumbnail.mediaType || 'image/png') + ';base64,' + obj.thumbnail.contentData + ');';\n\n                                    //if directive is on a responsive item (aka, in a gp-ui-card), \n                                    // ignore thumbnail dimensions. Otherwise, use them\n                                    if ($element.attr('class').indexOf('embed-responsive-item') < 0) {\n                                        style += 'width:' + (obj.thumbnail.width || '32') + 'px;' + 'height:' + (obj.thumbnail.height || '32') + 'px;';\n                                    }\n\n                                    $element.find('img').attr('style', style);\n                                }\n\n                    $scope.hasThumbnail = !!url;\n                    $element.find('img').attr('src', url);\n\n                    if ($scope.isLink) {\n                        //$element is a.media because of 'replace:true'\n                        $element.attr('href', $scope.link).attr('target', '_blank');\n                    }\n                }).catch(function (e) {\n                    $element.find('img').attr('src', $scope.fallback);\n                });\n            }\n        };\n    }]);\n})(angular, GeoPlatform);\n(function (angular) {\n\n    \"use strict\";\n\n    angular.module('gp-common')\n\n    //\n    .service('NotificationService', ['$rootScope', function ($rootScope) {\n        var Service = function Service() {\n            this.items = [];\n        };\n        Service.prototype = {\n            getItems: function getItems() {\n                return this.items;\n            },\n            /**\n             * @param item object\n             * @return function to cancel the notification\n             */\n            addItem: function addItem(item) {\n                this.items.push(item);\n                $rootScope.$broadcast('gp:notifications:new', item);\n\n                var fn = function fn(item) {\n                    this.removeItem(item);\n                };\n                return fn.bind(this, item);\n            },\n            removeItem: function removeItem(item) {\n                var index = this.items.indexOf(item);\n                if (index >= 0) return this.items.splice(index, 1);\n                return null;\n            },\n            error: function error(label, msg, dismiss) {\n                return this.addItem({ type: 'error', label: label, message: msg, canDismiss: dismiss });\n            },\n            success: function success(label, msg, dismiss) {\n                return this.addItem({ type: 'success', label: label, message: msg, canDismiss: dismiss });\n            },\n            info: function info(label, msg, dismiss) {\n                return this.addItem({ type: 'info', label: label, message: msg, canDismiss: dismiss });\n            }\n        };\n        return new Service();\n    }])\n\n    // Usage: <gp-notifications />\n    .directive('gpNotifications', ['$timeout', 'NotificationService', function ($timeout, NotificationService) {\n        return {\n            scope: {\n                expiration: '@'\n            },\n            template: ['<div class=\"notifications ng-hide\" ng-show=\"items.length\">', '  <div class=\"notification\" ng-repeat=\"item in items\"', '    ng-class=\"{\\'notification--success\\':item.type===\\'success\\', \\'notification--error\\':item.type===\\'error\\', \\'notification--info\\':item.type===\\'info\\'}\">', '    <h5 class=\"notification__title\">', '        <span class=\"pull-right glyphicon\" ', '            ng-class=\"{\\'glyphicon-ok-sign\\':item.type===\\'success\\',\\'glyphicon-exclamation-sign\\':item.type===\\'error\\',\\'glyphicon-info-sign\\':item.type===\\'info\\'}\">', '        </span>', '        {{item.label}}', '    </h5>', '    <p class=\"notification__content\" ng-bind-html=\"item.message\"></p>', '    <div class=\"notification__actions\" ng-if=\"item.canDismiss\">', '        <button type=\"button\" class=\"btn btn-link\" ng-click=\"dismiss(item)\">dismiss</button>', '    </div>', '  </div>', '</div>'].join(' '),\n\n            link: function link($scope, $element, $attrs) {\n\n                $scope.expiration = ($scope.expiration || 2000) * 1;\n\n                $scope.items = [];\n\n                function update() {\n                    $scope.items = NotificationService.getItems();\n\n                    //if updated before timer expired, reset timer\n                    if ($scope.timer) {\n                        $timeout.cancel($scope.timer);\n                        $scope.timer = null;\n                    }\n\n                    //set timer to kill earliest item after time\n                    $scope.timer = $timeout(function () {\n                        $scope.timer = null;\n                        //will ultimately call update() and thus trigger timeout again\n                        $scope.removeOldest();\n                    }, $scope.expiration);\n                }\n                update();\n\n                $scope.removeOldest = function () {\n                    //find oldest that can be removed\n                    var oldest = $scope.items.find(function (item) {\n                        return item.canDismiss;\n                    });\n                    if (oldest) NotificationService.removeItem(oldest);\n                };\n\n                $scope.dismiss = function (item) {\n                    //remove item using service\n                    NotificationService.removeItem(item);\n                };\n\n                $scope.$watchCollection(function () {\n                    return NotificationService.getItems();\n                }, update);\n\n                // $scope.$on('gp:notifications:new', function(event, item) { update(); });\n            }\n        };\n    }]);\n})(angular);\n(function (jQuery, angular) {\n\n    \"use strict\";\n\n    /*\n     * Usage:\n     * \n     *      <gp-pagination service=\"$ctrl.service\" event-key=\"maps\"></gp-pagination>\n     *\n     *  Expects a BrowseObjService instance for the 'service' binding, or at least \n     * one that provides the same pagination and options API.\n     */\n\n    /**\n     * Requires a service which exposes the following methods:\n     *   - getPagination() : returns {object} defining 'start', 'size', and 'total'\n     *   - start(int) : takes {int} defining which index to start requesting\n     *   - size(int) : takes {int} defining how many items to request\n     *   - on(eventName, listener) : must support event \"gp:browse:<key>:pagination\" where 'key' may be 'objects' or a custom key\n     */\n\n    var PaginationController = function () {\n        function PaginationController() {\n            'ngInject';\n\n            _classCallCheck(this, PaginationController);\n        }\n\n        _createClass(PaginationController, [{\n            key: \"$onInit\",\n            value: function $onInit() {\n                var _this3 = this;\n\n                if (!this.service) return;\n\n                this.options = this.service.getPagination();\n\n                //support using a traditional select instead of a uib dropdown menu\n                // in case the pagination control itself is wrapped in a dropdown menu.\n                //in this case, we use objects with labels and values in order to display\n                // the 'per page' text along with whatever the page size is.\n\n                this.pageSizeDropdown = true;\n                this.useSelect = typeof this.useSelect !== 'undefined' && (this.useSelect === true || this.useSelect === 'true' || this.useSelect === 1);\n                if (this.useSelect) {\n                    this.pageSizeDropdown = false;\n                    this.pageSize = this.options.size;\n                    this.pageSizeOptions = (this.options.sizeOptions || [5, 10, 20, 50]).map(function (o) {\n                        return { label: o + ' per page', value: o };\n                    });\n                }\n\n                var event = 'gp:browse:';\n                if (this.eventKey) event = 'gp:browse:' + this.eventKey + \":\";else event = 'gp:browse:objects:';\n\n                this.listener = this.service.on(event + 'pagination', function () {\n                    _this3.options = _this3.service.getPagination();\n                });\n            }\n        }, {\n            key: \"$onDestroy\",\n            value: function $onDestroy() {\n\n                //remove listener from service if exists\n                if (this.listener) this.listener();\n\n                this.service = null;\n            }\n        }, {\n            key: \"previous\",\n            value: function previous() {\n                if (this.service && this.hasPrevious()) {\n                    this.service.start(Math.max(0, this.options.start * 1 - this.options.size * 1), true);\n                }\n            }\n        }, {\n            key: \"next\",\n            value: function next() {\n                if (this.service && this.hasNext()) {\n                    this.service.start(Math.min(this.options.total, this.options.start * 1 + this.options.size * 1), true);\n                }\n            }\n        }, {\n            key: \"first\",\n            value: function first() {\n                if (this.service && this.hasPrevious()) {\n                    this.service.start(0, true);\n                }\n            }\n        }, {\n            key: \"last\",\n            value: function last() {\n                if (this.service && this.hasNext()) {\n                    var lastPage = Math.floor(this.options.total / this.options.size);\n                    this.setPage(lastPage);\n                }\n            }\n        }, {\n            key: \"setPage\",\n            value: function setPage(arg) {\n                if (this.service) {\n                    var page = arg * 1;\n                    this.service.start(page * (this.options.size * 1), true);\n                }\n            }\n        }, {\n            key: \"setPageSize\",\n            value: function setPageSize(size) {\n                if (this.service) {\n                    this.service.size(size * 1, true);\n                }\n            }\n        }, {\n            key: \"hasPrevious\",\n            value: function hasPrevious() {\n                return this.options && this.options.start > 0;\n            }\n        }, {\n            key: \"hasNext\",\n            value: function hasNext() {\n                return this.options && this.options.start + this.options.size < this.options.total;\n            }\n        }]);\n\n        return PaginationController;\n    }();\n\n    angular.module('gp-common').component('gpPagination', {\n\n        bindings: {\n            service: '=',\n            eventKey: '@',\n            useSelect: '@'\n        },\n\n        controller: PaginationController,\n\n        template: \"\\n            <div class=\\\"c-pagination\\\">\\n                <div class=\\\"c-pagination__total\\\">{{$ctrl.options.total||0}} results</div>\\n                <div class=\\\"c-pagination__page-size\\\" ng-if=\\\"$ctrl.pageSizeDropdown\\\">\\n                    <span uib-dropdown>\\n                        <a href=\\\"\\\" uib-dropdown-toggle title=\\\"Change the number of results returned\\\">\\n                            {{$ctrl.options.size}} per page <span class=\\\"caret\\\"></span>\\n                        </a>\\n                        <ul class=\\\"dropdown-menu\\\" role=\\\"menu\\\">\\n                            <li ng-repeat=\\\"size in $ctrl.options.sizeOptions track by $index\\\">\\n                                <a ng-click=\\\"$ctrl.setPageSize(size)\\\">{{size}} per page</a>\\n                            </li>\\n                        </ul>\\n                    </span>\\n                </div>\\n                <div class=\\\"c-pagination__page-size\\\" ng-if=\\\"!$ctrl.pageSizeDropdown\\\">\\n                    <select class=\\\"form-control\\\" \\n                        ng-model=\\\"$ctrl.pageSize\\\" ng-change=\\\"$ctrl.setPageSize($ctrl.pageSize)\\\"\\n                        ng-options=\\\"opt.value as opt.label for opt in $ctrl.pageSizeOptions\\\">\\n                    </select>\\n                </div>\\n                <div class=\\\"c-pagination__pages\\\">\\n                    <div class=\\\"c-pagination__button\\\" \\n                        ng-class=\\\"{'is-disabled':!$ctrl.hasPrevious()}\\\"\\n                        ng-click=\\\"$ctrl.first()\\\">\\n                        <span class=\\\"glyphicon glyphicon-fast-backward\\\"></span>\\n                    </div>\\n                    <div class=\\\"c-pagination__button\\\" \\n                        ng-class=\\\"{'is-disabled':!$ctrl.hasPrevious()}\\\"\\n                        ng-click=\\\"$ctrl.previous()\\\">\\n                        <span class=\\\"glyphicon glyphicon-backward\\\"></span>\\n                    </div>\\n                    <div class=\\\"c-pagination__page\\\">\\n                        {{$ctrl.options.start+1}} - {{$ctrl.options.start+$ctrl.options.size}}\\n                    </div>\\n                    <div class=\\\"c-pagination__button\\\" \\n                        ng-class=\\\"{'is-disabled':!$ctrl.hasNext()}\\\"\\n                        ng-click=\\\"$ctrl.next()\\\">\\n                        <span class=\\\"glyphicon glyphicon-forward\\\"></span>\\n                    </div>\\n                    <div class=\\\"c-pagination__button\\\" \\n                        ng-class=\\\"{'is-disabled':!$ctrl.hasNext()}\\\"\\n                        ng-click=\\\"$ctrl.last()\\\">\\n                        <span class=\\\"glyphicon glyphicon-fast-forward\\\"></span>\\n                    </div>\\n                </div>\\n            </div>\\n        \"\n\n    });\n})(jQuery, angular);\n(function (angular) {\n\n    \"use strict\";\n\n    /**\n     * Usage: \n     *  <gp-progress-circle ng-model=\"$ctrl.amount\"></gp-progress-circle>\n     */\n\n    angular.module('gp-common').component('gpProgressCircle', {\n\n        bindings: {\n            ngModel: '<' //amount out of 100\n        },\n\n        controller: function controller() {\n\n            this.$onInit = function () {\n                this.dashArray = 2 * Math.PI * 45 /*radius*/;\n                if (!this.ngModel) this.ngModel = 0;\n                this.update();\n            };\n\n            this.$onChanges = function (changes) {\n                if (changes.ngModel) this.update();\n            };\n\n            this.update = function () {\n                var offset = 2 * Math.PI * 45 * (1 - this.ngModel / 100);\n                this.value = offset;\n            };\n        },\n\n        template: \"\\n            <svg class=\\\"c-progress--circle\\\" viewBox=\\\"0 0 100 100\\\">\\n                <circle class=\\\"c-progress__meter\\\" cx=\\\"50\\\" cy=\\\"50\\\" r=\\\"45\\\" stroke-width=\\\"10\\\" />\\n                <circle class=\\\"c-progress__value\\\" cx=\\\"50\\\" cy=\\\"50\\\" r=\\\"45\\\" stroke-width=\\\"10\\\" \\n                    stroke-dasharray=\\\"{{$ctrl.dashArray}}\\\" stroke-dashoffset=\\\"{{$ctrl.value}}\\\"/>\\n                <text class=\\\"c-progress__label\\\" x=\\\"50\\\" y=\\\"-40\\\" text-anchor=\\\"middle\\\">{{$ctrl.ngModel}}%</text>\\n            </svg>\\n        \"\n    });\n})(angular);\n(function (jQuery, angular) {\n\n    \"use strict\";\n\n    angular.module('gp-common')\n\n    //helper to determine size of window for responsive breakpoint purposes\n    .provider('responsiveHelper', [\"$windowProvider\", function ($windowProvider) {\n\n        var $window = $windowProvider.$get();\n\n        function Helper($window) {\n            this.window = $window;\n        }\n        Helper.prototype = {\n            getWidth: function getWidth() {\n                return $window.innerWidth || $window.outerWidth;\n            },\n            isXS: function isXS() {\n                var width = this.getWidth();return width < 768;\n            },\n            isSM: function isSM() {\n                var width = this.getWidth();return width >= 768 && width < 992;\n            },\n            isMD: function isMD() {\n                var width = this.getWidth();return width >= 992 && width < 1200;\n            },\n            isLG: function isLG() {\n                var width = this.getWidth();return width >= 1200;\n            }\n        };\n\n        var helper = new Helper($window);\n\n        this.$get = function () {\n            return helper;\n        };\n    }])\n\n    //directive which appends appropriate responsive breakpoint classNames to the element\n    // on which it's set\n    .directive('gpResponsive', ['$window', 'responsiveHelper', function ($window, responsiveHelper) {\n\n        return {\n            restrict: \"A\",\n            link: function link($scope, $element, $attrs) {\n\n                function update(el, helper) {\n                    if (helper.isXS()) el.addClass('gp-responsive-xs');else el.removeClass('gp-responsive-xs');\n\n                    if (helper.isSM()) el.addClass('gp-responsive-sm');else el.removeClass('gp-responsive-sm');\n\n                    if (helper.isMD()) el.addClass('gp-responsive-md');else el.removeClass('gp-responsive-md');\n\n                    if (helper.isLG()) el.addClass('gp-responsive-lg');else el.removeClass('gp-responsive-lg');\n                }\n\n                update($element, responsiveHelper);\n\n                var resizeFn = function resizeFn() {\n                    update($element, responsiveHelper);\n                };\n\n                var w = angular.element($window);\n                var listener = w.on('resize', resizeFn);\n\n                $scope.$on('$destroy', function () {\n                    w.off('resize', resizeFn);\n                });\n            }\n        };\n    }]).directive('gpResize', function ($window, $timeout) {\n        return function ($scope, $element, $attr) {\n\n            var resizeFn = function resizeFn() {\n                var hh = jQuery('header')[0].offsetHeight;\n                // var fh = jQuery('footer')[0].offsetHeight;\n                // console.log('hh & fh', hh, fh);                    \n\n                var tp = hh + 2;\n                // var bt = fh + 2;\n                // console.log('tp & bt', tp, bt);                \n\n                var changes = {\n                    // bottom: bt + 'px',\n                    top: tp + 'px'\n                };\n                $element.css(changes);\n                $scope.$apply();\n            };\n\n            var w = angular.element($window);\n            w.on('resize', resizeFn);\n\n            $timeout(resizeFn, 200);\n\n            $scope.$on('$destroy', function () {\n                w.off('resize', resizeFn);\n            });\n        };\n    });\n})(jQuery, angular);\n(function (jQuery, angular) {\n\n    \"use strict\";\n\n    function inputLinkFunction($scope, $element, $attrs, ngModelController, $timeout) {\n\n        if (!$scope.type) $scope.type = \"text\";\n        if ($scope.required === 'true') $scope.required = true;else $scope.required = false;\n\n        $scope.elId = 'input_' + Math.ceil(Math.random() * 9999);\n        $scope.size = $scope.size || 'medium';\n        $scope.type = $scope.type || 'text';\n\n        //listen for changes to the inner value by way of the form-control\n        $element.find('.form-control').on('change', function onChange() {\n            validate($scope.innerValue);\n        });\n\n        /* ------------- private methods --------------- */\n\n        function validate() {\n\n            //check form-control for ng-invalid\n            var input = $element.find('.form-control');\n\n            $scope.isDirty = input.hasClass('ng-dirty');\n\n            if (input.hasClass('ng-invalid')) {\n                if (input.hasClass(\"ng-empty\")) $scope.error = \"This field requires a value\";else $scope.error = \"Invalid value provided\";\n            } else $scope.error = null;\n        }\n\n        function update(newValue) {\n            // call $parsers pipeline then update $modelValue\n            ngModelController.$setViewValue(newValue);\n            // update the local view\n            ngModelController.$render();\n        }\n\n        // when model change, update our view (just update the div content)\n        ngModelController.$render = function () {\n\n            var value = ngModelController.$viewValue;\n\n            //create copy of passed in model value that can be used\n            // by the controls here allowing us to cancel and \n            // commit changes at our own leisure\n            $scope.innerValue = value;\n\n            $scope.displayValue = value || $scope.placeholder || \"No value provided\";\n\n            validate(value);\n        };\n\n        /* ------------- private methods --------------- */\n\n        $scope.isReadOnly = function () {\n            var t = _typeof(this.readOnly);\n            if (t === 'undefined') return false;\n            if (t === 'string') return this.readOnly.toLowerCase() === 'true';\n            if (t === 'number') return this.readOnly === 1;\n            if (t === 'boolean') return this.readOnly;\n            return false;\n        };\n\n        //enter edit mode\n        $scope.edit = function () {\n            if ($scope.isReadOnly()) return;\n            $scope.editing = true;\n            //auto-focus on form-control when entering edit mode\n            $timeout(function () {\n                $element.find('.form-control').focus().select();\n            }, 200);\n        };\n        //leave edit mode (regardless of save() or cancel())\n        $scope.done = function () {\n            $scope.editing = false;\n            $scope.error = null;\n        };\n\n        $scope.save = function () {\n            //update display with new value\n            update($scope.innerValue);\n            $scope.done();\n        };\n        $scope.cancel = function () {\n            //reset inner value\n            $scope.innerValue = ngModelController.$viewValue;\n            $scope.done();\n        };\n\n        $scope.onKeyPress = function ($event, code) {\n            // console.log(\"Pressed \" + code);\n            if ((code === undefined || code === 0) && $event.which !== undefined) code = $event.which;\n            if ($scope.type === 'number') {\n\n                //NOTE: Chrome does not catch Backspace onKeyPress, so it \n                // skips this handler. FF does, so we need to watch for \n                // backspace, delete, and numbers\n\n                if (code === 8 || //backspace\n                code === 46 || //delete  \n                code >= 44 && code <= 57) //comma, hyphen, period and numbers (0-9)\n                    return;\n\n                //NOTE: keyPress period is 46. keyDown it is 190\n\n                $event.preventDefault();\n                return false; //ignore key\n            }\n        };\n        $scope.onKeyUp = function ($event, code) {\n            // console.log(\"Up \" + code);\n            if ((code === undefined || code === 0) && $event.which !== undefined) code = $event.which;\n            if (code === 13 && !$scope.error) $scope.done(); //enter\n            else if (code === 27) $scope.cancel(); //esc\n                else {\n\n                        if (code !== 8 && //backspace\n                        code !== 46 && //delete\n                        code !== 190 && ( //period\n                        code < 48 || code > 90) && ( //letters and numbers (a-z, 0-9)\n                        code < 106 || code > 111) && code < 186) return;\n\n                        validate();\n                    }\n        };\n\n        $scope.$destroy = function () {\n            $element.off('change');\n        };\n    }\n\n    angular.module(\"gp-common\").directive('gpSlickFormInput', ['$timeout', function ($timeout) {\n\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                placeholder: '@',\n                help: '=',\n                // validator: '&',\n                // validationExpr: '@',\n                type: '@',\n                pattern: \"@\",\n                required: '@',\n                readOnly: '@',\n                size: '@',\n                icon: '@'\n            },\n            template: INPUT_TEMPLATE,\n            link: function link($scope, $element, $attrs, ngModelController) {\n                inputLinkFunction($scope, $element, $attrs, ngModelController, $timeout);\n            }\n        };\n    }]).directive('gpSlickFormTextarea', ['$timeout', function ($timeout) {\n\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                placeholder: '@',\n                help: \"@\",\n                readOnly: \"@\",\n                size: \"@\",\n                icon: \"@\"\n            },\n            template: TEXTAREA_TEMPLATE,\n            link: function link($scope, $element, $attrs, ngModelController) {\n                inputLinkFunction($scope, $element, $attrs, ngModelController, $timeout);\n            }\n        };\n    }])\n\n    /**\n     *\n     * Notes:\n     *  - use 'form form-inline' classes for editable date so the field doesn't take up whole line\n     */\n    .directive('gpSlickFormDate', ['$timeout', '$filter', function ($timeout, $filter) {\n\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                format: \"@\",\n                placeholder: '@',\n                required: \"@\",\n                readOnly: \"@\",\n                size: '@',\n                icon: '@'\n            },\n            template: DATE_TEMPLATE,\n\n            controller: function controller($scope, $element) {\n                if (!$scope.format || $scope.format.length < 3) $scope.format = \"mediumDate\";\n                $scope.inline = $element.hasClass(\"inline\");\n            },\n\n            /**\n             *\n             */\n            link: function link($scope, $element, $attrs, ngModelController) {\n\n                if ($scope.required === 'true') $scope.required = true;else $scope.required = false;\n\n                $scope.elId = 'input_' + Math.ceil(Math.random() * 9999);\n                $scope.size = $scope.size || 'medium';\n                $scope.type = $scope.type || 'text';\n\n                function validate(value) {\n                    // console.log(\"Validating '\" + value + \"'\");\n\n                    //check form-control for ng-invalid\n                    var input = $element.find('.form-control');\n                    if (input.hasClass('ng-invalid')) {\n                        if (input.hasClass(\"ng-empty\")) $scope.error = \"This field requires a value\";else $scope.error = \"Invalid value provided\";\n                    } else $scope.error = null;\n                }\n\n                function update(newValue) {\n                    // call $parsers pipeline then update $modelValue\n                    ngModelController.$setViewValue(newValue);\n                    // update the local view\n                    ngModelController.$render();\n                }\n\n                // when model change, update our view (just update the div content)\n                ngModelController.$render = function () {\n\n                    var value = ngModelController.$viewValue;\n\n                    //create copy of passed in model value that can be used\n                    // by the controls here allowing us to cancel and \n                    // commit changes at our own leisure\n                    $scope.innerValue = value;\n\n                    $scope.displayValue = value ? $filter('date')(ngModelController.$modelValue, $scope.format) : $scope.placeholder || \"No value provided\";\n\n                    validate(value);\n                };\n\n                $scope.isReadOnly = function () {\n                    var t = _typeof(this.readOnly);\n                    if (t === 'undefined') return false;\n                    if (t === 'string') return this.readOnly.toLowerCase() === 'true';\n                    if (t === 'number') return this.readOnly === 1;\n                    if (t === 'boolean') return this.readOnly;\n                    return false;\n                };\n\n                //enter edit mode\n                $scope.edit = function () {\n                    if ($scope.isReadOnly()) return;\n\n                    $scope.editing = true;\n\n                    //auto-focus on form-control when entering edit mode\n                    // $timeout(function() { $element.find('.form-control').focus().select(); }, 200);\n                };\n                //leave edit mode (regardless of save() or cancel())\n                $scope.done = function () {\n                    $scope.opened = false;\n                    $scope.editing = false;\n                    $scope.error = null;\n                };\n\n                $scope.save = function () {\n                    //update display with new value\n                    update($scope.innerValue);\n                    $scope.done();\n                };\n                $scope.cancel = function () {\n                    //reset inner value\n                    $scope.innerValue = angular.copy(ngModelController.$modelValue);\n                    $scope.done();\n                };\n\n                $scope.open = function () {\n                    //must wrap 'opened' variable in an object for \n                    // angular to properly track its value changes\n                    // from within children scope (ie, the date picker)\n                    if (typeof $scope.uibopts === 'undefined') {\n                        $scope.uibopts = {};\n                    }\n                    $scope.uibopts.opened = true;\n                };\n\n                $scope.onKeyUp = function (code) {\n                    if (code === 13) {\n                        //enter\n                        $scope.done();\n                    } else if (code === 27) {\n                        //esc\n                        $scope.cancel();\n                    }\n                };\n                $scope.onChange = function (date) {\n                    if (isNaN(ngModelController.$modelValue) && $scope.required) {\n                        $scope.error = \"This field requires a value\";\n                    } else $scope.error = null;\n                };\n            }\n        };\n    }]).directive('gpSlickFormSelect', ['$timeout', function ($timeout) {\n\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                codeList: \"=\",\n                help: '=',\n                required: \"@\",\n                readOnly: \"@\",\n                size: '@',\n                icon: '@'\n            },\n            template: SELECT_TEMPLATE,\n            link: function link($scope, $element, $attrs, ngModelController) {\n\n                if (!$scope.type) $scope.type = \"text\";\n                if ($scope.required === 'true') $scope.required = true;else $scope.required = false;\n\n                $scope.elId = 'input_' + Math.ceil(Math.random() * 9999);\n                $scope.size = $scope.size || 'medium';\n                $scope.type = $scope.type || 'text';\n\n                var $select = null;\n\n                function getSelect() {\n                    if (!$select || !$select.length) $select = $element.find('.form-control');\n                    return $select;\n                }\n\n                if ($scope.codeList) {\n                    $scope.selectOptions = $scope.codeList.map(function (item) {\n                        if ((typeof item === \"undefined\" ? \"undefined\" : _typeof(item)) !== 'object' || !item.value) return { value: item, label: item };else if (!item.label) return { value: item.value, label: item.value };\n                        return item;\n                    });\n                } else $scope.selectOptions = [];\n\n                //listen for changes to the inner value by way of the form-control\n                // $element.find('.form-control').on('change', function onChange() { \n                //     validate($scope.innerValue); \n                // });\n\n\n                /* ------------- private methods --------------- */\n\n                function validate() {\n\n                    //check form-control for ng-invalid\n                    var select = getSelect();\n\n                    $scope.isDirty = select.hasClass('ng-dirty');\n\n                    if (select.hasClass('ng-invalid')) {\n                        if (select.hasClass(\"ng-empty\")) $scope.error = \"This field requires a value\";else $scope.error = \"Invalid value provided\";\n                    } else $scope.error = null;\n                }\n\n                function update(newValue) {\n                    // call $parsers pipeline then update $modelValue\n                    ngModelController.$setViewValue(newValue);\n                    // update the local view\n                    ngModelController.$render();\n                }\n\n                // when model change, update our view (just update the div content)\n                ngModelController.$render = function () {\n\n                    var value = ngModelController.$viewValue;\n\n                    //@see https://github.com/angular/angular.js/commit/7fda214c4f65a6a06b25cf5d5aff013a364e9cef\n\n                    //create copy of passed in model value that can be used\n                    // by the controls here allowing us to cancel and \n                    // commit changes at our own leisure\n                    $scope.innerValue = value;\n\n                    $scope.displayValue = $scope.placeholder || \"No value provided\";\n\n                    if (value) {\n                        //values are objects, not literals\n                        var opt = $scope.selectOptions.find(function (o) {\n                            return o.value == value;\n                        });\n                        $scope.displayValue = opt.label;\n                    }\n\n                    validate();\n                };\n\n                /* ------------- private methods --------------- */\n\n                $scope.onChange = function (value) {\n\n                    // console.log(\"Changing value \" + value + \" vs \" + $scope.innerValue);\n                    $scope.innerValue = value;\n                    $timeout(function () {\n                        validate();\n                    }, 200);\n                };\n\n                $scope.onTypeaheadSelection = function ($item, $model, $label, $event) {\n\n                    $scope.innerValue = $item ? $item.value : null;\n                    $timeout(function () {\n                        validate();\n                    }, 200);\n                };\n\n                $scope.isReadOnly = function () {\n                    var t = _typeof(this.readOnly);\n                    if (t === 'undefined') return false;\n                    if (t === 'string') return this.readOnly.toLowerCase() === 'true';\n                    if (t === 'number') return this.readOnly === 1;\n                    if (t === 'boolean') return this.readOnly;\n                    return false;\n                };\n\n                //enter edit mode\n                $scope.edit = function () {\n                    if ($scope.isReadOnly()) return;\n                    $scope.editing = true;\n                    //auto-focus on form-control when entering edit mode\n                    $timeout(function () {\n                        $select.focus().select();\n                    }, 200);\n                };\n                //leave edit mode (regardless of save() or cancel())\n                $scope.done = function () {\n                    $scope.editing = false;\n                    $scope.error = null;\n                };\n\n                $scope.save = function () {\n                    //update display with new value\n                    update($scope.innerValue);\n                    $scope.done();\n                };\n                $scope.cancel = function () {\n                    //reset inner value\n                    $scope.innerValue = ngModelController.$viewValue;\n                    $scope.done();\n                };\n\n                $scope.onKeyUp = function (code) {\n                    if (code === 13 && !$scope.error) {\n                        //enter\n                        $scope.save();\n                    } else if (code === 27) {\n                        //esc\n                        $scope.cancel();\n                    }\n                };\n\n                $scope.onTypeaheadKeyUp = function (code) {\n                    validate();\n                };\n\n                $scope.$destroy = function () {\n                    // $element.off('change');\n                };\n            }\n        };\n    }]);\n\n    var INPUT_TEMPLATE = ['<div class=\"form-group form-group-slick\">', '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>', '   <div class=\"input__display\" ', '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error,\\'text-lg\\':size===\\'large\\'}\" ', '       ng-show=\"!editing\" ng-click=\"edit()\" ', '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">', '      {{displayValue}}', '   </div>', '   <div ng-show=\"editing\">', '      <div class=\"input-group\" ng-class=\"{\\'input-group-lg\\':size===\\'large\\'}\">', '           <div class=\"input-group-slick\" ng-class=\"{\\'input-group-slick--lg\\':size===\\'large\\'}\">', '               <span ng-if=\"icon\" class=\"{{::icon}}\"></span>', '               <input id=\"{{::elId}}\" type=\"{{::type}}\" class=\"form-control\" ', '                   pattern=\"{{pattern}}\" ', '                   ng-model=\"innerValue\" ', '                   ng-required=\"{{required}}\" ', '                   ng-keypress=\"onKeyPress($event, $event.keyCode)\" ', '                   ng-keyup=\"onKeyUp($event, $event.keyCode)\" >', '               <span class=\"indicators\">', '                   <span class=\"is-valid glyphicon glyphicon-ok-sign\"></span>', '                  <span class=\"is-invalid glyphicon glyphicon-exclamation-sign\"></span>', '              </span>', '           </div>', '          <span class=\"input-group-btn\">', '               <button type=\"button\" class=\"btn btn-default\" ', '                   ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"', '                   ng-click=\"cancel()\" title=\"Cancel changes\">', '                   <span class=\"glyphicon glyphicon-ban-circle\"></span>', '              </button>', '               <button type=\"button\" class=\"btn btn-default\" ', '                   ng-class=\"{disabled:!!error||!isDirty,\\'btn-lg\\':size===\\'large\\'}\"', '                   ng-disabled=\"{{!!error}}\" ', '                   ng-click=\"save()\" title=\"Save changes\">', '                  <span class=\"glyphicon glyphicon-ok\"></span>', '               </button>', '           </span>', '       </div>', '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>', '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>', '   </div>', '</div>'].join(' ');\n\n    var TEXTAREA_TEMPLATE = ['<div class=\"form-group form-group-slick\">', '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>', '   <div class=\"input__display\" ', '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error,\\'text-lg\\':size===\\'large\\'}\" ', '       ng-show=\"!editing\" ng-click=\"edit()\" ', '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">', '      {{displayValue}}', '   </div>', '   <div ng-show=\"editing\">', '      <div class=\"input-group\" ng-class=\"{\\'input-group-lg\\':size===\\'large\\'}\">', '           <div class=\"input-group-slick\" ng-class=\"{\\'input-group-slick--lg\\':size===\\'large\\'}\">', '               <span ng-if=\"icon\" class=\"{{::icon}}\"></span>', '               <textarea rows=\"3\" id=\"{{::elId}}\" class=\"form-control\" ', '                   ng-required=\"{{required}}\" ng-model=\"innerValue\"', '                   ng-keypress=\"onKeyPress($event, $event.keyCode)\" ', '                   ng-keyup=\"onKeyUp($event, $event.keyCode)\"></textarea>', '               <span class=\"indicators\">', '                   <span class=\"is-valid glyphicon glyphicon-ok-sign\"></span>', '                  <span class=\"is-invalid glyphicon glyphicon-exclamation-sign\"></span>', '              </span>', '           </div>', '          <span class=\"input-group-btn\">', '               <button type=\"button\" class=\"btn btn-default\" ', '                   ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"', '                   ng-click=\"cancel()\" title=\"Cancel changes\">', '                   <span class=\"glyphicon glyphicon-ban-circle\"></span>', '              </button>', '               <button type=\"button\" class=\"btn btn-default\" ', '                   ng-class=\"{disabled:!!error||!isDirty,\\'btn-lg\\':size===\\'large\\'}\"', '                   ng-disabled=\"{{!!error}}\" ', '                   ng-click=\"save()\" title=\"Save changes\">', '                  <span class=\"glyphicon glyphicon-ok\"></span>', '               </button>', '           </span>', '       </div>', '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>', '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>', '   </div>', '</div>'].join(' ');\n\n    var DATE_TEMPLATE = ['<div class=\"form-group form-group-slick\">', '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>', '   <div class=\"input__display\" ', '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error}\" ', '       ng-show=\"!editing\" ng-click=\"edit()\" ', '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">', '      {{displayValue}}', '   </div>', '   <div ng-show=\"editing\">', '       <div uib-datepicker ng-required=\"{{required}}\" ng-model=\"innerValue\" datepicker-options=\"{showWeeks:false}\"></div>', '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>', '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>', '       <button type=\"button\" class=\"btn btn-default\" ', '           ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"', '           ng-click=\"cancel()\" title=\"Cancel changes\">', '           <span class=\"glyphicon glyphicon-ban-circle\"></span>', '      </button>', '      <button type=\"button\" class=\"btn btn-default\" ', '           ng-class=\"{disabled:!!error,\\'btn-lg\\':size===\\'large\\'}\"', '          ng-disabled=\"{{!!error}}\" ', '           ng-click=\"save()\" title=\"Save changes\">', '           <span class=\"glyphicon glyphicon-ok\"></span>', '      </button>', '   </div>', '</div>'].join(' ');\n\n    var SELECT_TEMPLATE = ['<div class=\"form-group form-group-slick\">', '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>', '   <div class=\"input__display\" ', '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error}\" ', '       ng-show=\"!editing\" ng-click=\"edit()\" ', '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">', '      {{displayValue}}', '   </div>', '   <div ng-show=\"editing\">', '      <div class=\"input-group\" ng-class=\"{\\'input-group-lg\\':size===\\'large\\'}\">', '           <div class=\"input-group-slick\" ng-class=\"{\\'input-group-slick--lg\\':size===\\'large\\'}\">', '               <span ng-if=\"icon\" class=\"{{::icon}}\"></span>', '               <select class=\"form-control input__field\" ', '                   ng-if=\"codeList.length<=12\" ', '                   ng-model=\"innerValue\" ', '                   ng-options=\"opt.value as opt.label for opt in selectOptions\" ', '                   ng-required=\"{{required}}\" ', '                   ng-change=\"onChange(innerValue)\" ', '                   ng-keyUp=\"onKeyUp($event.keyCode)\" >', '                   <option value=\"\">Select One</option>', '               </select>', '               <input type=\"text\" class=\"form-control input__field\" ng-if=\"codeList.length>12\" ', '                   ng-model=\"innerValue\" ', '                   ng-required=\"{{required}}\" ', '                   ng-keyUp=\"onTypeaheadKeyUp($event.keyCode)\" ', '                   typeahead-on-select=\"onTypeaheadSelection($item, $model, $label, $event)\" ', '                   uib-typeahead=\"opt.value as opt.label for opt in selectOptions | filter:{value:$viewValue} | limitTo:12\" ', '                   typeahead-min-length=\"0\" ', '                   typeahead-editable=\"false\">', '               <span class=\"indicators\">', '                   <span class=\"is-valid glyphicon glyphicon-ok-sign\"></span>', '                  <span class=\"is-invalid glyphicon glyphicon-exclamation-sign\"></span>', '              </span>', '           </div>', '          <span class=\"input-group-btn\">', '               <button type=\"button\" class=\"btn btn-default\" ', '                   ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"', '                   ng-click=\"cancel()\" title=\"Cancel changes\">', '                   <span class=\"glyphicon glyphicon-ban-circle\"></span>', '              </button>', '               <button type=\"button\" class=\"btn btn-default\" ', '                   ng-class=\"{disabled:!!error||!isDirty,\\'btn-lg\\':size===\\'large\\'}\"', '                   ng-disabled=\"{{!!error}}\" ', '                   ng-click=\"save()\" title=\"Save changes\">', '                  <span class=\"glyphicon glyphicon-ok\"></span>', '               </button>', '           </span>', '       </div>', '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>', '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>', '   </div>', '</div>'].join(' ');\n})(jQuery, angular);\n(function (angular) {\n\n    \"use strict\";\n\n    angular.module(\"gp-common\").directive('gpTweetButton', ['$timeout', function ($timeout) {\n\n        function debounce(func, wait, immediate) {\n            var timeout;\n            return function () {\n                var context = this,\n                    args = arguments;\n                var later = function later() {\n                    timeout = null;\n                    if (!immediate) func.apply(context, args);\n                };\n                var callNow = immediate && !timeout;\n                clearTimeout(timeout);\n                timeout = setTimeout(later, wait);\n                if (callNow) func.apply(context, args);\n            };\n        }\n\n        return {\n            link: function link(scope, element, attr) {\n\n                if (typeof twttr === 'undefined') {\n                    element.className += ' disabled';\n                    return;\n                }\n\n                var renderTwitterButton = debounce(function () {\n                    if (attr.url) {\n                        $timeout(function () {\n                            element[0].innerHTML = '';\n                            twttr.widgets.createShareButton(attr.url, element[0], function () {}, {\n                                count: attr.count,\n                                text: attr.text,\n                                via: attr.via,\n                                size: attr.size,\n                                hashtags: attr.hashtags,\n                                dnt: attr.dnt\n                            });\n                        });\n                    }\n                }, 75);\n                attr.$observe('url', renderTwitterButton);\n                attr.$observe('text', renderTwitterButton);\n            }\n        };\n    }]);\n})(angular);\n(function (angular) {\n\n    \"use strict\";\n\n    angular.module(\"gp-common\").directive('sortOrder', function () {\n        return {\n\n            replace: true,\n            require: 'ngModel',\n\n            template: ['<div>', '<a class=\"btn btn-default\" title=\"Click to sort in ascending order\" href ng-if=\"value===\\'dsc\\'\" ng-click=\"toggle()\">', '    <span class=\"glyphicon glyphicon-sort-by-attributes-alt\"></span>', '</a>', '<a class=\"btn btn-default\" title=\"Click to sort in descending order\" href ng-if=\"value===\\'asc\\'\" ng-click=\"toggle()\">', '    <span class=\"glyphicon glyphicon-sort-by-attributes\"></span>', '</a>', '</div>'].join(' '),\n\n            link: function link($scope, element, attrs, ngModel) {\n                ngModel.$viewChangeListeners.push(function () {\n                    $scope.$eval(attrs.ngChange);\n                });\n                ngModel.$render = function () {\n                    $scope.value = ngModel.$modelValue;\n                };\n                $scope.toggle = function () {\n                    $scope.value = $scope.value === 'asc' ? 'dsc' : 'asc';\n                    ngModel.$setViewValue($scope.value);\n                };\n            }\n        };\n    });\n})(angular);\n(function (angular) {\n\n    'use strict';\n\n    /** \n     * directive used in conjunction with ng-model to map arrays of strings\n     * to form field controls for editing.\n     *\n     * Usage:  <input ng-model=\"arrOfStr\" string-array-input></input>\n     *\n     */\n\n    angular.module('gp-common').directive('stringArrayInput', function () {\n        return {\n            restrict: 'A',\n            require: 'ngModel',\n            link: function link(scope, element, attr, ngModel) {\n\n                function fromInput(text) {\n                    var result = null;\n                    if (text && text.length) result = text.split(',').map(function (i) {\n                        return i.trim();\n                    });\n                    return result;\n                }\n\n                function toInput(arr) {\n                    var result = null;\n                    if (arr && typeof arr.push !== 'undefined') result = arr.join(', ');\n                    return result;\n                }\n\n                ngModel.$parsers.push(fromInput);\n                ngModel.$formatters.push(toInput);\n            }\n        };\n    });\n})(angular);\n(function (jQuery, angular) {\n\n    \"use strict\";\n\n    angular.module(\"gp-common\")\n\n    /**\n     * Custom filter to make label values visually helpful by \n     * replacing bad characters with spaces or meaningful equivalents\n     */\n    .filter('fixLabel', function () {\n        return function (value) {\n            if (!value || typeof value !== 'string' || !value.length) return 'Untitled';\n            var result = value.replace(/([a-z])([A-Z])/g, \"$1 $2\").replace(/_/g, \" \").trim();\n            return result.charAt(0).toUpperCase() + result.slice(1);\n        };\n    }).filter('pluralize', function () {\n        return function (text) {\n            if (!text || !text.length) return \"\";\n            if (text.endsWith('ss')) return text + 'es'; //classes, etc\n            if (text.endsWith('s')) return text; //already plural\n            return text + 's';\n            //TODO support irregular words like \"foot\" -> \"feet\"\n            // and words that need duplicate letters: \"quiz\" -> \"quizzes\"\n        };\n    }).filter('capitalize', function () {\n        return function (text) {\n            return text[0].toUpperCase() + text.substring(1);\n        };\n    }).filter('facets', function () {\n\n        return function (arr, facetName) {\n            if (!facetName) return arr;\n            if (!arr || !arr.length) return [];\n            return arr.filter(function (f) {\n                return f.toLowerCase().startsWith(facetName + \":\");\n            }).map(function (f) {\n                return f.substring(f.indexOf(':') + 1, f.length);\n            });\n        };\n    }).filter('joinBy', function () {\n        return function (input, delimiter, emptyValue) {\n            if (input && typeof input.push !== 'undefined' && input.length) return input.join(delimiter || ', ');else return emptyValue || '';\n        };\n    }).filter('defaultValue', function () {\n        return function (text, defVal) {\n            if (typeof text === 'undefined' || !text.length) return defVal;\n            return text;\n        };\n    }).filter('count', function () {\n        return function (input) {\n            if (typeof input !== 'undefined') {\n                if (typeof input.push === 'function') return input.length;\n                if ((typeof input === \"undefined\" ? \"undefined\" : _typeof(input)) === 'object') {\n                    if (typeof Object.keys !== 'undefined') {\n                        return Object.keys(input);\n                    }\n                }\n            }\n            return 0;\n        };\n    })\n\n    /**\n     *\n     */\n    .filter('gpObjTypeMapper', function () {\n        return function (str) {\n            if (!str || typeof str !== 'string' || str.length === 0) return str;\n\n            var name = str;\n\n            var idx = str.indexOf(\":\");\n            if (~idx) name = str.substring(idx + 1);\n\n            if ('VCard' === name) return 'Contact';\n            return name;\n        };\n    }).filter('gpReliabilityGrade', function () {\n\n        return function (arg) {\n\n            var o = arg;\n            if ((typeof o === \"undefined\" ? \"undefined\" : _typeof(o)) === 'object') {\n                if (o.statistics) o = o.statistics.reliability || null;else if (o.reliability) o = o.reliability;else o = null;\n            }\n\n            if (!isNaN(o)) {\n\n                o = o * 1;\n\n                if (o === null || typeof o === 'undefined') return 'X';else if (o > 90) return 'A';else if (o > 80) return 'B';else if (o > 70) return 'C';else if (o > 60) return 'D';else return 'F';\n\n                // if (value >= 97) letter = 'A+';\n                // else if (value >= 93) letter = 'A';\n                // else if (value >= 90) letter = 'A-';\n                // else if (value >= 87) letter = 'B+';\n                // else if (value >= 83) letter = 'B';\n                // else if (value >= 80) letter = 'B-';\n                // else if (value >= 77) letter = 'C+';\n                // else if (value >= 73) letter = 'C';\n                // else if (value >= 70) letter = 'C-';\n                // else if (value >= 67) letter = 'D+';\n                // else if (value >= 63) letter = 'D';\n                // else if (value >= 60) letter = 'D-';\n            }\n\n            return \"X\";\n        };\n    });\n})(jQuery, angular);\n\n(function (angular, Constants) {\n\n    'use strict';\n\n    var KGEditor = function () {\n        function KGEditor($rootScope, $element, KGFields, KGHelper) {\n            'ngInject';\n\n            _classCallCheck(this, KGEditor);\n\n            this.$rootScope = $rootScope;\n            this.$element = $element;\n            this.fields = KGFields.slice(0);\n            this.helper = KGHelper;\n        }\n\n        _createClass(KGEditor, [{\n            key: \"$onInit\",\n            value: function $onInit() {\n                this.displayOptions = {};\n                this.completion = 0;\n\n                this.service = this.helper.getService(this.ngModel.type);\n\n                this.descriptions = {\n                    purpose: 'The intended use or reason for the Object (i.e., layer, map, gallery) e.g., environmental impact of an oil spill.',\n                    'function': 'The business actions, activities, or tasks this Object is intended to support (i.e., the role it plays in supporting an activity).  e.g., environmental impact assessment.',\n                    audience: 'The group of people for which this Object was intended to be used. e.g., general public, disaster recovery personnel, Congress.',\n                    community: 'The GeoPlatform community this Object was produced for. e.g., \"Ecosystems and Biodiversity\" community',\n                    place: 'The central locale or common names for the place where the Subjects of the Object occur. e.g.,  USA/Gulf Coast',\n                    category: 'The type or category of the Object.  e.g., topographic map, elevation layer',\n                    primarySubject: 'The selected things, events, or concepts forming part of or represented by the Object. e.g., Deep Water Horizon oil rig, oil slick extent, oil slick movement over time, predicted oil slick movement, impacted sites, impact severity.',\n                    secondarySubject: 'Second-order subjects derived by machine processing/ analysis of the target Object',\n                    primaryTopic: 'The central branch of knowledge or theme pertaining to the thing, concept, situation, issue, or event of interest. e.g., environmental impact of oil spill.',\n                    secondaryTopic: 'Second-order topics derived by machine processing/ analysis of the target Object'\n                };\n\n                if (!this.ngModel.classifiers) this.ngModel.classifiers = {};\n\n                this.calculatePercentage();\n            }\n        }, {\n            key: \"$onDestroy\",\n            value: function $onDestroy() {\n                this.$rootScope = null;\n                this.ngModel = null;\n                this.helper = null;\n                this.fields = null;\n                this.service = null;\n            }\n\n            /**\n             * @param {string} property - name of KG property being modified\n             * @param {array[object]} values - new values to assign to the property (includes old values)\n             */\n\n        }, {\n            key: \"onChange\",\n            value: function onChange(property, values) {\n                // console.log(\"Changed \" + property + \" with \" + (values?values.length:0) + \" values\");\n                this.ngModel.classifiers[property] = values;\n                this.calculatePercentage();\n            }\n\n            /**\n             * @param {string} classifier - KG property whose value has been activated\n             * @param {object} value - selected value being activated\n             */\n\n        }, {\n            key: \"onValueClick\",\n            value: function onValueClick(classifier, value) {\n                if (this.onActivate) {\n                    this.onActivate({ classifier: classifier, value: value });\n                }\n            }\n\n            /**\n             *\n             */\n\n        }, {\n            key: \"calculatePercentage\",\n            value: function calculatePercentage() {\n                this.completion = this.helper.calculate(this.ngModel.classifiers);\n            }\n        }]);\n\n        return KGEditor;\n    }();\n\n    angular.module('gp-common-kg').component('kgEditor', {\n        require: {\n            // formCtrl: '^form', \n            ngModelCtrl: 'ngModel'\n        },\n        bindings: {\n            ngModel: '=', //object containing the KG\n            onActivate: '&' //function to invoke on KG item activation (click)\n        },\n        controller: KGEditor,\n        template: \"\\n            <div class=\\\"c-kg-editor\\\">\\n                <div class=\\\"c-kg-editor__header l-flex-container flex-justify-between flex-align-center\\\">\\n                    <div class=\\\"flex-1\\\">\\n                        <h4>Knowledge Graph</h4>\\n                        <div class=\\\"u-text--sm\\\">\\n                            Knowledge graphs (KGs) are formed from classifiers for several dimensions of GeoPlatform items \\n                            (layers, maps, galleries, etc), including <em>Purpose</em>, <em>Scope</em>, \\n                            <em>Fitness for Use</em>, and <em>Social Context</em>. \\n                            <br>\\n                            <br>\\n                            Knowledge graphs are used to answer questions about items, such as:\\n                            <ul>\\n                            <li>Why was the item created?</li>\\n                            <li>Why is it useful for others?</li>\\n                            <li>Why is it appropriate to be used?</li>\\n                            </ul>\\n                        </div>\\n                    </div>\\n                    <gp-progress-circle ng-model=\\\"$ctrl.completion\\\" class=\\\"u-mg-left--xlg u-mg-right--xlg\\\"></gp-progress-circle>\\n                </div>\\n\\n                <div class=\\\"c-kg-editor__content\\\">\\n\\n                    <div class=\\\"c-kg-editor__section\\\">\\n                        <h4 class=\\\"t-fg--accent\\\">Purpose</h4>\\n\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.purposes\\\"\\n                            on-change=\\\"$ctrl.onChange('purposes', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('purposes', value)\\\"\\n                            type=\\\"Purpose\\\"\\n                            label=\\\"Purpose\\\" \\n                            description=\\\"{{$ctrl.descriptions.purpose}}\\\">\\n                        </kg-section>\\n                    </div>\\n\\n\\n                    <div class=\\\"c-kg-editor__section\\\">\\n                        <h4 class=\\\"t-fg--accent\\\">Scope</h4>\\n\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.primaryTopics\\\"\\n                            on-change=\\\"$ctrl.onChange('primaryTopics', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('primaryTopics', value)\\\"\\n                            type=\\\"Topic\\\" \\n                            label=\\\"Primary Topics\\\" \\n                            description=\\\"{{$ctrl.descriptions.primaryTopic}}\\\">\\n                        </kg-section>\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.secondaryTopics\\\"\\n                            on-change=\\\"$ctrl.onChange('secondaryTopics', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('secondaryTopics', value)\\\"\\n                            type=\\\"Topic\\\" \\n                            label=\\\"Secondary Topics\\\" \\n                            description=\\\"{{$ctrl.descriptions.secondaryTopic}}\\\">\\n                        </kg-section>\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.primarySubjects\\\"\\n                            on-change=\\\"$ctrl.onChange('primarySubjects', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('primarySubjects', value)\\\"\\n                            type=\\\"Subject\\\" \\n                            label=\\\"Primary Subjects\\\" \\n                            description=\\\"{{$ctrl.descriptions.primarySubject}}\\\">\\n                        </kg-section>\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.secondarySubjects\\\"\\n                            on-change=\\\"$ctrl.onChange('secondarySubjects', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('secondarySubjects', value)\\\"\\n                            type=\\\"Subject\\\" \\n                            label=\\\"Secondary Subjects\\\" \\n                            description=\\\"{{$ctrl.descriptions.secondarySubject}}\\\">\\n                        </kg-section>\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.categories\\\"\\n                            on-change=\\\"$ctrl.onChange('categories', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('categories', value)\\\"\\n                            type=\\\"Category\\\" \\n                            label=\\\"Categories\\\" \\n                            description=\\\"{{$ctrl.descriptions.category}}\\\">\\n                        </kg-section>\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.communities\\\"\\n                            on-change=\\\"$ctrl.onChange('communities', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('communities', value)\\\"\\n                            type=\\\"Community\\\" \\n                            label=\\\"Communities\\\" \\n                            description=\\\"{{$ctrl.descriptions.community}}\\\">\\n                        </kg-section>\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.places\\\"\\n                            on-change=\\\"$ctrl.onChange('places', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('places', value)\\\"\\n                            type=\\\"Place\\\" \\n                            label=\\\"Places\\\" \\n                            description=\\\"{{$ctrl.descriptions.place}}\\\">\\n                        </kg-section> \\n                    </div> \\n\\n                    <div class=\\\"c-kg-editor__section\\\">\\n                        <h4 class=\\\"t-fg--accent\\\">Fitness for Use</h4>\\n\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.functions\\\"\\n                            on-change=\\\"$ctrl.onChange('functions', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('functions', value)\\\"\\n                            type=\\\"Function\\\" \\n                            label=\\\"Function\\\" \\n                            description=\\\"{{$ctrl.descriptions.function}}\\\">\\n                        </kg-section>\\n                    </div>\\n\\n                    <div class=\\\"c-kg-editor__section\\\">\\n                        <h4 class=\\\"t-fg--accent\\\">Social Context</h4>\\n\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.audiences\\\"\\n                            on-change=\\\"$ctrl.onChange('audiences', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('audiences', value)\\\"\\n                            type=\\\"Audience\\\" \\n                            label=\\\"Audiences\\\" \\n                            description=\\\"{{$ctrl.descriptions.audience}}\\\">\\n                        </kg-section>\\n                    </div>\\n\\n                </div>\\n            </div>\\n        \"\n    });\n})(angular, GeoPlatform);\n\n(function (angular, Constants) {\n\n    'use strict';\n\n    var SectionController = function () {\n        function SectionController($timeout, RecommenderService) {\n            'ngInject';\n\n            _classCallCheck(this, SectionController);\n\n            this.$timeout = $timeout;\n            // this.service = RecommenderService;\n        }\n\n        _createClass(SectionController, [{\n            key: \"$onInit\",\n            value: function $onInit() {\n                this.noResults = false;\n                this.query = '';\n                this.displayOptions = {\n                    fetching: false,\n                    showSuggested: false\n                };\n                this.paging = {\n                    start: 0,\n                    size: 5,\n                    sizeOptions: [5, 10, 20]\n                };\n                this.updateCache();\n\n                //default section description if one was not provided\n                if (!this.description) this.description = '<em>No description provided</em>';\n            }\n\n            /**\n             * Update cache when bound 'ngModel' is actually assigned in the component lifecycle\n             */\n\n        }, {\n            key: \"$onChanges\",\n            value: function $onChanges() {\n                this.updateCache();\n            }\n        }, {\n            key: \"$onDestroy\",\n            value: function $onDestroy() {\n                this.eventHandlers = null;\n                this.clearOptions();\n                this.selected = null;\n                this.service = null;\n                this.$timeout = null;\n            }\n\n            /**\n             * \n             * @param {object} item - selected value being activated (clicked on for navigation)\n             */\n\n        }, {\n            key: \"activate\",\n            value: function activate(item) {\n                if (this.onActivate) this.onActivate({ value: item });\n            }\n        }, {\n            key: \"on\",\n            value: function on(event, callback) {\n                this.eventHandlers = this.eventHandlers || {};\n                this.eventHandlers[event] = this.eventHandlers[event] || [];\n                this.eventHandlers[event].push(callback);\n            }\n        }, {\n            key: \"notify\",\n            value: function notify(event, data) {\n                if (!this.eventHandlers || !this.eventHandlers[event]) return;\n                angular.forEach(this.eventHandlers[event], function (handler) {\n                    try {\n                        handler(data);\n                    } catch (e) {}\n                });\n            }\n\n            /**\n             * @param {string} query - keywords provided by user input\n             * @return {Promise} resolving an array of results\n             */\n\n        }, {\n            key: \"fetchOptions\",\n            value: function fetchOptions(query) {\n                var _this4 = this;\n\n                //need this timeout or else 'this.query' isn't being \n                // seen as having the same value as 'query'\n                this.$timeout(function () {\n                    _this4.query = query;\n                }, 10);\n\n                this.displayOptions.fetching = true;\n                var params = {\n                    type: this.type,\n                    q: query,\n                    page: Math.floor(this.paging.start / this.paging.size),\n                    size: this.paging.size\n                };\n                // if(this.forType)\n                //     params['for'] = this.forType;\n\n                return this.service.query(params).$promise.then(function (response) {\n                    _this4.paging.total = response.totalResults;\n                    _this4.notify('gp:browse:suggestions:pagination', _this4.paging);\n                    _this4.suggested = response.results.map(function (result) {\n                        result._selected = _this4.isSelected(result);\n                        return result;\n                    });\n                    _this4.displayOptions.showSuggested = true;\n                    return _this4.suggested;\n                }).catch(function (e) {\n                    _this4.paging.total = 0;\n                    _this4.notify('gp:browse:suggestions:pagination', _this4.paging);\n                    _this4.suggested = [];\n                    return _this4.suggested;\n                }).finally(function () {\n                    return _this4.displayOptions.fetching = false;\n                });\n            }\n        }, {\n            key: \"clearQuery\",\n            value: function clearQuery() {\n                this.query = '';\n                this.fetchOptions(this.query);\n            }\n        }, {\n            key: \"clearOptions\",\n            value: function clearOptions() {\n\n                //clear query and available options\n                this.query = '';\n                this.suggested = null;\n\n                //reset paging\n                this.paging.start = 0;\n                this.paging.total = 0;\n                // this.notify('gp:browse:suggestions:pagination', this.paging);\n\n                //hide available options\n                this.displayOptions.showSuggested = false;\n            }\n\n            /**\n             * @param {integer} index - position in selected array of item removed\n             */\n\n        }, {\n            key: \"remove\",\n            value: function remove(index) {\n\n                var removed = this.ngModel[index].uri;\n                this.ngModel.splice(index, 1);\n\n                //remove from suggested list if one is populated (being shown)\n                if (this.suggested && this.suggested.length) {\n                    var found = this.suggested.find(function (it) {\n                        return it.uri === removed;\n                    });\n                    if (found) found._selected = false;\n                }\n                this.updateCache(); //update cache of selected ids\n\n                if (this.onChange) this.onChange({ values: this.ngModel }); //notify others of change\n            }\n\n            /**\n             * @param {object} value - item being checked for selection\n             * @return {boolean}\n             */\n\n        }, {\n            key: \"isSelected\",\n            value: function isSelected(value) {\n                return value._selected || ~this.selected.indexOf(value.uri);\n            }\n\n            /**\n             * @param {object} value - item being selected\n             */\n\n        }, {\n            key: \"selectValue\",\n            value: function selectValue(value) {\n                if (value._selected) return; //already selected\n\n                value._selected = true;\n\n                this.ngModel = this.ngModel || [];\n                this.ngModel.push(value);\n                this.updateCache();\n\n                if (this.onChange) this.onChange({ values: this.ngModel });\n            }\n        }, {\n            key: \"updateCache\",\n            value: function updateCache() {\n                this.selected = (this.ngModel || []).map(function (o) {\n                    return o.uri;\n                });\n            }\n        }, {\n            key: \"onDropdownToggled\",\n            value: function onDropdownToggled(open) {\n                if (!open) this.clearOptions();\n            }\n\n            /* -------- pagination methods ----------- */\n\n        }, {\n            key: \"getPagination\",\n            value: function getPagination() {\n                return this.paging;\n            }\n        }, {\n            key: \"start\",\n            value: function start(index) {\n                this.paging.start = index;\n                this.fetchOptions(this.query);\n            }\n        }, {\n            key: \"size\",\n            value: function size(value) {\n                this.paging.size = value;\n                this.fetchOptions(this.query);\n            }\n        }]);\n\n        return SectionController;\n    }();\n\n    angular.module('gp-common-kg').component('kgSection', {\n\n        bindings: {\n            ngModel: '<',\n            service: '<', //recommender service instance to use\n            label: '@',\n            description: '@',\n            type: '@', //type of KG property\n            onChange: '&?', //fire when value(s) change\n            onActivate: '&?' //fire when selected value link is clicked\n        },\n\n        controller: SectionController,\n\n        template: \"\\n            <h5>{{$ctrl.label}}</h5>\\n            <p class=\\\"u-text--sm\\\" ng-bind-html=\\\"$ctrl.description\\\"></p>\\n\\n            <div class=\\\"list-group list-group-sm\\\">\\n                <div ng-repeat=\\\"item in $ctrl.ngModel track by $index\\\" class=\\\"list-group-item\\\">\\n                    <button type=\\\"button\\\" class=\\\"btn btn-link\\\" ng-click=\\\"$ctrl.remove($index)\\\">\\n                        <span class=\\\"glyphicon glyphicon-remove-circle t-fg--danger\\\"></span> \\n                    </button>\\n                    <div class=\\\"flex-1 u-pd--md\\\">\\n                        <div class=\\\"u-pd-bottom--sm t-text--strong\\\">\\n                            <a ng-click=\\\"$ctrl.activate(item)\\\" ng-if=\\\"$ctrl.onActivate\\\"\\n                                 class=\\\"u-break--all\\\">{{item.label}}</a>\\n                            <span ng-if=\\\"!$ctrl.onActivate\\\">{{item.label}}</span>\\n                        </div>\\n                        <div class=\\\"u-text--sm t-text--italic\\\">\\n                            <a href=\\\"{{item.uri}}\\\" target=\\\"_blank\\\" class=\\\"u-break--all\\\"\\n                                title=\\\"Open source info in new window\\\">{{item.uri}}</a>\\n                        </div>\\n                        <div class=\\\"description\\\" ng-if=\\\"item.description\\\" ng-bind-html=\\\"item.description\\\"></div>\\n                    </div>\\n                </div>\\n            </div>\\n\\n            <div class=\\\"t-fg--gray-md\\\" ng-if=\\\"!$ctrl.ngModel.length\\\"><em>No values specified</em></div>            \\n\\n            <hr>\\n\\n            <div uib-dropdown is-open=\\\"$ctrl.displayOptions.showSuggested\\\" \\n                auto-close=\\\"outsideClick\\\" on-toggle=\\\"$ctrl.onDropdownToggled(open)\\\">\\n\\n                <div class=\\\"l-flex-container flex-justify-between flex-align-center\\\">\\n                    <div class=\\\"input-group-slick flex-1\\\">\\n                        <span class=\\\"glyphicon\\\"\\n                            ng-class=\\\"{'glyphicon-search':!$ctrl.displayOptions.fetching, 'glyphicon-hourglass spin':$ctrl.displayOptions.fetching}\\\"></span>\\n                        <input type=\\\"text\\\" class=\\\"form-control\\\" \\n                            ng-model=\\\"$ctrl.query\\\" \\n                            ng-model-options=\\\"{ debounce: 250 }\\\"\\n                            ng-change=\\\"$ctrl.fetchOptions($ctrl.query)\\\"\\n                            placeholder=\\\"Find values to add...\\\">\\n                    </div>\\n                </div>\\n                \\n                <div class=\\\"dropdown-menu\\\" uib-dropdown-menu>\\n                    \\n                    <div class=\\\"form-group l-flex-container flex-justify-between flex-align-center\\\">\\n                        <div class=\\\"input-group-slick flex-1\\\">\\n                            <span class=\\\"glyphicon\\\"\\n                                ng-class=\\\"{'glyphicon-search':!$ctrl.displayOptions.fetching, 'glyphicon-hourglass spin':$ctrl.displayOptions.fetching}\\\"></span>\\n                            <input type=\\\"text\\\" class=\\\"form-control\\\" \\n                                ng-model=\\\"$ctrl.query\\\" \\n                                ng-model-options=\\\"{ debounce: 250 }\\\"\\n                                ng-change=\\\"$ctrl.fetchOptions($ctrl.query)\\\"\\n                                placeholder=\\\"Find values to add...\\\">\\n                            <span class=\\\"glyphicon glyphicon-remove\\\"\\n                                ng-if=\\\"$ctrl.query.length\\\"\\n                                ng-click=\\\"$event.stopPropagation();$ctrl.clearQuery()\\\"></span>\\n                        </div>\\n                        <button type=\\\"button\\\" class=\\\"btn btn-info u-mg-left--xlg animated-show\\\"\\n                            ng-click=\\\"$ctrl.clearOptions();\\\">\\n                            Done\\n                        </button>\\n                    </div>\\n                    \\n                    <gp-pagination service=\\\"$ctrl\\\" event-key=\\\"suggestions\\\" use-select=\\\"true\\\"></gp-pagination>\\n\\n                    <div class=\\\"list-group list-group-sm u-text--sm\\\">\\n                        <div ng-repeat=\\\"item in $ctrl.suggested track by $index\\\" class=\\\"list-group-item\\\">\\n                            <button type=\\\"button\\\" class=\\\"btn btn-link\\\" ng-click=\\\"$ctrl.selectValue(item)\\\"\\n                                ng-class=\\\"{disabled:item._selected}\\\">\\n                                <span class=\\\"glyphicon glyphicon-ok t-fg--gray-md\\\" ng-show=\\\"item._selected\\\"></span> \\n                                <span class=\\\"glyphicon glyphicon-plus-sign t-fg--success\\\" ng-show=\\\"!item._selected\\\"></span> \\n                            </button>\\n                            <div class=\\\"flex-1 u-pd--md\\\">\\n                                <div class=\\\"u-break--all t-text--strong u-pd-bottom--sm\\\">{{item.prefLabel}}</div>\\n                                <a href=\\\"{{item.uri}}\\\" target=\\\"_blank\\\" \\n                                    class=\\\"u-break--all u-text--sm t-text--italic\\\"\\n                                    title=\\\"Open source info in new window\\\">\\n                                    {{item.uri}}\\n                                </a>\\n                                <div class=\\\"description\\\">{{item.description||\\\"No description provided\\\"}}</div>\\n                            </div>\\n                        </div>\\n                        <div ng-if=\\\"!$ctrl.suggested.length\\\" class=\\\"list-group-item disabled u-pd--md\\\">\\n                            No results match your query\\n                        </div>\\n                    </div>\\n                </div>\\n            </div>\\n        \"\n    });\n})(angular, GeoPlatform);\n\n(function (angular) {\n\n    'use strict';\n\n    angular.module('gp-common').component('createdByFilter', {\n\n        bindings: {\n            service: '<' //service filtering by\n        },\n\n        controller: function controller(AuthenticationService) {\n\n            this.$onInit = function () {\n                var _this5 = this;\n\n                this.value = null; //input from user for \"created by\" value\n                this.collapse = true; //hide show controls\n                this.limitToUser = false; //filter using current user\n                this.modelOptions = {\n                    'updateOn': 'default blur',\n                    'debounce': {\n                        'default': 250,\n                        'blur': 0\n                    }\n                };\n\n                AuthenticationService.getUserQ().then(function (user) {\n                    _this5.username = user ? user.username : null;\n                });\n            };\n\n            this.$onDestroy = function () {\n                this.value = null;\n                this.collapse = null;\n                this.limitToUser = null;\n                this.username = null;\n            };\n\n            this.filter = function () {\n                var value = this.limitToUser ? this.username : this.value;\n                if (typeof value !== 'undefined' && value !== null && value.trim().length === 0) value = null; //don't accept empty strings\n                this.service.setCreatedBy(value, true);\n            };\n\n            this.toggleLimitToUser = function () {\n                this.limitToUser = !this.limitToUser;\n                this.filter();\n            };\n\n            this.clear = function () {\n                this.value = null;\n                this.filter();\n            };\n        },\n        template: \"\\n            <div class=\\\"card\\\">\\n                <h5 class=\\\"card-title l-flex-container flex-justify-between flex-align-center\\\">\\n                    <span class=\\\"flex-1\\\">Filter by Author</span>\\n                    <button type=\\\"button\\\" class=\\\"btn btn-sm btn-link\\\"\\n                        title=\\\"{{$ctrl.collapse?'Expand':'Collapse'}}\\\"\\n                        ng-click=\\\"$ctrl.collapse = !$ctrl.collapse\\\">\\n                        <span class=\\\"glyphicon\\\" ng-class=\\\"{'glyphicon-chevron-up':!$ctrl.collapse,'glyphicon-chevron-down':$ctrl.collapse}\\\"></span>\\n                    </button>\\n                </h5>\\n                <div class=\\\"card-content\\\" ng-hide=\\\"$ctrl.collapse\\\">\\n\\n                    <div class=\\\"input-group-slick\\\">\\n                        <span class=\\\"glyphicon glyphicon-user\\\"></span>\\n                        <input type=\\\"text\\\" class=\\\"form-control\\\" placeholder=\\\"Specify author username\\\"\\n                            ng-disabled=\\\"$ctrl.limitToUser\\\"\\n                            ng-model=\\\"$ctrl.value\\\"\\n                            ng-model-options=\\\"$ctrl.modelOptions\\\"\\n                            ng-change=\\\"$ctrl.filter()\\\">\\n                        <span class=\\\"glyphicon glyphicon-remove\\\" title=\\\"Clear author\\\"\\n                            ng-if=\\\"$ctrl.value.length&&!$ctrl.limitToUser\\\" ng-click=\\\"$ctrl.clear()\\\"></span>\\n                    </div>\\n\\n                    <label class=\\\"control-label u-text--sm text-muted u-pd-top--sm\\\" ng-if=\\\"$ctrl.username\\\">\\n                        <input type=\\\"checkbox\\\" ng-model=\\\"$ctrl.limitToUser\\\" ng-change=\\\"$ctrl.filter()\\\">\\n                        Only show my maps\\n                    </label>\\n                </div>\\n            </div>\\n        \"\n    });\n})(angular);\n\n(function (angular, Constants) {\n\n    'use strict';\n\n    var PUBLISHER_FACET = 'publishers';\n\n    angular.module('gp-common').component('publisherFilter', {\n        bindings: {\n            name: '@', //name of this filter parameter,\n            service: \"<\"\n        },\n        controller: function controller($http) {\n\n            this.$onInit = function () {\n                this.collapse = true;\n                this.updateValues();\n            };\n\n            this.$onDestroy = function () {\n                this.values = null;\n            };\n\n            this.hasSelections = function () {\n                return (this.service.getAgencies() || []).length;\n            };\n\n            this.isSelected = function (value) {\n                var selected = this.service.getAgencies() || [];\n                return ~selected.indexOf(value.id);\n            };\n\n            this.toggle = function (value) {\n                var selected = this.service.getAgencies() || [];\n                var idx = selected.indexOf(value.id);\n                if (idx >= 0) selected.splice(idx, 1);else selected.push(value.id);\n                this.service.setAgencies(selected);\n            };\n\n            this.clear = function () {\n                var selected = this.service.getAgencies() || [];\n                if (!selected || !selected.length) this.collapse = !this.collapse; //toggle collapsed state\n                else this.service.setAgencies([]);\n            };\n\n            this.getCount = function (value) {\n                var facet = this.service.getFacet(PUBLISHER_FACET);\n                if (!facet) return '';\n                var valObj = facet.buckets.find(function (v) {\n                    return v.label === value.id;\n                });\n                if (!valObj) return '';\n                return valObj.count;\n            };\n\n            this.updateValues = function (query) {\n                var _this6 = this;\n\n                return $http.get(Constants.ualUrl + '/api/items', {\n                    params: {\n                        type: 'org:Organization',\n                        sort: 'label,asc',\n                        q: query,\n                        size: 20,\n                        bust: new Date().getTime()\n                    }\n                }).then(function (response) {\n\n                    var total = response.data.totalResults;\n                    var newValues = response.data.results.slice(0);\n                    _this6.additionalValueCount = total - newValues.length;\n\n                    var selections = _this6.service.getAgencies();\n                    if (selections && selections.length && _this6.values && _this6.values.length) {\n                        var existing = _this6.values.filter(function (v) {\n                            //find existing values that are selected\n                            return ~selections.indexOf(v.id) &&\n                            // but not in new set of values\n                            !newValues.filter(function (nv) {\n                                return nv.id === v.id;\n                            }).length;\n                        });\n                        newValues = existing.concat(newValues);\n                    }\n\n                    _this6.values = newValues;\n                }, function (response) {\n                    console.log(\"(\" + response.status + \") \" + response.statusText);\n                });\n            };\n        },\n        template: \"\\n            <div class=\\\"card\\\">\\n                <h5 class=\\\"card-title l-flex-container flex-justify-between flex-align-center\\\">\\n                    <span class=\\\"flex-1\\\">Filter by Publisher(s)</span>\\n                    <button type=\\\"button\\\" class=\\\"btn btn-sm btn-link\\\"\\n                        title=\\\"{{$ctrl.collapse?'Expand':'Collapse'}}\\\"\\n                        ng-click=\\\"$ctrl.collapse = !$ctrl.collapse\\\">\\n                        <span class=\\\"glyphicon\\\" ng-class=\\\"{'glyphicon-chevron-up':!$ctrl.collapse,'glyphicon-chevron-down':$ctrl.collapse}\\\"></span>\\n                    </button>\\n                </h5>\\n                <div class=\\\"card-content\\\">\\n                    <div class=\\\"c-facets\\\" ng-class=\\\"{'is-collapsed':$ctrl.collapse}\\\">\\n\\n                        <div class=\\\"c-facet__value\\\">\\n                            <div class=\\\"input-group-slick\\\">\\n                                <input name=\\\"scheme-typeahead\\\" type=\\\"text\\\" class=\\\"form-control\\\"\\n                                    ng-model=\\\"$ctrl.typeaheadValue\\\"\\n                                    ng-change=\\\"$ctrl.updateValues($ctrl.typeaheadValue)\\\"\\n                                    ng-model-options=\\\"{debounce:200}\\\"\\n                                    placeholder=\\\"Search by name\\\">\\n                                <span class=\\\"glyphicon glyphicon-remove\\\"\\n                                    title=\\\"Clear query\\\"\\n                                    ng-if=\\\"$ctrl.typeaheadValue.length\\\"\\n                                    ng-click=\\\"$ctrl.updateValues($ctrl.typeaheadValue=null)\\\">\\n                                </span>\\n                            </div>\\n                        </div>\\n\\n                        <a class=\\\"c-facet__value\\\" ng-click=\\\"$ctrl.clear()\\\"\\n                            ng-class=\\\"{active:!$ctrl.hasSelections()}\\\">\\n                            <span class=\\\"glyphicon\\\"\\n                                ng-class=\\\"{'glyphicon-check':!$ctrl.hasSelections(), 'glyphicon-unchecked t-fg--gray-lt':$ctrl.hasSelections()}\\\">\\n                            </span>\\n                            Any Publisher\\n                        </a>\\n                        <a  ng-repeat=\\\"value in $ctrl.values track by $index\\\"\\n                            class=\\\"c-facet__value\\\"\\n                            ng-click=\\\"$ctrl.toggle(value)\\\"\\n                            ng-class=\\\"{active:$ctrl.isSelected(value)}\\\">\\n\\n                            <span class=\\\"badge pull-right\\\">{{$ctrl.getCount(value)}}</span>\\n                            <span class=\\\"glyphicon\\\"\\n                                ng-class=\\\"{'glyphicon-check':$ctrl.isSelected(value),'glyphicon-unchecked t-fg--gray-lt':!$ctrl.isSelected(value)}\\\"></span>\\n                            {{value.label}}\\n                        </a>\\n                        <div class=\\\"c-facet__value t-fg--gray-md\\\"\\n                            ng-if=\\\"$ctrl.additionalValueCount\\\">\\n                            <em>plus {{$ctrl.additionalValueCount}} more options</em>\\n                        </div>\\n                    </div>\\n                </div>\\n            </div>\\n        \"\n    });\n})(angular, GeoPlatform);\n\n(function (angular) {\n\n    'use strict';\n\n    var PARAMETER = \"concepts\";\n\n    var RecommendedTermFilter = function () {\n        function RecommendedTermFilter($timeout, RecommenderService) {\n            'ngInject';\n\n            _classCallCheck(this, RecommendedTermFilter);\n\n            this.termService = RecommenderService;\n            this.$timeout = $timeout;\n        }\n\n        _createClass(RecommendedTermFilter, [{\n            key: \"$onInit\",\n            value: function $onInit() {\n                this.displayOpts = {\n                    fetching: false,\n                    empty: false,\n                    collapse: false,\n                    suggest: false\n                };\n                this.values = [];\n                this.suggested = [];\n                this.termQuery = null;\n                this.paging = {\n                    start: 0,\n                    size: 5,\n                    sizeOptions: [5, 10, 20]\n                };\n            }\n        }, {\n            key: \"$onDestroy\",\n            value: function $onDestroy() {\n                this.$timeout = null;\n                this.displayOpts = null;\n                this.values = null;\n                this.suggested = null;\n                this.service = null;\n                this.termService = null;\n                this.termQuery = null;\n                this.paging = null;\n                this.eventHandlers = null;\n            }\n\n            /* ----------------- typeahead methods ------------------ */\n            // onSelection ($item, $model, $label, $event) {\n            //     this.values.push($model);   //append selection to list\n            //     this.termQuery = null;      //clear the typeahead field\n            //     this.update();\n            // }\n            //\n            // getOptions (text) {\n            //\n            //     this.displayOpts.fetching = true;\n            //     this.displayOpts.empty = false;\n            //\n            //     let params = {\n            //         q:text,\n            //         size:12\n            //     };\n            //     if(this.type)\n            //         params['for'] = this.type;\n            //\n            //     return this.termService.query(params).$promise\n            //     .then( response => {\n            //         let results = response.results;\n            //         this.displayOpts.empty = !results.length;\n            //         return results;\n            //     })\n            //     .catch( e => {\n            //         this.displayOpts.empty = true;\n            //         console.log(\"Error finding semantic terms: \" + e.message);\n            //     })\n            //     .finally( () => {\n            //         this.displayOpts.fetching = false;\n            //     });\n            // }\n\n\n        }, {\n            key: \"hideSuggested\",\n            value: function hideSuggested() {\n                this.displayOpts.suggest = this.displayOpts.fetching = this.displayOpts.empty = false;\n                this.termQuery = null;\n                this.suggested = [];\n                this.paging.start = this.paging.total = 0;\n            }\n        }, {\n            key: \"select\",\n            value: function select(item) {\n                item._selected = true; //update status to show it's already _selected\n                this.values.push(item); //append selection to list\n                this.update(); //update overall browse query with new selection\n            }\n        }, {\n            key: \"getOptions\",\n            value: function getOptions() {\n                var _this7 = this;\n\n                var text = this.termQuery;\n                // console.log(\"Querying using '\" + text + \"'\");\n\n                //if empty value was provided, don't search.\n                if (!text || !text.length) {\n                    this.suggested = [];\n                    // this.suggestedTotal = this.suggestedCount = 0;\n                    this.paging.start = this.paging.total = 0;\n                    this.notify('gp:browse:suggestions:pagination', this.paging);\n                    // this.displayOpts.suggest = false;\n                    return;\n                }\n\n                //reset variables\n                this.suggested = [];\n                // this.suggestedTotal = this.suggestedCount = 0;\n                this.displayOpts.suggest = true;\n                this.displayOpts.fetching = true;\n                this.displayOpts.empty = false;\n\n                var params = {\n                    q: text,\n                    page: Math.floor(this.paging.start / this.paging.size),\n                    size: this.paging.size\n                };\n                if (this.type) params['for'] = this.type;\n\n                this.termService.query(params).$promise.then(function (response) {\n                    var results = response.results;\n                    _this7.displayOpts.empty = !results.length;\n                    _this7.suggested = results.map(function (result) {\n                        result._selected = _this7.isSelected(result);\n                        return result;\n                    });\n                    _this7.paging.total = response.totalResults;\n                    _this7.notify('gp:browse:suggestions:pagination', _this7.paging);\n                }).catch(function (e) {\n                    _this7.displayOpts.empty = true;\n                    _this7.suggested = [];\n                    _this7.paging.total = 0;\n                    _this7.notify('gp:browse:suggestions:pagination', _this7.paging);\n                    console.log(\"Error finding semantic terms: \" + e.message);\n                }).finally(function () {\n                    _this7.displayOpts.fetching = false;\n                    // this.displayOpts.suggest = true;\n                });\n            }\n        }, {\n            key: \"hasSelections\",\n            value: function hasSelections() {\n                return this.values.length;\n            }\n        }, {\n            key: \"isSelected\",\n            value: function isSelected(item) {\n                return this.values.filter(function (v) {\n                    return v.uri === item.uri;\n                }).length;\n            }\n        }, {\n            key: \"removeValue\",\n            value: function removeValue(index) {\n                if (this.values.length >= index) {\n                    var removed = this.values.splice(index, 1)[0]; //remove from selected\n                    this.update(); //update overall browse query\n\n                    //update associated item in suggested list (if visible)\n                    if (this.suggested.length) {\n                        var match = this.suggested.find(function (i) {\n                            return i.uri === removed.uri;\n                        });\n                        if (match) match._selected = false;\n                    }\n                }\n            }\n        }, {\n            key: \"clear\",\n            value: function clear() {\n                this.values = [];\n                this.update();\n            }\n        }, {\n            key: \"update\",\n            value: function update() {\n                var value = this.values.length ? this.values.map(function (v) {\n                    return v.uri;\n                }) : null;\n                this.service.applyOption(PARAMETER, value, true);\n            }\n\n            /* -------- pagination methods ----------- */\n\n        }, {\n            key: \"on\",\n            value: function on(event, callback) {\n                this.eventHandlers = this.eventHandlers || {};\n                this.eventHandlers[event] = this.eventHandlers[event] || [];\n                this.eventHandlers[event].push(callback);\n            }\n        }, {\n            key: \"notify\",\n            value: function notify(event, data) {\n                var _this8 = this;\n\n                if (!this.$timeout || !this.eventHandlers || !this.eventHandlers[event]) return;\n                this.$timeout(function () {\n                    angular.forEach(_this8.eventHandlers[event], function (handler) {\n                        try {\n                            handler(data);\n                        } catch (e) {}\n                    });\n                }, 100);\n            }\n        }, {\n            key: \"getPagination\",\n            value: function getPagination() {\n                return this.paging;\n            }\n        }, {\n            key: \"start\",\n            value: function start(index) {\n                this.paging.start = index;\n                this.getOptions();\n            }\n        }, {\n            key: \"size\",\n            value: function size(value) {\n                this.paging.size = value;\n                this.getOptions();\n            }\n        }]);\n\n        return RecommendedTermFilter;\n    }();\n\n    angular.module('gp-common').component('recommendedTermFilter', {\n        bindings: {\n\n            //type of object being searched (ie, Layer, Map)\n            type: '@',\n\n            //BrowseObjectService the filter will affect\n            service: \"<\"\n        },\n\n        controller: RecommendedTermFilter,\n\n        template: \"\\n            <div class=\\\"card c-filter__recommended-terms\\\">\\n\\n                <h5 class=\\\"card-title l-flex-container flex-justify-between flex-align-center\\\">\\n\\n                    Filter using Semantic Concepts\\n\\n                    <button type=\\\"button\\\" class=\\\"btn btn-sm btn-link\\\"\\n                        title=\\\"{{$ctrl.displayOpts.collapse?'Expand':'Collapse'}}\\\"\\n                        ng-click=\\\"$ctrl.displayOpts.collapse = !$ctrl.displayOpts.collapse\\\">\\n                        <span class=\\\"glyphicon\\\"\\n                            ng-class=\\\"{'glyphicon-chevron-up':!$ctrl.displayOpts.collapse,'glyphicon-chevron-down':$ctrl.displayOpts.collapse}\\\"></span>\\n                    </button>\\n                </h5>\\n\\n                <div class=\\\"c-facets\\\" ng-class=\\\"{'is-collapsed':$ctrl.displayOpts.collapse}\\\">\\n\\n                    <!--\\n                    <div class=\\\"c-facet__value\\\">\\n\\n                        <div class=\\\"input-group-slick\\\">\\n                            <input name=\\\"termQuery\\\" type=\\\"text\\\" class=\\\"form-control\\\"\\n                              ng-model=\\\"$ctrl.termQuery\\\"\\n                              typeahead-on-select=\\\"$ctrl.onSelection($item, $model, $label, $event)\\\"\\n                              uib-typeahead=\\\"opt as ' (' + opt.context + ') ' + opt.label for opt in $ctrl.getOptions($viewValue)\\\"\\n                              typeahead-loading=\\\"$ctrl.displayOpts.fetching\\\"\\n                              typeahead-no-results=\\\"$ctrl.displayOpts.empty\\\"\\n                              ng-model-options=\\\"{ debounce: 250 }\\\"\\n                              typeahead-min-length=\\\"2\\\"\\n                              typeahead-editable=\\\"false\\\"\\n                              placeholder=\\\"Find a concept\\\">\\n                            <span class=\\\"glyphicon glyphicon-hourglass spin\\\" ng-if=\\\"$ctrl.displayOpts.fetching\\\"></span>\\n                        </div>\\n\\n                        <div ng-show=\\\"$ctrl.displayOpts.empty\\\">No Results Found</div>\\n\\n                    </div>\\n                    -->\\n\\n                    <div ng-hide=\\\"$ctrl.displayOpts.collapse\\\">\\n\\n                        <div class=\\\"input-group-slick\\\">\\n                            <span class=\\\"glyphicon\\\"\\n                                ng-class=\\\"{'glyphicon-search':!$ctrl.displayOpts.fetching, 'glyphicon-hourglass spin':$ctrl.displayOpts.fetching}\\\"></span>\\n                            <input type=\\\"text\\\" class=\\\"form-control\\\"\\n                                ng-model=\\\"$ctrl.termQuery\\\"\\n                                ng-model-options=\\\"{ debounce: 250 }\\\"\\n                                ng-change=\\\"$ctrl.getOptions()\\\"\\n                                placeholder=\\\"Find concepts\\\">\\n                            <span class=\\\"glyphicon glyphicon-remove\\\" ng-if=\\\"$ctrl.displayOpts.suggest\\\"\\n                                ng-click=\\\"$ctrl.hideSuggested()\\\"></span>\\n                        </div>\\n\\n                        <gp-pagination service=\\\"$ctrl\\\" event-key=\\\"suggestions\\\" use-select=\\\"true\\\"\\n                            ng-if=\\\"$ctrl.displayOpts.suggest\\\">\\n                        </gp-pagination>\\n\\n                        <div class=\\\"list-group list-group-sm u-text--sm\\\"\\n                            ng-if=\\\"$ctrl.displayOpts.suggest && !$ctrl.displayOpts.fetching\\\">\\n\\n                            <a ng-repeat=\\\"item in $ctrl.suggested track by $index\\\"\\n                                class=\\\"list-group-item\\\"\\n                                ng-class=\\\"{disabled:item._selected}\\\"\\n                                ng-click=\\\"$ctrl.select(item)\\\">\\n                                <span class=\\\"u-break--all t-text--strong u-pd-bottom--sm\\\">{{item.prefLabel}}</span>\\n                                <br>\\n                                <span class=\\\"u-break--all u-text--sm t-text--italic\\\">{{item.uri}}</span>\\n                            </a>\\n\\n                            <div ng-if=\\\"$ctrl.displayOpts.empty\\\" class=\\\"list-group-item disabled u-pd--md\\\">\\n                                No concepts found\\n                            </div>\\n\\n                        </div>\\n\\n                    </div>\\n\\n\\n                    <!-- selected terms -->\\n                    <div ng-repeat=\\\"term in $ctrl.values\\\" class=\\\"c-facet__value active\\\"\\n                        title=\\\"Remove this term from the query\\\"\\n                        ng-click=\\\"$ctrl.removeValue($index)\\\">\\n\\n                        <div class=\\\"u-break--all t-text--strong u-pd-bottom--sm\\\">\\n                            <span class=\\\"glyphicon glyphicon-check\\\"></span>\\n                            {{term.prefLabel}}\\n                        </div>\\n                        <div class=\\\"u-break--all u-text--sm t-text--italic\\\">{{term.uri}}</div>\\n                    </div>\\n\\n                </div>\\n\\n            </div>\\n        \"\n    });\n})(angular);\n\n(function (angular) {\n\n    'use strict';\n\n    angular.module('gp-common').component('similarityFilter', {\n        bindings: {\n\n            //type of object being searched (ie, Layer, Map)\n            type: '@',\n\n            //BrowseObjectService the filter will affect\n            service: \"<\",\n\n            //optional, id of current map (if one exists)\n            mapId: '@'\n        },\n        controller: function controller() {\n\n            this.$onInit = function () {\n                var _this9 = this;\n\n                this.collapse = true;\n                this.value = null;\n                this.useMap = false;\n\n                var evtName = this.service.events.SIMILARITY;\n                this.listener = this.service.on(evtName, function (event, layer) {\n                    _this9.value = layer;\n                    _this9.service.applyOption('similarTo', _this9.value.id, true);\n                });\n\n                if (!this.type) this.type = \"item\";\n            };\n\n            this.$onDestroy = function () {\n                this.listener(); //dispose of listener\n                this.collapse = null;\n                this.value = null;\n                this.service = null;\n                this.mapId = null;\n            };\n\n            this.hasSelections = function () {\n                return !!this.value;\n            };\n\n            this.clearValue = function () {\n\n                if (this.useMap) {\n                    this.useMap = false;\n                    this.service.applyOption('similarTo', this.value.id, true);\n                } else {\n                    this.value = null;\n                    this.service.applyOption('similarTo', null, true);\n                }\n            };\n\n            this.toggleCurrentMap = function (bool) {\n\n                if (this.useMap) {\n                    //if already using map, stop\n                    this.useMap = false;\n\n                    if (this.value) {\n                        this.service.applyOption('similarTo', this.value.id, true);\n                    } else {\n                        this.service.applyOption('similarTo', false, true);\n                    }\n                } else {\n                    this.useMap = true;\n                    this.service.applyOption('similarTo', this.mapId, true);\n                }\n            };\n        },\n        template: \"\\n            <div class=\\\"card\\\" ng-if=\\\"$ctrl.value\\\">\\n\\n                <h5 class=\\\"card-title\\\">Find Similar</h5>\\n                <div class=\\\"card-content\\\">\\n\\n                    <p class=\\\"u-text--sm\\\">Searching for {{$ctrl.type}}s similar to the following: </p>\\n\\n                    <div class=\\\"c-facets\\\">\\n\\n                        <a class=\\\"c-facet__value\\\" ng-if=\\\"$ctrl.value\\\" ng-click=\\\"$ctrl.clearValue()\\\">\\n                            <span class=\\\"glyphicon glyphicon-remove-circle\\\"></span>\\n                            {{$ctrl.value.label}}\\n                        </a>\\n\\n                        <!--\\n                        <a ng-if=\\\"$ctrl.mapId\\\" class=\\\"c-facet__value\\\"\\n                            ng-click=\\\"$ctrl.toggleCurrentMap()\\\" ng-class=\\\"{active:$ctrl.useMap}\\\">\\n                            <span class=\\\"glyphicon glyphicon-check\\\" ng-show=\\\"$ctrl.useMap\\\"></span>\\n                            <span class=\\\"glyphicon glyphicon-unchecked\\\" ng-show=\\\"!$ctrl.useMap\\\"></span>\\n                            Find similar to my current map\\n                        </a>\\n                        -->\\n\\n                    </div>\\n\\n                    <br>\\n                    <p class=\\\"u-text--sm\\\">Note that query filters below are still being applied.</p>\\n\\n                </div>\\n            </div>\\n        \"\n    });\n})(angular);\n\n(function (angular, Constants) {\n\n    'use strict';\n\n    /*\n        <themes-filter></themes-filter>\n     */\n\n    angular.module('gp-common').component('themeFilter', {\n        bindings: {\n            name: '@', //name of this filter parameter\n            service: '<'\n        },\n        controller: function controller($http) {\n\n            this.$onInit = function () {\n                this.collapse = true;\n                this.updateValues();\n            };\n\n            this.$onDestroy = function () {\n                this.values = null;\n                this.service = null;\n            };\n\n            this.hasSelections = function () {\n                return (this.service.getThemes() || []).length;\n            };\n\n            this.isSelected = function (value) {\n                var themes = this.service.getThemes() || [];\n                return ~themes.indexOf(value.id);\n            };\n\n            this.toggle = function (value) {\n                var themes = this.service.getThemes() || [];\n                var idx = themes.indexOf(value.id);\n                if (idx >= 0) themes.splice(idx, 1);else themes.push(value.id);\n                this.service.setThemes(themes);\n            };\n\n            this.clear = function () {\n                var themes = this.service.getThemes() || [];\n                if (!themes || !themes.length) this.collapse = !this.collapse; //toggle collapsed state\n                else this.service.setThemes([]);\n            };\n\n            this.getCount = function (value) {\n                var facet = this.service.getFacet('themes');\n                if (!facet) return '';\n                var valObj = facet.buckets.find(function (v) {\n                    return v.label === value.id;\n                });\n                if (!valObj) return '';\n                return valObj.count;\n            };\n\n            this.updateValues = function (query) {\n                var _this10 = this;\n\n                return $http.get(Constants.ualUrl + '/api/items', {\n                    params: {\n                        type: 'skos:Concept',\n                        'scheme.label': 'NGDA Portfolio Themes',\n                        fields: 'scheme',\n                        size: 9999, //must return all\n                        sort: 'label,asc',\n                        bust: new Date().getTime()\n                    }\n                }).then(function (response) {\n                    // let total = response.data.totalResults;\n                    _this10.values = response.data.results.slice(0);\n                }, function (response) {\n                    console.log(\"(\" + response.status + \") \" + response.statusText);\n                }).catch(function (e) {\n                    console.log(\"Error fetching NGDA Themes: \" + e.message);\n                });\n            };\n        },\n        template: \"\\n            <div class=\\\"card c-browse-filter\\\">\\n                <h5 class=\\\"card-title l-flex-container flex-justify-between flex-align-center\\\">\\n                    Filter by NGDA Themes\\n                    <button type=\\\"button\\\" class=\\\"btn btn-sm btn-link\\\"\\n                        title=\\\"{{$ctrl.collapse?'Expand':'Collapse'}}\\\"\\n                        ng-click=\\\"$ctrl.collapse = !$ctrl.collapse\\\">\\n                        <span class=\\\"glyphicon\\\" ng-class=\\\"{'glyphicon-chevron-up':!$ctrl.collapse,'glyphicon-chevron-down':$ctrl.collapse}\\\"></span>\\n                    </button>\\n                </h5>\\n                <div class=\\\"card-content\\\">\\n                    <div class=\\\"c-facets\\\" ng-class=\\\"{'is-collapsed':$ctrl.collapse}\\\">\\n                        <a class=\\\"c-facet__value\\\" ng-click=\\\"$ctrl.clear()\\\"\\n                            ng-class=\\\"{active:!$ctrl.hasSelections()}\\\">\\n                            <span class=\\\"glyphicon\\\"\\n                                ng-class=\\\"{'glyphicon-check':!$ctrl.hasSelections(), 'glyphicon-unchecked t-fg--gray-lt':$ctrl.hasSelections()}\\\">\\n                            </span>\\n                            Any Theme\\n                        </a>\\n                        <a ng-repeat=\\\"theme in $ctrl.values track by $index\\\"\\n                            class=\\\"c-facet__value\\\" ng-click=\\\"$ctrl.toggle(theme)\\\"\\n                            ng-class=\\\"{active:$ctrl.isSelected(theme)}\\\">\\n                                <span class=\\\"badge pull-right\\\">{{$ctrl.getCount(theme)}}</span>\\n                                <span class=\\\"glyphicon\\\"\\n                                    ng-class=\\\"{'glyphicon-check':$ctrl.isSelected(theme),'glyphicon-unchecked t-fg--gray-lt':!$ctrl.isSelected(theme)}\\\"></span>\\n                                {{theme.label}}\\n                            </a>\\n                        </div>\\n                    </div>\\n                </div>\\n            </div>\\n        \"\n    });\n})(angular, GeoPlatform);\n\n(function (angular, Constants) {\n\n    \"use strict\";\n\n    //fields list sent to MDR in order to have these properties for display in search results\n\n    var FIELDS = ['created', 'modified', 'publishers', 'themes', 'description', 'extent'];\n\n    //facets list sent to MDR in order to get aggregation numbers\n    var FACETS = ['types', 'themes', 'publishers', 'serviceTypes', 'schemes', 'visibility', 'createdBy'];\n\n    var SORT_OPTIONS = [{ value: \"label,asc\", label: \"Name (A-Z)\" }, { value: \"label,desc\", label: \"Name (Z-A)\" }, { value: \"type,asc\", label: \"Type (A-Z)\" }, { value: \"type,desc\", label: \"Type (Z-A)\" }, { value: \"modified,desc\", label: \"Most recently modified\" }, { value: \"modified,asc\", label: \"Least recently modified\" }, { value: \"_score,desc\", label: \"Relevance\" }];\n\n    //list of _options variables for mapping to parameters\n    var VAR_TYPES = 'types';\n    var VAR_THEMES = 'themes';\n    var VAR_PUBLISHERS = 'publishers';\n    var VAR_USER = 'user';\n    var VAR_CREATED_BY = 'createdBy';\n    var VAR_SERVICE_TYPES = 'serviceTypes';\n    var VAR_SCHEMES = 'schemes';\n    var VAR_VISIBILITY = \"visibility\";\n    var VAR_QUERY = 'query';\n    var VAR_EXTENT = 'extent';\n    var VAR_MODIFIED_BEFORE = 'modified.max';\n    var VAR_MODIFIED_AFTER = 'modified.min';\n\n    //parameter names for various query constraints used in requests to MDR for results\n    var PARAMETER_TYPE = 'type';\n    var PARAMETER_THEME = 'theme.id';\n    var PARAMETER_PUBLISHER = 'publisher.id';\n    var PARAMETER_CREATED_BY = 'createdBy';\n    var PARAMETER_CONTRIBUTED_BY = 'contributedBy';\n    var PARAMETER_CREATOR = 'creator.id';\n    var PARAMETER_SVC_TYPE = 'serviceType.id';\n    var PARAMETER_IN_SCHEME = 'scheme.id';\n    var PARAMETER_VISIBILITY = 'visibility';\n    var PARAMETER_QUERY = 'q';\n    var PARAMETER_EXTENT = 'bbox';\n    var PARAMETER_MODIFIED_BEFORE = 'modified.max';\n    var PARAMETER_MODIFIED_AFTER = 'modified.min';\n    // const PARAMETER_CONTRIBUTOR     = 'contributor.id';\n\n\n    var PARAM_OPTIONS = [{ option: VAR_TYPES, parameter: PARAMETER_TYPE }, { option: VAR_THEMES, parameter: PARAMETER_THEME }, { option: VAR_PUBLISHERS, parameter: PARAMETER_PUBLISHER }, { option: VAR_USER, parameter: PARAMETER_CREATOR }, { option: VAR_CREATED_BY, parameter: PARAMETER_CREATED_BY }, { option: VAR_SERVICE_TYPES, parameter: PARAMETER_SVC_TYPE }, { option: VAR_SCHEMES, parameter: PARAMETER_IN_SCHEME }, { option: VAR_VISIBILITY, parameter: PARAMETER_VISIBILITY }, { option: VAR_QUERY, parameter: PARAMETER_QUERY }, { option: VAR_EXTENT, parameter: PARAMETER_EXTENT }, { option: VAR_MODIFIED_BEFORE, parameter: PARAMETER_MODIFIED_BEFORE }, { option: VAR_MODIFIED_AFTER, parameter: PARAMETER_MODIFIED_AFTER }];\n\n    var PAGE_SIZE_BASE_10 = [10, 20, 50, 100];\n    var PAGE_SIZE_BASE_12 = [12, 24, 48, 96];\n\n    /**\n     *\n     *\n     */\n    function BrowseObjectsService($rootScope, $timeout, $resource, options) {\n\n        /* -------- private data ----------- */\n\n        var url = options && options.url ? options.url + \"/:id\" : Constants.ualUrl + '/api/items/:id';\n\n        var eventKey = 'gp:browse:' + (options && options.key ? options.key : 'objects') + \":\";\n\n        var svc = $resource(url, { id: '@id' }, {\n            query: {\n                isArray: false\n            }\n        });\n\n        var _pageSizeBase = PAGE_SIZE_BASE_10.slice(0);\n        if (options && options.pageSizeBase && options.pageSizeBase === 12) _pageSizeBase = PAGE_SIZE_BASE_12.slice(0);\n\n        var _options = {\n            start: 0,\n            size: _pageSizeBase[0],\n            total: 0,\n            sort: options && options.sort ? options.sort : \"modified,desc\",\n            facets: {}\n        };\n\n        //list of field names to request in response\n        var _fields = options && options.fields ? options.fields : FIELDS.slice(0);\n\n        //list of facet names to request\n        var _requestFacets = options && options.facets ? options.facets : FACETS.slice(0);\n\n        var _facets = [];\n        var _selectedFacets = [];\n\n        var _results = [];\n\n        var _dirtyPromise = null;\n\n        var _isLoading = false;\n\n        var _selected = [];\n\n        var _onSelectFn = options && options.onSelect ? options.onSelect : null;\n\n        /**\n         *\n         */\n        function notify(eventName, arg) {\n            // console.log(\"Notifying of \" + eventName + \" with \" + arg);\n            $rootScope.$broadcast(eventName, arg);\n        }\n\n        /**\n         * when marked as dirty, debounce for rapid fire events like onKeyUp\n         */\n        function dirty(delay, resetStart) {\n\n            var doReset = typeof resetStart === 'undefined' || resetStart === true;\n\n            if (_dirtyPromise) $timeout.cancel(_dirtyPromise);\n            _dirtyPromise = $timeout(function () {\n                _dirtyPromise = null;\n                _doUpdate(doReset);\n            }, delay || 100);\n        }\n\n        /**\n         *\n         */\n        function _doUpdate(resetStart) {\n\n            if (resetStart) _options.start = 0;\n\n            _isLoading = true;\n            notify(eventKey + 'querying');\n\n            var params = {};\n\n            // -------- QUERY FILTERS --------\n\n            //create a temporary options object\n            var opts = angular.copy(_options);\n\n            //apply options as parameters\n            angular.forEach(PARAM_OPTIONS, function (po) {\n                var name = po.parameter;\n                var value = opts[po.option];\n\n                var isSet = value !== null && typeof value !== 'undefined';\n                var isArr = isSet && typeof value.push !== 'undefined';\n\n                if (isSet && (!isArr || value.length)) {\n                    params[name] = isArr ? value.join(',') : value;\n                } else {\n                    delete params[name];\n                }\n                delete opts[po.option]; //remove from temp opts\n            });\n\n            //apply remaining options to query\n            // these are not keyed with specific parameters (ie, custom params)\n            angular.forEach(opts, function (value, name) {\n                if (value !== null && typeof value !== 'undefined') {\n                    var isArr = typeof value.push !== 'undefined';\n                    params[name] = isArr ? value.join(',') : value;\n                } else {\n                    //make sure it doesn't get sent if no value provided\n                    delete params[name];\n                }\n            });\n\n            // -------- QUERY FILTERS --------\n\n\n            var arr = [];\n            for (var k in _options.facets) {\n                if (_options.facets.hasOwnProperty(k)) {\n                    //encode commas in facet name since it's used to separate multiple\n                    // facet values\n                    arr.push(k + \":\" + _options.facets[k].replace(/,/g, '%2C'));\n                }\n            }\n            _selectedFacets = arr;\n\n            var start = _options.start;\n            if (isNaN(start)) start = 0;else start = start * 1;\n\n            params.page = Math.floor(start / _options.size);\n            params.size = _options.size;\n            params.sort = _options.sort;\n\n            if (arr.length) params.facets = arr.join(',');\n\n            //prevent CORS cache bug in Chrome\n            params.bust = new Date().getTime();\n\n            //request facets\n            params.includeFacet = _requestFacets.join(',');\n\n            //request fields\n            params.fields = _fields.join(',');\n\n            svc.query(params).$promise.then(function (response) {\n\n                _results = response.results;\n                _facets = response.facets || [];\n\n                //auto select objects if user has marked it as selected previously\n                // this is needed to maintain selections across pagination pages\n                _selected.each(function (id) {\n                    var map = _results.find(function (map) {\n                        return map._id === id;\n                    });\n                    if (map) map.selected = true;\n                });\n\n                //will trigger update on pagination directive\n                _options.total = response.totalResults;\n\n                _isLoading = false;\n                notify(eventKey + 'results');\n                notify(eventKey + 'pagination');\n            }).catch(function (response) {\n                _isLoading = false;\n\n                //fallback\n                var obj = { error: \"An Error Occurred\", message: \"No details provided\"\n\n                    //http response error\n                };if (response && response.data) obj = response.data;\n                //normal error\n                else if (response && response.message) obj = response;\n\n                //serialized json\n                if (typeof obj === 'string') {\n                    try {\n                        obj = JSON.parse(obj);\n                    } catch (e) {\n                        obj.message = \"Bad response from server\";\n                    }\n                }\n\n                var error = {\n                    label: obj.error || \"An Error Occurred\",\n                    message: obj.message || \"No details provided\"\n                };\n                notify(eventKey + 'error', error);\n            });\n        }\n\n        function setOption(name, value, fire) {\n            _options[name] = value;\n            if (typeof fire === 'undefined' || !!fire) {\n                var delay = 500;\n                if (value === null || value === undefined) delay = 0;\n                if (value && typeof value.push !== 'undefined' && value.length) delay = 0; //arrays\n                else if (value && value.length) delay = 0; //strings\n                dirty(delay);\n            }\n        }\n\n        /* ------------ public api ------------- */\n\n        return {\n\n            events: {\n                LOADING: eventKey + 'querying',\n                RESULTS: eventKey + 'results',\n                PAGINATION: eventKey + 'pagination',\n                SELECTED: eventKey + 'selected',\n                ERROR: eventKey + 'error',\n                SELECTED_ADDED: eventKey + 'selected:added',\n                SELECTED_REMOVED: eventKey + 'selected:removed',\n                SIMILARITY: eventKey + 'similarTo'\n            },\n\n            /**\n             * @return {bool}\n             */\n            getLoadingStatus: function getLoadingStatus() {\n                return _isLoading;\n            },\n\n            /**\n             * NOTE: Make sure event names are prefixed with\n             *  eventKey + ''\n             * @param {string} eventName\n             * @param {function} listener\n             */\n            on: function on(eventName, listener) {\n                // if(eventName.indexOf(eventKey + \":\") !== 0)\n                //     eventName = eventKey + '' + eventName;\n                return $rootScope.$on(eventName, listener);\n            },\n\n            /**\n             * @param {string} eventName\n             * @param {*} args\n             */\n            trigger: function trigger(eventName, args) {\n                notify(eventName, args);\n            },\n\n            /**\n             * @return {array[object]}\n             */\n            getResults: function getResults() {\n                return _results;\n            },\n\n            /**\n             * @return {array[string]} list of facet names\n             */\n            getFacetNames: function getFacetNames() {\n                return FACETS.slice(0);\n            },\n\n            /**\n             * @return {object} in form of <facet>: [<values>]\n             */\n            getFacets: function getFacets() {\n                return _facets;\n            },\n\n            /**\n             * @param {string} name\n             * @return {object|null}\n             */\n            getFacet: function getFacet(name) {\n                if (_facets) {\n                    return _facets.find(function (facet) {\n                        return facet.name === name;\n                    });\n                }\n                return null;\n            },\n\n            addFacet: function addFacet(name) {\n                _requestFacets.push(name);\n            },\n\n            applyConstraints: function applyConstraints(obj) {\n                // _options[VAR_QUERY] = obj.query;\n                // _options[VAR_TYPES] = obj.types;\n                // _options[VAR_THEMES] = obj.themes;\n                // _options[VAR_PUBLISHERS] = obj.publishers;\n                // _options[VAR_USER] = obj.user;\n                // _options[VAR_CREATED_BY] = obj.createdBy;\n                // _options[VAR_SERVICE_TYPES] = obj.serviceTypes;\n                // _options[VAR_SCHEMES] = obj.schemes;\n                // _options[VAR_VISIBILITY] = obj.visibility;\n                // //do we need to set extent here too?\n\n                for (var p in obj) {\n                    if (obj.hasOwnProperty(p)) {\n                        _options[p] = obj[p];\n                    }\n                }\n\n                _doUpdate(true);\n            },\n\n            applyOption: function applyOption(key, value, fire) {\n                setOption(key, value, fire);\n            },\n\n            applyOptions: function applyOptions(opts, fire) {\n                angular.forEach(opts, function (value, key) {\n                    setOption(key, value, false);\n                });\n                if (fire) _doUpdate(true);\n            },\n\n            /**\n             * @param {string} text - free text query\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setQuery: function setQuery(text, fireUpdate) {\n                setOption(VAR_QUERY, text, fireUpdate);\n            },\n\n            /**\n             * @param {array[string]} types - name of class(es) to request\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setTypes: function setTypes(types, fireUpdate) {\n                setOption(VAR_TYPES, types, fireUpdate);\n            },\n\n            getTypes: function getTypes() {\n                return _options[VAR_TYPES];\n            },\n\n            /**\n             * @param {string} userId - identifier of user\n             * @param {boolean} fireUpdate -\n             */\n            setUser: function setUser(userId, fireUpdate) {\n                setOption(VAR_USER, userId, fireUpdate);\n            },\n\n            /**\n             * @param {array[string]} creators - ids of creators\n             * @param {boolean} fireUpdate -\n             */\n            setCreatedBy: function setCreatedBy(creators, fireUpdate) {\n                setOption(VAR_CREATED_BY, creators, fireUpdate);\n            },\n\n            /**\n             * @param {array[string]} themes - name of class(es) to request\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setThemes: function setThemes(themes, fireUpdate) {\n                setOption(VAR_THEMES, themes, fireUpdate);\n            },\n\n            getThemes: function getThemes() {\n                return _options[VAR_THEMES];\n            },\n\n            /**\n             * @param {array[string]} publishers - name of class(es) to request\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setAgencies: function setAgencies(publishers, fireUpdate) {\n                setOption(VAR_PUBLISHERS, publishers, fireUpdate);\n            },\n\n            getAgencies: function getAgencies() {\n                return _options[VAR_PUBLISHERS];\n            },\n\n            /**\n             * @param {array[string]} svcTypes - ids\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setServiceTypes: function setServiceTypes(svcTypes, fireUpdate) {\n                setOption(VAR_SERVICE_TYPES, svcTypes, fireUpdate);\n            },\n\n            getServiceTypes: function getServiceTypes() {\n                return _options[VAR_SERVICE_TYPES];\n            },\n\n            /**\n             * @param {array[string]} schemes - ids\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setSchemes: function setSchemes(schemes, fireUpdate) {\n                setOption(VAR_SCHEMES, schemes, fireUpdate);\n            },\n\n            /**\n             * @param {string} visibility - one of 'public' or 'private'\n             * @param {boolean} fireUpdate\n             */\n            setVisibility: function setVisibility(visibility, fireUpdate) {\n                setOption(VAR_VISIBILITY, visibility, fireUpdate);\n            },\n\n            /**\n             * @param {Date} date - date to compare against\n             * @param {boolean} beforeOrAfter - flag specifying which boundary condition (true = before, false = after)\n             * @param {boolean} fireUpdate - flag specifying whether to trigger update automatically\n             */\n            setModified: function setModified(date, beforeOrAfter, fireUpdate) {\n\n                //if no date was supplied, consider it \"unset\" for both properties\n                if (!date) {\n                    setOption(VAR_MODIFIED_BEFORE, null, false);\n                    setOption(VAR_MODIFIED_AFTER, null, true);\n                    return;\n                }\n\n                var dir = beforeOrAfter && (beforeOrAfter === true || beforeOrAfter === \"true\");\n                var prop = dir ? VAR_MODIFIED_BEFORE : VAR_MODIFIED_AFTER; //property being set\n                var oppProp = dir ? VAR_MODIFIED_AFTER : VAR_MODIFIED_BEFORE; //unset opposite property\n                var arg = date && date.getTime ? date.getTime() : date;\n\n                setOption(oppProp, null, false);\n                setOption(prop, arg, true);\n            },\n\n            getModified: function getModified() {\n                return this._options[VAR_MODIFIED_BEFORE] || this._options[VAR_MODIFIED_AFTER];\n            },\n\n            /**\n             * @param {string} bboxStr - form of \"minx,miny,maxx,maxy\"\n             * @param {boolean} fireUpdate\n             */\n            setExtent: function setExtent(bboxStr) {\n                setOption(VAR_EXTENT, bboxStr, true);\n            },\n\n            /**\n             * @return {string} bbox string or null if not set\n             */\n            getExtent: function getExtent() {\n                return _options[VAR_EXTENT];\n            },\n\n            /**\n             * @return {array} list of selected items from current search results\n             */\n            getSelected: function getSelected() {\n                return _selected;\n            },\n\n            /**\n             * @param {array} arr - list of items to select in current search results\n             */\n            setSelected: function setSelected(arr) {\n                _selected = arr;\n                notify(this.events.SELECTED, _selected);\n            },\n\n            /**\n             * @param {string} id - identifier of item in current search results to add to selected list\n             */\n            select: function select(id) {\n\n                var finder = function finder(l) {\n                    return l.id === id;\n                };\n\n                var existing = _selected.find(finder);\n                if (existing) {\n                    //already selected, deselect it\n\n                    var idx = _selected.indexOf(existing);\n                    if (idx >= 0) {\n                        _selected.splice(idx, 1);\n                        notify(eventKey + 'selected:removed', existing);\n                    }\n                } else {\n                    //not selected, select it\n\n                    var obj = _results.find(finder);\n                    if (obj) {\n\n                        if (_onSelectFn) {\n                            _onSelectFn(id, function (err, item) {\n                                if (item) {\n                                    _selected.unshift(item);\n                                    notify(eventKey + 'selected:added', item);\n                                }\n                            });\n                        } else {\n                            _selected.unshift(obj);\n                            notify(eventKey + 'selected:added', obj);\n                        }\n                    }\n                }\n\n                notify(this.events.SELECTED, _selected);\n            },\n\n            /**\n             * @param {string} id - identifier of item to check\n             * @return {boolean} true if selected, false otherwise\n             */\n            isSelected: function isSelected(id) {\n                return _selected.find(function (obj) {\n                    return obj.id === id;\n                });\n            },\n\n            /**\n             * select all items in current page of results\n             */\n            selectAll: function selectAll() {\n                var _this11 = this;\n\n                angular.forEach(_results, function (obj) {\n                    if (!_this11.isSelected(obj.id)) _selected.unshift(obj);\n                });\n                notify(this.events.SELECTED, _selected);\n            },\n\n            /**\n             * empty list of selected items\n             */\n            clearSelected: function clearSelected() {\n                _selected = [];\n                notify(this.events.SELECTED, []);\n            },\n\n            /**\n             *\n             */\n            clear: function clear(refresh) {\n\n                for (var prop in _options) {\n                    if (!_options.hasOwnProperty(prop)) continue;\n                    if ('start' === prop) _options[prop] = 0;else if ('size' === prop) {} else if ('sort' === prop) _options[prop] = 'modified,desc';else if ('facets' === prop) _options[prop] = {};else _options[prop] = null;\n                }\n\n                if (refresh || typeof refresh === 'undefined') _doUpdate(true);\n            },\n\n            /*\n             * @param {string} category - name of facet\n             * @param {string} value - value of facet\n             */\n            setFacet: function setFacet(category, value) {\n\n                var f = _options.facets[category];\n                if (!f) //this facet category not set yet\n                    _options.facets[category] = value;else {\n                    //this facet category already set\n                    if (f === value) {\n                        //this facet value already set\n                        //unset it\n                        delete _options.facets[category];\n                    } else {\n                        //this facet value not set\n                        //set it\n                        _options.facets[category] = value;\n                    }\n                }\n\n                _doUpdate(true);\n            },\n\n            /**\n             * @param {array[string]} fields - list of field names to request for each search result\n             */\n            setFields: function setFields(fields) {\n                if (fields && typeof fields.push !== 'undefined') _fields = fields;\n            },\n\n            /**\n             * @param {int} start - beginning index of results to request\n             * @param {bool} andUpdate - trigger update (default is true)\n             */\n            start: function start(_start, andUpdate) {\n                _options.start = _start;\n                if (andUpdate && andUpdate === true) _doUpdate(false);\n            },\n\n            /**\n             * @param {int} size - page size to request\n             * @param {bool} andUpdate - trigger update (default is true)\n             */\n            size: function size(_size, andUpdate) {\n\n                _options.size = _size;\n\n                //find out which page in the new scheme the current first-result of current page\n                // will show up in, and set start so that it shows up with the new page size\n                var page = Math.floor(_options.start * 1 / _options.size * 1);\n                _options.start = page * (_options.size * 1);\n\n                if (andUpdate && andUpdate === true) _doUpdate(false);\n            },\n\n            /**\n             * @param {int} size - number of items to return in each page of results\n             */\n            pageSize: function pageSize(size) {\n                this.size(size, true);\n            },\n\n            /**\n             * @param {string} sort - form of <field>,<dir>\n             */\n            sort: function sort(_sort) {\n                _options.sort = _sort;\n                _doUpdate(false);\n            },\n\n            /**\n             * return {object} containing start index, page size, and total results\n             */\n            getPagination: function getPagination() {\n                return {\n                    start: _options.start,\n                    size: _options.size,\n                    pageSize: _options.size,\n                    total: _options.total,\n                    sizeOptions: _pageSizeBase\n                };\n            },\n\n            /**\n             * @return {array} list of key-value pairs of sort options\n             */\n            getSortOptions: function getSortOptions() {\n                return SORT_OPTIONS.slice(0);\n            },\n\n            /**\n             * @return {string} sorting parameter (field,order)\n             */\n            getSortValue: function getSortValue() {\n                return _options.sort;\n            },\n\n            /**\n             * @return {object} clone of the current set of query options\n             */\n            getQueryOptions: function getQueryOptions() {\n                return jQuery.extend({}, _options);\n            },\n\n            /**\n             *\n             */\n            hasQueryOptions: function hasQueryOptions() {\n                var result = false;\n                for (var k in _options) {\n                    if (_options.hasOwnProperty(k)) {\n\n                        if ('start' === k || 'size' === k || 'total' === k || 'sort' === k || 'order' === k || 'within' === k || 'facets' === k) continue;\n\n                        if (_selectedFacets.length) result = true;\n\n                        if (typeof _options[k] !== 'undefined' && _options[k] !== null) {\n                            result = true;\n                        }\n                    }\n                }\n                return result;\n            },\n\n            /**\n             * Triggers a refresh of current search results\n             * @param {boolean} resetStart - reset 'start' to 0 flag\n             */\n            update: function update(resetStart) {\n                dirty(0, resetStart);\n            },\n\n            reset: function reset() {\n                _options = {\n                    start: 0,\n                    size: _pageSizeBase[0],\n                    total: 0,\n                    sort: \"modified,desc\", order: \"asc\",\n                    facets: {}\n                };\n\n                _facets = [];\n                _selectedFacets = [];\n                _results = [];\n                _isLoading = false;\n                _selected = [];\n\n                if (_dirtyPromise) $timeout.cancel(_dirtyPromise);\n                _dirtyPromise = null;\n            },\n\n            destroy: function destroy() {\n                if (_dirtyPromise) $timeout.cancel(_dirtyPromise);\n            }\n        };\n    }\n\n    /**\n     * Factory for creating instances of BrowseObjectsService\n     */\n    function BrowseServiceFactory($rootScope, $timeout, $resource) {\n\n        return function (options) {\n            var svc = BrowseObjectsService($rootScope, $timeout, $resource, options);\n            if (options && options.params) svc.applyOptions(options.params);\n            return svc;\n        };\n    }\n\n    angular.module('gp-common')\n\n    //generic browse service\n    .service(\"BrowseObjectsService\", ['$rootScope', '$timeout', '$resource', BrowseObjectsService])\n\n    //factory for creating specific browse services\n    .factory(\"BrowseServiceFactory\", ['$rootScope', '$timeout', '$resource', 'BrowseObjectsService', BrowseServiceFactory]);\n\n    /*\n        Example of how to use the factory to customize a service\n    \n        //layer-specific browse service\n        .service('BrowseLayerObjService', ['BrowseServiceFactory', function(BrowseServiceFactory) {\n            let service = BrowseServiceFactory({\n                key: 'layers',\n                url: Constants.ualUrl + '/api/layers'\n            });\n    \n            //add custom methods here\n    \n            return service;\n        }])\n    */\n})(angular, GeoPlatform);\n\n(function (angular) {\n\n    'use strict';\n\n    /* *********************************************\n     * Requires socket.io be in the global namespace\n     * tested with version 2.x\n     * ********************************************* */\n\n    /*\n       Usage:\n        let service = ...\n        let svcId = service.getId();\n        //listen to events from the server\n       service.on('testing', (event) => { \n           if(event.clientId === svcId) return; //ignore our own events\n           ... do something ...\n       });\n       \n       //sends out a message to others\n       service.emit( service.events.CREATED, 'test');\n        //sends out a message to others\n       service.begin(service.events.EDITING, 'test');\n        //sends out a message to others\n       service.end(service.events.EDITING, 'test');\n        //stop listening and close the socket\n       service.close();\n      */\n\n    /**\n     *\n     */\n\n    var SocketService = function () {\n        function SocketService(url, options) {\n            'ngInject';\n\n            var _this12 = this;\n\n            _classCallCheck(this, SocketService);\n\n            var opts = (typeof options === \"undefined\" ? \"undefined\" : _typeof(options)) === 'object' ? options : {};\n            for (var key in opts) {\n                this[key] = opts[key];\n            }this.socket = null;\n\n            //list of ids of things being tracked, such as \n            // items edited, in order to send messages\n            // about the things lifecycle\n            this.tracking = {};\n\n            //events supported.\n            // Note that lifecycles can be added by using the \n            // begin() and end() methods on the service,\n            // which appends '_start' and '_end' respectively\n            this.events = {\n                CREATED: 'created',\n                UPDATED: 'updated',\n                DELETED: 'deleted',\n                EDITING: 'editing',\n                STATUS: 'status'\n            };\n\n            if (typeof io === 'undefined') {\n                console.log(\"Socket.IO not found in global namespace\");\n                return;\n            }\n\n            if (!url) {\n                //TODO validate URL with regex?\n                console.log(\"No web socket URL configured for this app to communicate with\");\n                return;\n            }\n\n            //make connection\n            this.socket = io.connect(url);\n\n            //listen for the init event indicating connection has been made\n            // and to get the socket's id from the server\n            this.socket.on(\"init\", function (evt) {\n                _this12.socketId = evt.id;\n            });\n\n            //if unable to connect\n            this.socket.on('error', function () {\n                console.log(\"Unable to connect to \" + url + \" with websockets\");\n            });\n        }\n\n        /**\n         *\n         */\n\n\n        _createClass(SocketService, [{\n            key: \"getId\",\n            value: function getId() {\n                return this.socketId;\n            }\n\n            /**\n             * @param {string} eventName\n             * @param {Function} callback\n             * @return {Function} to remove the listener\n             */\n\n        }, {\n            key: \"on\",\n            value: function on(eventName, callback) {\n                var _this13 = this;\n\n                if (!this.socket) return function () {};\n                //add the listener to the socket\n                this.socket.on(eventName, callback);\n                //return an 'off' function to remove the listener\n                return function () {\n                    _this13.socket.off(eventName, callback);\n                };\n            }\n\n            /**\n             *\n             */\n\n        }, {\n            key: \"emit\",\n            value: function emit(eventName, data, callback) {\n                if (!this.socket) return;\n                this.socket.emit(eventName, data, callback);\n            }\n\n            /**\n             * Closes this service's socket\n             */\n\n        }, {\n            key: \"close\",\n            value: function close() {\n                var _this14 = this;\n\n                //if this app was tracking an obj, \n                // notify listeners that it is no longer\n                for (var event in this.tracking) {\n                    if (this.tracking.hasOwnProperty(event)) {\n                        var tracks = this.tracking[event];\n                        if (tracks && tracks.length) {\n                            /* jshint ignore:start */\n                            angular.forEach(tracks, function (id) {\n                                _this14.end(event, id);\n                            });\n                            /* jshint ignore:end */\n                        }\n                    }\n                }\n\n                if (this.socket) {\n                    this.socket.close();\n                    this.socket = null;\n                }\n\n                return null;\n            }\n\n            /**\n             * @param {string} event - name of the event being started\n             * @param {string} objId - identifier of the item being tracked\n             */\n\n        }, {\n            key: \"begin\",\n            value: function begin(event, objId) {\n                var _this15 = this;\n\n                this.tracking[event] = this.tracking[event] || [];\n                this.tracking[event].push(objId);\n\n                var room = objId + \"_\" + event.toLowerCase();\n\n                this.join(room, function () {\n                    _this15.socket.emit(event, room, _this15.socketId, true);\n                });\n            }\n\n            /**\n             * @param {string} event - name of the event being ended\n             * @param {string} objId - identifier of the item being tracked\n             */\n\n        }, {\n            key: \"end\",\n            value: function end(event, objId) {\n                var _this16 = this;\n\n                this.tracking[event] = this.tracking[event] || [];\n                if (!this.tracking[event].length) return; //empty, ignore request\n\n                var idx = this.tracking[event].indexOf(objId);\n                if (idx < 0) //not found, ignore request\n\n                    //remove tracker\n                    this.tracking[event].splice(idx, 1);\n\n                //send event to server about client stopping it's tracking\n                var room = objId + \"_\" + event.toLowerCase();\n                this.socket.emit(event, room, this.socketId, false, function () {\n                    _this16.leave(room);\n                });\n            }\n\n            /**\n             *\n             */\n\n        }, {\n            key: \"join\",\n            value: function join(objId, callback) {\n                this.emit('join', objId, callback);\n            }\n\n            /**\n             *\n             */\n\n        }, {\n            key: \"leave\",\n            value: function leave(objId, callback) {\n                this.emit('leave', objId, callback);\n            }\n        }]);\n\n        return SocketService;\n    }();\n\n    /** \n     * Factory to get a Service used to listen for WebSocket messages from a server\n     *\n     * Usage: \n     *\n     * let wsUrl = ...\n     * let service = SocketServiceFactory(wsUrl);\n     *\n     */\n\n\n    angular.module('gp-common').factory('SocketServiceFactory', function ($rootScope, $window, UUID) {\n\n        var cache = {};\n\n        //disconnect whenever the app is closed\n        var onClose = function onClose(e) {\n            for (var key in cache) {\n                if (cache.hasOwnProperty(key)) {\n                    cache[key].close();\n                    cache[key] = null;\n                }\n            }\n            cache = null;\n            return null;\n        };\n\n        //needed for reload/backbtn\n        if ($window.onbeforeunload === 'function') {\n            var existing = $window.onbeforeunload;\n            $window.onbeforeunload = function (e) {\n                onClose(e);\n                return existing(e);\n            };\n        } else {\n            $window.onbeforeunload = onClose;\n        }\n\n        $rootScope.$on('$destroy', onClose);\n        //-------------------\n\n\n        return function (url) {\n\n            // if(!url) return null;\n            // if(cache[url]) return cache[url];\n\n            var cacheRef = UUID();\n            var service = new SocketService(url, $rootScope, { cacheRef: cacheRef });\n            var closeDelegate = service.close;\n            service.close = function () {\n                var id = service.cacheRef;\n                closeDelegate.call(service); //have service disconnect and clean up itself\n                //then clean up cache reference\n                delete cache[id];\n            };\n\n            var onDelegate = service.on;\n            service.on = function (event, callback) {\n\n                if (typeof callback === 'function') {\n                    //have to use old-school refs instead of arrow functions\n                    // or else the arguments get scrambled\n                    var handle = function handle() {\n                        var args = arguments;\n                        $rootScope.$apply(function () {\n                            callback.apply(service.socket, args);\n                        });\n                    };\n                    return onDelegate.call(service, event, handle);\n                } else {\n                    return onDelegate.call(service, event);\n                }\n            };\n\n            var emitDelegate = service.emit;\n            service.emit = function (event, data, callback) {\n\n                if (typeof callback === 'function') {\n                    //have to use old-school refs instead of arrow functions\n                    // or else the arguments get scrambled\n                    var handle = function handle() {\n                        var args = arguments;\n                        $rootScope.$apply(function () {\n                            callback.apply(service.socket, args);\n                        });\n                    };\n                    emitDelegate.call(service, event, data, handle);\n                } else {\n                    emitDelegate.call(service, event, data);\n                }\n            };\n\n            // cache[url] = service;\n            cache[cacheRef] = service;\n            return service;\n        };\n    });\n})(angular);\n(function (angular) {\n\n    'use strict';\n\n    angular.module(\"gp-common\").factory('UUID', function () {\n\n        function s4() {\n            return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);\n        }\n\n        /*\n        return function() {\n                return s4() + s4() + '-' + s4() + '-' + s4() + '-' +\n                    s4() + '-' + s4() + s4() + s4();\n            }\n         */\n\n        return function () {\n            // http://www.ietf.org/rfc/rfc4122.txt\n            var s = [];\n            var hexDigits = \"0123456789abcdef\";\n            for (var i = 0; i < 36; i++) {\n                s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);\n            }\n            s[14] = \"4\"; // bits 12-15 of the time_hi_and_version field to 0010\n            s[19] = hexDigits.substr(s[19] & 0x3 | 0x8, 1); // bits 6-7 of the clock_seq_hi_and_reserved to 01\n            s[8] = s[13] = s[18] = s[23] = \"-\";\n            return s.join(\"\");\n        };\n    });\n})(angular);","\n/**\n * \n * KnowledgeGraph property on RIM Asset renamed to Classifiers\n *\n */\n\n\n(function(jQuery, angular, Constants) {\n    'use strict';\n\n    angular.module('gp-common-kg', [])\n\n    // .constant('KGClassifiers', [\n    //     { \n    //         label: 'purpose', \n    //         description: 'The intended use or reason for the Object (i.e., layer, map, gallery) e.g., environmental impact of an oil spill.',\n    //         property: 'purposes',\n    //         section: 'Purpose' \n    //     },\n    //     { \n    //         label: 'primarySubject', \n    //         description: 'The selected things, events, or concepts forming part of or represented by the Object. e.g., Deep Water Horizon oil rig, oil slick extent, oil slick movement over time, predicted oil slick movement, impacted sites, impact severity.',\n    //         property: 'primarySubjects',\n    //         section: 'Scope' \n    //     },\n    //     { \n    //         label: 'secondarySubject', \n    //         description: 'Second-order subjects derived by machine processing/ analysis of the target Object',\n    //         property: 'secondarySubjects',\n    //         section: 'Scope' \n    //     },\n    //     { \n    //         label: 'primaryTopic', \n    //         description: 'The central branch of knowledge or theme pertaining to the thing, concept, situation, issue, or event of interest. e.g., environmental impact of oil spill.',\n    //         property: 'primaryTopics',\n    //         section: 'Scope' \n    //     },\n    //     { \n    //         label: 'secondaryTopic', \n    //         description: 'Second-order topics derived by machine processing/ analysis of the target Object',\n    //         property: 'secondaryTopics',\n    //         section: 'Scope' \n    //     },\n    //     { \n    //         label: 'category', \n    //         description: 'The type or category of the Object.  e.g., topographic map, elevation layer',\n    //         property: 'categories',\n    //         section: 'Scope' \n    //     },\n    //     { \n    //         label: 'community', \n    //         description: 'The GeoPlatform community this Object was produced for. e.g., \"Ecosystems and Biodiversity\" community',\n    //         property: 'communities',\n    //         section: 'Scope' \n    //     },\n    //     { \n    //         label: 'place', \n    //         description: 'The central locale or common names for the place where the Subjects of the Object occur. e.g.,  USA/Gulf Coast',\n    //         property: 'places',\n    //         section: 'Scope' \n    //     },\n    //     { \n    //         label: 'function', \n    //         description: 'The business actions, activities, or tasks this Object is intended to support (i.e., the role it plays in supporting an activity).  e.g., environmental impact assessment.',\n    //         property: 'functions',\n    //         section: 'Fitness for Use' \n    //     },\n    //     { \n    //         label: 'audience', \n    //         description: 'The group of people for which this Object was intended to be used. e.g., general public, disaster recovery personnel, Congress.',\n    //         property: 'audiences',\n    //         section: 'Social Context' \n    //     }\n    // ])\n\n    .constant('KGFields', [\n        'purposes', 'functions', 'primaryTopics', 'secondaryTopics', \n        'primarySubjects', 'secondarySubjects', 'communities', 'audiences', \n        'places', 'categories'\n    ])\n\n\n    .service('KGHelper', [ 'KGFields', 'RecommenderServiceFactory', \n        function(KGFields, RecommenderServiceFactory) {\n\n        return {\n            calculate: function(kg) {\n                if(!kg) return 0;\n                let result = 0;\n                angular.forEach(KGFields, prop => {\n                    if(kg[prop] && kg[prop].length)\n                        result += 7 + Math.floor( (kg[prop].length-1) / 2 );\n                    // result += kg[prop] ? kg[prop].length*5 : 0;\n                });\n                return result;\n            },\n\n            getService: function(type) {\n                return RecommenderServiceFactory(type);\n            }\n\n        };\n    }])\n\n\n\n    /**\n     * Service that queries the recommendation service endpoint \n     * exposed by UAL \n     */\n    .service(\"RecommenderService\", function($resource) {\n\n        let baseUrl = Constants.ualUrl + '/api/recommender';\n        return $resource(baseUrl, { }, {\n\n            query: {\n                url: baseUrl + '/suggest',\n                isArray: false\n            },\n            queryTypes: {\n                url: baseUrl + '/types',\n                isArray: false\n            },\n            querySources: {\n                url: baseUrl + '/sources',\n                isArray: false\n            }\n\n        });\n\n    })\n\n\n\n    /**\n     * Factory for creating services that query the recommendation \n     * service endpoint exposed by UAL and includes object type\n     * parameter based upon owner of KG\n     */\n    .factory(\"RecommenderServiceFactory\", function($resource) {\n\n        return function(type) {\n        \n            let baseUrl = Constants.ualUrl + '/api/recommender';\n            return $resource(baseUrl, { 'for': type }, {\n\n                query: {\n                    url: baseUrl + '/suggest',\n                    isArray: false\n                },\n                queryTypes: {\n                    url: baseUrl + '/types',\n                    isArray: false\n                },\n                querySources: {\n                    url: baseUrl + '/sources',\n                    isArray: false\n                }\n\n            });\n\n        };\n\n    })\n\n\n\n    /** \n     * Component for rendering a brief % of completion\n     *\n     */\n    .component('kgCompletionDisplay', {\n\n        bindings: {\n            ngModel: '<' // the Asset containing the knowledge graph ('classifiers') property\n        },\n\n        controller: function($rootScope, KGHelper) {\n\n            this.$onInit = function() {\n\n                this.update();\n\n                this.listener = $rootScope.$on('gp:kg:updated', (event, item) => {\n                    if(item && item.id === this.id) {\n                        //in case kg didn't exist, \n                        if(!this.ngModel.classifiers)\n                            this.ngModel.classifiers = item.classifiers;\n                        this.value = KGHelper.calculate(this.ngModel.classifiers);\n                    }\n                });\n\n            };\n\n            this.$onChanges = function() {\n                this.update();\n            };\n\n            this.$onDestroy = function() {\n                this.listener();\n                this.listener = null;\n            };\n\n            this.update = function() {\n\n                if(this.ngModel.$promise && !this.ngModel.$resolved) {\n                    this.ngModel.$promise.then( model => { this.update(); });\n                    return;\n                }\n\n                this.id = this.ngModel ? this.ngModel.id : null;\n                this.value = KGHelper.calculate(this.ngModel.classifiers);\n            };\n\n        },\n\n        template: \n        `\n            <span>{{$ctrl.value||0}}%</span>\n            <span class=\"glyphicon glyphicon-dashboard\"></span>\n        `\n\n    })\n    ;\n\n\n}) (jQuery, angular, GeoPlatform);\n\n","(function(angular) {\n\n  'use strict';\n\n  //flag on whether we're in dev env\n  // function isDEV() {\n  //     return \"localhost\" === window.location.hostname ||\n  //         ~window.location.hostname.indexOf(\"192.168\")||\n  //         ~window.location.hostname.indexOf(\"localhost\")||\n  //         ~window.location.hostname.indexOf(\"10.0\");\n  // }\n\n  /**\n   * Get token from query string\n   *\n   * Note:\n   *  Lifted outside of any Angular service to prevent cyclical service dependencies.\n   *\n   * @method getJWTFromUrl\n   * @returns {String} token - token in query string or undefined\n   */\n  function getJWTFromUrl() {\n    var queryString = window.location.hash ? window.location.hash : window.location.href;\n    var res = queryString.match(/access_token=([^\\&]*)/);\n    return res && res[1];\n  };\n\n  /**\n   * GeoPlatform Common Module Authentication Support\n   *\n   * Contains re-usable services, directives, and other angular components\n   *\n   *\n   * NOTE: This module uses certain variables in $rootScope in order to\n   * perform actions like authentication.  The following variables should be\n   * set before using any service/directive in this file:\n   *\n   *   - idspUrl : the url to the identity service provider server\n   *   - idmUrl : the url to the identity management server\n   *   - portalUrl : the url to the main landing page of GeoPlatform (www.geoplatform.gov in production)\n   */\n  angular.module('gp-common')\n\n\n    /**\n     * Authentication Service\n     *\n     * Because the auth service redirects the page to the IDM portal\n     * and WMV is reloaded once the login/logout processes are complete,\n     * there's no need to bind listeners informing other components of\n     * an auth change.\n     *\n     * Inside \"DEV\", you should close and re-open any components' widgets\n     * to get current auth status.\n     */\n    .service('AuthenticationService', ['$q', '$http', '$location', '$rootScope', '$window', 'GPConfig',\n      function($q, $http, $location, $rootScope, $window, Config) {\n\n        //extend Storage prototype\n        Storage.prototype.setObject = function(key, value) {\n          this.setItem(key, btoa(JSON.stringify(value)));\n        };\n\n        Storage.prototype.getObject = function(key) {\n          var value = atob(this.getItem(key));\n          return value && JSON.parse(value);\n        };\n\n        function User(opts) {\n          for (var p in opts) {\n            this[p] = opts[p];\n          }\n          if (!this.id && this.username)\n            this.id = this.username;\n\n          this.toJSON = function() {\n            return {\n              id: this.id,\n              username: this.username,\n              name: this.name,\n              email: this.email,\n              org: this.org,\n              exp: this.exp\n            };\n          };\n\n          this.clone = function() {\n            return new User(this.toJSON());\n          };\n\n          this.compare = function(arg) {\n            if (arg instanceof User) {\n              return this.id === arg.id;\n            } else if (typeof(arg) === 'object') {\n              return typeof(arg.id) !== 'undefined' &&\n                arg.id === this.id;\n            }\n            return false;\n          };\n\n          this.isAuthorized = function(role) {\n            let env = Config.env || Config.ENV || Config.NODE_ENV;\n            if(env === 'dev' || env === 'development') return true;\n            if(!this.roles || !this.roles.length || typeof(this.roles.push) === 'undefined')\n                return false;\n            return this.roles.indexOf(role)>=0;exp: this.exp\n          };\n        }\n\n        var _user = null;\n\n        /**\n         * Authentication Service\n         */\n        var Service = function() {\n\n          var self = this;\n\n          //$q version of getUser\n          this.getUserQ = function() {\n            return $q.when(self.getUser())\n          };\n\n          /**\n           * Redirects the page to the login site\n           */\n          this.login = function() {\n\n            //use current window\n            var current = window.location.href;\n            var redirect = (Config.CALLBACK) ? Config.CALLBACK : current;\n\n            if (Config.AUTH_TYPE !== 'grant' && Config.AUTH_TYPE !== 'token') {\n              //fail this request\n              throw new Error(\"Invalid authentication request type.  Must be 'token' or 'grant'.\");\n            }\n\n            //check auth type to set login URL: Implicit -> to IDP, Grant -> Resource Provider Login URL\n            var loginUrl = (Config.AUTH_TYPE === 'token') ? Config.IDP_BASE_URL +\n              '/auth/authorize?client_id=' + Config.APP_ID + '&response_type=' +\n              Config.AUTH_TYPE + '&redirect_uri=' + encodeURIComponent(redirect) : Config.LOGIN_URL;\n\n            window.location = loginUrl;\n\n            //This could be writen to use an modal / pop-up for login so you don't have to lose your current page\n            //Logout already executes using a background call\n          };\n\n          /**\n           * Performs background logout and requests jwt revokation\n           */\n          this.logout = function() {\n            //implicitly remove incase the idp is down and the revoke call does not work\n            _user = null;\n            self.clearLocalStorageJWT();\n\n            $http.get(Config.IDP_BASE_URL + '/auth/revoke')\n              .then(function(response) {\n                self.removeAuth();\n                //goto logout page\n                if (Config.LOGOUT_URL) {\n                  Config.FORCE_LOGIN = false;\n                  window.location = Config.LOGOUT_URL;\n                } else {\n                  window.location.hash = '';\n                  window.location = Config.PORTAL_URL || window.location.host;\n                }\n              }, function(err) {\n                console.log(err);\n              });\n          };\n\n          /**\n           * Optional force redirect for non-public services\n           */\n          this.forceLogin = function() {\n            self.login();\n          };\n\n          /**\n           * Get protected user profile\n           */\n          this.getOauthProfile = function() {\n            var Q = $q.defer();\n            //check to make sure we can make called\n            if (self.getJWTfromLocalStorage()) {\n              var url = Config.IDP_BASE_URL + '/api/profile';\n              $http.get(url)\n                .then(function(response) {\n                  //when we get it, save it so we don't have to hit the IDP so many times\n                  Q.resolve(response.data);\n                }, function(err) {\n                  console.log(err);\n                  Q.reject(err);\n                });\n            }\n            return Q.promise;\n          };\n\n          /*\n           * Set the _user property in this scope\n           */\n          this.setUser = function(user){ _user = user }\n\n          /**\n           * Unpacks JWT to see if session is valid.\n           *\n           * Side Effects:\n           *  - Sets the _user property\n           *  - Sets the Authorize header if valid user found (this.setAuth)\n           *  - Will redirect user to login url if FORCE_LOGIN is set an no valid user is found\n           *\n           * @return {User} - the authenticated user or undefined\n           */\n          this.check = function() {\n            // Pull user from either LocalStorage or the JWT (or the URL)\n            const jwt = self.getJWT();\n\n            // Save JWT in Auhorization Header\n            if(jwt && !self.isExpired(jwt)){\n              self.setAuth(jwt);\n              const user = self.parseJwt(jwt);\n              // slightly differnet mapping ;)\n              self.setUser(new User({\n                id: user.sub,\n                username: user.username,\n                email: user.email,\n                name: user.name,\n                org: user.org,\n                exp: user.exp\n              }))\n\n              //clean hosturl on redirect from oauth\n              const current = ($window && $window.location && $window.location.hash) ? $window.location.hash : $location.url()\n              if (getJWTFromUrl()) {\n                var cleanUrl = current.replace(/access_token=([^\\&]*)/, '');\n                $window.location = cleanUrl;\n              }\n\n            // No valid userdata found\n            } else {\n              self.removeAuth();\n              // Redirect if settings set\n              if(Config.FORCE_LOGIN === true) self.forceLogin();\n            }\n\n            // return the user\n            return _user\n          };\n\n          /**\n           * If the callback parameter is specified, this method\n           * will return undefined. Otherwise, it returns the user (or null).\n           *\n           * Side Effects:\n           *  - This property sets the _user property for the enclosing scope\n           *  - Will redirect users if no valid JWT was found\n           *\n           * @param callback optional function to invoke with the user\n           * @return object representing current user\n           */\n          this.getUser = function(callback) {\n            // better check 'em first\n            self.check(); // Sideffects will redirect browser if JWT invalid\n\n            return callback && typeof(callback) === 'function' ?\n              callback(_user) :\n              _user;\n          }\n\n          //=====================================================\n\n          /**\n           * Extract token from current URL\n           *\n           * @method getJWTFromUrl\n           *\n           * @return {String | undefined} - JWT Token (raw string)\n           */\n          this.getJWTFromUrl = function(){\n            const queryString = ($window && $window.location && $window.location.hash) ? $window.location.hash : $location.url();\n            const res = queryString.match(/access_token=([^\\&]*)/);\n            return res && res[1];\n          };\n\n          /**\n           * Load the JWT stored in local storage.\n           *\n           * @method getJWTfromLocalStorage\n           *\n           * @return {JWT | undefined} An object wih the following format:\n           */\n          this.getJWTfromLocalStorage = function(){\n            return window.localStorage.gpoauthJWT\n          };\n\n          /**\n           * Attempt and pull JWT from the following locations (in order):\n           *  - URL query parameter 'access_token' (returned from IDP)\n           *  - Browser local storage (saved from previous request)\n           *\n           * @method getJWT\n           *\n           * @return {JWT | undefined}\n           */\n          this.getJWT = function(){\n            return self.getJWTFromUrl() || self.getJWTfromLocalStorage()\n          };\n\n          /**\n           * Remove the JWT saved in local storge.\n           *\n           * @method clearLocalStorageJWT\n           *\n           * @return  {undefined}\n           */\n          this.clearLocalStorageJWT = function(){\n            delete window.localStorage.gpoauthJWT;\n          };\n\n          /**\n           * Is a token expired.\n           *\n           * @method isExpired\n           * @param {JWT} jwt - A JWT\n           *\n           * @return {boolean}\n           */\n          this.isExpired = function(jwt){\n            const exp = jwt && self.parseJwt(jwt).exp;\n            const now = (new Date()).getTime() / 1000;\n            return now > exp;\n          };\n\n          /**\n           * Unsafe (signature not checked) unpacking of JWT.\n           *\n           * @param {string} token - Access Token (JWT)\n           *\n           * @return {Object} the parsed payload in the JWT\n           */\n          this.parseJwt = function(token) {\n            var parsed;\n            if (token) {\n              var base64Url = token.split('.')[1];\n              var base64 = base64Url.replace('-', '+').replace('_', '/');\n              parsed = JSON.parse(atob(base64));\n            }\n            return parsed;\n          };\n\n          /**\n           *\n           */\n          this.validateJwt = function(token) {\n            var parsed = self.parseJwt(token);\n            var valid = (parsed && parsed.exp && parsed.exp * 1000 > Date.now()) ? true : false;\n            //TODO: chk jwt signature too\n            return valid;\n          };\n\n          this.setAuth = function(jwt) {\n            window.localStorage.gpoauthJWT = jwt;\n            $http.defaults.headers.common.Authorization = 'Bearer ' + jwt;\n            $http.defaults.useXDomain = true;\n            return;\n          };\n\n          this.removeAuth = function() {\n            _user = null;\n            delete window.localStorage.gpoauthJWT;\n            delete $http.defaults.headers.common.Authorization;\n            $http.defaults.useXDomain = false;\n            return;\n          };\n\n          //initialize with auth check\n          this.check()\n\n        };\n\n        return new Service();\n\n      }\n    ])\n\n    /**\n     * Interceptor that check for an updaed AccessToken coming from any request\n     * and will take it and set it as the token to use in future outgoing\n     * requests\n     */\n    .factory('ng-common-AuthenticationInterceptor', function($injector, $window){\n      // Interceptor\n      return {\n        response: function(resp) {\n          const jwt = getJWTFromUrl();\n          const authHeader = resp.headers('Authorization');\n\n          if(jwt){\n            const AuthenticationService = $injector.get('AuthenticationService')\n            AuthenticationService.setAuth(jwt);\n          } else if (authHeader) {\n            const AuthenticationService = $injector.get('AuthenticationService')\n            AuthenticationService.setAuth(authHeader.replace('Bearer ',''));\n          }\n\n          return resp;\n        }\n      };\n    })\n\n    .config(function myAppConfig ($httpProvider) {\n      $httpProvider.interceptors.push('ng-common-AuthenticationInterceptor');\n    })\n\n\n    .directive('gpLoginButton', ['$timeout', 'AuthenticationService', 'GPConfig',\n      function($timeout, AuthenticationService, Config) {\n        return {\n          scope: {\n            minimal: '@'\n          },\n          replace: true,\n          template: [\n\n            '<div class=\"btn-account btn-group\">' +\n\n            //not logged in\n            '  <a class=\"btn btn-link\" ng-click=\"login()\" ng-if=\"!user\">Sign In</a>' +\n\n            //logged in\n            '  <button type=\"button\" class=\"btn btn-link dropdown-toggle\" data-toggle=\"dropdown\" ' +\n            '   aria-expanded=\"false\" ng-if=\"user\">' +\n            '     <span class=\"glyphicon glyphicon-user\"></span> ' +\n            '     <span class=\"hidden-xs\">{{::user.name}}</span> ' +\n            '     <span class=\"caret\"></span>' +\n            '  </button>' +\n            '  <ul class=\"dropdown-menu dropdown-menu-right\" role=\"menu\" ng-if=\"user\">' +\n            '    <li class=\"account-details\">' +\n            '      <div class=\"media\">' +\n            '        <div class=\"media-left\">' +\n            '          <div class=\"media-object\">' +\n            '            <span class=\"glyphicon glyphicon-user glyphicon-xlg\"></span>' +\n            '          </div>' +\n            '        </div>' +\n            '        <div class=\"media-body\">' +\n            '          <div class=\"media-heading\">{{::user.name}}</div>' +\n            '          <div><em>{{::user.username}}</em></div>' +\n            '          <div>{{::user.email}}</div>' +\n            '          <div>{{::user.org}}</div>' +\n            '        </div>' +\n            '      </div>' +\n            '    </li>' +\n            '    <li class=\"divider\"></li>' +\n            '    <li><a href=\"{{::idpUrl}}/modifyuser.html\">Edit Info</a></li>' +\n            '    <li><a href=\"{{::idpUrl}}/changepassword.html\">Change Password</a></li>' +\n            '    <li><a href ng-click=\"logout()\">Sign Out</a></li>' +\n            '  </ul>' +\n\n\n            '</div>'\n          ].join(' '),\n          controller: function($scope, $element) {\n\n            if ($scope.minimal === 'true') $scope.minimal = true;\n            if ($scope.minimal !== true) $scope.minimal = false;\n\n            $scope.idpUrl = Config.idmUrl;\n            // console.log(\"IDM Base Url: \" + Config.idmUrl);\n\n            AuthenticationService.getUser(function(user) {\n              $timeout(function() {\n                $scope.user = user;\n              }, 100);\n            });\n\n            $scope.login = function() {\n              $scope.user = AuthenticationService.login();\n            };\n\n            $scope.logout = function() {\n              $scope.user = AuthenticationService.logout();\n            };\n          }\n        };\n      }\n    ])\n\n\n\n    .directive('gpAccountDetails', ['$timeout', 'AuthenticationService', 'GPConfig',\n      function($timeout, AuthenticationService, Config) {\n\n        return {\n          scope: {},\n          replace: true,\n          template: [\n            '<div>' +\n            '  <div class=\"media\">',\n            '    <div class=\"media-left\">',\n            '        <div class=\"media-object\">',\n            '            <span class=\"glyphicon glyphicon-user glyphicon-xlg\"></span>',\n            '        </div>',\n            '    </div>',\n            '    <div class=\"media-body\" ng-if=\"user\">',\n            '       <div class=\"media-heading\">{{::user.name}}</div>' +\n            '       <div><small><em>{{::user.username}}</em></small></div>' +\n            '       <div><small>{{::user.email}}</small></div>' +\n            '       <div><small>{{::user.org}}</small></div>' +\n            '    </div>',\n            '    <div class=\"media-body\" ng-if=\"!user\">',\n            '       <div class=\"media-heading\">Please Sign In</div>' +\n            '       <div><small>Sign in to your GeoPlatform account or register a new account.</small></div>' +\n            '    </div>',\n            '  </div>',\n            '  <hr/>',\n            '  <div ng-if=\"user\">',\n            '    <button type=\"button\" class=\"btn btn-sm btn-accent pull-right\" ng-click=\"logout()\">Sign Out</button>' +\n            '    <a class=\"btn btn-sm btn-default\" href=\"{{::idpUrl}}/modifyuser.html\">Edit Details</a>' +\n            '  </div>',\n            '  <div ng-if=\"!user\">',\n            '    <button type=\"button\" class=\"btn btn-sm btn-accent pull-right\" ng-click=\"login()\">Sign In</button>' +\n            '    <a class=\"btn btn-sm btn-default\" href=\"{{::idpUrl}}/registeruser.html\">Register</a>' +\n            '  </div>',\n            '</div>'\n          ].join(' '),\n          controller: function($scope, $element) {\n\n            $scope.idpUrl = Config.idmUrl;\n\n            AuthenticationService.getUser(function(user) {\n              $timeout(function() {\n                $scope.user = user;\n              }, 100);\n            });\n\n            $scope.login = function() {\n              $scope.user = AuthenticationService.login();\n            };\n\n            $scope.logout = function() {\n              $scope.user = AuthenticationService.logout();\n            };\n\n          }\n        };\n      }\n    ])\n\n  ;\n\n})(angular);\n","(function() {\n\n    \"use strict\";\n\n    if(typeof(Array.prototype.find) === 'undefined') {\n        Array.prototype.find = function(callback) {\n            for(var i=0; i<this.length; ++i) {\n                if(callback(this[i], i, this))\n                    return this[i];\n            }\n            return null;\n        };\n    }\n    if(typeof(Array.prototype.filter) === 'undefined') {\n        Array.prototype.filter = function(callback) {\n            var results = [];\n            for(var i=0; i<this.length; ++i) {\n                if(callback(this[i], i, this))\n                    results.push(this[i]);\n            }\n            return results;\n        };\n    }\n    if(typeof(Array.prototype.each) === 'undefined') {\n        Array.prototype.each = function(callback) {\n            for(var i=0; i<this.length; ++i) {\n                callback(this[i], i, this);\n            }\n        };\n    }\n    if(typeof(Array.prototype.indexOfObj) === 'undefined') {\n        Array.prototype.indexOfObj = function(obj, comparatorFn) {\n            \n            let arr = this, len = arr.length;\n            \n            if(typeof(comparatorFn) !== 'function')\n                comparatorFn = (a,b) => { return a===b; };\n\n            for(let i=0; i<len; ++i) {\n                if(comparatorFn(obj, arr[i]))\n                    return i;\n            }\n            return -1;\n        };\n    }\n    if(typeof(String.prototype.startsWith) === 'undefined') {\n        String.prototype.startsWith = function(value) {\n            var str = this;\n            if(!str.length)     return false;\n            if(!value.length)   return false;\n            if(str.length < value.length) return false;\n            return str.indexOf(value) === 0;\n        };\n    }\n    if(typeof(String.prototype.endsWith) === 'undefined') {\n        String.prototype.endsWith = function(value) {\n            var str = this;\n            if(!str.length)     return false;\n            if(!value.length)   return false;\n            if(str.length < value.length) return false;\n            var substr = str.substring(\n                str.length - value.length,\n                str.length\n            );\n            return substr == value;\n        };\n    }\n\n\n\n\n    if(typeof(Date.prototype.plus) === 'undefined') {\n        Date.prototype.plus = function(offset) {\n            \n            var type = typeof(offset);\n            if(type === 'undefined') return this;\n\n            var offsetMS = 0;\n            if(type === 'string') {\n                switch(offset) {\n                    case 'hour':    offsetMS = 1000*60*60; break;\n                    case 'day':     offsetMS = 1000*60*60*24; break;\n                    case 'week':    offsetMS = 1000*60*60*24*7; break;\n                    case 'month':   offsetMS = 1000*60*60*24*31; break;\n                    case 'year':    offsetMS = 1000*60*60*24*365; break;\n                }\n            } else if(type === 'number') {\n                offsetMS = offset;\n            } else return this;\n\n            var d = this;\n            return new Date(d.getTime() + offsetMS);\n        };\n    }\n\n    if(typeof(Date.prototype.random) === 'undefined') {\n        Date.prototype.random = function(threshold) {\n\n            var type = typeof(threshold);\n            if(type === 'undefined') return this;\n\n            var offsetMS = 0;\n            if(type === 'string') {\n                switch(threshold) {\n                    case 'hour':    offsetMS = 1000*60*60; break;\n                    case 'day':     offsetMS = 1000*60*60*24; break;\n                    case 'week':    offsetMS = 1000*60*60*24*7; break;\n                    case 'month':   offsetMS = 1000*60*60*24*31; break;\n                    case 'year':    offsetMS = 1000*60*60*24*365; break;\n                }\n            } else if(type === 'number') {\n                offsetMS = threshold;\n            } else return this;\n\n            var d = this;\n            return new Date(d.getTime() + Math.floor(Math.random()*offsetMS));\n        };\n    }\n\n})();","(function(angular) {\n    \n    \"use strict\";\n\n    const ACTIVATORS_HTML = \n        `\n            <div class=\"gp-ui-card__details-activator--left\" title=\"Show previous details\"\n                ng-class=\"{disabled:!hasPrevious()}\" ng-click=\"previousDetails()\">\n                <span class=\"glyphicon glyphicon-chevron-left\"></span>\n            </div>\n            <div class=\"gp-ui-card__details-activator--right\" title=\"Show next details\"\n                ng-class=\"{disabled:!hasNext()}\" ng-click=\"nextDetails()\">\n                <span class=\"glyphicon glyphicon-chevron-right\"></span>\n            </div>\n        `;\n\n\n\n    /*\n     * Appends carousel-like activators onto a card section\n     * Usage: \n     *\n     *  <div class=\"text--supporting\" card-details-carousel-activator>\n     *      <div class=\"gp-ui-card__details active\" id=\"description\">...</div>    \n     *      <div class=\"gp-ui-card__details\" id=\"author\">...</div>        \n     *  </div>\n     */\n    angular.module(\"gp-common\").directive('cardDetailsCarouselActivator', function() {\n\n        return {\n\n            compile: function($element) {\n                $element.append(ACTIVATORS_HTML);\n            },\n\n            controller: function($scope, $element) {\n\n                $scope.hasPrevious = function() {\n                    let pane = $element.find('.gp-ui-card__details.active');\n                    return pane.prevAll('.gp-ui-card__details').length;\n                };\n\n                $scope.hasNext = function() {\n                    let pane = $element.find('.gp-ui-card__details.active');\n                    return pane.nextAll('.gp-ui-card__details').length;\n                };\n\n                $scope.previousDetails = function() {\n                    if(!$scope.hasPrevious()) return;\n                    let pane = $element.find('.gp-ui-card__details.active');\n                    pane.removeClass('active');\n                    pane = pane.prevAll('.gp-ui-card__details');\n                    if(pane.length)\n                        angular.element(pane[0]).addClass('active');\n                };\n\n                $scope.nextDetails = function() {\n                    if(!$scope.hasNext()) return;\n                    let pane = $element.find('.gp-ui-card__details.active');\n                    pane.removeClass('active');\n                    pane = pane.nextAll('.gp-ui-card__details');\n                    if(pane.length)\n                        angular.element(pane[0]).addClass('active');\n                };\n\n            }\n        };\n    });\n\n}) (angular);","(function(jQuery, angular) {\n\n    'use strict';\n\n\n\n    /**\n     * determines whether an rgb value is invalid\n     * the value starts as false (the rbg value is valid)\n     * and is invalidated if the value(s) are empty, greater than 255 or less than 0\n     *\n     * @param rgb either an object { r: 0, g: 0, b: 0 } or a single value\n     * @returns {boolean} whether the rgb value is invalid\n     */\n    function invalidRGB(rgb) {\n        var error = false;\n\n        if(rgb instanceof Object) {\n            var r = parseInt(rgb.r, 10);\n            var g = parseInt(rgb.g, 10);\n            var b = parseInt(rgb.b, 10);\n\n            if(r > 255 || r < 0 || (!r && r !== 0)) error = true;\n            if(g > 255 || g < 0 || (!g && g !== 0)) error = true;\n            if(b > 255 || b < 0 || (!b && b !== 0)) error = true;\n        } else {\n            var x = parseInt(rgb, 10);\n            if(x > 255 || x < 0 || (!x && x !== 0)) error = true;\n        }\n\n        return error;\n    }\n\n    /**\n     * converts a decimal (base 10) number to hex (base 16) string\n     *\n     * @param c base 10 number\n     * @returns {*} base 16 string\n     */\n    function componentToHex(c) {\n        var hex = c.toString(16), result = null;\n\n        if(!isNaN(c) && !invalidRGB(c))\n            result = hex.length == 1 ? '0' + hex : hex;\n\n        return result;\n    }\n\n    /**\n     * converts an rgb object to a hexadecimal string\n     *\n     * @param rgb object { r: 0, g: 0, b: 0 }\n     * @returns {*} hexadecimal string\n     */\n    function rgbToHex(rgb) {\n        var result = null;\n\n        var r = componentToHex(parseInt(rgb.r, 10));\n        var g = componentToHex(parseInt(rgb.g, 10));\n        var b = componentToHex(parseInt(rgb.b, 10));\n\n        if(r && g && b) result = '#' + r + g + b;\n\n        return result;\n    }\n\n    /**\n     * determines whether a hex value is valid\n     *\n     * @param hex string value\n     * @returns hex value or null if hex is invalid\n     */\n    function validHex(hex) {\n        return  (/^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i).exec(hex) || null;\n    }\n\n    /**\n     * converts a hex string to rgb object\n     *\n     * @param hex string\n     * @returns {*} rgb object { r: 0, g: 0, b: 0 }\n     */\n    function hexToRgb(hex) {\n        // Expand shorthand form (e.g. '03F') to full form (e.g. '0033FF')\n        var shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n        hex = hex.replace(shorthandRegex, function(m, r, g, b) {\n            return r + r + g + g + b + b;\n        });\n\n        var result = validHex(hex);\n        return result ? {\n            r: parseInt(result[1], 16),\n            g: parseInt(result[2], 16),\n            b: parseInt(result[3], 16)\n        } : null;\n    }\n\n\n\n\n    /**\n     * Advanced Color Picker Directive (advanced-color-picker)\n     * This color picker is meant to augment the functionality in angular-bootstrap-colorpicker\n     * It adds the ability to change the color with RGB and Hex\n     * It needs to be used in a container that has at least 160px of vertical real estate\n     *\n     * You must pass in the following:\n     *   - ngModel  (a hexadecimal string color value)\n     *   - onChange (the event to be fired when the value changes)\n     *\n     * Usage Example:\n     * <div advanced-color-picker ng-model=\"hexColor\" ng-change=\"changeEvent()\"></div>\n     */\n     angular.module('gp-common').component('gpColorPicker', {\n\n        bindings: {\n            ngModel : '=',\n            onChange: '&'\n        },\n\n        controller: function($timeout, $q) {\n            \n            // fired when an rgb value is changed\n            this.changeRGB = function() {\n                \n                // make sure rgb color value is correct\n                this.rgbError = invalidRGB(this.rgb);\n\n                // parse it anyways leaving hex value blank until valid rbg\n                this.ngModel = rgbToHex(this.rgb);\n\n                // have to use timeout to make sure ngModel is set before\n                // firing change event upstream\n                var self = this;\n                $timeout(function() {\n                    self.onChange({value: self.ngModel});\n                });\n\n            };\n\n            // fired when a hex value is changed\n            this.changeHex = function() {\n            \n                // make sure the hex color value is correct\n                if(!validHex(this.ngModel))\n                    this.hexError = 'Invalid hex color value';\n                else this.hexError = false;\n\n                // parse it anyway leaving rgb values blank until it's a valid hex\n                this.rgb = hexToRgb(this.ngModel);\n\n                // have to use timeout to make sure ngModel is set before\n                // firing change event upstream\n                var self = this;\n                $timeout(function() {\n                    self.onChange({value: self.ngModel});\n                });\n\n            };\n\n\n            this.$onInit = function() {\n                this.rgb = hexToRgb(this.ngModel);\n            };\n\n                \n        },\n\n        template: \n        `\n            <div class=\"gp-colorpicker\">\n                <div class=\"form-group hex-form-group\" ng-class=\"{'has-error':$ctrl.hexError}\">\n                    <input type=\"text\" class=\"form-control\"\n                        ng-model=\"$ctrl.ngModel\" ng-keyup=\"$ctrl.changeHex()\">\n                </div>\n                <div class=\"gp-colorpicker__wrapper\">\n                    <div colorpicker colorpicker-inline=\"true\" colorpicker-parent=\"true\" \n                        ng-model=\"$ctrl.ngModel\" ng-change=\"$ctrl.changeHex()\"></div>\n                </div>\n                <div class=\"form-group rgb-form-group\" ng-class=\"{'has-error':$ctrl.rgbError}\">\n                    <input type=\"text\" class=\"form-control\"\n                        placeholder=\"R\" ng-model=\"$ctrl.rgb.r\" ng-keyup=\"$ctrl.changeRGB()\" title=\"R\">\n                    <input type=\"text\" class=\"form-control\"\n                        placeholder=\"G\" ng-model=\"$ctrl.rgb.g\" ng-keyup=\"$ctrl.changeRGB()\" title=\"G\">\n                    <input type=\"text\" class=\"form-control\"\n                        placeholder=\"B\" ng-model=\"$ctrl.rgb.b\" ng-keyup=\"$ctrl.changeRGB()\" title=\"B\">\n                </div>\n            </div>\n        `\n    });\n\n})(jQuery, angular);","(function(jQuery, angular) {\n    \n    'use strict';\n\n    angular.module('gp-common').directive('gpDatePicker', ['$timeout', function($timeout) {\n\n        return {\n            scope: {\n                label: '@',\n                format: '@',\n                date: '=',\n                onChange: '&?'\n            },\n            template: [\n                '<div class=\"input-group-slick\">',\n                '    <input type=\"text\" class=\"form-control\" placeholder=\"{{::label}}\"',\n                '        datepicker-popup=\"{{format}}\" ng-model=\"date\" is-open=\"opened\" />',\n                '    <span class=\"glyphicon glyphicon-calendar\" ng-click=\"toggle($event)\"></span>',\n                '</div>',\n                '<p class=\"help-block\"><small><em>Ex: \"2015-01-31\" or \"Jan 31 2015\"</em></small></p>'\n            ].join(' '),\n\n            controller: function($scope, $element, $attrs) {\n\n                //toggle date picker\n                $scope.toggle = function(event) {\n                    event.preventDefault();\n                    event.stopPropagation();\n                    this.opened = !this.opened;\n                };\n\n                if(!$scope.format)\n                    $scope.format = 'MMM dd yyyy';\n\n                var promise = null;\n\n                $scope.debounce = function() {\n                    if(promise) $timeout.cancel(promise);\n                    promise = $timeout(function() { \n                        promise = null;\n                        if($scope.onChange)\n                            $scope.onChange();\n                    }, 200);\n                };\n\n                $scope.$watch('date', function() {\n                    $scope.debounce();\n                });\n\n                var listener = $scope.$on('$destroy', function() {\n                    \n                    listener();             //deregister listener\n                    \n                    if(promise) $timeout.cancel(promise);\n                    promise = null;\n\n                    $scope.opened = false;    //close picker if open\n                    $scope.onChange = null;\n                    $scope.format = null;\n                    $scope.debounce = null;\n                });\n\n            }\n        };\n\n    }]);\n\n})(jQuery, angular);","(function(jQuery, angular) {\n    \n    \"use strict\"; \n    \n    angular.module(\"gp-common\")\n\n    /**\n     * Geolocation directive\n     */\n    .directive('gpGeolocation', ['$window',function ($window) {\n        \n        var defaultBtnLabel = \"Locate\";\n\n        return {\n            scope: {\n                label: '=?'\n            },\n            restrict: \"EA\",\n            template: [\n                '<a class=\"btn btn-primary\" ng-click=\"geolocate()\" ng-if=\"available\">',\n                '  <span class=\"glyphicon glyphicon-screenshot\" ng-if=\"!loading\"></span>',\n                '  <span class=\"glyphicon glyphicon-hourglass glyphicon-spin\" ng-if=\"loading\"></span>',\n                '  {{btnLabel}}',\n                '</a>',\n                '<div ng-if=\"error\">{{error}}</div>'\n            ].join(' '),\n            controller: function($scope) {\n\n                $scope.btnLabel = $scope.label || defaultBtnLabel;\n                $scope.loading = false;\n                $scope.available = ($window.navigator && $window.navigator.geolocation);\n\n                if(!$scope.available) \n                    $scope.error = \"Your browser does not support determining location\";\n\n                $scope.geolocate = function() {\n\n                    $scope.loading = true;\n                    $window.navigator.geolocation.getCurrentPosition(function(position){\n\n                        $scope.$apply(function() {$scope.loading = false;});\n                        $scope.$emit('map:geolocation', position.coords.latitude, position.coords.longitude);\n\n                    }, function(error) {\n                        switch (error.code) {\n                          case 1:\n                            $scope.error = \"Permission was denied while attempting to determine location\";\n                            break;\n                          case 2:\n                            $scope.error = \"Unable to determine your location\";\n                            break;\n                          case 3:\n                            $scope.error = \"Unable to determine location in a reasonable amount of time\";\n                            break;\n                        }\n                    });\n                }; \n            }\n        };\n\n    }])\n\n    ;\n\n})(jQuery, angular);","(function(jQuery, angular) {\n    \n    \"use strict\"; \n    \n    angular.module(\"gp-common\")\n\n\n    /**\n     * Header directive for GeoPlatform Angular-based web applications\n     * \n     * Uses transclusion to inject links into the nav-menu which floats to the right.\n     * The menu already provides a \"Home\" link (to app home) and Sign In/User Info button.\n     * The home link is not enabled by default but can be shown using 'show-home-link=\"true\"' \n     * parameter on the directive.\n     *\n     * Note: any links transcluded should reference '$parent.user' to access authenticated user info\n     * \n     * ex:\n     * \n     *   <div gp-header brand=\"Map Manager\" show-home-link=\"true\" class=\"navbar-fixed-top\">\n     *     <li><a href=\"#/maps\">Maps</a></li>\n     *     <li><a href=\"#/galleries\">Galleries</a></li>\n     *     <li><a ng-if=\"$parent.user!==null\" href=\"#/agol\">AGOL</a></li>\n     *     <li><a href=\"#/help\">Help</a></li>\n     *   </div>\n     */\n    .directive('gpHeader', ['GPConfig', 'AuthenticationService', function(Config, AuthenticationService) {\n\n        return {\n\n            scope: {\n                brand: \"@\",\n                showHomeLink: \"@\"\n            },\n            restrict: \"AE\",\n            transclude: true,\n            replace: true,\n            template: [\n                '<header>',\n                '  <div class=\"container-fluid\">',\n                '    <div class=\"row\">',\n                '      <div class=\"col-md-12\">',\n                '        <ul role=\"menu\" class=\"header__menu\" gp-header-menu>',\n                '          <li ng-if=\"showHomeLink\">',\n                '            <a href=\"#/goHome\">',\n                '                <span class=\"glyphicon glyphicon-home\"></span> ',\n                '                <span class=\"hidden-xs hidden-sm\">Home</span>',\n                '            </a>',\n                '          </li>',\n                '          <div class=\"transcluded\"></div>',\n                '          <li><span gp-login-button></span></li>',\n                '        </ul>',\n                '        <h4 class=\"brand\">',\n                '          <a href=\"{{portalUrl}}\" title=\"Go to the GeoPlatform Home Page\">',\n                '            <span class=\"icon-gp\"></span>',\n                '            <span class=\"hidden-xs\">GeoPlatform</span>',\n                '          </a>',\n                '          {{brand}}',\n                '        </h4>',\n                '      </div>',\n                '    </div>',\n                '  </div>',\n                '</header>'\n            ].join(' '),\n\n            // controller: function($rootScope, $scope, $element) {\n            //     $scope.portalUrl = $rootScope.portalUrl;\n            // }, \n\n            link: function($scope, $element, $attrs, ctrl, transcludeFn) {\n\n                $scope.showHomeLink = $scope.showHomeLink === 'true' || false;\n\n                $scope.portalUrl = Config.portalUrl;\n\n                AuthenticationService.getUserQ().then(function(user) {\n                    $scope.user = user;    \n                });\n                \n                $element.find('.transcluded').replaceWith(transcludeFn());\n            }            \n\n        };\n\n    }])\n\n\n    \n    /**\n     * Header Menu\n     *\n     * Monitors the current page URL and updates the header links \n     * to highlight whichever one is associated with the current page\n     *\n     * Usage: \n     *\n     *  <ul role=\"menu\" class=\"header__menu\" gp-header-menu>\n     *      <li><a href=\"#/maps\">Maps</a></li>\n     *      <li><a href=\"#/galleries\">Galleries</a></li>\n     *      ...\n     *  </ul>\n     *\n     */\n    .directive('gpHeaderMenu', ['$location', function($location) {\n\n        //default href for \"home\" link in header__menu\n        //uses 'goHome' to avoid angular-route issues with empty hash not \n        // triggering a page reload. Relies upon the \"otherwise\" condition\n        // being configured inside a routeProvider within the application.\n        var homeLink = 'goHome';\n\n        function update($element) {\n\n            var path = $location.path();\n            \n            if(path === '/' || path === '/#' || path === '/#/')\n                path = homeLink;\n\n            if(path[0] === '/') \n                path = path.substring(1);\n\n            var menu = $element;\n            menu.find('li.active').removeClass('active');\n            \n            var link = menu.find('li > a[href=\"#/' + path + '\"]');\n            if(link.length) {\n                //check if link is within a dropdown in the header menu\n                var dd = link.closest('.dropdown-menu');\n                if(dd.length) {\n                    //find next ancestor that is a list element and mark it active\n                    dd.closest('li').addClass('active');\n                } else {\n                    //not in a dropdown, mark this link active\n                    link.parent().addClass('active');\n                }\n            }\n            \n            menu.find('li > a').each(function(i,a) {\n                var $a = $(a), href = $a.attr('href');\n                if(!href) return;\n                href = href.replace('#/', '');\n                if(path.indexOf(href) === 0)\n                    $a.parent().addClass('active');\n            });\n        }\n\n        return {\n            scope: {\n                homeHref: '@'\n            },\n            restrict: \"A\",\n            \n            controller: function($rootScope, $scope, $element) {\n                if($scope.homeHref)\n                    homeLink = $scope.homeHref;\n            },\n\n            link: function($scope, $element) {\n\n                update($element);\n\n                $scope.$root.$on('$locationChangeSuccess', function() {\n                    update($element);\n                });\n\n            }\n        };\n    }])\n\n\n\n\n    /**\n     *\n     * Usage: \n     *\n     *    <div ng-cloak gp-flex-header show-home-link=\"true\" brand=\"Application Name\">\n     *      <li><a>Menu Item</a></li>\n     *      <li><a>Menu Item</a></li>\n     *      <li><a>Menu Item</a></li>\n     *      <li><a>Menu Item</a></li>\n     *    </div>\n     *\n     */\n    .directive('gpFlexHeader', ['GPConfig', 'AuthenticationService', function(Config, AuthenticationService) {\n\n        return {\n\n            scope: {\n                brand: \"@\",\n                showHomeLink: \"@\"\n            },\n            restrict: \"AE\",\n            transclude: true,\n            replace: true,\n            template: \n            `\n                <header>\n                    <h4 class=\"brand\">\n                        <a href=\"{{portalUrl}}\" title=\"Go to the GeoPlatform Home Page\">\n                            <span class=\"icon-gp\"></span>\n                            <span class=\"hidden-xs\">GeoPlatform</span>\n                        </a>\n                        {{brand}}\n                    </h4>\n                    <ul role=\"menu\" class=\"header__menu\" gp-header-menu>\n                        <li ng-if=\"showHomeLink\">\n                            <a href=\"/\">\n                                <span class=\"glyphicon glyphicon-home\"></span> \n                                <span class=\"hidden-xs hidden-sm\">Home</span>\n                            </a>\n                        </li>\n                        <div class=\"transcluded\"></div>\n                        <li><span gp-login-button></span></li>\n                    </ul>\n                </header>\n            `,\n\n            link: function($scope, $element, $attrs, ctrl, transcludeFn) {\n\n                $scope.showHomeLink = $scope.showHomeLink === 'true' || false;\n\n                $scope.portalUrl = Config.portalUrl;\n\n                AuthenticationService.getUserQ().then(function(user) {\n                    $scope.user = user;    \n                });\n                \n                $element.find('.transcluded').replaceWith(transcludeFn());\n            }            \n\n        };\n\n    }]);\n\n\n})(jQuery, angular);\n","(function(angular) {\n\n\n    \"use strict\";\n\n    angular.module('gp-common').directive('iframeOnload', function(){\n        return {\n            scope: {\n                callback: '&iframeOnload'\n            },\n            link: function(scope, element, attrs){\n                element.on('load', function(event){\n                    element.off('load');\n                    return scope.callback(event);\n                });\n            }\n        };\n    });\n\n}) (angular);","(function(angular, Constants) {\n    \n    \"use strict\";\n\n    angular.module(\"gp-common\")\n\n\n    .directive('onImgFail', function() {\n        return {\n            restrict: \"A\",\n            link: function($scope, $element, $attrs) {\n                var jqEl = jQuery($element);\n                jqEl.on('error', function() {\n                    jqEl.off('error');\n                    jqEl.attr('src', $attrs.onImgFail);\n                });\n            }\n        };\n    })\n\n\n    .directive('mapThumbnail', [function() {\n        return {\n            restrict: \"A\",\n            scope: {\n                mapThumbnail: '='\n            },\n            link: function($scope, $element, $attrs) {\n\n                let map = $scope.mapThumbnail;\n\n                if(map.$promise && !map.$resolved) {\n\n                    map.$promise\n                    .then(  (m) => { \n                        if(typeof(m.thumbnail) === 'string')    //old map model\n                            $element.attr('src', getUrl(m)); \n                        else \n                            buildThumbnail(m);                  //open map model\n                    })\n                    .catch( (e) => { $element.attr('src', null); });\n\n                } else {\n                    if(typeof(map.thumbnail) === 'string')    //old map model\n                        $element.attr('src', getUrl(map));\n                    else \n                        buildThumbnail(map);\n                }\n\n                function buildThumbnail(map) {\n                    if(!map.thumbnail) {\n                        $element.attr('src', null);\n\n                    } else if(map.thumbnail.contentData) {\n\n                        var style = \n                            'background-size:contain;' + \n                            'background-repeat:no-repeat;' + \n                            'background-image: url(data:' + \n                                (map.thumbnail.mediaType||'image/png') + ';base64,' + \n                                map.thumbnail.contentData + ');';\n\n                        //if directive is on a responsive item (aka, in a gp-ui-card), \n                        // ignore thumbnail dimensions. Otherwise, use them\n                        if($element.attr('class').indexOf('embed-responsive-item') < 0) {\n                            style += 'width:' + (map.thumbnail.width||'32') + 'px;' +\n                                     'height:' + (map.thumbnail.height||'32') + 'px;';\n                        }\n\n                        $element.attr('style', style);\n\n                    } else if(map.thumbnail.url) {\n                        $element.attr('src', map.thumbnail.url);\n                    } else \n                        $element.attr('src', null);\n\n                }\n\n\n                function getUrl(map) {\n                    var url = map.thumbnail;\n                    if(!url || !url.length)\n                        url = Constants.ualUrl + '/api/maps/' + map.id + '/thumbnail';\n                    else if(url.indexOf(\"http\") !== 0) {\n                        if(url[0] !== '/')\n                            url = Constants.ualUrl + '/' + url;\n                        else \n                            url = Constants.ualUrl + url;\n                    }\n                    return url;\n                }\n            }\n        };\n\n    }])\n\n\n    \n    .directive('itemThumbnail', ['$q', function($q) {\n        return {\n            restrict: \"E\",\n            replace: true,\n            scope: {\n                item    : '=',\n                fallback: '@',\n                link:     '@'\n            },\n            template:\n            `\n                <a ng-show=\"hasThumbnail\" class=\"media embed-responsive embed-responsive-16by9\">\n                    <img class=\"embed-responsive-item\" on-img-error=\"{{fallback||'/img/img-404.jpg'}}\">\n                </a>\n            `,\n            controller: function($scope) {\n                $scope.elName = 'div';\n\n                $scope.isLink = !!$scope.link;\n                if($scope.isLink) {\n                    $scope.elName = 'a';\n                }\n            }, \n            link: function($scope, $element, $attrs) {\n\n                let item = $scope.item;\n                (item.$promise || $q.resolve(item)).then( (obj) => {\n\n                    let url = $scope.fallback;\n                \n                    //maps\n                    if(obj.type && obj.type === 'Map')\n                        url = Constants.ualUrl + \"/api/maps/\" + obj.id + \"/thumbnail\";\n                    //maps as gallery items\n                    else if(obj.assetType && obj.assetType === 'Map')\n                        url = Constants.ualUrl + \"/api/maps/\" + obj.assetId + \"/thumbnail\";\n                    //other thumbnail'ed items with URLs\n                    else if(obj.thumbnail && obj.thumbnail.url)\n                        url = obj.thumbnail.url;\n                    //other thumbnail'ed items with base64 content\n                    else if(obj.thumbnail && obj.thumbnail.contentData) {\n                        \n                        var style = \n                            'background-size:contain;' + \n                            'background-repeat:no-repeat;' + \n                            'background-image: url(data:' + \n                                (obj.thumbnail.mediaType||'image/png') + ';base64,' + \n                                obj.thumbnail.contentData + ');';\n\n                        //if directive is on a responsive item (aka, in a gp-ui-card), \n                        // ignore thumbnail dimensions. Otherwise, use them\n                        if($element.attr('class').indexOf('embed-responsive-item') < 0) {\n                            style += 'width:' + (obj.thumbnail.width||'32') + 'px;' +\n                                     'height:' + (obj.thumbnail.height||'32') + 'px;';\n                        }\n\n                        $element.find('img').attr('style', style);\n                    }\n                    \n                    $scope.hasThumbnail = !!url;\n                    $element.find('img').attr('src', url);\n\n                    if($scope.isLink) {\n                        //$element is a.media because of 'replace:true'\n                        $element.attr('href', $scope.link).attr('target', '_blank');\n                    }\n            \n                })\n                .catch( (e) => { \n                    $element.find('img').attr('src', $scope.fallback); \n                });\n            }\n        };\n\n    }])\n\n    ;\n\n}) (angular, GeoPlatform);","(function(angular) {\n    \n    \"use strict\";\n\n\n    angular.module('gp-common')\n\n\n    //\n    .service('NotificationService', ['$rootScope', function($rootScope) {\n        var Service = function() {\n            this.items = [];\n        };\n        Service.prototype = {\n            getItems: function() { return this.items; },\n            /**\n             * @param item object\n             * @return function to cancel the notification\n             */\n            addItem: function(item) { \n                this.items.push(item); \n                $rootScope.$broadcast('gp:notifications:new', item);\n\n                var fn = function(item) { this.removeItem(item); };\n                return fn.bind(this, item);\n            },\n            removeItem: function(item) {\n                var index = this.items.indexOf(item);\n                if(index >= 0)\n                    return this.items.splice(index, 1);\n                return null;\n            },\n            error: function(label, msg, dismiss) { \n                return this.addItem({ type: 'error', label: label, message: msg, canDismiss: dismiss });\n            },\n            success: function(label, msg, dismiss) { \n                return this.addItem({ type: 'success', label: label, message: msg, canDismiss: dismiss });\n            },\n            info: function(label, msg, dismiss) { \n                return this.addItem({ type: 'info', label: label, message: msg, canDismiss: dismiss });\n            }\n        };\n        return new Service();\n    }])\n\n\n    // Usage: <gp-notifications />\n    .directive('gpNotifications', ['$timeout', 'NotificationService', function($timeout, NotificationService) {\n        return {\n            scope: {\n                expiration: '@'\n            },\n            template: [\n                '<div class=\"notifications ng-hide\" ng-show=\"items.length\">',\n                '  <div class=\"notification\" ng-repeat=\"item in items\"',\n                '    ng-class=\"{\\'notification--success\\':item.type===\\'success\\', \\'notification--error\\':item.type===\\'error\\', \\'notification--info\\':item.type===\\'info\\'}\">',\n                '    <h5 class=\"notification__title\">',\n                '        <span class=\"pull-right glyphicon\" ',\n                '            ng-class=\"{\\'glyphicon-ok-sign\\':item.type===\\'success\\',\\'glyphicon-exclamation-sign\\':item.type===\\'error\\',\\'glyphicon-info-sign\\':item.type===\\'info\\'}\">',\n                '        </span>',\n                '        {{item.label}}',\n                '    </h5>',\n                '    <p class=\"notification__content\" ng-bind-html=\"item.message\"></p>',\n                '    <div class=\"notification__actions\" ng-if=\"item.canDismiss\">',\n                '        <button type=\"button\" class=\"btn btn-link\" ng-click=\"dismiss(item)\">dismiss</button>',\n                '    </div>',\n                '  </div>',\n                '</div>'\n            ].join(' '),\n\n            link: function($scope, $element, $attrs) {\n\n                $scope.expiration = ($scope.expiration || 2000)*1;\n\n                $scope.items = [];\n\n\n                function update() {\n                    $scope.items = NotificationService.getItems();\n\n                    //if updated before timer expired, reset timer\n                    if($scope.timer) {\n                        $timeout.cancel($scope.timer);\n                        $scope.timer = null;\n                    }\n\n                    //set timer to kill earliest item after time\n                    $scope.timer = $timeout(function() {\n                        $scope.timer = null;\n                        //will ultimately call update() and thus trigger timeout again\n                        $scope.removeOldest();\n                    }, $scope.expiration);\n                }\n                update();\n\n                $scope.removeOldest = function() {\n                    //find oldest that can be removed\n                    var oldest = $scope.items.find(function(item) {return item.canDismiss;});\n                    if(oldest)\n                        NotificationService.removeItem(oldest);\n                };\n\n                $scope.dismiss = function(item) {\n                    //remove item using service\n                    NotificationService.removeItem(item);\n                };\n\n                $scope.$watchCollection(function() {\n                    return NotificationService.getItems();\n                }, update);\n\n                // $scope.$on('gp:notifications:new', function(event, item) { update(); });\n\n            }\n        };\n    }]);\n\n\n})(angular);","(function(jQuery, angular) {\n    \n    \"use strict\";\n\n\n\n    /*\n     * Usage:\n     * \n     *      <gp-pagination service=\"$ctrl.service\" event-key=\"maps\"></gp-pagination>\n     *\n     *  Expects a BrowseObjService instance for the 'service' binding, or at least \n     * one that provides the same pagination and options API.\n     */\n\n\n\n\n\n\n    /**\n     * Requires a service which exposes the following methods:\n     *   - getPagination() : returns {object} defining 'start', 'size', and 'total'\n     *   - start(int) : takes {int} defining which index to start requesting\n     *   - size(int) : takes {int} defining how many items to request\n     *   - on(eventName, listener) : must support event \"gp:browse:<key>:pagination\" where 'key' may be 'objects' or a custom key\n     */\n    class PaginationController {\n\n        constructor () {\n            'ngInject';\n        }\n\n        $onInit () {\n            \n            if(!this.service) return;\n\n            this.options = this.service.getPagination();\n            \n            //support using a traditional select instead of a uib dropdown menu\n            // in case the pagination control itself is wrapped in a dropdown menu.\n            //in this case, we use objects with labels and values in order to display\n            // the 'per page' text along with whatever the page size is.\n            \n            this.pageSizeDropdown = true;\n            this.useSelect = typeof(this.useSelect) !== 'undefined' && \n                (this.useSelect === true || this.useSelect === 'true' || this.useSelect === 1);\n            if(this.useSelect) {\n                this.pageSizeDropdown = false;\n                this.pageSize = this.options.size;\n                this.pageSizeOptions = (this.options.sizeOptions||[5,10,20,50]).map(o=> {\n                    return { label: o +' per page', value: o };\n                });\n            } \n\n            let event = 'gp:browse:';\n            if(this.eventKey)\n                event = 'gp:browse:' + this.eventKey + \":\";\n            else\n                event = 'gp:browse:objects:';\n\n            this.listener = this.service.on(event + 'pagination', () => { \n                this.options = this.service.getPagination();\n            });\n        }\n\n        $onDestroy () {\n\n            //remove listener from service if exists\n            if(this.listener) \n                this.listener();\n\n            this.service = null;\n        }\n\n        \n        previous () { \n            if(this.service && this.hasPrevious()) {\n                this.service.start(Math.max(0, this.options.start*1 - this.options.size*1), true);\n            }\n        }\n\n        next () {\n            if(this.service && this.hasNext()) {\n                this.service.start(Math.min(this.options.total, this.options.start*1 + this.options.size*1), true);\n            }\n        }\n\n        first () {\n            if(this.service && this.hasPrevious()) {\n                this.service.start(0, true);\n            }\n        }\n\n        last () {\n            if(this.service && this.hasNext()) {\n                var lastPage = Math.floor(this.options.total / this.options.size);\n                this.setPage(lastPage);\n            }\n        }\n\n        setPage (arg) {\n            if(this.service) {\n                var page = arg*1;\n                this.service.start(page * (this.options.size*1), true);\n            }\n        }\n\n        setPageSize (size) {\n            if(this.service) {\n                this.service.size(size*1, true);\n            }\n        }\n\n        hasPrevious () {\n            return this.options && this.options.start > 0;\n        }\n\n        hasNext () {\n            return this.options && (this.options.start+this.options.size) < this.options.total;\n        }\n\n    }\n\n\n\n\n\n    angular.module('gp-common').component('gpPagination', {\n\n        bindings: {\n            service: '=',\n            eventKey: '@',\n            useSelect: '@'\n        },\n\n        controller: PaginationController,\n\n        template: \n        `\n            <div class=\"c-pagination\">\n                <div class=\"c-pagination__total\">{{$ctrl.options.total||0}} results</div>\n                <div class=\"c-pagination__page-size\" ng-if=\"$ctrl.pageSizeDropdown\">\n                    <span uib-dropdown>\n                        <a href=\"\" uib-dropdown-toggle title=\"Change the number of results returned\">\n                            {{$ctrl.options.size}} per page <span class=\"caret\"></span>\n                        </a>\n                        <ul class=\"dropdown-menu\" role=\"menu\">\n                            <li ng-repeat=\"size in $ctrl.options.sizeOptions track by $index\">\n                                <a ng-click=\"$ctrl.setPageSize(size)\">{{size}} per page</a>\n                            </li>\n                        </ul>\n                    </span>\n                </div>\n                <div class=\"c-pagination__page-size\" ng-if=\"!$ctrl.pageSizeDropdown\">\n                    <select class=\"form-control\" \n                        ng-model=\"$ctrl.pageSize\" ng-change=\"$ctrl.setPageSize($ctrl.pageSize)\"\n                        ng-options=\"opt.value as opt.label for opt in $ctrl.pageSizeOptions\">\n                    </select>\n                </div>\n                <div class=\"c-pagination__pages\">\n                    <div class=\"c-pagination__button\" \n                        ng-class=\"{'is-disabled':!$ctrl.hasPrevious()}\"\n                        ng-click=\"$ctrl.first()\">\n                        <span class=\"glyphicon glyphicon-fast-backward\"></span>\n                    </div>\n                    <div class=\"c-pagination__button\" \n                        ng-class=\"{'is-disabled':!$ctrl.hasPrevious()}\"\n                        ng-click=\"$ctrl.previous()\">\n                        <span class=\"glyphicon glyphicon-backward\"></span>\n                    </div>\n                    <div class=\"c-pagination__page\">\n                        {{$ctrl.options.start+1}} - {{$ctrl.options.start+$ctrl.options.size}}\n                    </div>\n                    <div class=\"c-pagination__button\" \n                        ng-class=\"{'is-disabled':!$ctrl.hasNext()}\"\n                        ng-click=\"$ctrl.next()\">\n                        <span class=\"glyphicon glyphicon-forward\"></span>\n                    </div>\n                    <div class=\"c-pagination__button\" \n                        ng-class=\"{'is-disabled':!$ctrl.hasNext()}\"\n                        ng-click=\"$ctrl.last()\">\n                        <span class=\"glyphicon glyphicon-fast-forward\"></span>\n                    </div>\n                </div>\n            </div>\n        `\n\n    });\n\n})(jQuery, angular);","(function(angular) {\n    \n    \"use strict\";\n\n\n    /**\n     * Usage: \n     *  <gp-progress-circle ng-model=\"$ctrl.amount\"></gp-progress-circle>\n     */\n    angular.module('gp-common').component('gpProgressCircle', {\n\n        bindings: {\n            ngModel: '<'    //amount out of 100\n        },\n\n        controller: function() {\n\n            this.$onInit = function() {\n                this.dashArray = 2 * Math.PI * 45 /*radius*/;\n                if(!this.ngModel)\n                    this.ngModel = 0;\n                this.update();\n            };\n\n            this.$onChanges = function(changes) {\n                if(changes.ngModel)\n                    this.update();\n            };\n\n            this.update = function() {\n                let offset = 2 * Math.PI * 45 * (1 - ( this.ngModel / 100) );\n                this.value = offset;\n            };\n\n        },\n\n        template: \n        `\n            <svg class=\"c-progress--circle\" viewBox=\"0 0 100 100\">\n                <circle class=\"c-progress__meter\" cx=\"50\" cy=\"50\" r=\"45\" stroke-width=\"10\" />\n                <circle class=\"c-progress__value\" cx=\"50\" cy=\"50\" r=\"45\" stroke-width=\"10\" \n                    stroke-dasharray=\"{{$ctrl.dashArray}}\" stroke-dashoffset=\"{{$ctrl.value}}\"/>\n                <text class=\"c-progress__label\" x=\"50\" y=\"-40\" text-anchor=\"middle\">{{$ctrl.ngModel}}%</text>\n            </svg>\n        `\n    });\n\n\n}) (angular);","(function(jQuery, angular) {\n\n    \"use strict\";\n\n\n    angular.module('gp-common')\n\n\n    //helper to determine size of window for responsive breakpoint purposes\n    .provider('responsiveHelper', [\"$windowProvider\", function ($windowProvider) {\n        \n        var $window  = $windowProvider.$get();\n\n        function Helper($window) {\n            this.window = $window;\n        }\n        Helper.prototype = {\n            getWidth: function() { return $window.innerWidth || $window.outerWidth; },\n            isXS: function () { var width = this.getWidth(); return width < 768; },\n            isSM: function () { var width = this.getWidth(); return width >= 768 && width < 992; },\n            isMD: function () { var width = this.getWidth(); return width >= 992 && width < 1200; },\n            isLG: function () { var width = this.getWidth(); return width >= 1200; }\n        };\n\n        var helper = new Helper($window);\n\n        this.$get = function() {\n            return helper;\n        };\n    }])\n\n\n    //directive which appends appropriate responsive breakpoint classNames to the element\n    // on which it's set\n    .directive('gpResponsive', ['$window', 'responsiveHelper', function($window, responsiveHelper) {\n\n        return {\n            restrict: \"A\",\n            link: function($scope, $element, $attrs) {\n\n                function update(el, helper) {\n                    if(helper.isXS())\n                        el.addClass('gp-responsive-xs');\n                    else\n                        el.removeClass('gp-responsive-xs');\n\n                    if(helper.isSM())\n                        el.addClass('gp-responsive-sm');\n                    else \n                        el.removeClass('gp-responsive-sm');\n\n                    if(helper.isMD())\n                        el.addClass('gp-responsive-md');\n                    else \n                        el.removeClass('gp-responsive-md');\n\n                    if(helper.isLG())\n                        el.addClass('gp-responsive-lg');\n                    else \n                        el.removeClass('gp-responsive-lg');\n                }\n\n                update($element, responsiveHelper);\n\n                var resizeFn = function() {\n                    update($element, responsiveHelper);\n                };\n\n                var w = angular.element($window);\n                var listener = w.on('resize', resizeFn);\n\n                $scope.$on('$destroy', function() {\n                    w.off('resize', resizeFn);\n                });\n\n            }\n        };\n\n    }])\n\n\n    .directive('gpResize', function($window, $timeout) {\n        return function($scope, $element, $attr) {\n\n            var resizeFn = function() {\n                var hh = jQuery('header')[0].offsetHeight;\n                // var fh = jQuery('footer')[0].offsetHeight;\n                // console.log('hh & fh', hh, fh);                    \n\n                var tp = hh + 2;\n                // var bt = fh + 2;\n                // console.log('tp & bt', tp, bt);                \n                \n                var changes = {\n                    // bottom: bt + 'px',\n                    top: tp + 'px',\n                };\n                $element.css(changes);\n                $scope.$apply();\n            };\n\n            var w = angular.element($window);\n            w.on('resize', resizeFn);\n\n            $timeout(resizeFn, 200);\n\n            $scope.$on('$destroy', function() {\n                w.off('resize', resizeFn);\n            });\n\n        };\n    });\n\n})(jQuery, angular);","(function(jQuery, angular) {\n    \n    \"use strict\";\n\n\n\n    function inputLinkFunction($scope, $element, $attrs, ngModelController, $timeout) {\n\n        if(!$scope.type) $scope.type = \"text\";\n        if($scope.required === 'true')\n            $scope.required = true;\n        else $scope.required = false;\n\n        $scope.elId = 'input_' + Math.ceil(Math.random()*9999);\n        $scope.size = $scope.size || 'medium';\n        $scope.type = $scope.type || 'text';\n\n\n\n        //listen for changes to the inner value by way of the form-control\n        $element.find('.form-control').on('change', function onChange() { \n            validate($scope.innerValue); \n        });\n        \n        \n\n        /* ------------- private methods --------------- */\n\n        function validate() {\n\n            //check form-control for ng-invalid\n            var input = $element.find('.form-control');\n\n            $scope.isDirty = input.hasClass('ng-dirty');\n\n            if(input.hasClass('ng-invalid')) {\n                if(input.hasClass(\"ng-empty\"))\n                    $scope.error = \"This field requires a value\";\n                else\n                    $scope.error = \"Invalid value provided\";\n            } else\n                $scope.error = null;\n\n        }\n\n        function update(newValue) {\n            // call $parsers pipeline then update $modelValue\n            ngModelController.$setViewValue(newValue);\n            // update the local view\n            ngModelController.$render();\n        }\n\n\n\n        // when model change, update our view (just update the div content)\n        ngModelController.$render = function() {\n                \n            var value = ngModelController.$viewValue;\n\n            //create copy of passed in model value that can be used\n            // by the controls here allowing us to cancel and \n            // commit changes at our own leisure\n            $scope.innerValue = value;\n            \n            $scope.displayValue = value || $scope.placeholder || \"No value provided\";\n\n            validate(value);\n        };\n\n\n        /* ------------- private methods --------------- */\n\n        $scope.isReadOnly = function() {\n            var t = typeof(this.readOnly);\n            if(t === 'undefined') return false;\n            if(t === 'string') return this.readOnly.toLowerCase() === 'true';\n            if(t === 'number') return this.readOnly === 1;\n            if(t === 'boolean') return this.readOnly;\n            return false;\n        };\n\n        //enter edit mode\n        $scope.edit = function() {\n            if($scope.isReadOnly()) return;\n            $scope.editing=true;\n            //auto-focus on form-control when entering edit mode\n            $timeout(function() { $element.find('.form-control').focus().select(); }, 200);\n        };\n        //leave edit mode (regardless of save() or cancel())\n        $scope.done = function() {\n            $scope.editing=false;\n            $scope.error = null;\n        };\n\n\n        $scope.save = function() {\n            //update display with new value\n            update($scope.innerValue);\n            $scope.done();\n        };\n        $scope.cancel = function() {\n            //reset inner value\n            $scope.innerValue = ngModelController.$viewValue;\n            $scope.done();\n        };\n\n\n        $scope.onKeyPress = function($event, code) {\n            // console.log(\"Pressed \" + code);\n            if((code === undefined || code === 0) && $event.which !== undefined)\n                code = $event.which;\n            if($scope.type === 'number') {\n                \n                //NOTE: Chrome does not catch Backspace onKeyPress, so it \n                // skips this handler. FF does, so we need to watch for \n                // backspace, delete, and numbers\n\n                if (code === 8  ||   //backspace\n                    code === 46 ||  //delete  \n                    (code >= 44 && code <= 57))    //comma, hyphen, period and numbers (0-9)\n                    return;\n                \n                //NOTE: keyPress period is 46. keyDown it is 190\n\n                $event.preventDefault();\n                return false;               //ignore key\n            }\n        };\n        $scope.onKeyUp = function($event, code) {\n            // console.log(\"Up \" + code);\n            if((code === undefined || code === 0) && $event.which !== undefined)\n                code = $event.which;\n            if(code === 13 && !$scope.error) $scope.done();  //enter\n            else if(code === 27)             $scope.cancel();//esc\n            else {\n            \n                if(code !== 8 &&                //backspace\n                    code !== 46 &&              //delete\n                    code !== 190 &&             //period\n                    (code < 48 || code > 90) && //letters and numbers (a-z, 0-9)\n                    (code < 106 || code > 111) && \n                    (code < 186)) \n                    return;\n\n                validate();\n            }\n        };\n\n\n        $scope.$destroy = function() {\n            $element.off('change');\n        };\n    }\n\n\n\n    angular.module(\"gp-common\")\n\n    .directive('gpSlickFormInput', ['$timeout', function($timeout) {\n\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                placeholder: '@',\n                help: '=',\n                // validator: '&',\n                // validationExpr: '@',\n                type: '@',\n                pattern: \"@\",\n                required: '@',\n                readOnly: '@',\n                size: '@',\n                icon: '@'\n            },\n            template: INPUT_TEMPLATE,\n            link: function($scope, $element, $attrs, ngModelController) {\n                inputLinkFunction($scope, $element, $attrs, ngModelController, $timeout);\n            }\n        };\n\n    }])\n\n\n    .directive('gpSlickFormTextarea', ['$timeout', function($timeout) {\n\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                placeholder: '@',\n                help: \"@\",\n                readOnly: \"@\",\n                size: \"@\",\n                icon: \"@\"\n            },\n            template: TEXTAREA_TEMPLATE,\n            link: function($scope, $element, $attrs, ngModelController) {\n                inputLinkFunction($scope, $element, $attrs, ngModelController, $timeout);\n            }\n        };\n\n    }])\n\n\n    /**\n     *\n     * Notes:\n     *  - use 'form form-inline' classes for editable date so the field doesn't take up whole line\n     */\n    .directive('gpSlickFormDate', ['$timeout', '$filter', function($timeout, $filter) {\n\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                format: \"@\",\n                placeholder: '@',\n                required: \"@\",\n                readOnly: \"@\",\n                size: '@',\n                icon: '@'\n            },\n            template: DATE_TEMPLATE,\n\n            controller: function($scope, $element) {\n                if(!$scope.format || $scope.format.length < 3) $scope.format = \"mediumDate\";\n                $scope.inline = $element.hasClass(\"inline\");\n            },\n\n            /**\n             *\n             */\n            link: function($scope, $element, $attrs, ngModelController) {\n\n                if($scope.required === 'true')\n                    $scope.required = true;\n                else $scope.required = false;\n                \n                $scope.elId = 'input_' + Math.ceil(Math.random()*9999);\n                $scope.size = $scope.size || 'medium';\n                $scope.type = $scope.type || 'text';\n\n\n                function validate(value) {\n                    // console.log(\"Validating '\" + value + \"'\");\n\n                    //check form-control for ng-invalid\n                    var input = $element.find('.form-control');\n                    if(input.hasClass('ng-invalid')) {\n                        if(input.hasClass(\"ng-empty\"))\n                            $scope.error = \"This field requires a value\";\n                        else\n                            $scope.error = \"Invalid value provided\";\n                    } else\n                        $scope.error = null;\n                }\n\n                function update(newValue) {\n                    // call $parsers pipeline then update $modelValue\n                    ngModelController.$setViewValue(newValue);\n                    // update the local view\n                    ngModelController.$render();\n                }\n\n\n                // when model change, update our view (just update the div content)\n                ngModelController.$render = function() {\n\n                    var value = ngModelController.$viewValue;\n\n                    //create copy of passed in model value that can be used\n                    // by the controls here allowing us to cancel and \n                    // commit changes at our own leisure\n                    $scope.innerValue = value;\n                    \n                    $scope.displayValue = value ? $filter('date')(ngModelController.$modelValue, $scope.format) :\n                        $scope.placeholder || \"No value provided\";\n\n                    validate(value);\n\n                };\n\n\n\n\n                $scope.isReadOnly = function() {\n                    var t = typeof(this.readOnly);\n                    if(t === 'undefined') return false;\n                    if(t === 'string') return this.readOnly.toLowerCase() === 'true';\n                    if(t === 'number') return this.readOnly === 1;\n                    if(t === 'boolean') return this.readOnly;\n                    return false;\n                };\n\n\n                //enter edit mode\n                $scope.edit = function() {\n                    if($scope.isReadOnly()) return;\n                    \n                    $scope.editing=true;\n                    \n                    //auto-focus on form-control when entering edit mode\n                    // $timeout(function() { $element.find('.form-control').focus().select(); }, 200);\n                };\n                //leave edit mode (regardless of save() or cancel())\n                $scope.done = function() {\n                    $scope.opened = false;\n                    $scope.editing=false;\n                    $scope.error = null;\n                };\n\n\n                $scope.save = function() {\n                    //update display with new value\n                    update($scope.innerValue);\n                    $scope.done();\n                };\n                $scope.cancel = function() {\n                    //reset inner value\n                    $scope.innerValue = angular.copy(ngModelController.$modelValue);\n                    $scope.done();\n                };\n\n\n                \n                \n\n                $scope.open = function() {\n                    //must wrap 'opened' variable in an object for \n                    // angular to properly track its value changes\n                    // from within children scope (ie, the date picker)\n                    if (typeof($scope.uibopts) === 'undefined'){\n                       $scope.uibopts = {};\n                    }\n                    $scope.uibopts.opened = true;\n                };\n\n                $scope.onKeyUp = function(code) {\n                    if(code === 13) {   //enter\n                        $scope.done();\n                    } else if(code === 27) {    //esc\n                        $scope.cancel();\n                    }\n                };\n                $scope.onChange = function(date) {\n                    if(isNaN(ngModelController.$modelValue) && $scope.required) {\n                        $scope.error = \"This field requires a value\";\n                    } else $scope.error = null;\n                };\n            }\n        };\n\n    }])\n\n\n\n    .directive('gpSlickFormSelect', ['$timeout', function($timeout) {\n\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                codeList: \"=\",\n                help: '=',\n                required: \"@\",\n                readOnly: \"@\",\n                size: '@',\n                icon: '@'\n            },\n            template: SELECT_TEMPLATE,\n            link: function($scope, $element, $attrs, ngModelController) {\n\n                if(!$scope.type) $scope.type = \"text\";\n                if($scope.required === 'true')\n                    $scope.required = true;\n                else $scope.required = false;\n\n                $scope.elId = 'input_' + Math.ceil(Math.random()*9999);\n                $scope.size = $scope.size || 'medium';\n                $scope.type = $scope.type || 'text';\n\n                var $select = null;\n\n                function getSelect() {\n                    if(!$select || !$select.length)\n                        $select = $element.find('.form-control');\n                    return $select;\n                }\n\n\n                if($scope.codeList) {\n                    $scope.selectOptions = $scope.codeList.map(function(item) {\n                        if(typeof(item) !== 'object' || !item.value)\n                            return {value: item, label: item};\n                        else if(!item.label)\n                            return {value: item.value, label: item.value};\n                        return item;\n                    });\n                } else \n                    $scope.selectOptions = [];\n\n\n\n                //listen for changes to the inner value by way of the form-control\n                // $element.find('.form-control').on('change', function onChange() { \n                //     validate($scope.innerValue); \n                // });\n                \n                \n\n                /* ------------- private methods --------------- */\n\n                function validate() {\n\n                    //check form-control for ng-invalid\n                    var select = getSelect();\n\n                    $scope.isDirty = select.hasClass('ng-dirty');\n\n                    if(select.hasClass('ng-invalid')) {\n                        if(select.hasClass(\"ng-empty\"))\n                            $scope.error = \"This field requires a value\";\n                        else\n                            $scope.error = \"Invalid value provided\";\n                    } else\n                        $scope.error = null;\n\n                }\n\n                function update(newValue) {\n                    // call $parsers pipeline then update $modelValue\n                    ngModelController.$setViewValue(newValue);\n                    // update the local view\n                    ngModelController.$render();\n                }\n\n\n\n                // when model change, update our view (just update the div content)\n                ngModelController.$render = function() {\n                        \n                    var value = ngModelController.$viewValue;\n\n                    //@see https://github.com/angular/angular.js/commit/7fda214c4f65a6a06b25cf5d5aff013a364e9cef\n\n                    //create copy of passed in model value that can be used\n                    // by the controls here allowing us to cancel and \n                    // commit changes at our own leisure\n                    $scope.innerValue = value;\n\n                    $scope.displayValue = $scope.placeholder || \"No value provided\";\n\n                    if(value) {\n                        //values are objects, not literals\n                        var opt = $scope.selectOptions.find(function(o){return o.value==value;});\n                        $scope.displayValue = opt.label;\n                    }\n                    \n                    validate();\n                };\n\n\n                /* ------------- private methods --------------- */\n\n                $scope.onChange = function(value) {\n                    \n                    // console.log(\"Changing value \" + value + \" vs \" + $scope.innerValue);\n                    $scope.innerValue = value;                \n                    $timeout(function() { validate(); }, 200);\n\n                };\n\n                $scope.onTypeaheadSelection = function($item, $model, $label, $event) {\n\n                    $scope.innerValue = $item ? $item.value : null;\n                    $timeout(function() { validate(); }, 200);\n\n                };\n\n                $scope.isReadOnly = function() {\n                    var t = typeof(this.readOnly);\n                    if(t === 'undefined') return false;\n                    if(t === 'string') return this.readOnly.toLowerCase() === 'true';\n                    if(t === 'number') return this.readOnly === 1;\n                    if(t === 'boolean') return this.readOnly;\n                    return false;\n                };\n\n                //enter edit mode\n                $scope.edit = function() {\n                    if($scope.isReadOnly()) return;\n                    $scope.editing=true;\n                    //auto-focus on form-control when entering edit mode\n                    $timeout(function() { $select.focus().select(); }, 200);\n                };\n                //leave edit mode (regardless of save() or cancel())\n                $scope.done = function() {\n                    $scope.editing=false;\n                    $scope.error = null;\n                };\n\n\n                $scope.save = function() {\n                    //update display with new value\n                    update($scope.innerValue);\n                    $scope.done();\n                };\n                $scope.cancel = function() {\n                    //reset inner value\n                    $scope.innerValue = ngModelController.$viewValue;\n                    $scope.done();\n                };\n\n                $scope.onKeyUp = function(code) {\n                    if(code === 13 && !$scope.error) {   //enter\n                        $scope.save();\n                    } else if(code === 27) {    //esc\n                        $scope.cancel();\n                    }\n                };\n\n                $scope.onTypeaheadKeyUp = function(code) {\n                    validate();\n                };\n\n\n                $scope.$destroy = function() {\n                    // $element.off('change');\n                };\n            }\n        };\n\n    }])\n\n\n\n    ;\n\n\n    var INPUT_TEMPLATE = [\n        \n        '<div class=\"form-group form-group-slick\">',\n        \n        '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>',\n        \n        '   <div class=\"input__display\" ',\n        '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error,\\'text-lg\\':size===\\'large\\'}\" ',\n        '       ng-show=\"!editing\" ng-click=\"edit()\" ',\n        '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">',\n        '      {{displayValue}}',\n        '   </div>',\n        \n        '   <div ng-show=\"editing\">',\n        '      <div class=\"input-group\" ng-class=\"{\\'input-group-lg\\':size===\\'large\\'}\">',\n        '           <div class=\"input-group-slick\" ng-class=\"{\\'input-group-slick--lg\\':size===\\'large\\'}\">',\n        \n        '               <span ng-if=\"icon\" class=\"{{::icon}}\"></span>',\n        \n        '               <input id=\"{{::elId}}\" type=\"{{::type}}\" class=\"form-control\" ',\n        '                   pattern=\"{{pattern}}\" ',\n        '                   ng-model=\"innerValue\" ',\n        '                   ng-required=\"{{required}}\" ',\n        '                   ng-keypress=\"onKeyPress($event, $event.keyCode)\" ',\n        '                   ng-keyup=\"onKeyUp($event, $event.keyCode)\" >',\n        \n        '               <span class=\"indicators\">',\n        '                   <span class=\"is-valid glyphicon glyphicon-ok-sign\"></span>',\n        '                  <span class=\"is-invalid glyphicon glyphicon-exclamation-sign\"></span>',\n        '              </span>',\n        \n        '           </div>',\n        \n        '          <span class=\"input-group-btn\">',\n        \n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '                   ng-click=\"cancel()\" title=\"Cancel changes\">',\n        '                   <span class=\"glyphicon glyphicon-ban-circle\"></span>',\n        '              </button>',\n        \n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{disabled:!!error||!isDirty,\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '                   ng-disabled=\"{{!!error}}\" ',\n        '                   ng-click=\"save()\" title=\"Save changes\">',\n        '                  <span class=\"glyphicon glyphicon-ok\"></span>',\n        '               </button>',\n        \n        '           </span>',\n        \n        '       </div>', \n\n        '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>',\n        '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>',\n        \n        '   </div>',\n        \n        '</div>'\n\n    ].join(' ');\n\n    var TEXTAREA_TEMPLATE = [\n        '<div class=\"form-group form-group-slick\">',\n        \n        '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>',\n        \n        '   <div class=\"input__display\" ',\n        '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error,\\'text-lg\\':size===\\'large\\'}\" ',\n        '       ng-show=\"!editing\" ng-click=\"edit()\" ',\n        '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">',\n        '      {{displayValue}}',\n        '   </div>',\n        \n        '   <div ng-show=\"editing\">',\n        '      <div class=\"input-group\" ng-class=\"{\\'input-group-lg\\':size===\\'large\\'}\">',\n        '           <div class=\"input-group-slick\" ng-class=\"{\\'input-group-slick--lg\\':size===\\'large\\'}\">',\n        \n        '               <span ng-if=\"icon\" class=\"{{::icon}}\"></span>',\n        \n        '               <textarea rows=\"3\" id=\"{{::elId}}\" class=\"form-control\" ',\n        '                   ng-required=\"{{required}}\" ng-model=\"innerValue\"',\n        '                   ng-keypress=\"onKeyPress($event, $event.keyCode)\" ',\n        '                   ng-keyup=\"onKeyUp($event, $event.keyCode)\"></textarea>',\n        \n        '               <span class=\"indicators\">',\n        '                   <span class=\"is-valid glyphicon glyphicon-ok-sign\"></span>',\n        '                  <span class=\"is-invalid glyphicon glyphicon-exclamation-sign\"></span>',\n        '              </span>',\n        \n        '           </div>',\n        \n        '          <span class=\"input-group-btn\">',\n        \n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '                   ng-click=\"cancel()\" title=\"Cancel changes\">',\n        '                   <span class=\"glyphicon glyphicon-ban-circle\"></span>',\n        '              </button>',\n        \n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{disabled:!!error||!isDirty,\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '                   ng-disabled=\"{{!!error}}\" ',\n        '                   ng-click=\"save()\" title=\"Save changes\">',\n        '                  <span class=\"glyphicon glyphicon-ok\"></span>',\n        '               </button>',\n        \n        '           </span>',\n        \n        '       </div>', \n\n        '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>',\n        '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>',\n        \n        '   </div>',\n        \n        '</div>'\n    ].join(' ');\n\n    var DATE_TEMPLATE = [\n\n        \n        '<div class=\"form-group form-group-slick\">',\n        \n        '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>',\n\n        '   <div class=\"input__display\" ',\n        '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error}\" ',\n        '       ng-show=\"!editing\" ng-click=\"edit()\" ',\n        '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">',\n        '      {{displayValue}}',\n        '   </div>',\n        \n        '   <div ng-show=\"editing\">',\n        '       <div uib-datepicker ng-required=\"{{required}}\" ng-model=\"innerValue\" datepicker-options=\"{showWeeks:false}\"></div>',\n        \n        '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>',\n        '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>',\n        \n        '       <button type=\"button\" class=\"btn btn-default\" ',\n        '           ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '           ng-click=\"cancel()\" title=\"Cancel changes\">',\n        '           <span class=\"glyphicon glyphicon-ban-circle\"></span>',\n        '      </button>',\n        \n        '      <button type=\"button\" class=\"btn btn-default\" ',\n        '           ng-class=\"{disabled:!!error,\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '          ng-disabled=\"{{!!error}}\" ',\n        '           ng-click=\"save()\" title=\"Save changes\">',\n        '           <span class=\"glyphicon glyphicon-ok\"></span>',\n        '      </button>',\n\n        '   </div>',\n\n        '</div>'\n\n    ].join(' ');\n\n    var SELECT_TEMPLATE = [\n        \n        '<div class=\"form-group form-group-slick\">',\n        \n        '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>',\n        \n        '   <div class=\"input__display\" ',\n        '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error}\" ',\n        '       ng-show=\"!editing\" ng-click=\"edit()\" ',\n        '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">',\n        '      {{displayValue}}',\n        '   </div>',\n        \n        '   <div ng-show=\"editing\">',\n\n        '      <div class=\"input-group\" ng-class=\"{\\'input-group-lg\\':size===\\'large\\'}\">',\n        \n        '           <div class=\"input-group-slick\" ng-class=\"{\\'input-group-slick--lg\\':size===\\'large\\'}\">',\n        \n        '               <span ng-if=\"icon\" class=\"{{::icon}}\"></span>',\n        \n        '               <select class=\"form-control input__field\" ',\n        '                   ng-if=\"codeList.length<=12\" ',\n        '                   ng-model=\"innerValue\" ',\n        '                   ng-options=\"opt.value as opt.label for opt in selectOptions\" ',\n        '                   ng-required=\"{{required}}\" ',\n        '                   ng-change=\"onChange(innerValue)\" ',\n        '                   ng-keyUp=\"onKeyUp($event.keyCode)\" >',\n        '                   <option value=\"\">Select One</option>',\n        '               </select>',\n\n        '               <input type=\"text\" class=\"form-control input__field\" ng-if=\"codeList.length>12\" ',\n        '                   ng-model=\"innerValue\" ',\n        '                   ng-required=\"{{required}}\" ',\n        '                   ng-keyUp=\"onTypeaheadKeyUp($event.keyCode)\" ',\n        '                   typeahead-on-select=\"onTypeaheadSelection($item, $model, $label, $event)\" ',\n        '                   uib-typeahead=\"opt.value as opt.label for opt in selectOptions | filter:{value:$viewValue} | limitTo:12\" ',\n        '                   typeahead-min-length=\"0\" ',\n        '                   typeahead-editable=\"false\">',\n        \n        '               <span class=\"indicators\">',\n        '                   <span class=\"is-valid glyphicon glyphicon-ok-sign\"></span>',\n        '                  <span class=\"is-invalid glyphicon glyphicon-exclamation-sign\"></span>',\n        '              </span>',\n        \n        '           </div>',\n        \n        '          <span class=\"input-group-btn\">',\n        \n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '                   ng-click=\"cancel()\" title=\"Cancel changes\">',\n        '                   <span class=\"glyphicon glyphicon-ban-circle\"></span>',\n        '              </button>',\n        \n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{disabled:!!error||!isDirty,\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '                   ng-disabled=\"{{!!error}}\" ',\n        '                   ng-click=\"save()\" title=\"Save changes\">',\n        '                  <span class=\"glyphicon glyphicon-ok\"></span>',\n        '               </button>',\n        \n        '           </span>',\n        \n        '       </div>',\n        \n        '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>',\n        '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>',\n        \n        '   </div>',\n        \n        '</div>'\n\n    ].join(' ');\n\n})(jQuery, angular);","(function(angular) {\n    \n    \"use strict\";\n\n    angular.module(\"gp-common\").directive('gpTweetButton', ['$timeout', function($timeout) {\n        \n        function debounce(func, wait, immediate) {\n            var timeout;\n            return function() {\n                var context = this,\n                    args = arguments;\n                var later = function() {\n                    timeout = null;\n                    if (!immediate) func.apply(context, args);\n                };\n                var callNow = immediate && !timeout;\n                clearTimeout(timeout);\n                timeout = setTimeout(later, wait);\n                if (callNow) func.apply(context, args);\n            };\n        }\n\n        return {\n            link: function(scope, element, attr) {\n\n                if(typeof(twttr) === 'undefined') {\n                    element.className += ' disabled';\n                    return;\n                }\n\n                var renderTwitterButton = debounce(function() {\n                    if (attr.url) {\n                        $timeout(function() {\n                            element[0].innerHTML = '';\n                            twttr.widgets.createShareButton(\n                                attr.url,\n                                element[0],\n                                function() {}, {\n                                    count: attr.count,\n                                    text: attr.text,\n                                    via: attr.via,\n                                    size: attr.size,\n                                    hashtags: attr.hashtags,\n                                    dnt: attr.dnt\n                                }\n                            );\n                        });\n                    }\n                }, 75);\n                attr.$observe('url', renderTwitterButton);\n                attr.$observe('text', renderTwitterButton);\n            }\n        };\n    }]);\n\n}) (angular);","(function(angular) {\n\n    \"use strict\";\n\n    angular.module(\"gp-common\").directive('sortOrder', function() {\n        return {\n            \n            replace: true,\n            require: 'ngModel',\n            \n            template: [\n                '<div>',\n                '<a class=\"btn btn-default\" title=\"Click to sort in ascending order\" href ng-if=\"value===\\'dsc\\'\" ng-click=\"toggle()\">',\n                '    <span class=\"glyphicon glyphicon-sort-by-attributes-alt\"></span>',\n                '</a>',\n                '<a class=\"btn btn-default\" title=\"Click to sort in descending order\" href ng-if=\"value===\\'asc\\'\" ng-click=\"toggle()\">',\n                '    <span class=\"glyphicon glyphicon-sort-by-attributes\"></span>',\n                '</a>',\n                '</div>'\n            ].join(' '),\n\n            link: function($scope, element, attrs, ngModel) {\n                ngModel.$viewChangeListeners.push(function() {\n                    $scope.$eval(attrs.ngChange);\n                });\n                ngModel.$render = function() {\n                    $scope.value = ngModel.$modelValue;\n                };\n                $scope.toggle = function() {\n                    $scope.value = $scope.value === 'asc' ? 'dsc' : 'asc';\n                    ngModel.$setViewValue($scope.value);\n                };\n            }\n        };\n    });\n\n})(angular);","(function(angular) {\n    \n    'use strict';\n\n    /** \n     * directive used in conjunction with ng-model to map arrays of strings\n     * to form field controls for editing.\n     *\n     * Usage:  <input ng-model=\"arrOfStr\" string-array-input></input>\n     *\n     */\n    angular.module('gp-common').directive('stringArrayInput', function() {\n        return {\n            restrict: 'A',\n            require: 'ngModel',\n            link: function(scope, element, attr, ngModel) {\n                \n                function fromInput(text) {\n                    let result = null;\n                    if(text && text.length)\n                        result = text.split(',').map( i => i.trim() );\n                    return result;\n                }\n\n                function toInput(arr) {\n                    let result = null;\n                    if(arr && typeof(arr.push) !== 'undefined')\n                        result = arr.join(', ');\n                    return result;\n                }\n\n                ngModel.$parsers.push(fromInput);\n                ngModel.$formatters.push(toInput);\n\n            }\n        };\n    });\n\n}) (angular);","(function(jQuery, angular) {\n    \n    \"use strict\"; \n    \n    angular.module(\"gp-common\")\n\n    /**\n     * Custom filter to make label values visually helpful by \n     * replacing bad characters with spaces or meaningful equivalents\n     */\n    .filter('fixLabel', function() {\n        return function(value) {\n            if(!value || typeof(value) !== 'string' || !value.length) return 'Untitled';\n            let result = value.replace(/([a-z])([A-Z])/g, \"$1 $2\").replace(/_/g, \" \").trim();\n            return result.charAt(0).toUpperCase() + result.slice(1);\n        };\n    })\n\n    .filter('pluralize', function() {\n        return function(text) {\n            if(!text || !text.length) return \"\";\n            if(text.endsWith('ss')) return text + 'es'; //classes, etc\n            if(text.endsWith('s')) return text;         //already plural\n            return text + 's';\n            //TODO support irregular words like \"foot\" -> \"feet\"\n            // and words that need duplicate letters: \"quiz\" -> \"quizzes\"\n        };\n    })    \n\n    .filter('capitalize', function() {\n        return function(text) {\n            return text[0].toUpperCase() + text.substring(1);\n        };\n    })\n\n\n    .filter('facets', function() {\n\n        return function(arr,facetName) {\n            if(!facetName) return arr;\n            if(!arr || !arr.length) return [];\n            return arr.filter(function(f){return f.toLowerCase().startsWith(facetName + \":\");})\n                .map(function(f) {return f.substring(f.indexOf(':')+1, f.length);});\n        };\n\n    })\n\n    .filter('joinBy', function () {\n        return function (input,delimiter,emptyValue) {\n            if(input && typeof(input.push) !== 'undefined' && input.length) \n                return input.join(delimiter || ', ');\n            else             return emptyValue || '';\n        };\n    })\n\n\n\n    .filter('defaultValue', function() {\n        return function(text, defVal) {\n            if(typeof(text)==='undefined' || !text.length) return defVal;\n            return text;\n        };\n    })\n\n    .filter('count', function() {\n        return function(input) {\n            if(typeof(input) !== 'undefined') {\n                if(typeof(input.push) === 'function') \n                    return input.length;\n                if(typeof(input) === 'object') {\n                    if(typeof(Object.keys) !== 'undefined') {\n                        return Object.keys(input);\n                    }\n                }\n            }\n            return 0;\n        };\n    })\n\n\n    /**\n     *\n     */\n    .filter('gpObjTypeMapper', function() {\n        return function(str) {\n            if(!str || typeof(str) !== 'string' || str.length === 0) \n                return str;\n            \n            var name = str;\n            \n            var idx = str.indexOf(\":\");\n            if(~idx) name = str.substring(idx+1);\n\n            if('VCard' === name) return 'Contact';\n            return name;\n            \n        };\n    })\n\n\n    .filter('gpReliabilityGrade', function() {\n\n        return function(arg) {\n\n            let o = arg;\n            if(typeof(o) === 'object') {\n                if(o.statistics)        o = o.statistics.reliability || null;\n                else if(o.reliability)  o = o.reliability;\n                else                    o = null;\n            }\n\n            if(!isNaN(o)) {\n\n                o = o*1;\n\n                if(o===null || typeof(o)==='undefined') \n                    return 'X';\n                else if(o > 90) return 'A';\n                else if(o > 80) return 'B';\n                else if(o > 70) return 'C';\n                else if(o > 60) return 'D';\n                else return 'F';\n\n                // if (value >= 97) letter = 'A+';\n                // else if (value >= 93) letter = 'A';\n                // else if (value >= 90) letter = 'A-';\n                // else if (value >= 87) letter = 'B+';\n                // else if (value >= 83) letter = 'B';\n                // else if (value >= 80) letter = 'B-';\n                // else if (value >= 77) letter = 'C+';\n                // else if (value >= 73) letter = 'C';\n                // else if (value >= 70) letter = 'C-';\n                // else if (value >= 67) letter = 'D+';\n                // else if (value >= 63) letter = 'D';\n                // else if (value >= 60) letter = 'D-';\n            }\n\n            return \"X\";\n        };\n    })\n\n    ;\n\n})(jQuery, angular);","\n\n( function(angular, Constants) {\n    \n    'use strict';\n\n\n\n    class KGEditor {\n\n        constructor ($rootScope, $element, KGFields, KGHelper) {\n            'ngInject';\n            this.$rootScope = $rootScope;\n            this.$element = $element;\n            this.fields = KGFields.slice(0);\n            this.helper = KGHelper;\n        }\n\n        $onInit () {\n            this.displayOptions = { };\n            this.completion = 0;\n\n            this.service = this.helper.getService(this.ngModel.type);\n\n            this.descriptions = {\n                purpose: 'The intended use or reason for the Object (i.e., layer, map, gallery) e.g., environmental impact of an oil spill.',\n                'function': 'The business actions, activities, or tasks this Object is intended to support (i.e., the role it plays in supporting an activity).  e.g., environmental impact assessment.',\n                audience: 'The group of people for which this Object was intended to be used. e.g., general public, disaster recovery personnel, Congress.',\n                community: 'The GeoPlatform community this Object was produced for. e.g., \"Ecosystems and Biodiversity\" community',\n                place: 'The central locale or common names for the place where the Subjects of the Object occur. e.g.,  USA/Gulf Coast',\n                category: 'The type or category of the Object.  e.g., topographic map, elevation layer',\n                primarySubject: 'The selected things, events, or concepts forming part of or represented by the Object. e.g., Deep Water Horizon oil rig, oil slick extent, oil slick movement over time, predicted oil slick movement, impacted sites, impact severity.',\n                secondarySubject: 'Second-order subjects derived by machine processing/ analysis of the target Object',\n                primaryTopic: 'The central branch of knowledge or theme pertaining to the thing, concept, situation, issue, or event of interest. e.g., environmental impact of oil spill.',\n                secondaryTopic: 'Second-order topics derived by machine processing/ analysis of the target Object'\n            };\n\n            if(!this.ngModel.classifiers)\n                this.ngModel.classifiers = { };\n\n            this.calculatePercentage();\n        }\n\n        $onDestroy () {\n            this.$rootScope = null;\n            this.ngModel = null;\n            this.helper = null;\n            this.fields = null;\n            this.service = null;\n        }\n\n        /**\n         * @param {string} property - name of KG property being modified\n         * @param {array[object]} values - new values to assign to the property (includes old values)\n         */\n        onChange (property, values) {\n            // console.log(\"Changed \" + property + \" with \" + (values?values.length:0) + \" values\");\n            this.ngModel.classifiers[property] = values;\n            this.calculatePercentage();\n        }\n\n        /**\n         * @param {string} classifier - KG property whose value has been activated\n         * @param {object} value - selected value being activated\n         */\n        onValueClick (classifier, value) {\n            if(this.onActivate) {\n                this.onActivate({classifier: classifier, value: value});\n            }\n        }\n\n        /**\n         *\n         */\n        calculatePercentage () {\n            this.completion = this.helper.calculate(this.ngModel.classifiers);\n        }\n    }\n\n\n\n    angular.module('gp-common-kg').component('kgEditor', {\n        require: {\n            // formCtrl: '^form', \n            ngModelCtrl: 'ngModel'\n        },\n        bindings: {\n            ngModel: '=',       //object containing the KG\n            onActivate: '&'     //function to invoke on KG item activation (click)\n        },\n        controller: KGEditor, \n        template: \n        `\n            <div class=\"c-kg-editor\">\n                <div class=\"c-kg-editor__header l-flex-container flex-justify-between flex-align-center\">\n                    <div class=\"flex-1\">\n                        <h4>Knowledge Graph</h4>\n                        <div class=\"u-text--sm\">\n                            Knowledge graphs (KGs) are formed from classifiers for several dimensions of GeoPlatform items \n                            (layers, maps, galleries, etc), including <em>Purpose</em>, <em>Scope</em>, \n                            <em>Fitness for Use</em>, and <em>Social Context</em>. \n                            <br>\n                            <br>\n                            Knowledge graphs are used to answer questions about items, such as:\n                            <ul>\n                            <li>Why was the item created?</li>\n                            <li>Why is it useful for others?</li>\n                            <li>Why is it appropriate to be used?</li>\n                            </ul>\n                        </div>\n                    </div>\n                    <gp-progress-circle ng-model=\"$ctrl.completion\" class=\"u-mg-left--xlg u-mg-right--xlg\"></gp-progress-circle>\n                </div>\n\n                <div class=\"c-kg-editor__content\">\n\n                    <div class=\"c-kg-editor__section\">\n                        <h4 class=\"t-fg--accent\">Purpose</h4>\n\n                        <kg-section \n                            service=\"$ctrl.service\"\n                            ng-model=\"$ctrl.ngModel.classifiers.purposes\"\n                            on-change=\"$ctrl.onChange('purposes', values)\"\n                            on-activate=\"$ctrl.onValueClick('purposes', value)\"\n                            type=\"Purpose\"\n                            label=\"Purpose\" \n                            description=\"{{$ctrl.descriptions.purpose}}\">\n                        </kg-section>\n                    </div>\n\n\n                    <div class=\"c-kg-editor__section\">\n                        <h4 class=\"t-fg--accent\">Scope</h4>\n\n                        <kg-section \n                            service=\"$ctrl.service\"\n                            ng-model=\"$ctrl.ngModel.classifiers.primaryTopics\"\n                            on-change=\"$ctrl.onChange('primaryTopics', values)\"\n                            on-activate=\"$ctrl.onValueClick('primaryTopics', value)\"\n                            type=\"Topic\" \n                            label=\"Primary Topics\" \n                            description=\"{{$ctrl.descriptions.primaryTopic}}\">\n                        </kg-section>\n                        <kg-section \n                            service=\"$ctrl.service\"\n                            ng-model=\"$ctrl.ngModel.classifiers.secondaryTopics\"\n                            on-change=\"$ctrl.onChange('secondaryTopics', values)\"\n                            on-activate=\"$ctrl.onValueClick('secondaryTopics', value)\"\n                            type=\"Topic\" \n                            label=\"Secondary Topics\" \n                            description=\"{{$ctrl.descriptions.secondaryTopic}}\">\n                        </kg-section>\n                        <kg-section \n                            service=\"$ctrl.service\"\n                            ng-model=\"$ctrl.ngModel.classifiers.primarySubjects\"\n                            on-change=\"$ctrl.onChange('primarySubjects', values)\"\n                            on-activate=\"$ctrl.onValueClick('primarySubjects', value)\"\n                            type=\"Subject\" \n                            label=\"Primary Subjects\" \n                            description=\"{{$ctrl.descriptions.primarySubject}}\">\n                        </kg-section>\n                        <kg-section \n                            service=\"$ctrl.service\"\n                            ng-model=\"$ctrl.ngModel.classifiers.secondarySubjects\"\n                            on-change=\"$ctrl.onChange('secondarySubjects', values)\"\n                            on-activate=\"$ctrl.onValueClick('secondarySubjects', value)\"\n                            type=\"Subject\" \n                            label=\"Secondary Subjects\" \n                            description=\"{{$ctrl.descriptions.secondarySubject}}\">\n                        </kg-section>\n                        <kg-section \n                            service=\"$ctrl.service\"\n                            ng-model=\"$ctrl.ngModel.classifiers.categories\"\n                            on-change=\"$ctrl.onChange('categories', values)\"\n                            on-activate=\"$ctrl.onValueClick('categories', value)\"\n                            type=\"Category\" \n                            label=\"Categories\" \n                            description=\"{{$ctrl.descriptions.category}}\">\n                        </kg-section>\n                        <kg-section \n                            service=\"$ctrl.service\"\n                            ng-model=\"$ctrl.ngModel.classifiers.communities\"\n                            on-change=\"$ctrl.onChange('communities', values)\"\n                            on-activate=\"$ctrl.onValueClick('communities', value)\"\n                            type=\"Community\" \n                            label=\"Communities\" \n                            description=\"{{$ctrl.descriptions.community}}\">\n                        </kg-section>\n                        <kg-section \n                            service=\"$ctrl.service\"\n                            ng-model=\"$ctrl.ngModel.classifiers.places\"\n                            on-change=\"$ctrl.onChange('places', values)\"\n                            on-activate=\"$ctrl.onValueClick('places', value)\"\n                            type=\"Place\" \n                            label=\"Places\" \n                            description=\"{{$ctrl.descriptions.place}}\">\n                        </kg-section> \n                    </div> \n\n                    <div class=\"c-kg-editor__section\">\n                        <h4 class=\"t-fg--accent\">Fitness for Use</h4>\n\n                        <kg-section \n                            service=\"$ctrl.service\"\n                            ng-model=\"$ctrl.ngModel.classifiers.functions\"\n                            on-change=\"$ctrl.onChange('functions', values)\"\n                            on-activate=\"$ctrl.onValueClick('functions', value)\"\n                            type=\"Function\" \n                            label=\"Function\" \n                            description=\"{{$ctrl.descriptions.function}}\">\n                        </kg-section>\n                    </div>\n\n                    <div class=\"c-kg-editor__section\">\n                        <h4 class=\"t-fg--accent\">Social Context</h4>\n\n                        <kg-section \n                            service=\"$ctrl.service\"\n                            ng-model=\"$ctrl.ngModel.classifiers.audiences\"\n                            on-change=\"$ctrl.onChange('audiences', values)\"\n                            on-activate=\"$ctrl.onValueClick('audiences', value)\"\n                            type=\"Audience\" \n                            label=\"Audiences\" \n                            description=\"{{$ctrl.descriptions.audience}}\">\n                        </kg-section>\n                    </div>\n\n                </div>\n            </div>\n        `\n    });\n\n}) (angular, GeoPlatform);\n\n","\n\n( function(angular, Constants) {\n    \n    'use strict';\n\n\n    class SectionController {\n\n        constructor($timeout, RecommenderService) {\n            'ngInject';\n            \n            this.$timeout = $timeout;\n            // this.service = RecommenderService;\n        }\n\n        $onInit () {\n            this.noResults = false;\n            this.query = '';\n            this.displayOptions = {\n                fetching: false,\n                showSuggested: false\n            };\n            this.paging = {\n                start: 0,\n                size: 5,\n                sizeOptions: [5, 10, 20]\n            };\n            this.updateCache();\n\n            //default section description if one was not provided\n            if(!this.description)\n                this.description = '<em>No description provided</em>';\n        }\n\n        /**\n         * Update cache when bound 'ngModel' is actually assigned in the component lifecycle\n         */\n        $onChanges () {\n            this.updateCache();\n        }\n\n        $onDestroy() {\n            this.eventHandlers = null;\n            this.clearOptions();\n            this.selected = null;\n            this.service = null;\n            this.$timeout = null;\n        }\n\n        /**\n         * \n         * @param {object} item - selected value being activated (clicked on for navigation)\n         */\n        activate(item) {\n            if(this.onActivate)\n                this.onActivate({value: item});\n        }\n\n        on (event, callback) {\n            this.eventHandlers = this.eventHandlers || {};\n            this.eventHandlers[event] = this.eventHandlers[event] || [];\n            this.eventHandlers[event].push(callback);\n        }\n\n        notify(event, data) {\n            if(!this.eventHandlers || !this.eventHandlers[event]) return;\n            angular.forEach(this.eventHandlers[event], (handler) => { \n                try { handler(data); } catch(e) { } \n            });\n        }\n\n\n        /**\n         * @param {string} query - keywords provided by user input\n         * @return {Promise} resolving an array of results\n         */\n        fetchOptions (query) {\n            \n            //need this timeout or else 'this.query' isn't being \n            // seen as having the same value as 'query'\n            this.$timeout( () => { this.query = query; }, 10);\n\n            this.displayOptions.fetching = true;\n            let params = {\n                type:   this.type,\n                q:      query,\n                page:   Math.floor(this.paging.start/this.paging.size),\n                size:   this.paging.size\n            };\n            // if(this.forType)\n            //     params['for'] = this.forType;\n\n            return this.service.query(params).$promise\n            .then(  response => {\n                this.paging.total = response.totalResults;\n                this.notify('gp:browse:suggestions:pagination', this.paging);\n                this.suggested = response.results.map( result => {\n                    result._selected = this.isSelected(result);\n                    return result;\n                });\n                this.displayOptions.showSuggested = true;\n                return this.suggested;\n            })\n            .catch( e        => { \n                this.paging.total = 0;\n                this.notify('gp:browse:suggestions:pagination', this.paging);\n                this.suggested = [];\n                return this.suggested;\n            })\n            .finally( ()     => this.displayOptions.fetching = false );\n        }\n\n        clearQuery () {\n            this.query='';\n            this.fetchOptions(this.query);\n        }\n\n        clearOptions () {\n\n            //clear query and available options\n            this.query='';\n            this.suggested = null;\n\n            //reset paging\n            this.paging.start = 0;\n            this.paging.total = 0;\n            // this.notify('gp:browse:suggestions:pagination', this.paging);\n\n            //hide available options\n            this.displayOptions.showSuggested = false;\n        }\n        \n        /**\n         * @param {integer} index - position in selected array of item removed\n         */\n        remove (index) {\n            \n            let removed = this.ngModel[index].uri;\n            this.ngModel.splice(index, 1);\n\n            //remove from suggested list if one is populated (being shown)\n            if(this.suggested && this.suggested.length) {\n                let found = this.suggested.find( it => it.uri === removed );\n                if(found) found._selected = false;\n            }\n            this.updateCache();                       //update cache of selected ids\n            \n            if(this.onChange)\n                this.onChange({values: this.ngModel});  //notify others of change\n        }\n\n        /**\n         * @param {object} value - item being checked for selection\n         * @return {boolean}\n         */\n        isSelected (value) {\n            return value._selected || ~this.selected.indexOf( value.uri );\n        }\n\n        /**\n         * @param {object} value - item being selected\n         */\n        selectValue (value) {\n            if(value._selected) return; //already selected\n\n            value._selected = true;\n\n            this.ngModel = this.ngModel || [];\n            this.ngModel.push(value);\n            this.updateCache();\n\n            if(this.onChange)\n                this.onChange({values: this.ngModel});\n\n        }\n\n        updateCache () {\n            this.selected = (this.ngModel || []).map( o => o.uri );\n        }\n\n        onDropdownToggled (open) {\n            if(!open) this.clearOptions();\n        }\n\n\n        /* -------- pagination methods ----------- */\n\n        getPagination () {\n            return this.paging;\n        }\n\n        start (index) {\n            this.paging.start = index;\n            this.fetchOptions(this.query);\n        }\n\n        size (value) {\n            this.paging.size = value;\n            this.fetchOptions(this.query);\n        }\n        \n    }\n\n\n\n\n    angular.module('gp-common-kg').component('kgSection', {\n\n        bindings: {\n            ngModel: '<',\n            service: '<',       //recommender service instance to use\n            label: '@',\n            description: '@',\n            type: '@',          //type of KG property\n            onChange: '&?',     //fire when value(s) change\n            onActivate: '&?'    //fire when selected value link is clicked\n        },\n\n        controller: SectionController,\n\n        template: \n        `\n            <h5>{{$ctrl.label}}</h5>\n            <p class=\"u-text--sm\" ng-bind-html=\"$ctrl.description\"></p>\n\n            <div class=\"list-group list-group-sm\">\n                <div ng-repeat=\"item in $ctrl.ngModel track by $index\" class=\"list-group-item\">\n                    <button type=\"button\" class=\"btn btn-link\" ng-click=\"$ctrl.remove($index)\">\n                        <span class=\"glyphicon glyphicon-remove-circle t-fg--danger\"></span> \n                    </button>\n                    <div class=\"flex-1 u-pd--md\">\n                        <div class=\"u-pd-bottom--sm t-text--strong\">\n                            <a ng-click=\"$ctrl.activate(item)\" ng-if=\"$ctrl.onActivate\"\n                                 class=\"u-break--all\">{{item.label}}</a>\n                            <span ng-if=\"!$ctrl.onActivate\">{{item.label}}</span>\n                        </div>\n                        <div class=\"u-text--sm t-text--italic\">\n                            <a href=\"{{item.uri}}\" target=\"_blank\" class=\"u-break--all\"\n                                title=\"Open source info in new window\">{{item.uri}}</a>\n                        </div>\n                        <div class=\"description\" ng-if=\"item.description\" ng-bind-html=\"item.description\"></div>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"t-fg--gray-md\" ng-if=\"!$ctrl.ngModel.length\"><em>No values specified</em></div>            \n\n            <hr>\n\n            <div uib-dropdown is-open=\"$ctrl.displayOptions.showSuggested\" \n                auto-close=\"outsideClick\" on-toggle=\"$ctrl.onDropdownToggled(open)\">\n\n                <div class=\"l-flex-container flex-justify-between flex-align-center\">\n                    <div class=\"input-group-slick flex-1\">\n                        <span class=\"glyphicon\"\n                            ng-class=\"{'glyphicon-search':!$ctrl.displayOptions.fetching, 'glyphicon-hourglass spin':$ctrl.displayOptions.fetching}\"></span>\n                        <input type=\"text\" class=\"form-control\" \n                            ng-model=\"$ctrl.query\" \n                            ng-model-options=\"{ debounce: 250 }\"\n                            ng-change=\"$ctrl.fetchOptions($ctrl.query)\"\n                            placeholder=\"Find values to add...\">\n                    </div>\n                </div>\n                \n                <div class=\"dropdown-menu\" uib-dropdown-menu>\n                    \n                    <div class=\"form-group l-flex-container flex-justify-between flex-align-center\">\n                        <div class=\"input-group-slick flex-1\">\n                            <span class=\"glyphicon\"\n                                ng-class=\"{'glyphicon-search':!$ctrl.displayOptions.fetching, 'glyphicon-hourglass spin':$ctrl.displayOptions.fetching}\"></span>\n                            <input type=\"text\" class=\"form-control\" \n                                ng-model=\"$ctrl.query\" \n                                ng-model-options=\"{ debounce: 250 }\"\n                                ng-change=\"$ctrl.fetchOptions($ctrl.query)\"\n                                placeholder=\"Find values to add...\">\n                            <span class=\"glyphicon glyphicon-remove\"\n                                ng-if=\"$ctrl.query.length\"\n                                ng-click=\"$event.stopPropagation();$ctrl.clearQuery()\"></span>\n                        </div>\n                        <button type=\"button\" class=\"btn btn-info u-mg-left--xlg animated-show\"\n                            ng-click=\"$ctrl.clearOptions();\">\n                            Done\n                        </button>\n                    </div>\n                    \n                    <gp-pagination service=\"$ctrl\" event-key=\"suggestions\" use-select=\"true\"></gp-pagination>\n\n                    <div class=\"list-group list-group-sm u-text--sm\">\n                        <div ng-repeat=\"item in $ctrl.suggested track by $index\" class=\"list-group-item\">\n                            <button type=\"button\" class=\"btn btn-link\" ng-click=\"$ctrl.selectValue(item)\"\n                                ng-class=\"{disabled:item._selected}\">\n                                <span class=\"glyphicon glyphicon-ok t-fg--gray-md\" ng-show=\"item._selected\"></span> \n                                <span class=\"glyphicon glyphicon-plus-sign t-fg--success\" ng-show=\"!item._selected\"></span> \n                            </button>\n                            <div class=\"flex-1 u-pd--md\">\n                                <div class=\"u-break--all t-text--strong u-pd-bottom--sm\">{{item.prefLabel}}</div>\n                                <a href=\"{{item.uri}}\" target=\"_blank\" \n                                    class=\"u-break--all u-text--sm t-text--italic\"\n                                    title=\"Open source info in new window\">\n                                    {{item.uri}}\n                                </a>\n                                <div class=\"description\">{{item.description||\"No description provided\"}}</div>\n                            </div>\n                        </div>\n                        <div ng-if=\"!$ctrl.suggested.length\" class=\"list-group-item disabled u-pd--md\">\n                            No results match your query\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `\n    });\n\n}) (angular, GeoPlatform);\n\n","\n(function(angular) {\n\n    'use strict';\n\n    angular.module('gp-common').component('createdByFilter', {\n\n        bindings: {\n            service: '<'   //service filtering by\n        },\n\n        controller: function(AuthenticationService) {\n\n            this.$onInit = function() {\n                this.value       = null;    //input from user for \"created by\" value\n                this.collapse    = true;    //hide show controls\n                this.limitToUser = false;   //filter using current user\n                this.modelOptions = {\n                    'updateOn': 'default blur',\n                    'debounce': {\n                      'default': 250,\n                      'blur': 0\n                    }\n                };\n\n                AuthenticationService.getUserQ().then( user => {\n                    this.username = user ? user.username : null;\n                });\n            };\n\n            this.$onDestroy = function() {\n                this.value       = null;\n                this.collapse    = null;\n                this.limitToUser = null;\n                this.username    = null;\n            };\n\n            this.filter = function() {\n                let value = (this.limitToUser) ? this.username : this.value;\n                if(typeof(value) !== 'undefined' && value !== null && value.trim().length === 0)\n                    value = null;    //don't accept empty strings\n                this.service.setCreatedBy(value, true);\n            };\n\n            this.toggleLimitToUser = function() {\n                this.limitToUser = !this.limitToUser;\n                this.filter();\n            };\n\n            this.clear = function() {\n                this.value = null;\n                this.filter();\n            };\n\n        },\n        template:\n        `\n            <div class=\"card\">\n                <h5 class=\"card-title l-flex-container flex-justify-between flex-align-center\">\n                    <span class=\"flex-1\">Filter by Author</span>\n                    <button type=\"button\" class=\"btn btn-sm btn-link\"\n                        title=\"{{$ctrl.collapse?'Expand':'Collapse'}}\"\n                        ng-click=\"$ctrl.collapse = !$ctrl.collapse\">\n                        <span class=\"glyphicon\" ng-class=\"{'glyphicon-chevron-up':!$ctrl.collapse,'glyphicon-chevron-down':$ctrl.collapse}\"></span>\n                    </button>\n                </h5>\n                <div class=\"card-content\" ng-hide=\"$ctrl.collapse\">\n\n                    <div class=\"input-group-slick\">\n                        <span class=\"glyphicon glyphicon-user\"></span>\n                        <input type=\"text\" class=\"form-control\" placeholder=\"Specify author username\"\n                            ng-disabled=\"$ctrl.limitToUser\"\n                            ng-model=\"$ctrl.value\"\n                            ng-model-options=\"$ctrl.modelOptions\"\n                            ng-change=\"$ctrl.filter()\">\n                        <span class=\"glyphicon glyphicon-remove\" title=\"Clear author\"\n                            ng-if=\"$ctrl.value.length&&!$ctrl.limitToUser\" ng-click=\"$ctrl.clear()\"></span>\n                    </div>\n\n                    <label class=\"control-label u-text--sm text-muted u-pd-top--sm\" ng-if=\"$ctrl.username\">\n                        <input type=\"checkbox\" ng-model=\"$ctrl.limitToUser\" ng-change=\"$ctrl.filter()\">\n                        Only show my maps\n                    </label>\n                </div>\n            </div>\n        `\n    });\n\n}) (angular);\n","(function(angular, Constants) {\n\n    'use strict';\n\n    const PUBLISHER_FACET = 'publishers';\n\n    angular.module('gp-common').component('publisherFilter', {\n        bindings: {\n            name: '@',      //name of this filter parameter,\n            service: \"<\"\n        },\n        controller: function($http) {\n\n            this.$onInit = function() {\n                this.collapse   = true;\n                this.updateValues();\n            };\n\n            this.$onDestroy = function() {\n                this.values = null;\n            };\n\n            this.hasSelections = function() {\n                return (this.service.getAgencies() || []).length;\n            };\n\n            this.isSelected = function(value) {\n                let selected =    this.service.getAgencies() || [];\n                return ~selected.indexOf(value.id);\n            };\n\n            this.toggle = function(value) {\n                let selected =  this.service.getAgencies() || [];\n                let idx =       selected.indexOf(value.id);\n                if(idx >= 0)    selected.splice(idx, 1);\n                else            selected.push(value.id);\n                this.service.setAgencies(selected);\n            };\n\n            this.clear = function() {\n                let selected = this.service.getAgencies() || [];\n                if(!selected || !selected.length)\n                    this.collapse = !this.collapse; //toggle collapsed state\n                else\n                    this.service.setAgencies([]);\n            };\n\n            this.getCount = function(value) {\n                var facet = this.service.getFacet(PUBLISHER_FACET);\n                if(!facet) return '';\n                var valObj = facet.buckets.find(function(v) { return v.label===value.id; });\n                if(!valObj) return '';\n                return valObj.count;\n            };\n\n            this.updateValues = function(query) {\n\n                return $http.get(Constants.ualUrl + '/api/items', {\n                    params: {\n                        type:'org:Organization',\n                        sort: 'label,asc',\n                        q: query,\n                        size: 20,\n                        bust: new Date().getTime()\n                    }\n                }).then( (response) => {\n\n                    let total = response.data.totalResults;\n                    let newValues = response.data.results.slice(0);\n                    this.additionalValueCount = total - newValues.length;\n\n                    let selections = this.service.getAgencies();\n                    if(selections && selections.length && this.values && this.values.length) {\n                        let existing = this.values.filter( v => {\n                            //find existing values that are selected\n                            return ~selections.indexOf(v.id) &&\n                                // but not in new set of values\n                                !newValues.filter( nv => nv.id === v.id).length;\n                        });\n                        newValues = existing.concat(newValues);\n                    }\n\n                    this.values = newValues;\n\n                }, (response) => {\n                    console.log(\"(\" + response.status + \") \" + response.statusText);\n                });\n            };\n        },\n        template:\n        `\n            <div class=\"card\">\n                <h5 class=\"card-title l-flex-container flex-justify-between flex-align-center\">\n                    <span class=\"flex-1\">Filter by Publisher(s)</span>\n                    <button type=\"button\" class=\"btn btn-sm btn-link\"\n                        title=\"{{$ctrl.collapse?'Expand':'Collapse'}}\"\n                        ng-click=\"$ctrl.collapse = !$ctrl.collapse\">\n                        <span class=\"glyphicon\" ng-class=\"{'glyphicon-chevron-up':!$ctrl.collapse,'glyphicon-chevron-down':$ctrl.collapse}\"></span>\n                    </button>\n                </h5>\n                <div class=\"card-content\">\n                    <div class=\"c-facets\" ng-class=\"{'is-collapsed':$ctrl.collapse}\">\n\n                        <div class=\"c-facet__value\">\n                            <div class=\"input-group-slick\">\n                                <input name=\"scheme-typeahead\" type=\"text\" class=\"form-control\"\n                                    ng-model=\"$ctrl.typeaheadValue\"\n                                    ng-change=\"$ctrl.updateValues($ctrl.typeaheadValue)\"\n                                    ng-model-options=\"{debounce:200}\"\n                                    placeholder=\"Search by name\">\n                                <span class=\"glyphicon glyphicon-remove\"\n                                    title=\"Clear query\"\n                                    ng-if=\"$ctrl.typeaheadValue.length\"\n                                    ng-click=\"$ctrl.updateValues($ctrl.typeaheadValue=null)\">\n                                </span>\n                            </div>\n                        </div>\n\n                        <a class=\"c-facet__value\" ng-click=\"$ctrl.clear()\"\n                            ng-class=\"{active:!$ctrl.hasSelections()}\">\n                            <span class=\"glyphicon\"\n                                ng-class=\"{'glyphicon-check':!$ctrl.hasSelections(), 'glyphicon-unchecked t-fg--gray-lt':$ctrl.hasSelections()}\">\n                            </span>\n                            Any Publisher\n                        </a>\n                        <a  ng-repeat=\"value in $ctrl.values track by $index\"\n                            class=\"c-facet__value\"\n                            ng-click=\"$ctrl.toggle(value)\"\n                            ng-class=\"{active:$ctrl.isSelected(value)}\">\n\n                            <span class=\"badge pull-right\">{{$ctrl.getCount(value)}}</span>\n                            <span class=\"glyphicon\"\n                                ng-class=\"{'glyphicon-check':$ctrl.isSelected(value),'glyphicon-unchecked t-fg--gray-lt':!$ctrl.isSelected(value)}\"></span>\n                            {{value.label}}\n                        </a>\n                        <div class=\"c-facet__value t-fg--gray-md\"\n                            ng-if=\"$ctrl.additionalValueCount\">\n                            <em>plus {{$ctrl.additionalValueCount}} more options</em>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `\n    });\n\n}) (angular, GeoPlatform);\n","\n(function(angular) {\n\n    'use strict';\n\n\n    const PARAMETER = \"concepts\";\n\n    class RecommendedTermFilter {\n\n        constructor($timeout, RecommenderService) {\n            'ngInject';\n            this.termService = RecommenderService;\n            this.$timeout = $timeout;\n        }\n\n        $onInit () {\n            this.displayOpts = {\n                fetching : false,\n                empty    : false,\n                collapse : false,\n                suggest  : false\n            };\n            this.values     = [];\n            this.suggested  = [];\n            this.termQuery  = null;\n            this.paging = {\n                start: 0,\n                size: 5,\n                sizeOptions: [5, 10, 20]\n            };\n        }\n\n        $onDestroy () {\n            this.$timeout = null;\n            this.displayOpts = null;\n            this.values     = null;\n            this.suggested  = null;\n            this.service    = null;\n            this.termService = null;\n            this.termQuery  = null;\n            this.paging     = null;\n            this.eventHandlers = null;\n        }\n\n\n        /* ----------------- typeahead methods ------------------ */\n        // onSelection ($item, $model, $label, $event) {\n        //     this.values.push($model);   //append selection to list\n        //     this.termQuery = null;      //clear the typeahead field\n        //     this.update();\n        // }\n        //\n        // getOptions (text) {\n        //\n        //     this.displayOpts.fetching = true;\n        //     this.displayOpts.empty = false;\n        //\n        //     let params = {\n        //         q:text,\n        //         size:12\n        //     };\n        //     if(this.type)\n        //         params['for'] = this.type;\n        //\n        //     return this.termService.query(params).$promise\n        //     .then( response => {\n        //         let results = response.results;\n        //         this.displayOpts.empty = !results.length;\n        //         return results;\n        //     })\n        //     .catch( e => {\n        //         this.displayOpts.empty = true;\n        //         console.log(\"Error finding semantic terms: \" + e.message);\n        //     })\n        //     .finally( () => {\n        //         this.displayOpts.fetching = false;\n        //     });\n        // }\n\n\n        hideSuggested () {\n            this.displayOpts.suggest = this.displayOpts.fetching =\n                this.displayOpts.empty = false;\n            this.termQuery = null;\n            this.suggested = [];\n            this.paging.start = this.paging.total = 0;\n        }\n\n        select (item) {\n            item._selected = true;  //update status to show it's already _selected\n            this.values.push(item); //append selection to list\n            this.update();          //update overall browse query with new selection\n        }\n\n        getOptions () {\n\n            let text = this.termQuery;\n            // console.log(\"Querying using '\" + text + \"'\");\n\n            //if empty value was provided, don't search.\n            if(!text || !text.length) {\n                this.suggested = [];\n                // this.suggestedTotal = this.suggestedCount = 0;\n                this.paging.start = this.paging.total = 0;\n                this.notify('gp:browse:suggestions:pagination', this.paging);\n                // this.displayOpts.suggest = false;\n                return;\n            }\n\n            //reset variables\n            this.suggested = [];\n            // this.suggestedTotal = this.suggestedCount = 0;\n            this.displayOpts.suggest = true;\n            this.displayOpts.fetching = true;\n            this.displayOpts.empty = false;\n\n            let params = {\n                q:text,\n                page: Math.floor(this.paging.start/this.paging.size),\n                size: this.paging.size\n            };\n            if(this.type)\n                params['for'] = this.type;\n\n            this.termService.query(params).$promise\n            .then( response => {\n                let results = response.results;\n                this.displayOpts.empty = !results.length;\n                this.suggested = results.map( result => {\n                    result._selected = this.isSelected(result);\n                    return result;\n                });\n                this.paging.total = response.totalResults;\n                this.notify('gp:browse:suggestions:pagination', this.paging);\n            })\n            .catch( e => {\n                this.displayOpts.empty = true;\n                this.suggested = [];\n                this.paging.total = 0;\n                this.notify('gp:browse:suggestions:pagination', this.paging);\n                console.log(\"Error finding semantic terms: \" + e.message);\n            })\n            .finally( () => {\n                this.displayOpts.fetching = false;\n                // this.displayOpts.suggest = true;\n            });\n        }\n\n        hasSelections () {\n            return this.values.length;\n        }\n\n        isSelected (item) {\n            return this.values.filter( v => v.uri === item.uri ).length;\n        }\n\n        removeValue (index) {\n            if(this.values.length >= index) {\n                let removed = this.values.splice(index, 1)[0];   //remove from selected\n                this.update();     //update overall browse query\n\n                //update associated item in suggested list (if visible)\n                if(this.suggested.length) {\n                    let match = this.suggested.find( i => i.uri === removed.uri );\n                    if(match) match._selected = false;\n                }\n            }\n        }\n\n        clear () {\n            this.values = [];\n            this.update();\n        }\n\n        update () {\n            let value = this.values.length ? this.values.map( v => v.uri ) : null;\n            this.service.applyOption(PARAMETER, value, true);\n        }\n\n\n        /* -------- pagination methods ----------- */\n\n        on (event, callback) {\n            this.eventHandlers = this.eventHandlers || {};\n            this.eventHandlers[event] = this.eventHandlers[event] || [];\n            this.eventHandlers[event].push(callback);\n        }\n\n        notify(event, data) {\n            if(!this.$timeout || !this.eventHandlers || !this.eventHandlers[event]) return;\n            this.$timeout( () => {\n                angular.forEach(this.eventHandlers[event], (handler) => {\n                    try { handler(data); } catch(e) { }\n                });\n            }, 100);\n        }\n\n        getPagination () {\n            return this.paging;\n        }\n\n        start (index) {\n            this.paging.start = index;\n            this.getOptions();\n        }\n\n        size (value) {\n            this.paging.size = value;\n            this.getOptions();\n        }\n\n    }\n\n\n    angular.module('gp-common').component('recommendedTermFilter', {\n        bindings: {\n\n            //type of object being searched (ie, Layer, Map)\n            type: '@',\n\n            //BrowseObjectService the filter will affect\n            service: \"<\"\n        },\n\n        controller: RecommendedTermFilter,\n\n        template:\n        `\n            <div class=\"card c-filter__recommended-terms\">\n\n                <h5 class=\"card-title l-flex-container flex-justify-between flex-align-center\">\n\n                    Filter using Semantic Concepts\n\n                    <button type=\"button\" class=\"btn btn-sm btn-link\"\n                        title=\"{{$ctrl.displayOpts.collapse?'Expand':'Collapse'}}\"\n                        ng-click=\"$ctrl.displayOpts.collapse = !$ctrl.displayOpts.collapse\">\n                        <span class=\"glyphicon\"\n                            ng-class=\"{'glyphicon-chevron-up':!$ctrl.displayOpts.collapse,'glyphicon-chevron-down':$ctrl.displayOpts.collapse}\"></span>\n                    </button>\n                </h5>\n\n                <div class=\"c-facets\" ng-class=\"{'is-collapsed':$ctrl.displayOpts.collapse}\">\n\n                    <!--\n                    <div class=\"c-facet__value\">\n\n                        <div class=\"input-group-slick\">\n                            <input name=\"termQuery\" type=\"text\" class=\"form-control\"\n                              ng-model=\"$ctrl.termQuery\"\n                              typeahead-on-select=\"$ctrl.onSelection($item, $model, $label, $event)\"\n                              uib-typeahead=\"opt as ' (' + opt.context + ') ' + opt.label for opt in $ctrl.getOptions($viewValue)\"\n                              typeahead-loading=\"$ctrl.displayOpts.fetching\"\n                              typeahead-no-results=\"$ctrl.displayOpts.empty\"\n                              ng-model-options=\"{ debounce: 250 }\"\n                              typeahead-min-length=\"2\"\n                              typeahead-editable=\"false\"\n                              placeholder=\"Find a concept\">\n                            <span class=\"glyphicon glyphicon-hourglass spin\" ng-if=\"$ctrl.displayOpts.fetching\"></span>\n                        </div>\n\n                        <div ng-show=\"$ctrl.displayOpts.empty\">No Results Found</div>\n\n                    </div>\n                    -->\n\n                    <div ng-hide=\"$ctrl.displayOpts.collapse\">\n\n                        <div class=\"input-group-slick\">\n                            <span class=\"glyphicon\"\n                                ng-class=\"{'glyphicon-search':!$ctrl.displayOpts.fetching, 'glyphicon-hourglass spin':$ctrl.displayOpts.fetching}\"></span>\n                            <input type=\"text\" class=\"form-control\"\n                                ng-model=\"$ctrl.termQuery\"\n                                ng-model-options=\"{ debounce: 250 }\"\n                                ng-change=\"$ctrl.getOptions()\"\n                                placeholder=\"Find concepts\">\n                            <span class=\"glyphicon glyphicon-remove\" ng-if=\"$ctrl.displayOpts.suggest\"\n                                ng-click=\"$ctrl.hideSuggested()\"></span>\n                        </div>\n\n                        <gp-pagination service=\"$ctrl\" event-key=\"suggestions\" use-select=\"true\"\n                            ng-if=\"$ctrl.displayOpts.suggest\">\n                        </gp-pagination>\n\n                        <div class=\"list-group list-group-sm u-text--sm\"\n                            ng-if=\"$ctrl.displayOpts.suggest && !$ctrl.displayOpts.fetching\">\n\n                            <a ng-repeat=\"item in $ctrl.suggested track by $index\"\n                                class=\"list-group-item\"\n                                ng-class=\"{disabled:item._selected}\"\n                                ng-click=\"$ctrl.select(item)\">\n                                <span class=\"u-break--all t-text--strong u-pd-bottom--sm\">{{item.prefLabel}}</span>\n                                <br>\n                                <span class=\"u-break--all u-text--sm t-text--italic\">{{item.uri}}</span>\n                            </a>\n\n                            <div ng-if=\"$ctrl.displayOpts.empty\" class=\"list-group-item disabled u-pd--md\">\n                                No concepts found\n                            </div>\n\n                        </div>\n\n                    </div>\n\n\n                    <!-- selected terms -->\n                    <div ng-repeat=\"term in $ctrl.values\" class=\"c-facet__value active\"\n                        title=\"Remove this term from the query\"\n                        ng-click=\"$ctrl.removeValue($index)\">\n\n                        <div class=\"u-break--all t-text--strong u-pd-bottom--sm\">\n                            <span class=\"glyphicon glyphicon-check\"></span>\n                            {{term.prefLabel}}\n                        </div>\n                        <div class=\"u-break--all u-text--sm t-text--italic\">{{term.uri}}</div>\n                    </div>\n\n                </div>\n\n            </div>\n        `\n    });\n\n}) (angular);\n","\n(function(angular) {\n\n    'use strict';\n\n    angular.module('gp-common').component('similarityFilter', {\n        bindings: {\n\n            //type of object being searched (ie, Layer, Map)\n            type: '@',\n\n            //BrowseObjectService the filter will affect\n            service: \"<\",\n\n            //optional, id of current map (if one exists)\n            mapId: '@'\n        },\n        controller: function() {\n\n            this.$onInit = function() {\n\n                this.collapse   = true;\n                this.value      = null;\n                this.useMap     = false;\n\n                let evtName     = this.service.events.SIMILARITY;\n                this.listener   = this.service.on(evtName, (event, layer) => {\n                    this.value  = layer;\n                    this.service.applyOption('similarTo', this.value.id, true);\n                });\n\n                if(!this.type)\n                    this.type = \"item\";\n            };\n\n            this.$onDestroy = function() {\n                this.listener();    //dispose of listener\n                this.collapse   = null;\n                this.value      = null;\n                this.service    = null;\n                this.mapId      = null;\n            };\n\n            this.hasSelections = function() {\n                return !!this.value;\n            };\n\n            this.clearValue = function() {\n\n                if(this.useMap) {\n                    this.useMap = false;\n                    this.service.applyOption('similarTo', this.value.id, true);\n                } else {\n                    this.value = null;\n                    this.service.applyOption('similarTo', null, true);\n                }\n\n            };\n\n            this.toggleCurrentMap = function(bool) {\n\n                if(this.useMap) {   //if already using map, stop\n                    this.useMap = false;\n\n                    if(this.value) {\n                        this.service.applyOption('similarTo', this.value.id, true);\n                    } else {\n                        this.service.applyOption('similarTo', false, true);\n                    }\n\n                } else {\n                    this.useMap = true;\n                    this.service.applyOption('similarTo', this.mapId, true);\n                }\n            };\n\n        },\n        template:\n        `\n            <div class=\"card\" ng-if=\"$ctrl.value\">\n\n                <h5 class=\"card-title\">Find Similar</h5>\n                <div class=\"card-content\">\n\n                    <p class=\"u-text--sm\">Searching for {{$ctrl.type}}s similar to the following: </p>\n\n                    <div class=\"c-facets\">\n\n                        <a class=\"c-facet__value\" ng-if=\"$ctrl.value\" ng-click=\"$ctrl.clearValue()\">\n                            <span class=\"glyphicon glyphicon-remove-circle\"></span>\n                            {{$ctrl.value.label}}\n                        </a>\n\n                        <!--\n                        <a ng-if=\"$ctrl.mapId\" class=\"c-facet__value\"\n                            ng-click=\"$ctrl.toggleCurrentMap()\" ng-class=\"{active:$ctrl.useMap}\">\n                            <span class=\"glyphicon glyphicon-check\" ng-show=\"$ctrl.useMap\"></span>\n                            <span class=\"glyphicon glyphicon-unchecked\" ng-show=\"!$ctrl.useMap\"></span>\n                            Find similar to my current map\n                        </a>\n                        -->\n\n                    </div>\n\n                    <br>\n                    <p class=\"u-text--sm\">Note that query filters below are still being applied.</p>\n\n                </div>\n            </div>\n        `\n    });\n\n}) (angular);\n","\n(function(angular, Constants) {\n\n    'use strict';\n\n\n    /*\n        <themes-filter></themes-filter>\n     */\n\n    angular.module('gp-common').component('themeFilter', {\n        bindings: {\n            name: '@',      //name of this filter parameter\n            service: '<'\n        },\n        controller: function($http) {\n\n\n            this.$onInit = function() {\n                this.collapse   = true;\n                this.updateValues();\n            };\n\n            this.$onDestroy = function() {\n                this.values = null;\n                this.service = null;\n            };\n\n            this.hasSelections = function() {\n                return (this.service.getThemes() || []).length;\n            };\n\n            this.isSelected = function(value) {\n                let themes =    this.service.getThemes() || [];\n                return ~themes.indexOf(value.id);\n            };\n\n            this.toggle = function(value) {\n                let themes =    this.service.getThemes() || [];\n                let idx =       themes.indexOf(value.id);\n                if(idx >= 0)    themes.splice(idx, 1);\n                else            themes.push(value.id);\n                this.service.setThemes(themes);\n            };\n\n            this.clear = function() {\n                let themes =    this.service.getThemes() || [];\n                if(!themes || !themes.length)\n                    this.collapse = !this.collapse; //toggle collapsed state\n                else\n                    this.service.setThemes([]);\n            };\n\n            this.getCount = function(value) {\n                var facet = this.service.getFacet('themes');\n                if(!facet) return '';\n                var valObj = facet.buckets.find(function(v) { return v.label===value.id; });\n                if(!valObj) return '';\n                return valObj.count;\n            };\n\n            this.updateValues = function(query) {\n\n                return $http.get(Constants.ualUrl + '/api/items', {\n                    params: {\n                        type:'skos:Concept',\n                        'scheme.label': 'NGDA Portfolio Themes',\n                        fields:'scheme',\n                        size: 9999,                 //must return all\n                        sort: 'label,asc',\n                        bust: new Date().getTime()\n                    }\n                }).then( (response) => {\n                    // let total = response.data.totalResults;\n                    this.values = response.data.results.slice(0);\n                }, (response) => {\n                    console.log(\"(\" + response.status + \") \" + response.statusText);\n                }).catch( e => {\n                    console.log(\"Error fetching NGDA Themes: \" + e.message);\n                });\n            };\n        },\n        template:\n        `\n            <div class=\"card c-browse-filter\">\n                <h5 class=\"card-title l-flex-container flex-justify-between flex-align-center\">\n                    Filter by NGDA Themes\n                    <button type=\"button\" class=\"btn btn-sm btn-link\"\n                        title=\"{{$ctrl.collapse?'Expand':'Collapse'}}\"\n                        ng-click=\"$ctrl.collapse = !$ctrl.collapse\">\n                        <span class=\"glyphicon\" ng-class=\"{'glyphicon-chevron-up':!$ctrl.collapse,'glyphicon-chevron-down':$ctrl.collapse}\"></span>\n                    </button>\n                </h5>\n                <div class=\"card-content\">\n                    <div class=\"c-facets\" ng-class=\"{'is-collapsed':$ctrl.collapse}\">\n                        <a class=\"c-facet__value\" ng-click=\"$ctrl.clear()\"\n                            ng-class=\"{active:!$ctrl.hasSelections()}\">\n                            <span class=\"glyphicon\"\n                                ng-class=\"{'glyphicon-check':!$ctrl.hasSelections(), 'glyphicon-unchecked t-fg--gray-lt':$ctrl.hasSelections()}\">\n                            </span>\n                            Any Theme\n                        </a>\n                        <a ng-repeat=\"theme in $ctrl.values track by $index\"\n                            class=\"c-facet__value\" ng-click=\"$ctrl.toggle(theme)\"\n                            ng-class=\"{active:$ctrl.isSelected(theme)}\">\n                                <span class=\"badge pull-right\">{{$ctrl.getCount(theme)}}</span>\n                                <span class=\"glyphicon\"\n                                    ng-class=\"{'glyphicon-check':$ctrl.isSelected(theme),'glyphicon-unchecked t-fg--gray-lt':!$ctrl.isSelected(theme)}\"></span>\n                                {{theme.label}}\n                            </a>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `\n    });\n\n}) (angular, GeoPlatform);\n","\n(function(angular, Constants) {\n\n    \"use strict\";\n\n\n    //fields list sent to MDR in order to have these properties for display in search results\n    const FIELDS = [ 'created','modified','publishers','themes','description','extent' ];\n\n    //facets list sent to MDR in order to get aggregation numbers\n    const FACETS = [ 'types','themes','publishers', 'serviceTypes', 'schemes', 'visibility', 'createdBy' ];\n\n    const SORT_OPTIONS = [\n        { value:\"label,asc\",       label: \"Name (A-Z)\"              },\n        { value:\"label,desc\",      label: \"Name (Z-A)\"              },\n        { value:\"type,asc\",        label: \"Type (A-Z)\"              },\n        { value:\"type,desc\",       label: \"Type (Z-A)\"              },\n        { value:\"modified,desc\",   label: \"Most recently modified\"  },\n        { value:\"modified,asc\",    label: \"Least recently modified\" },\n        { value:\"_score,desc\",     label: \"Relevance\"               },\n    ];\n\n    //list of _options variables for mapping to parameters\n    const VAR_TYPES                 = 'types';\n    const VAR_THEMES                = 'themes';\n    const VAR_PUBLISHERS            = 'publishers';\n    const VAR_USER                  = 'user';\n    const VAR_CREATED_BY            = 'createdBy';\n    const VAR_SERVICE_TYPES         = 'serviceTypes';\n    const VAR_SCHEMES               = 'schemes';\n    const VAR_VISIBILITY            = \"visibility\";\n    const VAR_QUERY                 = 'query';\n    const VAR_EXTENT                = 'extent';\n    const VAR_MODIFIED_BEFORE       = 'modified.max';\n    const VAR_MODIFIED_AFTER        = 'modified.min';\n\n    //parameter names for various query constraints used in requests to MDR for results\n    const PARAMETER_TYPE            = 'type';\n    const PARAMETER_THEME           = 'theme.id';\n    const PARAMETER_PUBLISHER       = 'publisher.id';\n    const PARAMETER_CREATED_BY      = 'createdBy';\n    const PARAMETER_CONTRIBUTED_BY  = 'contributedBy';\n    const PARAMETER_CREATOR         = 'creator.id';\n    const PARAMETER_SVC_TYPE        = 'serviceType.id';\n    const PARAMETER_IN_SCHEME       = 'scheme.id';\n    const PARAMETER_VISIBILITY      = 'visibility';\n    const PARAMETER_QUERY           = 'q';\n    const PARAMETER_EXTENT          = 'bbox';\n    const PARAMETER_MODIFIED_BEFORE = 'modified.max';\n    const PARAMETER_MODIFIED_AFTER  = 'modified.min';\n    // const PARAMETER_CONTRIBUTOR     = 'contributor.id';\n\n\n    const PARAM_OPTIONS = [\n        { option: VAR_TYPES,            parameter: PARAMETER_TYPE           },\n        { option: VAR_THEMES,           parameter: PARAMETER_THEME          },\n        { option: VAR_PUBLISHERS,       parameter: PARAMETER_PUBLISHER      },\n        { option: VAR_USER,             parameter: PARAMETER_CREATOR        },\n        { option: VAR_CREATED_BY,       parameter: PARAMETER_CREATED_BY     },\n        { option: VAR_SERVICE_TYPES,    parameter: PARAMETER_SVC_TYPE       },\n        { option: VAR_SCHEMES,          parameter: PARAMETER_IN_SCHEME      },\n        { option: VAR_VISIBILITY,       parameter: PARAMETER_VISIBILITY     },\n        { option: VAR_QUERY,            parameter: PARAMETER_QUERY          },\n        { option: VAR_EXTENT,           parameter: PARAMETER_EXTENT         },\n        { option: VAR_MODIFIED_BEFORE,  parameter: PARAMETER_MODIFIED_BEFORE },\n        { option: VAR_MODIFIED_AFTER,   parameter: PARAMETER_MODIFIED_AFTER }\n    ];\n\n\n    const PAGE_SIZE_BASE_10 = [ 10, 20, 50, 100 ];\n    const PAGE_SIZE_BASE_12 = [ 12, 24, 48, 96 ];\n\n\n    /**\n     *\n     *\n     */\n    function BrowseObjectsService($rootScope, $timeout, $resource, options) {\n\n\n        /* -------- private data ----------- */\n\n        let url = options && options.url ? options.url + \"/:id\" : Constants.ualUrl + '/api/items/:id';\n\n        let eventKey = 'gp:browse:' + (options && options.key ? options.key : 'objects') + \":\";\n\n        var svc = $resource(url, {id: '@id'}, {\n            query: {\n                isArray: false\n            }\n        });\n\n        var _pageSizeBase = PAGE_SIZE_BASE_10.slice(0);\n        if(options && options.pageSizeBase && options.pageSizeBase === 12)\n            _pageSizeBase = PAGE_SIZE_BASE_12.slice(0);\n\n        var _options = {\n            start: 0,\n            size: _pageSizeBase[0],\n            total: 0,\n            sort: (options && options.sort) ? options.sort : \"modified,desc\",\n            facets: {}\n        };\n\n        //list of field names to request in response\n        var _fields = options && options.fields ? options.fields : FIELDS.slice(0);\n\n        //list of facet names to request\n        var _requestFacets = options && options.facets ? options.facets : FACETS.slice(0);\n\n\n        var _facets = [];\n        var _selectedFacets = [];\n\n        var _results = [];\n\n        var _dirtyPromise = null;\n\n        var _isLoading = false;\n\n        var _selected = [];\n\n        var _onSelectFn = options && options.onSelect ? options.onSelect : null;\n\n\n        /**\n         *\n         */\n        function notify(eventName, arg) {\n            // console.log(\"Notifying of \" + eventName + \" with \" + arg);\n            $rootScope.$broadcast(eventName, arg);\n        }\n\n        /**\n         * when marked as dirty, debounce for rapid fire events like onKeyUp\n         */\n        function dirty(delay, resetStart) {\n\n            var doReset = typeof(resetStart) === 'undefined' || resetStart === true;\n\n            if(_dirtyPromise)\n                $timeout.cancel(_dirtyPromise);\n            _dirtyPromise = $timeout(function() {\n                _dirtyPromise = null;\n                _doUpdate(doReset);\n            }, delay || 100);\n\n        }\n\n        /**\n         *\n         */\n        function _doUpdate(resetStart) {\n\n            if(resetStart)\n                _options.start = 0;\n\n            _isLoading = true;\n            notify(eventKey + 'querying');\n\n            let params = {};\n\n\n            // -------- QUERY FILTERS --------\n\n            //create a temporary options object\n            let opts = angular.copy(_options);\n\n            //apply options as parameters\n            angular.forEach(PARAM_OPTIONS, po => {\n                let name = po.parameter;\n                let value = opts[po.option];\n\n                let isSet = value !== null && typeof(value) !== 'undefined';\n                let isArr = isSet && typeof(value.push) !== 'undefined';\n\n                if(isSet && (!isArr||value.length)) {\n                    params[name] = isArr ? value.join(',') : value;\n                } else {\n                    delete params[name];\n                }\n                delete opts[po.option]; //remove from temp opts\n            });\n\n            //apply remaining options to query\n            // these are not keyed with specific parameters (ie, custom params)\n            angular.forEach(opts, (value, name) => {\n                if(value !== null && typeof(value) !== 'undefined') {\n                    let isArr = typeof(value.push) !== 'undefined';\n                    params[name] = isArr ? value.join(',') : value;\n                } else {\n                    //make sure it doesn't get sent if no value provided\n                    delete params[name];\n                }\n            });\n\n            // -------- QUERY FILTERS --------\n\n\n\n\n            let arr = [];\n            for(let k in _options.facets) {\n                if(_options.facets.hasOwnProperty(k)) {\n                    //encode commas in facet name since it's used to separate multiple\n                    // facet values\n                    arr.push(k+\":\"+_options.facets[k].replace(/,/g, '%2C'));\n                }\n            }\n            _selectedFacets = arr;\n\n\n            let start = _options.start;\n            if(isNaN(start)) start = 0;\n            else start = start*1;\n\n            params.page = Math.floor(start/_options.size);\n            params.size = _options.size;\n            params.sort = _options.sort;\n\n            if(arr.length)\n                params.facets = arr.join(',');\n\n\n\n            //prevent CORS cache bug in Chrome\n            params.bust = new Date().getTime();\n\n\n            //request facets\n            params.includeFacet=_requestFacets.join(',');\n\n            //request fields\n            params.fields=_fields.join(',');\n\n            svc.query(params).$promise.\n            then( function(response) {\n\n                _results = response.results;\n                _facets = response.facets || [];\n\n                //auto select objects if user has marked it as selected previously\n                // this is needed to maintain selections across pagination pages\n                _selected.each(function(id) {\n                    var map = _results.find(function(map) {return map._id === id;});\n                    if(map) map.selected = true;\n                });\n\n                //will trigger update on pagination directive\n                _options.total = response.totalResults;\n\n                _isLoading = false;\n                notify(eventKey + 'results');\n                notify(eventKey + 'pagination');\n\n            })\n            .catch( function(response) {\n                _isLoading = false;\n\n                //fallback\n                let obj = { error: \"An Error Occurred\", message: \"No details provided\" }\n\n                //http response error\n                if(response && response.data) obj = response.data;\n                //normal error\n                else if(response && response.message) obj = response;\n\n                //serialized json\n                if(typeof(obj) === 'string') {\n                    try      { obj = JSON.parse(obj);  }\n                    catch(e) { obj.message = \"Bad response from server\"; }\n                }\n\n                var error = {\n                    label: obj.error || \"An Error Occurred\",\n                    message: obj.message || \"No details provided\"\n                };\n                notify(eventKey + 'error', error);\n            });\n\n        }\n\n\n\n        function setOption(name, value, fire) {\n            _options[name] = value;\n            if(typeof(fire) === 'undefined' || !!fire) {\n                let delay = 500;\n                if(value === null || value === undefined)\n                    delay = 0;\n                if(value && typeof(value.push) !== 'undefined' && value.length)\n                    delay = 0;  //arrays\n                else if(value && value.length)\n                    delay = 0;   //strings\n                dirty(delay);\n            }\n        }\n\n\n\n        /* ------------ public api ------------- */\n\n        return {\n\n            events: {\n                LOADING:            eventKey + 'querying',\n                RESULTS:            eventKey + 'results',\n                PAGINATION:         eventKey + 'pagination',\n                SELECTED:           eventKey + 'selected',\n                ERROR:              eventKey + 'error',\n                SELECTED_ADDED:     eventKey + 'selected:added',\n                SELECTED_REMOVED:   eventKey + 'selected:removed',\n                SIMILARITY:         eventKey + 'similarTo'\n            },\n\n            /**\n             * @return {bool}\n             */\n            getLoadingStatus: function() {\n                return _isLoading;\n            },\n\n            /**\n             * NOTE: Make sure event names are prefixed with\n             *  eventKey + ''\n             * @param {string} eventName\n             * @param {function} listener\n             */\n            on: function(eventName, listener) {\n                // if(eventName.indexOf(eventKey + \":\") !== 0)\n                //     eventName = eventKey + '' + eventName;\n                return $rootScope.$on(eventName, listener);\n            },\n\n            /**\n             * @param {string} eventName\n             * @param {*} args\n             */\n            trigger: function(eventName, args) { notify(eventName, args); },\n\n            /**\n             * @return {array[object]}\n             */\n            getResults: function() { return _results; },\n\n            /**\n             * @return {array[string]} list of facet names\n             */\n            getFacetNames: function() { return FACETS.slice(0); },\n\n            /**\n             * @return {object} in form of <facet>: [<values>]\n             */\n            getFacets: function() { return _facets; },\n\n            /**\n             * @param {string} name\n             * @return {object|null}\n             */\n            getFacet: function(name) {\n                if(_facets) {\n                    return _facets.find(function(facet) {return facet.name===name;});\n                }\n                return null;\n            },\n\n            addFacet: function(name) {\n                _requestFacets.push(name);\n            },\n\n            applyConstraints: function(obj) {\n                // _options[VAR_QUERY] = obj.query;\n                // _options[VAR_TYPES] = obj.types;\n                // _options[VAR_THEMES] = obj.themes;\n                // _options[VAR_PUBLISHERS] = obj.publishers;\n                // _options[VAR_USER] = obj.user;\n                // _options[VAR_CREATED_BY] = obj.createdBy;\n                // _options[VAR_SERVICE_TYPES] = obj.serviceTypes;\n                // _options[VAR_SCHEMES] = obj.schemes;\n                // _options[VAR_VISIBILITY] = obj.visibility;\n                // //do we need to set extent here too?\n\n                for(var p in obj) {\n                    if(obj.hasOwnProperty(p)) {\n                        _options[p] = obj[p];\n                    }\n                }\n\n                _doUpdate(true);\n            },\n\n            applyOption: function(key, value, fire) {setOption(key, value, fire); },\n\n            applyOptions: function(opts, fire) {\n                angular.forEach(opts, (value, key) => { setOption(key, value, false); });\n                if(fire) _doUpdate(true);\n            },\n\n            /**\n             * @param {string} text - free text query\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setQuery: function(text, fireUpdate) { setOption(VAR_QUERY, text, fireUpdate); },\n\n            /**\n             * @param {array[string]} types - name of class(es) to request\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setTypes: function(types, fireUpdate) { setOption(VAR_TYPES, types, fireUpdate); },\n\n            getTypes: function() { return _options[VAR_TYPES]; },\n\n            /**\n             * @param {string} userId - identifier of user\n             * @param {boolean} fireUpdate -\n             */\n            setUser: function(userId, fireUpdate) { setOption(VAR_USER, userId, fireUpdate); },\n\n            /**\n             * @param {array[string]} creators - ids of creators\n             * @param {boolean} fireUpdate -\n             */\n            setCreatedBy: function(creators, fireUpdate) { setOption(VAR_CREATED_BY, creators, fireUpdate); },\n\n            /**\n             * @param {array[string]} themes - name of class(es) to request\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setThemes: function(themes, fireUpdate) { setOption(VAR_THEMES, themes, fireUpdate); },\n\n            getThemes: function() { return _options[VAR_THEMES]; },\n\n            /**\n             * @param {array[string]} publishers - name of class(es) to request\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setAgencies: function(publishers, fireUpdate) { setOption(VAR_PUBLISHERS, publishers, fireUpdate); },\n\n            getAgencies: function() { return _options[VAR_PUBLISHERS]; },\n\n            /**\n             * @param {array[string]} svcTypes - ids\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setServiceTypes: function(svcTypes, fireUpdate) { setOption(VAR_SERVICE_TYPES, svcTypes, fireUpdate);  },\n\n            getServiceTypes: function() { return _options[VAR_SERVICE_TYPES]; },\n\n            /**\n             * @param {array[string]} schemes - ids\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setSchemes: function(schemes, fireUpdate) { setOption(VAR_SCHEMES, schemes, fireUpdate); },\n\n            /**\n             * @param {string} visibility - one of 'public' or 'private'\n             * @param {boolean} fireUpdate\n             */\n            setVisibility: function(visibility, fireUpdate) { setOption(VAR_VISIBILITY, visibility, fireUpdate); },\n\n            /**\n             * @param {Date} date - date to compare against\n             * @param {boolean} beforeOrAfter - flag specifying which boundary condition (true = before, false = after)\n             * @param {boolean} fireUpdate - flag specifying whether to trigger update automatically\n             */\n            setModified: function(date, beforeOrAfter, fireUpdate) {\n\n                //if no date was supplied, consider it \"unset\" for both properties\n                if(!date) {\n                    setOption(VAR_MODIFIED_BEFORE, null, false);\n                    setOption(VAR_MODIFIED_AFTER, null, true);\n                    return;\n                }\n\n                let dir = beforeOrAfter && (beforeOrAfter === true || beforeOrAfter === \"true\");\n                let prop = dir ? VAR_MODIFIED_BEFORE : VAR_MODIFIED_AFTER;       //property being set\n                let oppProp = dir ? VAR_MODIFIED_AFTER : VAR_MODIFIED_BEFORE;    //unset opposite property\n                let arg = (date && date.getTime) ? date.getTime() : date;\n\n                setOption(oppProp, null, false);\n                setOption(prop, arg, true);\n            },\n\n            getModified: function() {\n                return this._options[VAR_MODIFIED_BEFORE] || this._options[VAR_MODIFIED_AFTER];\n            },\n\n            /**\n             * @param {string} bboxStr - form of \"minx,miny,maxx,maxy\"\n             * @param {boolean} fireUpdate\n             */\n            setExtent: function(bboxStr) { setOption(VAR_EXTENT, bboxStr, true); },\n\n            /**\n             * @return {string} bbox string or null if not set\n             */\n            getExtent: function() { return _options[VAR_EXTENT]; },\n\n            /**\n             * @return {array} list of selected items from current search results\n             */\n            getSelected: function() { return _selected; },\n\n            /**\n             * @param {array} arr - list of items to select in current search results\n             */\n            setSelected: function(arr) {\n                _selected = arr;\n                notify(this.events.SELECTED, _selected);\n            },\n\n            /**\n             * @param {string} id - identifier of item in current search results to add to selected list\n             */\n            select: function(id) {\n\n                var finder = function(l){ return l.id === id; };\n\n                var existing = _selected.find(finder);\n                if(existing) {  //already selected, deselect it\n\n                    var idx = _selected.indexOf(existing);\n                    if(idx >= 0) {\n                        _selected.splice(idx, 1);\n                        notify(eventKey + 'selected:removed', existing);\n                    }\n\n                } else {        //not selected, select it\n\n                    let obj = _results.find(finder);\n                    if(obj) {\n\n                        if(_onSelectFn) {\n                            _onSelectFn(id, function(err, item) {\n                                if(item) {\n                                    _selected.unshift(item);\n                                    notify(eventKey + 'selected:added', item);\n                                }\n                            });\n                        } else {\n                            _selected.unshift(obj);\n                            notify(eventKey + 'selected:added', obj);\n                        }\n                    }\n\n                }\n\n                notify(this.events.SELECTED, _selected);\n            },\n\n            /**\n             * @param {string} id - identifier of item to check\n             * @return {boolean} true if selected, false otherwise\n             */\n            isSelected: function(id) {\n                return _selected.find(function(obj) {return obj.id === id;});\n            },\n\n            /**\n             * select all items in current page of results\n             */\n            selectAll: function() {\n                angular.forEach(_results, (obj) => {\n                    if(!this.isSelected(obj.id))\n                        _selected.unshift(obj);\n                });\n                notify(this.events.SELECTED, _selected);\n            },\n\n            /**\n             * empty list of selected items\n             */\n            clearSelected: function() {\n                _selected = [];\n                notify(this.events.SELECTED, []);\n            },\n\n\n            /**\n             *\n             */\n            clear: function(refresh) {\n\n                for(var prop in _options) {\n                    if(!_options.hasOwnProperty(prop)) continue;\n                    if('start' === prop) _options[prop] = 0;\n                    else if('size' === prop) { }\n                    else if('sort' === prop) _options[prop] = 'modified,desc';\n                    else if('facets' === prop) _options[prop] = {};\n                    else _options[prop] = null;\n                }\n\n                if(refresh || typeof(refresh) === 'undefined')\n                    _doUpdate(true);\n            },\n\n            /*\n             * @param {string} category - name of facet\n             * @param {string} value - value of facet\n             */\n            setFacet: function(category, value) {\n\n                var f = _options.facets[category];\n                if(!f)  //this facet category not set yet\n                    _options.facets[category] = value;\n                else {  //this facet category already set\n                    if(f === value) {   //this facet value already set\n                        //unset it\n                        delete _options.facets[category];\n                    } else {    //this facet value not set\n                        //set it\n                        _options.facets[category] = value;\n                    }\n                }\n\n                _doUpdate(true);\n            },\n\n            /**\n             * @param {array[string]} fields - list of field names to request for each search result\n             */\n            setFields: function(fields) {\n                if(fields && typeof(fields.push) !== 'undefined')\n                    _fields = fields;\n            },\n\n            /**\n             * @param {int} start - beginning index of results to request\n             * @param {bool} andUpdate - trigger update (default is true)\n             */\n            start: function(start, andUpdate) {\n                _options.start = start;\n                if(andUpdate && andUpdate === true)\n                    _doUpdate(false);\n            },\n\n            /**\n             * @param {int} size - page size to request\n             * @param {bool} andUpdate - trigger update (default is true)\n             */\n            size: function(size, andUpdate) {\n\n                _options.size = size;\n\n                //find out which page in the new scheme the current first-result of current page\n                // will show up in, and set start so that it shows up with the new page size\n                var page = Math.floor(_options.start*1 / _options.size*1);\n                _options.start = page * (_options.size*1);\n\n                if(andUpdate && andUpdate === true)\n                    _doUpdate(false);\n\n            },\n\n            /**\n             * @param {int} size - number of items to return in each page of results\n             */\n            pageSize: function(size) {\n                this.size(size, true);\n            },\n\n            /**\n             * @param {string} sort - form of <field>,<dir>\n             */\n            sort: function(sort) {\n                _options.sort = sort;\n                _doUpdate(false);\n            },\n\n            /**\n             * return {object} containing start index, page size, and total results\n             */\n            getPagination: function() {\n                return {\n                    start: _options.start,\n                    size:  _options.size,\n                    pageSize: _options.size,\n                    total: _options.total,\n                    sizeOptions: _pageSizeBase\n                };\n            },\n\n            /**\n             * @return {array} list of key-value pairs of sort options\n             */\n            getSortOptions: function() { return SORT_OPTIONS.slice(0); },\n\n            /**\n             * @return {string} sorting parameter (field,order)\n             */\n            getSortValue: function () { return _options.sort; },\n\n            /**\n             * @return {object} clone of the current set of query options\n             */\n            getQueryOptions: function() { return jQuery.extend({}, _options); },\n\n            /**\n             *\n             */\n            hasQueryOptions: function() {\n                var result = false;\n                for(var k in _options) {\n                    if(_options.hasOwnProperty(k)) {\n\n                        if( 'start' === k || 'size' === k || 'total' === k ||\n                            'sort' === k || 'order' === k || 'within' === k ||\n                            'facets' === k) continue;\n\n                        if(_selectedFacets.length)\n                            result = true;\n\n                        if(typeof(_options[k]) !== 'undefined' && _options[k] !== null) {\n                            result = true;\n                        }\n                    }\n                }\n                return result;\n            },\n\n            /**\n             * Triggers a refresh of current search results\n             * @param {boolean} resetStart - reset 'start' to 0 flag\n             */\n            update: function(resetStart) {\n                dirty(0, resetStart);\n            },\n\n\n            reset: function() {\n                _options = {\n                    start: 0,\n                    size: _pageSizeBase[0],\n                    total: 0,\n                    sort: \"modified,desc\", order: \"asc\",\n                    facets: {}\n                };\n\n                _facets = [];\n                _selectedFacets = [];\n                _results = [];\n                _isLoading = false;\n                _selected = [];\n\n                if(_dirtyPromise)\n                    $timeout.cancel(_dirtyPromise);\n                _dirtyPromise = null;\n            },\n\n            destroy: function() {\n                if(_dirtyPromise)\n                    $timeout.cancel(_dirtyPromise);\n            }\n        };\n    }\n\n\n\n\n\n\n\n\n    /**\n     * Factory for creating instances of BrowseObjectsService\n     */\n    function BrowseServiceFactory($rootScope, $timeout, $resource) {\n\n        return function(options) {\n            let svc = BrowseObjectsService($rootScope, $timeout, $resource, options);\n            if(options && options.params)\n                svc.applyOptions(options.params);\n            return svc;\n        };\n    }\n\n\n\n\n    angular.module('gp-common')\n\n    //generic browse service\n    .service(\"BrowseObjectsService\",\n        ['$rootScope', '$timeout', '$resource', BrowseObjectsService])\n\n    //factory for creating specific browse services\n    .factory(\"BrowseServiceFactory\",\n        ['$rootScope', '$timeout', '$resource', 'BrowseObjectsService', BrowseServiceFactory]);\n\n/*\n    Example of how to use the factory to customize a service\n\n    //layer-specific browse service\n    .service('BrowseLayerObjService', ['BrowseServiceFactory', function(BrowseServiceFactory) {\n        let service = BrowseServiceFactory({\n            key: 'layers',\n            url: Constants.ualUrl + '/api/layers'\n        });\n\n        //add custom methods here\n\n        return service;\n    }])\n*/\n\n\n})(angular, GeoPlatform);\n","(function(angular) {\n    \n    'use strict';\n\n\n    /* *********************************************\n     * Requires socket.io be in the global namespace\n     * tested with version 2.x\n     * ********************************************* */\n\n\n\n     /*\n        Usage:\n\n        let service = ...\n\n        let svcId = service.getId();\n\n        //listen to events from the server\n        service.on('testing', (event) => { \n            if(event.clientId === svcId) return; //ignore our own events\n            ... do something ...\n        });\n        \n        //sends out a message to others\n        service.emit( service.events.CREATED, 'test');\n\n        //sends out a message to others\n        service.begin(service.events.EDITING, 'test');\n\n        //sends out a message to others\n        service.end(service.events.EDITING, 'test');\n\n        //stop listening and close the socket\n        service.close();\n\n      */\n\n\n\n\n    /**\n     *\n     */\n    class SocketService {\n\n        constructor (url, options) {\n            'ngInject';\n\n            let opts = typeof(options) === 'object' ? options : {};\n            for(var key in opts)\n                this[key] = opts[key];\n\n            this.socket = null;\n\n            //list of ids of things being tracked, such as \n            // items edited, in order to send messages\n            // about the things lifecycle\n            this.tracking = {};\n\n            //events supported.\n            // Note that lifecycles can be added by using the \n            // begin() and end() methods on the service,\n            // which appends '_start' and '_end' respectively\n            this.events = {\n                CREATED: 'created',\n                UPDATED: 'updated',\n                DELETED: 'deleted',\n                EDITING: 'editing',\n                STATUS: 'status'\n            };\n\n            if(typeof(io) === 'undefined') {\n                console.log(\"Socket.IO not found in global namespace\");\n                return;\n            }\n\n            if(!url) {   //TODO validate URL with regex?\n                console.log(\"No web socket URL configured for this app to communicate with\");\n                return;\n            }\n\n            //make connection\n            this.socket = io.connect(url);\n\n            //listen for the init event indicating connection has been made\n            // and to get the socket's id from the server\n            this.socket.on(\"init\", (evt) => { \n                this.socketId = evt.id; \n            });\n\n            //if unable to connect\n            this.socket.on('error', () => {\n                console.log(\"Unable to connect to \" + url + \" with websockets\");\n            });\n\n        }\n\n        /**\n         *\n         */\n        getId () { return this.socketId; }\n            \n        /**\n         * @param {string} eventName\n         * @param {Function} callback\n         * @return {Function} to remove the listener\n         */\n        on (eventName, callback) {\n            if(!this.socket) return function() { };\n            //add the listener to the socket\n            this.socket.on(eventName, callback);\n            //return an 'off' function to remove the listener\n            return () => { this.socket.off(eventName, callback); };\n        }\n\n        /**\n         *\n         */\n        emit ( eventName, data, callback ) {\n            if(!this.socket) return;\n            this.socket.emit(eventName, data, callback);\n        }\n\n        /**\n         * Closes this service's socket\n         */\n        close () { \n\n            //if this app was tracking an obj, \n            // notify listeners that it is no longer\n            for(var event in this.tracking) {\n                if(this.tracking.hasOwnProperty(event)) {\n                    let tracks = this.tracking[event];\n                    if(tracks && tracks.length) {\n                        /* jshint ignore:start */\n                        angular.forEach(tracks, (id) => { \n                            this.end(event, id); \n                        });\n                        /* jshint ignore:end */\n                    }        \n                }\n            }\n\n            if(this.socket) {\n                this.socket.close(); \n                this.socket = null;\n            }\n\n            return null;\n        }\n\n        /**\n         * @param {string} event - name of the event being started\n         * @param {string} objId - identifier of the item being tracked\n         */\n        begin (event, objId) {\n\n            this.tracking[event] = this.tracking[event] || [];\n            this.tracking[event].push(objId);\n\n            let room = objId + \"_\" + event.toLowerCase();\n\n            this.join(room, () => {\n                this.socket.emit(event, room, this.socketId, true);\n            });\n\n        }\n\n        /**\n         * @param {string} event - name of the event being ended\n         * @param {string} objId - identifier of the item being tracked\n         */\n        end (event, objId) {\n\n            this.tracking[event] = this.tracking[event] || [];\n            if(!this.tracking[event].length) return;    //empty, ignore request\n\n            let idx = this.tracking[event].indexOf(objId);\n            if(idx < 0) //not found, ignore request\n                \n            //remove tracker\n            this.tracking[event].splice(idx, 1);\n\n            //send event to server about client stopping it's tracking\n            let room = objId + \"_\" + event.toLowerCase();\n            this.socket.emit(event, room, this.socketId, false, () => {\n                this.leave(room);\n            });\n\n        }\n\n        /**\n         *\n         */\n        join (objId, callback) {\n            this.emit('join', objId, callback);\n        }\n\n        /**\n         *\n         */\n        leave (objId, callback) {\n            this.emit('leave', objId, callback);\n        }\n\n    }\n\n\n\n\n    /** \n     * Factory to get a Service used to listen for WebSocket messages from a server\n     *\n     * Usage: \n     *\n     * let wsUrl = ...\n     * let service = SocketServiceFactory(wsUrl);\n     *\n     */\n     angular.module('gp-common').factory('SocketServiceFactory', function ($rootScope, $window, UUID) {\n\n        var cache = {};\n\n        //disconnect whenever the app is closed\n        var onClose = (e) => { \n            for(var key in cache) {\n                if(cache.hasOwnProperty(key)) {\n                    cache[key].close();\n                    cache[key] = null;\n                }\n            }\n            cache = null;\n            return null;\n        };\n        \n        //needed for reload/backbtn\n        if($window.onbeforeunload === 'function') {\n            let existing = $window.onbeforeunload;\n            $window.onbeforeunload = function(e) {\n                onClose(e);\n                return existing(e);\n            };\n        } else {\n            $window.onbeforeunload = onClose;      \n        }\n\n        $rootScope.$on('$destroy', onClose);\n        //-------------------\n\n\n        return function(url) {\n\n            // if(!url) return null;\n            // if(cache[url]) return cache[url];\n\n            let cacheRef = UUID();\n            let service = new SocketService(url, $rootScope, {cacheRef: cacheRef});\n            let closeDelegate = service.close;\n            service.close = function() {\n                let id = service.cacheRef;\n                closeDelegate.call(service); //have service disconnect and clean up itself\n                //then clean up cache reference\n                delete cache[id];\n            };\n\n            let onDelegate = service.on;\n            service.on = function(event, callback) {\n\n                if(typeof(callback) === 'function') {\n                    //have to use old-school refs instead of arrow functions\n                    // or else the arguments get scrambled\n                    let handle = function() {\n                        var args = arguments;\n                        $rootScope.$apply(function() { \n                            callback.apply(service.socket, args); \n                        });\n                    };\n                    return onDelegate.call(service, event, handle);\n\n                } else {\n                    return onDelegate.call(service, event);\n                }\n            };\n\n            let emitDelegate = service.emit;\n            service.emit = function(event, data, callback) {\n                \n                if(typeof(callback) === 'function') {\n                    //have to use old-school refs instead of arrow functions\n                    // or else the arguments get scrambled\n                    let handle = function() {\n                        var args = arguments;\n                        $rootScope.$apply(function() { \n                            callback.apply(service.socket, args); \n                        });\n                    };\n                    emitDelegate.call(service, event, data, handle);\n\n                } else {\n                    emitDelegate.call(service, event, data);\n                }\n            };\n\n            // cache[url] = service;\n            cache[cacheRef] = service;\n            return service;\n\n        };\n\n    });\n\n}) (angular);","(function(angular) {\n    \n    'use strict';\n\n    angular.module(\"gp-common\").factory('UUID', function() {\n            \n        function s4() {\n            return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);\n        }\n\n        /*\n        return function() {\n                return s4() + s4() + '-' + s4() + '-' + s4() + '-' +\n                    s4() + '-' + s4() + s4() + s4();\n            }\n         */\n\n        return function() {\n            // http://www.ietf.org/rfc/rfc4122.txt\n            var s = [];\n            var hexDigits = \"0123456789abcdef\";\n            for (var i = 0; i < 36; i++) {\n                s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);\n            }\n            s[14] = \"4\"; // bits 12-15 of the time_hi_and_version field to 0010\n            s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1); // bits 6-7 of the clock_seq_hi_and_reserved to 01\n            s[8] = s[13] = s[18] = s[23] = \"-\";\n            return s.join(\"\");\n        }\n        \n    });\n\n})(angular);"]}