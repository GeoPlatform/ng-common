{"version":3,"sources":["module.js","auth.js","lang.js","directives/datepicker.js","directives/geolocation.js","directives/header-menu.js","directives/iframe.js","directives/image.js","directives/notifications.js","directives/pagination.js","geoplatform.common.js","directives/responsive.js","directives/slick-forms.js","directives/social.js","directives/sort.js","filters/filters.js"],"names":["jQuery","angular","module","value","GeoPlatform","getJWTFromUrl","queryString","window","location","hash","href","res","match","service","$q","$http","$location","$rootScope","$window","Config","User","opts","p","this","id","username","toJSON","name","email","org","exp","clone","compare","arg","Storage","prototype","setObject","key","setItem","btoa","JSON","stringify","getObject","atob","getItem","parse","_user","Service","self","getUserQ","when","getUser","login","current","redirect","CALLBACK","AUTH_TYPE","Error","loginUrl","IDP_BASE_URL","APP_ID","encodeURIComponent","LOGIN_URL","logout","clearLocalStorageJWT","get","then","response","removeAuth","LOGOUT_URL","FORCE_LOGIN","PORTAL_URL","host","err","console","log","forceLogin","getOauthProfile","Q","defer","getJWTfromLocalStorage","url","resolve","data","reject","promise","setUser","user","check","jwt","getJWT","isExpired","setAuth","parseJwt","sub","cleanUrl","replace","callback","localStorage","gpoauthJWT","now","Date","getTime","token","parsed","base64Url","split","base64","validateJwt","valid","defaults","headers","common","Authorization","useXDomain","factory","$injector","resp","authHeader","AuthenticationService","config","$httpProvider","interceptors","push","directive","$timeout","scope","minimal","template","join","controller","$scope","$element","idpUrl","idmUrl","Array","find","i","length","filter","results","each","String","startsWith","str","indexOf","endsWith","substr","substring","plus","offset","type","offsetMS","d","random","threshold","Math","floor","label","format","date","onChange","$attrs","toggle","event","preventDefault","stopPropagation","opened","debounce","cancel","$watch","listener","$on","defaultBtnLabel","restrict","btnLabel","loading","available","navigator","geolocation","error","geolocate","getCurrentPosition","position","$apply","$emit","coords","latitude","longitude","code","brand","showHomeLink","transclude","link","ctrl","transcludeFn","portalUrl","replaceWith","update","path","homeLink","menu","removeClass","dd","closest","addClass","parent","a","$a","$","attr","homeHref","$root","element","attrs","on","off","onImgFail","jqEl","items","getItems","addItem","item","$broadcast","fn","removeItem","bind","index","splice","msg","dismiss","message","canDismiss","success","info","NotificationService","expiration","timer","removeOldest","oldest","$watchCollection","Controller","ostart","start","osize","pageSize","pages","maxPagination","ceil","total","numPages","currentPage","s","e","min","pageStart","pageEnd","tooltip","active","pageSizeOpts","sort","previous","max","next","setPage","page","setPageSize","size","hasPrevious","hasNext","$inject","provider","$windowProvider","Helper","$get","getWidth","innerWidth","outerWidth","isXS","width","isSM","isMD","isLG","helper","responsiveHelper","el","resizeFn","w","$attr","hh","offsetHeight","tp","changes","top","css","inputLinkFunction","ngModelController","validate","input","isDirty","hasClass","newValue","$setViewValue","$render","required","elId","innerValue","$viewValue","displayValue","placeholder","isReadOnly","t","readOnly","toLowerCase","edit","editing","focus","select","done","save","onKeyPress","$event","undefined","which","onKeyUp","$destroy","require","help","pattern","icon","INPUT_TEMPLATE","TEXTAREA_TEMPLATE","$filter","DATE_TEMPLATE","inline","$modelValue","copy","open","uibopts","isNaN","codeList","SELECT_TEMPLATE","getSelect","$select","selectOptions","map","opt","o","onTypeaheadSelection","$item","$model","$label","onTypeaheadKeyUp","func","wait","immediate","timeout","context","args","arguments","later","apply","callNow","clearTimeout","setTimeout","className","renderTwitterButton","innerHTML","twttr","widgets","createShareButton","count","text","via","hashtags","dnt","$observe","ngModel","$viewChangeListeners","$eval","ngChange","toUpperCase","arr","facetName","f","delimiter","emptyValue","defVal","Object","keys"],"mappings":"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","file":"geoplatform.common.min.js","sourcesContent":["(function(jQuery, angular) {\n    \n    \"use strict\"; \n    \n    angular.module(\"gp-common\", [])\n\n    //Assumes a global object containing configuration values for GeoPlatform exists \n    // prior to this module being declared\n    // (using 'value' since config might change)\n    .value('GPConfig', GeoPlatform)\n    ;\n\n})(jQuery, angular);\n","(function(angular) {\n\n  'use strict';\n\n  //flag on whether we're in dev env\n  // function isDEV() {\n  //     return \"localhost\" === window.location.hostname ||\n  //         ~window.location.hostname.indexOf(\"192.168\")||\n  //         ~window.location.hostname.indexOf(\"localhost\")||\n  //         ~window.location.hostname.indexOf(\"10.0\");\n  // }\n\n  /**\n   * Get token from query string\n   * \n   * Note:\n   *  Lifted outside of any Angular service to prevent cyclical service dependencies.\n   * \n   * @method getJWTFromUrl\n   * @returns {String} token - token in query string or undefined\n   */\n  function getJWTFromUrl() {\n    var queryString = window.location.hash ? window.location.hash : window.location.href;\n    var res = queryString.match(/access_token=([^\\&]*)/);\n    return res && res[1];\n  };\n\n  /**\n   * GeoPlatform Common Module Authentication Support\n   *\n   * Contains re-usable services, directives, and other angular components\n   *\n   *\n   * NOTE: This module uses certain variables in $rootScope in order to\n   * perform actions like authentication.  The following variables should be\n   * set before using any service/directive in this file:\n   *\n   *   - idspUrl : the url to the identity service provider server\n   *   - idmUrl : the url to the identity management server\n   *   - portalUrl : the url to the main landing page of GeoPlatform (www.geoplatform.gov in production)\n   */\n  angular.module('gp-common')\n\n\n    /**\n     * Authentication Service\n     *\n     * Because the auth service redirects the page to the IDM portal\n     * and WMV is reloaded once the login/logout processes are complete,\n     * there's no need to bind listeners informing other components of\n     * an auth change.\n     *\n     * Inside \"DEV\", you should close and re-open any components' widgets\n     * to get current auth status.\n     */\n    .service('AuthenticationService', ['$q', '$http', '$location', '$rootScope', '$window', 'GPConfig',\n      function($q, $http, $location, $rootScope, $window, Config) {\n\n        //extend Storage prototype\n        Storage.prototype.setObject = function(key, value) {\n          this.setItem(key, btoa(JSON.stringify(value)));\n        };\n\n        Storage.prototype.getObject = function(key) {\n          var value = atob(this.getItem(key));\n          return value && JSON.parse(value);\n        };\n\n        function User(opts) {\n          for (var p in opts) {\n            this[p] = opts[p];\n          }\n          if (!this.id && this.username)\n            this.id = this.username;\n\n          this.toJSON = function() {\n            return {\n              id: this.id,\n              username: this.username,\n              name: this.name,\n              email: this.email,\n              org: this.org,\n              exp: this.exp\n            };\n          };\n\n          this.clone = function() {\n            return new User(this.toJSON());\n          };\n          this.compare = function(arg) {\n            if (arg instanceof User) {\n              return this.id === arg.id;\n            } else if (typeof(arg) === 'object') {\n              return typeof(arg.id) !== 'undefined' &&\n                arg.id === this.id;\n            }\n            return false;\n          };\n        }\n\n        var _user = null;\n\n        /**\n         * Authentication Service\n         */\n        var Service = function() {\n\n          var self = this;\n\n          //$q version of getUser\n          this.getUserQ = function() {\n            return $q.when(self.getUser())\n          };\n\n          /**\n           * Redirects the page to the login site\n           */\n          this.login = function() {\n\n            //use current window\n            var current = window.location.href;\n            var redirect = (Config.CALLBACK) ? Config.CALLBACK : current;\n\n            if (Config.AUTH_TYPE !== 'grant' && Config.AUTH_TYPE !== 'token') {\n              //fail this request\n              throw new Error(\"Invalid authentication request type.  Must be 'token' or 'grant'.\");\n            }\n\n            //check auth type to set login URL: Implicit -> to IDP, Grant -> Resource Provider Login URL\n            var loginUrl = (Config.AUTH_TYPE === 'token') ? Config.IDP_BASE_URL +\n              '/auth/authorize?client_id=' + Config.APP_ID + '&response_type=' +\n              Config.AUTH_TYPE + '&redirect_uri=' + encodeURIComponent(redirect) : Config.LOGIN_URL;\n\n            window.location = loginUrl;\n\n            //This could be writen to use an modal / pop-up for login so you don't have to lose your current page\n            //Logout already executes using a background call\n          };\n\n          /**\n           * Performs background logout and requests jwt revokation\n           */\n          this.logout = function() {\n            //implicitly remove incase the idp is down and the revoke call does not work\n            _user = null;\n            self.clearLocalStorageJWT();\n\n            $http.get(Config.IDP_BASE_URL + '/auth/revoke')\n              .then(function(response) {\n                self.removeAuth();\n                //goto logout page\n                if (Config.LOGOUT_URL) {\n                  Config.FORCE_LOGIN = false;\n                  window.location = Config.LOGOUT_URL;\n                } else {\n                  window.location.hash = '';\n                  window.location = Config.PORTAL_URL || window.location.host;\n                }\n              }, function(err) {\n                console.log(err);\n              });\n          };\n\n          /**\n           * Optional force redirect for non-public services\n           */\n          this.forceLogin = function() {\n            self.login();\n          };\n\n          /**\n           * Get protected user profile\n           */\n          this.getOauthProfile = function() {\n            var Q = $q.defer();\n            //check to make sure we can make called\n            if (self.getJWTfromLocalStorage()) {\n              var url = Config.IDP_BASE_URL + '/api/profile';\n              $http.get(url)\n                .then(function(response) {\n                  //when we get it, save it so we don't have to hit the IDP so many times\n                  Q.resolve(response.data);\n                }, function(err) {\n                  console.log(err);\n                  Q.reject(err);\n                });\n            }\n            return Q.promise;\n          };\n\n          /*\n           * Set the _user property in this scope\n           */ \n          this.setUser = function(user){ _user = user }\n\n          /**\n           * Unpacks JWT to see if session is valid.\n           * \n           * Side Effects: \n           *  - Sets the _user property\n           *  - Sets the Authorize header if valid user found (this.setAuth)\n           *  - Will redirect user to login url if FORCE_LOGIN is set an no valid user is found\n           * \n           * @return {User} - the authenticated user or undefined\n           */\n          this.check = function() {\n            // Pull user from either LocalStorage or the JWT (or the URL)\n            const jwt = self.getJWT();\n\n            // Save JWT in Auhorization Header\n            if(jwt && !self.isExpired(jwt)){\n              self.setAuth(jwt); \n              const user = self.parseJwt(jwt);\n              // slightly differnet mapping ;)\n              self.setUser(new User({\n                id: user.sub,\n                username: user.username,\n                email: user.email,\n                name: user.name,\n                org: user.org,\n                exp: user.exp\n              }))\n\n              //clean hosturl on redirect from oauth\n              const current = ($window && $window.location && $window.location.hash) ? $window.location.hash : $location.url()\n              if (getJWTFromUrl()) {\n                var cleanUrl = current.replace(/access_token=([^\\&]*)/, '');\n                $window.location = cleanUrl;\n              }\n\n            // No valid userdata found\n            } else { \n              self.removeAuth(); \n              // Redirect if settings set\n              if(Config.FORCE_LOGIN === true) self.forceLogin();\n            }\n\n            // return the user\n            return _user\n          };\n\n          /**\n           * If the callback parameter is specified, this method\n           * will return undefined. Otherwise, it returns the user (or null).\n           * \n           * Side Effects: \n           *  - This property sets the _user property for the enclosing scope\n           *  - Will redirect users if no valid JWT was found\n           *\n           * @param callback optional function to invoke with the user\n           * @return object representing current user\n           */\n          this.getUser = function(callback) {\n            // better check 'em first\n            self.check(); // Sideffects will redirect browser if JWT invalid\n\n            return callback && typeof(callback) === 'function' ?\n              callback(_user) :\n              _user;\n          }\n\n          //=====================================================\n\n          /**\n           * Extract token from current URL\n           * \n           * @method getJWTFromUrl\n           * \n           * @return {String | undefined} - JWT Token (raw string)\n           */\n          this.getJWTFromUrl = function(){\n            const queryString = ($window && $window.location && $window.location.hash) ? $window.location.hash : $location.url();\n            const res = queryString.match(/access_token=([^\\&]*)/);\n            return res && res[1];\n          };\n\n          /**\n           * Load the JWT stored in local storage.\n           * \n           * @method getJWTfromLocalStorage\n           * \n           * @return {JWT | undefined} An object wih the following format:\n           */\n          this.getJWTfromLocalStorage = function(){\n            return window.localStorage.gpoauthJWT\n          };\n\n          /**\n           * Attempt and pull JWT from the following locations (in order):\n           *  - URL query parameter 'access_token' (returned from IDP)\n           *  - Browser local storage (saved from previous request)\n           * \n           * @method getJWT \n           * \n           * @return {JWT | undefined} \n           */\n          this.getJWT = function(){\n            return self.getJWTFromUrl() || self.getJWTfromLocalStorage()\n          };\n\n          /**\n           * Remove the JWT saved in local storge.\n           * \n           * @method clearLocalStorageJWT\n           * \n           * @return  {undefined}\n           */\n          this.clearLocalStorageJWT = function(){\n            delete window.localStorage.gpoauthJWT;\n          };\n\n          /**\n           * Is a token expired.\n           * \n           * @method isExpired\n           * @param {JWT} jwt - A JWT\n           * \n           * @return {boolean}\n           */\n          this.isExpired = function(jwt){\n            const exp = jwt && self.parseJwt(jwt).exp;\n            const now = (new Date()).getTime() / 1000;\n            return now > exp;\n          };\n\n          /**\n           * Unsafe (signature not checked) unpacking of JWT.\n           * \n           * @param {string} token - Access Token (JWT)\n           * \n           * @return {Object} the parsed payload in the JWT\n           */\n          this.parseJwt = function(token) {\n            var parsed;\n            if (token) {\n              var base64Url = token.split('.')[1];\n              var base64 = base64Url.replace('-', '+').replace('_', '/');\n              parsed = JSON.parse(atob(base64));\n            }\n            return parsed;\n          };\n\n          /**\n           * \n           */\n          this.validateJwt = function(token) {\n            var parsed = self.parseJwt(token);\n            var valid = (parsed && parsed.exp && parsed.exp * 1000 > Date.now()) ? true : false;\n            //TODO: chk jwt signature too\n            return valid;\n          };\n\n          this.setAuth = function(jwt) {\n            window.localStorage.gpoauthJWT = jwt;\n            $http.defaults.headers.common.Authorization = 'Bearer ' + jwt;\n            $http.defaults.useXDomain = true;\n            return;\n          };\n\n          this.removeAuth = function() {\n            _user = null;\n            delete window.localStorage.gpoauthJWT;\n            delete $http.defaults.headers.common.Authorization;\n            $http.defaults.useXDomain = false;\n            return;\n          };\n\n          //initialize with auth check\n          this.check()\n\n        };\n\n        return new Service();\n\n      }\n    ])\n\n    /**\n     * Interceptor that check for an updaed AccessToken coming from any request\n     * and will take it and set it as the token to use in future outgoing\n     * requests\n     */\n    .factory('ng-common-AuthenticationInterceptor', function($injector, $window){\n      // Interceptor\n      return {\n        response: function(resp) {\n          const jwt = getJWTFromUrl();\n          const authHeader = resp.headers('Authorization');\n\n          if(jwt){\n            const AuthenticationService = $injector.get('AuthenticationService')\n            AuthenticationService.setAuth(jwt);\n          } else if (authHeader) {\n            const AuthenticationService = $injector.get('AuthenticationService')\n            AuthenticationService.setAuth(authHeader.replace('Bearer ',''));\n          }\n\n          return resp;\n        }\n      };\n    })\n\n    .config(function myAppConfig ($httpProvider) {\n      $httpProvider.interceptors.push('ng-common-AuthenticationInterceptor');\n    })\n\n\n    .directive('gpLoginButton', ['$timeout', 'AuthenticationService', 'GPConfig',\n      function($timeout, AuthenticationService, Config) {\n        return {\n          scope: {\n            minimal: '@'\n          },\n          replace: true,\n          template: [\n\n            '<div class=\"btn-account btn-group\">' +\n\n            //not logged in\n            '  <a class=\"btn btn-link\" ng-click=\"login()\" ng-if=\"!user\">Sign In</a>' +\n\n            //logged in\n            '  <button type=\"button\" class=\"btn btn-link dropdown-toggle\" data-toggle=\"dropdown\" ' +\n            '   aria-expanded=\"false\" ng-if=\"user\">' +\n            '     <span class=\"glyphicon glyphicon-user\"></span> ' +\n            '     <span class=\"hidden-xs\">{{::user.name}}</span> ' +\n            '     <span class=\"caret\"></span>' +\n            '  </button>' +\n            '  <ul class=\"dropdown-menu dropdown-menu-right\" role=\"menu\" ng-if=\"user\">' +\n            '    <li class=\"account-details\">' +\n            '      <div class=\"media\">' +\n            '        <div class=\"media-left\">' +\n            '          <div class=\"media-object\">' +\n            '            <span class=\"glyphicon glyphicon-user glyphicon-xlg\"></span>' +\n            '          </div>' +\n            '        </div>' +\n            '        <div class=\"media-body\">' +\n            '          <div class=\"media-heading\">{{::user.name}}</div>' +\n            '          <div><em>{{::user.username}}</em></div>' +\n            '          <div>{{::user.email}}</div>' +\n            '          <div>{{::user.org}}</div>' +\n            '        </div>' +\n            '      </div>' +\n            '    </li>' +\n            '    <li class=\"divider\"></li>' +\n            '    <li><a href=\"{{::idpUrl}}/modifyuser.html\">Edit Info</a></li>' +\n            '    <li><a href=\"{{::idpUrl}}/changepassword.html\">Change Password</a></li>' +\n            '    <li><a href ng-click=\"logout()\">Sign Out</a></li>' +\n            '  </ul>' +\n\n\n            '</div>'\n          ].join(' '),\n          controller: function($scope, $element) {\n\n            if ($scope.minimal === 'true') $scope.minimal = true;\n            if ($scope.minimal !== true) $scope.minimal = false;\n\n            $scope.idpUrl = Config.idmUrl;\n            // console.log(\"IDM Base Url: \" + Config.idmUrl);\n\n            AuthenticationService.getUser(function(user) {\n              $timeout(function() {\n                $scope.user = user;\n              }, 100);\n            });\n\n            $scope.login = function() {\n              $scope.user = AuthenticationService.login();\n            };\n\n            $scope.logout = function() {\n              $scope.user = AuthenticationService.logout();\n            };\n          }\n        };\n      }\n    ])\n\n\n\n    .directive('gpAccountDetails', ['$timeout', 'AuthenticationService', 'GPConfig',\n      function($timeout, AuthenticationService, Config) {\n\n        return {\n          scope: {},\n          replace: true,\n          template: [\n            '<div>' +\n            '  <div class=\"media\">',\n            '    <div class=\"media-left\">',\n            '        <div class=\"media-object\">',\n            '            <span class=\"glyphicon glyphicon-user glyphicon-xlg\"></span>',\n            '        </div>',\n            '    </div>',\n            '    <div class=\"media-body\" ng-if=\"user\">',\n            '       <div class=\"media-heading\">{{::user.name}}</div>' +\n            '       <div><small><em>{{::user.username}}</em></small></div>' +\n            '       <div><small>{{::user.email}}</small></div>' +\n            '       <div><small>{{::user.org}}</small></div>' +\n            '    </div>',\n            '    <div class=\"media-body\" ng-if=\"!user\">',\n            '       <div class=\"media-heading\">Please Sign In</div>' +\n            '       <div><small>Sign in to your GeoPlatform account or register a new account.</small></div>' +\n            '    </div>',\n            '  </div>',\n            '  <hr/>',\n            '  <div ng-if=\"user\">',\n            '    <button type=\"button\" class=\"btn btn-sm btn-accent pull-right\" ng-click=\"logout()\">Sign Out</button>' +\n            '    <a class=\"btn btn-sm btn-default\" href=\"{{::idpUrl}}/modifyuser.html\">Edit Details</a>' +\n            '  </div>',\n            '  <div ng-if=\"!user\">',\n            '    <button type=\"button\" class=\"btn btn-sm btn-accent pull-right\" ng-click=\"login()\">Sign In</button>' +\n            '    <a class=\"btn btn-sm btn-default\" href=\"{{::idpUrl}}/registeruser.html\">Register</a>' +\n            '  </div>',\n            '</div>'\n          ].join(' '),\n          controller: function($scope, $element) {\n\n            $scope.idpUrl = Config.idmUrl;\n\n            AuthenticationService.getUser(function(user) {\n              $timeout(function() {\n                $scope.user = user;\n              }, 100);\n            });\n\n            $scope.login = function() {\n              $scope.user = AuthenticationService.login();\n            };\n\n            $scope.logout = function() {\n              $scope.user = AuthenticationService.logout();\n            };\n\n          }\n        };\n      }\n    ])\n\n  ;\n\n})(angular);\n","(function() {\n\n    \"use strict\";\n\n    if(typeof(Array.prototype.find) === 'undefined') {\n        Array.prototype.find = function(callback) {\n            for(var i=0; i<this.length; ++i) {\n                if(callback(this[i], i, this))\n                    return this[i];\n            }\n            return null;\n        };\n    }\n    if(typeof(Array.prototype.filter) === 'undefined') {\n        Array.prototype.filter = function(callback) {\n            var results = [];\n            for(var i=0; i<this.length; ++i) {\n                if(callback(this[i], i, this))\n                    results.push(this[i]);\n            }\n            return results;\n        };\n    }\n    if(typeof(Array.prototype.each) === 'undefined') {\n        Array.prototype.each = function(callback) {\n            for(var i=0; i<this.length; ++i) {\n                callback(this[i], i, this);\n            }\n        };\n    }\n    if(typeof(String.prototype.startsWith) === 'undefined') {\n        String.prototype.startsWith = function(value) {\n            var str = this;\n            if(!str.length)     return false;\n            if(!value.length)   return false;\n            if(str.length < value.length) return false;\n            return str.indexOf(value) === 0;\n        };\n    }\n    if(typeof(String.prototype.endsWith) === 'undefined') {\n        String.prototype.endsWith = function(value) {\n            var str = this;\n            if(!str.length)     return false;\n            if(!value.length)   return false;\n            if(str.length < value.length) return false;\n            var substr = str.substring(\n                str.length - value.length,\n                str.length\n            );\n            return substr == value;\n        };\n    }\n\n\n\n\n    if(typeof(Date.prototype.plus) === 'undefined') {\n        Date.prototype.plus = function(offset) {\n            \n            var type = typeof(offset);\n            if(type === 'undefined') return this;\n\n            var offsetMS = 0;\n            if(type === 'string') {\n                switch(offset) {\n                    case 'hour':    offsetMS = 1000*60*60; break;\n                    case 'day':     offsetMS = 1000*60*60*24; break;\n                    case 'week':    offsetMS = 1000*60*60*24*7; break;\n                    case 'month':   offsetMS = 1000*60*60*24*31; break;\n                    case 'year':    offsetMS = 1000*60*60*24*365; break;\n                }\n            } else if(type === 'number') {\n                offsetMS = offset;\n            } else return this;\n\n            var d = this;\n            return new Date(d.getTime() + offsetMS);\n        };\n    }\n\n    if(typeof(Date.prototype.random) === 'undefined') {\n        Date.prototype.random = function(threshold) {\n\n            var type = typeof(threshold);\n            if(type === 'undefined') return this;\n\n            var offsetMS = 0;\n            if(type === 'string') {\n                switch(threshold) {\n                    case 'hour':    offsetMS = 1000*60*60; break;\n                    case 'day':     offsetMS = 1000*60*60*24; break;\n                    case 'week':    offsetMS = 1000*60*60*24*7; break;\n                    case 'month':   offsetMS = 1000*60*60*24*31; break;\n                    case 'year':    offsetMS = 1000*60*60*24*365; break;\n                }\n            } else if(type === 'number') {\n                offsetMS = threshold;\n            } else return this;\n\n            var d = this;\n            return new Date(d.getTime() + Math.floor(Math.random()*offsetMS));\n        };\n    }\n\n})();","(function(jQuery, angular) {\n    \n    'use strict';\n\n    angular.module('gp-common').directive('gpDatePicker', ['$timeout', function($timeout) {\n\n        return {\n            scope: {\n                label: '@',\n                format: '@',\n                date: '=',\n                onChange: '&?'\n            },\n            template: [\n                '<div class=\"input-group-slick\">',\n                '    <input type=\"text\" class=\"form-control\" placeholder=\"{{::label}}\"',\n                '        datepicker-popup=\"{{format}}\" ng-model=\"date\" is-open=\"opened\" />',\n                '    <span class=\"glyphicon glyphicon-calendar\" ng-click=\"toggle($event)\"></span>',\n                '</div>',\n                '<p class=\"help-block\"><small><em>Ex: \"2015-01-31\" or \"Jan 31 2015\"</em></small></p>'\n            ].join(' '),\n\n            controller: function($scope, $element, $attrs) {\n\n                //toggle date picker\n                $scope.toggle = function(event) {\n                    event.preventDefault();\n                    event.stopPropagation();\n                    this.opened = !this.opened;\n                };\n\n                if(!$scope.format)\n                    $scope.format = 'MMM dd yyyy';\n\n                var promise = null;\n\n                $scope.debounce = function() {\n                    if(promise) $timeout.cancel(promise);\n                    promise = $timeout(function() { \n                        promise = null;\n                        if($scope.onChange)\n                            $scope.onChange();\n                    }, 200);\n                };\n\n                $scope.$watch('date', function() {\n                    $scope.debounce();\n                });\n\n                var listener = $scope.$on('$destroy', function() {\n                    \n                    listener();             //deregister listener\n                    \n                    if(promise) $timeout.cancel(promise);\n                    promise = null;\n\n                    $scope.opened = false;    //close picker if open\n                    $scope.onChange = null;\n                    $scope.format = null;\n                    $scope.debounce = null;\n                });\n\n            }\n        };\n\n    }]);\n\n})(jQuery, angular);","(function(jQuery, angular) {\n    \n    \"use strict\"; \n    \n    angular.module(\"gp-common\")\n\n    /**\n     * Geolocation directive\n     */\n    .directive('gpGeolocation', ['$window',function ($window) {\n        \n        var defaultBtnLabel = \"Locate\";\n\n        return {\n            scope: {\n                label: '=?'\n            },\n            restrict: \"EA\",\n            template: [\n                '<a class=\"btn btn-primary\" ng-click=\"geolocate()\" ng-if=\"available\">',\n                '  <span class=\"glyphicon glyphicon-screenshot\" ng-if=\"!loading\"></span>',\n                '  <span class=\"glyphicon glyphicon-hourglass glyphicon-spin\" ng-if=\"loading\"></span>',\n                '  {{btnLabel}}',\n                '</a>',\n                '<div ng-if=\"error\">{{error}}</div>'\n            ].join(' '),\n            controller: function($scope) {\n\n                $scope.btnLabel = $scope.label || defaultBtnLabel;\n                $scope.loading = false;\n                $scope.available = ($window.navigator && $window.navigator.geolocation);\n\n                if(!$scope.available) \n                    $scope.error = \"Your browser does not support determining location\";\n\n                $scope.geolocate = function() {\n\n                    $scope.loading = true;\n                    $window.navigator.geolocation.getCurrentPosition(function(position){\n\n                        $scope.$apply(function() {$scope.loading = false;});\n                        $scope.$emit('map:geolocation', position.coords.latitude, position.coords.longitude);\n\n                    }, function(error) {\n                        switch (error.code) {\n                          case 1:\n                            $scope.error = \"Permission was denied while attempting to determine location\";\n                            break;\n                          case 2:\n                            $scope.error = \"Unable to determine your location\";\n                            break;\n                          case 3:\n                            $scope.error = \"Unable to determine location in a reasonable amount of time\";\n                            break;\n                        }\n                    });\n                }; \n            }\n        };\n\n    }])\n\n    ;\n\n})(jQuery, angular);","(function(jQuery, angular) {\n    \n    \"use strict\"; \n    \n    angular.module(\"gp-common\")\n\n\n    /**\n     * Header directive for GeoPlatform Angular-based web applications\n     * \n     * Uses transclusion to inject links into the nav-menu which floats to the right.\n     * The menu already provides a \"Home\" link (to app home) and Sign In/User Info button.\n     * The home link is not enabled by default but can be shown using 'show-home-link=\"true\"' \n     * parameter on the directive.\n     *\n     * Note: any links transcluded should reference '$parent.user' to access authenticated user info\n     * \n     * ex:\n     * \n     *   <div gp-header brand=\"Map Manager\" show-home-link=\"true\" class=\"navbar-fixed-top\">\n     *     <li><a href=\"#/maps\">Maps</a></li>\n     *     <li><a href=\"#/galleries\">Galleries</a></li>\n     *     <li><a ng-if=\"$parent.user!==null\" href=\"#/agol\">AGOL</a></li>\n     *     <li><a href=\"#/help\">Help</a></li>\n     *   </div>\n     */\n    .directive('gpHeader', ['GPConfig', 'AuthenticationService', function(Config, AuthenticationService) {\n\n        return {\n\n            scope: {\n                brand: \"@\",\n                showHomeLink: \"@\"\n            },\n            restrict: \"AE\",\n            transclude: true,\n            replace: true,\n            template: [\n                '<header>',\n                '  <div class=\"container-fluid\">',\n                '    <div class=\"row\">',\n                '      <div class=\"col-md-12\">',\n                '        <ul role=\"menu\" class=\"header__menu\" gp-header-menu>',\n                '          <li ng-if=\"showHomeLink\">',\n                '            <a href=\"#/goHome\">',\n                '                <span class=\"glyphicon glyphicon-home\"></span> ',\n                '                <span class=\"hidden-xs hidden-sm\">Home</span>',\n                '            </a>',\n                '          </li>',\n                '          <div class=\"transcluded\"></div>',\n                '          <li><span gp-login-button></span></li>',\n                '        </ul>',\n                '        <h4 class=\"brand\">',\n                '          <a href=\"{{portalUrl}}\" title=\"Go to the GeoPlatform Home Page\">',\n                '            <span class=\"icon-gp\"></span>',\n                '            <span class=\"hidden-xs\">GeoPlatform</span>',\n                '          </a>',\n                '          {{brand}}',\n                '        </h4>',\n                '      </div>',\n                '    </div>',\n                '  </div>',\n                '</header>'\n            ].join(' '),\n\n            // controller: function($rootScope, $scope, $element) {\n            //     $scope.portalUrl = $rootScope.portalUrl;\n            // }, \n\n            link: function($scope, $element, $attrs, ctrl, transcludeFn) {\n\n                $scope.showHomeLink = $scope.showHomeLink === 'true' || false;\n\n                $scope.portalUrl = Config.portalUrl;\n\n                AuthenticationService.getUserQ().then(function(user) {\n                    $scope.user = user;    \n                });\n                \n                $element.find('.transcluded').replaceWith(transcludeFn());\n            }            \n\n        };\n\n    }])\n\n\n    \n    /**\n     * Header Menu\n     *\n     * Monitors the current page URL and updates the header links \n     * to highlight whichever one is associated with the current page\n     *\n     * Usage: \n     *\n     *  <ul role=\"menu\" class=\"header__menu\" gp-header-menu>\n     *      <li><a href=\"#/maps\">Maps</a></li>\n     *      <li><a href=\"#/galleries\">Galleries</a></li>\n     *      ...\n     *  </ul>\n     *\n     */\n    .directive('gpHeaderMenu', ['$location', function($location) {\n\n        //default href for \"home\" link in header__menu\n        //uses 'goHome' to avoid angular-route issues with empty hash not \n        // triggering a page reload. Relies upon the \"otherwise\" condition\n        // being configured inside a routeProvider within the application.\n        var homeLink = 'goHome';\n\n        function update($element) {\n\n            var path = $location.path();\n            \n            if(path === '/' || path === '/#' || path === '/#/')\n                path = homeLink;\n\n            if(path[0] === '/') \n                path = path.substring(1);\n\n            var menu = $element;\n            menu.find('li.active').removeClass('active');\n            \n            var link = menu.find('li > a[href=\"#/' + path + '\"]');\n            if(link.length) {\n                //check if link is within a dropdown in the header menu\n                var dd = link.closest('.dropdown-menu');\n                if(dd.length) {\n                    //find next ancestor that is a list element and mark it active\n                    dd.closest('li').addClass('active');\n                } else {\n                    //not in a dropdown, mark this link active\n                    link.parent().addClass('active');\n                }\n            }\n            \n            menu.find('li > a').each(function(i,a) {\n                var $a = $(a), href = $a.attr('href');\n                if(!href) return;\n                href = href.replace('#/', '');\n                if(path.indexOf(href) === 0)\n                    $a.parent().addClass('active');\n            });\n        }\n\n        return {\n            scope: {\n                homeHref: '@'\n            },\n            restrict: \"A\",\n            \n            controller: function($rootScope, $scope, $element) {\n                if($scope.homeHref)\n                    homeLink = $scope.homeHref;\n            },\n\n            link: function($scope, $element) {\n\n                update($element);\n\n                $scope.$root.$on('$locationChangeSuccess', function() {\n                    update($element);\n                });\n\n            }\n        };\n    }]);\n\n})(jQuery, angular);\n","(function(angular) {\n\n\n    \"use strict\";\n\n    angular.module('gp-common').directive('iframeOnload', function(){\n        return {\n            scope: {\n                callback: '&iframeOnload'\n            },\n            link: function(scope, element, attrs){\n                element.on('load', function(event){\n                    element.off('load');\n                    return scope.callback(event);\n                });\n            }\n        };\n    });\n\n}) (angular);","(function(angular) {\n    \n    \"use strict\";\n\n    angular.module(\"gp-common\").directive('onImgFail', function() {\n        return {\n            scope: {\n                onImgFail: '@'\n            },\n            link: function($scope, $element) {\n                var jqEl = jQuery($element);\n                jqEl.on('error', function() {\n                    jqEl.attr('src', $scope.onImgFail);\n                });\n            }\n        };\n    });\n\n}) (angular);","(function(angular) {\n    \n    \"use strict\";\n\n\n    angular.module('gp-common')\n\n\n    //\n    .service('NotificationService', ['$rootScope', function($rootScope) {\n        var Service = function() {\n            this.items = [];\n        };\n        Service.prototype = {\n            getItems: function() { return this.items; },\n            /**\n             * @param item object\n             * @return function to cancel the notification\n             */\n            addItem: function(item) { \n                this.items.push(item); \n                $rootScope.$broadcast('gp:notifications:new', item);\n\n                var fn = function(item) { this.removeItem(item); };\n                return fn.bind(this, item);\n            },\n            removeItem: function(item) {\n                var index = this.items.indexOf(item);\n                if(index >= 0)\n                    return this.items.splice(index, 1);\n                return null;\n            },\n            error: function(label, msg, dismiss) { \n                return this.addItem({ type: 'error', label: label, message: msg, canDismiss: dismiss });\n            },\n            success: function(label, msg, dismiss) { \n                return this.addItem({ type: 'success', label: label, message: msg, canDismiss: dismiss });\n            },\n            info: function(label, msg, dismiss) { \n                return this.addItem({ type: 'info', label: label, message: msg, canDismiss: dismiss });\n            }\n        };\n        return new Service();\n    }])\n\n\n    // Usage: <gp-notifications />\n    .directive('gpNotifications', ['$timeout', 'NotificationService', function($timeout, NotificationService) {\n        return {\n            scope: {\n                expiration: '@'\n            },\n            template: [\n                '<div class=\"notifications ng-hide\" ng-show=\"items.length\">',\n                '  <div class=\"notification\" ng-repeat=\"item in items\"',\n                '    ng-class=\"{\\'notification--success\\':item.type===\\'success\\', \\'notification--error\\':item.type===\\'error\\', \\'notification--info\\':item.type===\\'info\\'}\">',\n                '    <h5 class=\"notification__title\">',\n                '        <span class=\"pull-right glyphicon\" ',\n                '            ng-class=\"{\\'glyphicon-ok-sign\\':item.type===\\'success\\',\\'glyphicon-exclamation-sign\\':item.type===\\'error\\',\\'glyphicon-info-sign\\':item.type===\\'info\\'}\">',\n                '        </span>',\n                '        {{item.label}}',\n                '    </h5>',\n                '    <p class=\"notification__content\" ng-bind-html=\"item.message\"></p>',\n                '    <div class=\"notification__actions\" ng-if=\"item.canDismiss\">',\n                '        <button type=\"button\" class=\"btn btn-link\" ng-click=\"dismiss(item)\">dismiss</button>',\n                '    </div>',\n                '  </div>',\n                '</div>'\n            ].join(' '),\n\n            link: function($scope, $element, $attrs) {\n\n                $scope.expiration = ($scope.expiration || 2000)*1;\n\n                $scope.items = [];\n\n\n                function update() {\n                    $scope.items = NotificationService.getItems();\n\n                    //if updated before timer expired, reset timer\n                    if($scope.timer) {\n                        $timeout.cancel($scope.timer);\n                        $scope.timer = null;\n                    }\n\n                    //set timer to kill earliest item after time\n                    $scope.timer = $timeout(function() {\n                        $scope.timer = null;\n                        //will ultimately call update() and thus trigger timeout again\n                        $scope.removeOldest();\n                    }, $scope.expiration);\n                }\n                update();\n\n                $scope.removeOldest = function() {\n                    //find oldest that can be removed\n                    var oldest = $scope.items.find(function(item) {return item.canDismiss;});\n                    if(oldest)\n                        NotificationService.removeItem(oldest);\n                };\n\n                $scope.dismiss = function(item) {\n                    //remove item using service\n                    NotificationService.removeItem(item);\n                };\n\n                $scope.$watchCollection(function() {\n                    return NotificationService.getItems();\n                }, update);\n\n                // $scope.$on('gp:notifications:new', function(event, item) { update(); });\n\n            }\n        };\n    }]);\n\n\n})(angular);","(function(jQuery, angular) {\n    \n    \"use strict\";\n\n    angular.module('gp-common').directive('gpPagination', function() {\n\n\n        function Controller($scope, $element) {\n\n            if(!$scope.pageSizeOpts) {\n                $scope.pageSizeOpts = [5, 10, 25, 50];\n            }\n            if($scope.pageSize && $scope.pageSizeOpts.indexOf($scope.pageSize*1)<0) {\n                $scope.pageSizeOpts.push($scope.pageSize*1).sort();\n            }\n\n            $scope.previous = function() { \n                $scope.start = Math.max(0, $scope.start*1 - $scope.pageSize*1);\n                $scope.$emit('pagination:change', $scope.start, $scope.pageSize);\n            };\n\n            $scope.next = function() {\n                $scope.start = Math.min($scope.total, $scope.start*1 + $scope.pageSize*1);\n                $scope.$emit('pagination:change', $scope.start, $scope.pageSize);\n            };\n\n            $scope.setPage = function(arg) {\n                var page = arg*1;\n                $scope.start = (page-1) * ($scope.pageSize*1);\n                $scope.$emit('pagination:change', $scope.start, $scope.pageSize);\n            };\n\n            $scope.setPageSize = function(size) {\n\n                $scope.pageSize = size*1;\n                //move start cursor to beginning of new current page based on updated pagesize\n                var currentPage = Math.floor($scope.start / $scope.pageSize) + 1;\n                $scope.setPage(currentPage);\n            };\n\n            $scope.hasPrevious = function() {\n                return $scope.start > 0;\n            };\n\n            $scope.hasNext = function() {\n                return ($scope.start+$scope.pageSize) < $scope.total;\n            };\n\n\n            function update() {\n            \n                var ostart = $scope.start*1;\n                var osize = $scope.pageSize*1;\n                \n                //calculate # of pages needed\n                var pages = [];\n                var maxPagination = 5;\n                var maxPaginationMidPoint = ((maxPagination % 2) !== 0) ? Math.ceil(maxPagination / 2) : maxPagination / 2;\n\n                if($scope.total > 0) {\n                    \n                    var numPages = Math.ceil($scope.total / osize);\n                    var currentPage = Math.floor(ostart / osize);\n\n                    var s = 0;\n                    if(currentPage > Math.floor(maxPagination/2)) {     //  1 2 '3' 4 5\n                        s = currentPage-Math.floor(maxPagination/2);    //  1 2 3 '4' 5\n                                                                        //  ...\n\n                    } else {                                            //  '1' 2 3 4 5\n                        s = 0;                                          //  1 '2' 3 4 5\n                                                                        //  ...\n                    }\n\n                    var e = Math.min(s+maxPagination, numPages);\n\n                    //ensure at least <maxPagination> # of page links are shown\n                    // even if near the end of the results\n                    while(s>0 && ((e-s) < maxPagination))\n                        s-=1;\n\n                    for(var i=s; i<e; ++i) {\n                        var pageStart = (i*osize)+1;\n                        var pageEnd = Math.min(pageStart + osize - 1, $scope.total);\n                        pages.push({\n                            label: (i+1)+\"\",\n                            tooltip: \"Results \" + pageStart + \"-\" + pageEnd\n                        });\n                        if(i == currentPage)\n                            pages[pages.length-1].active = true;\n                    }\n\n                }\n\n                $scope.pages = pages;\n\n            }\n\n            update();\n\n            $scope.$watch('start',      update);\n            $scope.$watch('pageSize',   update);\n            $scope.$watch('total',      update);\n\n        }\n\n\n\n        return {\n\n            scope: {\n                start: '=',\n                pageSize: '=',\n                total: '=',\n                pageSizeOpts: '='\n            },\n            replace: true,\n            template: [\n                '<div>',\n                '  <div class=\"visible-xs row\">',\n                '    <div class=\"col-xs-6\">{{total}} results</div>',\n                '    <div class=\"col-xs-6\">',\n                '      <select class=\"form-control\" ng-model=\"pageSize\">',\n                '        <option ng-repeat=\"ps in pageSizeOpts\" ',\n                '          ng-selected=\"pageSize===ps\" ',\n                '          value=\"{{ps}}\">{{ps}} per page</option>',\n                '      </select>',\n                '    </div>',\n                '  </div>',\n                '  <ul class=\"pagination\">',\n                '    <li class=\"info hidden-xs\">',\n                '      <a>{{total}} results</a>',\n                '    </li>',\n                '    <li class=\"pagination-control hidden-xs\" ng-if=\"total>0\">',\n                '      <span uib-dropdown>',\n                '        <a href=\"\" uib-dropdown-toggle title=\"Change the number of results returned\">',\n                '          {{pageSize}} per page <span class=\"caret\"></span>',\n                '        </a>',\n                '        <ul class=\"dropdown-menu\" role=\"menu\">',\n                '          <li ng-repeat=\"ps in pageSizeOpts\"><a ng-click=\"setPageSize(ps)\">{{ps}} per page</a></li>',\n                '        </ul>',\n                '      </span>',\n                '    </li>',\n                '    <li class=\"separator hidden-xs\"></li>',\n                '    <li ng-if=\"hasPrevious()\">',\n                '      <a ng-click=\"previous()\">',\n                '        <span class=\"glyphicon glyphicon-backward\"></span>',\n                '      </a>',\n                '    </li>',\n                '    <li ng-repeat=\"page in pages\" ng-class=\"{active:page.active,disabled:page.disabled}\">',\n                '      <a ng-click=\"setPage(page.label)\" title=\"{{::page.tooltip}}\">{{::page.label}}</a>',\n                '    </li>',\n                '    <li ng-if=\"hasNext()\">',\n                '      <a ng-click=\"next()\">',\n                '        <span class=\"glyphicon glyphicon-forward\"></span>',\n                '      </a>',\n                '    </li>',\n                '  </ul>',\n                '</div>'\n            ].join(' '),\n\n            controller: Controller\n\n        };\n\n    });\n\n\n})(jQuery, angular);","(function(jQuery, angular) {\n    \n    \"use strict\"; \n    \n    angular.module(\"gp-common\", [])\n\n    //Assumes a global object containing configuration values for GeoPlatform exists \n    // prior to this module being declared\n    // (using 'value' since config might change)\n    .value('GPConfig', GeoPlatform)\n    ;\n\n})(jQuery, angular);\n\n(function(angular) {\n\n  'use strict';\n\n  //flag on whether we're in dev env\n  // function isDEV() {\n  //     return \"localhost\" === window.location.hostname ||\n  //         ~window.location.hostname.indexOf(\"192.168\")||\n  //         ~window.location.hostname.indexOf(\"localhost\")||\n  //         ~window.location.hostname.indexOf(\"10.0\");\n  // }\n\n  /**\n   * Get token from query string\n   * \n   * Note:\n   *  Lifted outside of any Angular service to prevent cyclical service dependencies.\n   * \n   * @method getJWTFromUrl\n   * @returns {String} token - token in query string or undefined\n   */\n  function getJWTFromUrl() {\n    var queryString = window.location.hash ? window.location.hash : window.location.href;\n    var res = queryString.match(/access_token=([^\\&]*)/);\n    return res && res[1];\n  };\n\n  /**\n   * GeoPlatform Common Module Authentication Support\n   *\n   * Contains re-usable services, directives, and other angular components\n   *\n   *\n   * NOTE: This module uses certain variables in $rootScope in order to\n   * perform actions like authentication.  The following variables should be\n   * set before using any service/directive in this file:\n   *\n   *   - idspUrl : the url to the identity service provider server\n   *   - idmUrl : the url to the identity management server\n   *   - portalUrl : the url to the main landing page of GeoPlatform (www.geoplatform.gov in production)\n   */\n  angular.module('gp-common')\n\n\n    /**\n     * Authentication Service\n     *\n     * Because the auth service redirects the page to the IDM portal\n     * and WMV is reloaded once the login/logout processes are complete,\n     * there's no need to bind listeners informing other components of\n     * an auth change.\n     *\n     * Inside \"DEV\", you should close and re-open any components' widgets\n     * to get current auth status.\n     */\n    .service('AuthenticationService', ['$q', '$http', '$location', '$rootScope', '$window', 'GPConfig',\n      function($q, $http, $location, $rootScope, $window, Config) {\n\n        //extend Storage prototype\n        Storage.prototype.setObject = function(key, value) {\n          this.setItem(key, btoa(JSON.stringify(value)));\n        };\n\n        Storage.prototype.getObject = function(key) {\n          var value = atob(this.getItem(key));\n          return value && JSON.parse(value);\n        };\n\n        function User(opts) {\n          for (var p in opts) {\n            this[p] = opts[p];\n          }\n          if (!this.id && this.username)\n            this.id = this.username;\n\n          this.toJSON = function() {\n            return {\n              id: this.id,\n              username: this.username,\n              name: this.name,\n              email: this.email,\n              org: this.org,\n              exp: this.exp\n            };\n          };\n\n          this.clone = function() {\n            return new User(this.toJSON());\n          };\n          this.compare = function(arg) {\n            if (arg instanceof User) {\n              return this.id === arg.id;\n            } else if (typeof(arg) === 'object') {\n              return typeof(arg.id) !== 'undefined' &&\n                arg.id === this.id;\n            }\n            return false;\n          };\n        }\n\n        var _user = null;\n\n        /**\n         * Authentication Service\n         */\n        var Service = function() {\n\n          var self = this;\n\n          //$q version of getUser\n          this.getUserQ = function() {\n            return $q.when(self.getUser())\n          };\n\n          /**\n           * Redirects the page to the login site\n           */\n          this.login = function() {\n\n            //use current window\n            var current = window.location.href;\n            var redirect = (Config.CALLBACK) ? Config.CALLBACK : current;\n\n            if (Config.AUTH_TYPE !== 'grant' && Config.AUTH_TYPE !== 'token') {\n              //fail this request\n              throw new Error(\"Invalid authentication request type.  Must be 'token' or 'grant'.\");\n            }\n\n            //check auth type to set login URL: Implicit -> to IDP, Grant -> Resource Provider Login URL\n            var loginUrl = (Config.AUTH_TYPE === 'token') ? Config.IDP_BASE_URL +\n              '/auth/authorize?client_id=' + Config.APP_ID + '&response_type=' +\n              Config.AUTH_TYPE + '&redirect_uri=' + encodeURIComponent(redirect) : Config.LOGIN_URL;\n\n            window.location = loginUrl;\n\n            //This could be writen to use an modal / pop-up for login so you don't have to lose your current page\n            //Logout already executes using a background call\n          };\n\n          /**\n           * Performs background logout and requests jwt revokation\n           */\n          this.logout = function() {\n            //implicitly remove incase the idp is down and the revoke call does not work\n            _user = null;\n            self.clearLocalStorageJWT();\n\n            $http.get(Config.IDP_BASE_URL + '/auth/revoke')\n              .then(function(response) {\n                self.removeAuth();\n                //goto logout page\n                if (Config.LOGOUT_URL) {\n                  Config.FORCE_LOGIN = false;\n                  window.location = Config.LOGOUT_URL;\n                } else {\n                  window.location.hash = '';\n                  window.location = Config.PORTAL_URL || window.location.host;\n                }\n              }, function(err) {\n                console.log(err);\n              });\n          };\n\n          /**\n           * Optional force redirect for non-public services\n           */\n          this.forceLogin = function() {\n            self.login();\n          };\n\n          /**\n           * Get protected user profile\n           */\n          this.getOauthProfile = function() {\n            var Q = $q.defer();\n            //check to make sure we can make called\n            if (self.getJWTfromLocalStorage()) {\n              var url = Config.IDP_BASE_URL + '/api/profile';\n              $http.get(url)\n                .then(function(response) {\n                  //when we get it, save it so we don't have to hit the IDP so many times\n                  Q.resolve(response.data);\n                }, function(err) {\n                  console.log(err);\n                  Q.reject(err);\n                });\n            }\n            return Q.promise;\n          };\n\n          /*\n           * Set the _user property in this scope\n           */ \n          this.setUser = function(user){ _user = user }\n\n          /**\n           * Unpacks JWT to see if session is valid.\n           * \n           * Side Effects: \n           *  - Sets the _user property\n           *  - Sets the Authorize header if valid user found (this.setAuth)\n           *  - Will redirect user to login url if FORCE_LOGIN is set an no valid user is found\n           * \n           * @return {User} - the authenticated user or undefined\n           */\n          this.check = function() {\n            // Pull user from either LocalStorage or the JWT (or the URL)\n            const jwt = self.getJWT();\n\n            // Save JWT in Auhorization Header\n            if(jwt && !self.isExpired(jwt)){\n              self.setAuth(jwt); \n              const user = self.parseJwt(jwt);\n              // slightly differnet mapping ;)\n              self.setUser(new User({\n                id: user.sub,\n                username: user.username,\n                email: user.email,\n                name: user.name,\n                org: user.org,\n                exp: user.exp\n              }))\n\n              //clean hosturl on redirect from oauth\n              const current = ($window && $window.location && $window.location.hash) ? $window.location.hash : $location.url()\n              if (getJWTFromUrl()) {\n                var cleanUrl = current.replace(/access_token=([^\\&]*)/, '');\n                $window.location = cleanUrl;\n              }\n\n            // No valid userdata found\n            } else { \n              self.removeAuth(); \n              // Redirect if settings set\n              if(Config.FORCE_LOGIN === true) self.forceLogin();\n            }\n\n            // return the user\n            return _user\n          };\n\n          /**\n           * If the callback parameter is specified, this method\n           * will return undefined. Otherwise, it returns the user (or null).\n           * \n           * Side Effects: \n           *  - This property sets the _user property for the enclosing scope\n           *  - Will redirect users if no valid JWT was found\n           *\n           * @param callback optional function to invoke with the user\n           * @return object representing current user\n           */\n          this.getUser = function(callback) {\n            // better check 'em first\n            self.check(); // Sideffects will redirect browser if JWT invalid\n\n            return callback && typeof(callback) === 'function' ?\n              callback(_user) :\n              _user;\n          }\n\n          //=====================================================\n\n          /**\n           * Extract token from current URL\n           * \n           * @method getJWTFromUrl\n           * \n           * @return {String | undefined} - JWT Token (raw string)\n           */\n          this.getJWTFromUrl = function(){\n            const queryString = ($window && $window.location && $window.location.hash) ? $window.location.hash : $location.url();\n            const res = queryString.match(/access_token=([^\\&]*)/);\n            return res && res[1];\n          };\n\n          /**\n           * Load the JWT stored in local storage.\n           * \n           * @method getJWTfromLocalStorage\n           * \n           * @return {JWT | undefined} An object wih the following format:\n           */\n          this.getJWTfromLocalStorage = function(){\n            return window.localStorage.gpoauthJWT\n          };\n\n          /**\n           * Attempt and pull JWT from the following locations (in order):\n           *  - URL query parameter 'access_token' (returned from IDP)\n           *  - Browser local storage (saved from previous request)\n           * \n           * @method getJWT \n           * \n           * @return {JWT | undefined} \n           */\n          this.getJWT = function(){\n            return self.getJWTFromUrl() || self.getJWTfromLocalStorage()\n          };\n\n          /**\n           * Remove the JWT saved in local storge.\n           * \n           * @method clearLocalStorageJWT\n           * \n           * @return  {undefined}\n           */\n          this.clearLocalStorageJWT = function(){\n            delete window.localStorage.gpoauthJWT;\n          };\n\n          /**\n           * Is a token expired.\n           * \n           * @method isExpired\n           * @param {JWT} jwt - A JWT\n           * \n           * @return {boolean}\n           */\n          this.isExpired = function(jwt){\n            const exp = jwt && self.parseJwt(jwt).exp;\n            const now = (new Date()).getTime() / 1000;\n            return now > exp;\n          };\n\n          /**\n           * Unsafe (signature not checked) unpacking of JWT.\n           * \n           * @param {string} token - Access Token (JWT)\n           * \n           * @return {Object} the parsed payload in the JWT\n           */\n          this.parseJwt = function(token) {\n            var parsed;\n            if (token) {\n              var base64Url = token.split('.')[1];\n              var base64 = base64Url.replace('-', '+').replace('_', '/');\n              parsed = JSON.parse(atob(base64));\n            }\n            return parsed;\n          };\n\n          /**\n           * \n           */\n          this.validateJwt = function(token) {\n            var parsed = self.parseJwt(token);\n            var valid = (parsed && parsed.exp && parsed.exp * 1000 > Date.now()) ? true : false;\n            //TODO: chk jwt signature too\n            return valid;\n          };\n\n          this.setAuth = function(jwt) {\n            window.localStorage.gpoauthJWT = jwt;\n            $http.defaults.headers.common.Authorization = 'Bearer ' + jwt;\n            $http.defaults.useXDomain = true;\n            return;\n          };\n\n          this.removeAuth = function() {\n            _user = null;\n            delete window.localStorage.gpoauthJWT;\n            delete $http.defaults.headers.common.Authorization;\n            $http.defaults.useXDomain = false;\n            return;\n          };\n\n          //initialize with auth check\n          this.check()\n\n        };\n\n        return new Service();\n\n      }\n    ])\n\n    /**\n     * Interceptor that check for an updaed AccessToken coming from any request\n     * and will take it and set it as the token to use in future outgoing\n     * requests\n     */\n    .factory('ng-common-AuthenticationInterceptor', [\"$injector\", \"$window\", function($injector, $window){\n      // Interceptor\n      return {\n        response: function(resp) {\n          const jwt = getJWTFromUrl();\n          const authHeader = resp.headers('Authorization');\n\n          if(jwt){\n            const AuthenticationService = $injector.get('AuthenticationService')\n            AuthenticationService.setAuth(jwt);\n          } else if (authHeader) {\n            const AuthenticationService = $injector.get('AuthenticationService')\n            AuthenticationService.setAuth(authHeader.replace('Bearer ',''));\n          }\n\n          return resp;\n        }\n      };\n    }])\n\n    .config([\"$httpProvider\", function myAppConfig ($httpProvider) {\n      $httpProvider.interceptors.push('ng-common-AuthenticationInterceptor');\n    }])\n\n\n    .directive('gpLoginButton', ['$timeout', 'AuthenticationService', 'GPConfig',\n      function($timeout, AuthenticationService, Config) {\n        return {\n          scope: {\n            minimal: '@'\n          },\n          replace: true,\n          template: [\n\n            '<div class=\"btn-account btn-group\">' +\n\n            //not logged in\n            '  <a class=\"btn btn-link\" ng-click=\"login()\" ng-if=\"!user\">Sign In</a>' +\n\n            //logged in\n            '  <button type=\"button\" class=\"btn btn-link dropdown-toggle\" data-toggle=\"dropdown\" ' +\n            '   aria-expanded=\"false\" ng-if=\"user\">' +\n            '     <span class=\"glyphicon glyphicon-user\"></span> ' +\n            '     <span class=\"hidden-xs\">{{::user.name}}</span> ' +\n            '     <span class=\"caret\"></span>' +\n            '  </button>' +\n            '  <ul class=\"dropdown-menu dropdown-menu-right\" role=\"menu\" ng-if=\"user\">' +\n            '    <li class=\"account-details\">' +\n            '      <div class=\"media\">' +\n            '        <div class=\"media-left\">' +\n            '          <div class=\"media-object\">' +\n            '            <span class=\"glyphicon glyphicon-user glyphicon-xlg\"></span>' +\n            '          </div>' +\n            '        </div>' +\n            '        <div class=\"media-body\">' +\n            '          <div class=\"media-heading\">{{::user.name}}</div>' +\n            '          <div><em>{{::user.username}}</em></div>' +\n            '          <div>{{::user.email}}</div>' +\n            '          <div>{{::user.org}}</div>' +\n            '        </div>' +\n            '      </div>' +\n            '    </li>' +\n            '    <li class=\"divider\"></li>' +\n            '    <li><a href=\"{{::idpUrl}}/modifyuser.html\">Edit Info</a></li>' +\n            '    <li><a href=\"{{::idpUrl}}/changepassword.html\">Change Password</a></li>' +\n            '    <li><a href ng-click=\"logout()\">Sign Out</a></li>' +\n            '  </ul>' +\n\n\n            '</div>'\n          ].join(' '),\n          controller: [\"$scope\", \"$element\", function($scope, $element) {\n\n            if ($scope.minimal === 'true') $scope.minimal = true;\n            if ($scope.minimal !== true) $scope.minimal = false;\n\n            $scope.idpUrl = Config.idmUrl;\n            // console.log(\"IDM Base Url: \" + Config.idmUrl);\n\n            AuthenticationService.getUser(function(user) {\n              $timeout(function() {\n                $scope.user = user;\n              }, 100);\n            });\n\n            $scope.login = function() {\n              $scope.user = AuthenticationService.login();\n            };\n\n            $scope.logout = function() {\n              $scope.user = AuthenticationService.logout();\n            };\n          }]\n        };\n      }\n    ])\n\n\n\n    .directive('gpAccountDetails', ['$timeout', 'AuthenticationService', 'GPConfig',\n      function($timeout, AuthenticationService, Config) {\n\n        return {\n          scope: {},\n          replace: true,\n          template: [\n            '<div>' +\n            '  <div class=\"media\">',\n            '    <div class=\"media-left\">',\n            '        <div class=\"media-object\">',\n            '            <span class=\"glyphicon glyphicon-user glyphicon-xlg\"></span>',\n            '        </div>',\n            '    </div>',\n            '    <div class=\"media-body\" ng-if=\"user\">',\n            '       <div class=\"media-heading\">{{::user.name}}</div>' +\n            '       <div><small><em>{{::user.username}}</em></small></div>' +\n            '       <div><small>{{::user.email}}</small></div>' +\n            '       <div><small>{{::user.org}}</small></div>' +\n            '    </div>',\n            '    <div class=\"media-body\" ng-if=\"!user\">',\n            '       <div class=\"media-heading\">Please Sign In</div>' +\n            '       <div><small>Sign in to your GeoPlatform account or register a new account.</small></div>' +\n            '    </div>',\n            '  </div>',\n            '  <hr/>',\n            '  <div ng-if=\"user\">',\n            '    <button type=\"button\" class=\"btn btn-sm btn-accent pull-right\" ng-click=\"logout()\">Sign Out</button>' +\n            '    <a class=\"btn btn-sm btn-default\" href=\"{{::idpUrl}}/modifyuser.html\">Edit Details</a>' +\n            '  </div>',\n            '  <div ng-if=\"!user\">',\n            '    <button type=\"button\" class=\"btn btn-sm btn-accent pull-right\" ng-click=\"login()\">Sign In</button>' +\n            '    <a class=\"btn btn-sm btn-default\" href=\"{{::idpUrl}}/registeruser.html\">Register</a>' +\n            '  </div>',\n            '</div>'\n          ].join(' '),\n          controller: [\"$scope\", \"$element\", function($scope, $element) {\n\n            $scope.idpUrl = Config.idmUrl;\n\n            AuthenticationService.getUser(function(user) {\n              $timeout(function() {\n                $scope.user = user;\n              }, 100);\n            });\n\n            $scope.login = function() {\n              $scope.user = AuthenticationService.login();\n            };\n\n            $scope.logout = function() {\n              $scope.user = AuthenticationService.logout();\n            };\n\n          }]\n        };\n      }\n    ])\n\n  ;\n\n})(angular);\n\n(function() {\n\n    \"use strict\";\n\n    if(typeof(Array.prototype.find) === 'undefined') {\n        Array.prototype.find = function(callback) {\n            for(var i=0; i<this.length; ++i) {\n                if(callback(this[i], i, this))\n                    return this[i];\n            }\n            return null;\n        };\n    }\n    if(typeof(Array.prototype.filter) === 'undefined') {\n        Array.prototype.filter = function(callback) {\n            var results = [];\n            for(var i=0; i<this.length; ++i) {\n                if(callback(this[i], i, this))\n                    results.push(this[i]);\n            }\n            return results;\n        };\n    }\n    if(typeof(Array.prototype.each) === 'undefined') {\n        Array.prototype.each = function(callback) {\n            for(var i=0; i<this.length; ++i) {\n                callback(this[i], i, this);\n            }\n        };\n    }\n    if(typeof(String.prototype.startsWith) === 'undefined') {\n        String.prototype.startsWith = function(value) {\n            var str = this;\n            if(!str.length)     return false;\n            if(!value.length)   return false;\n            if(str.length < value.length) return false;\n            return str.indexOf(value) === 0;\n        };\n    }\n    if(typeof(String.prototype.endsWith) === 'undefined') {\n        String.prototype.endsWith = function(value) {\n            var str = this;\n            if(!str.length)     return false;\n            if(!value.length)   return false;\n            if(str.length < value.length) return false;\n            var substr = str.substring(\n                str.length - value.length,\n                str.length\n            );\n            return substr == value;\n        };\n    }\n\n\n\n\n    if(typeof(Date.prototype.plus) === 'undefined') {\n        Date.prototype.plus = function(offset) {\n            \n            var type = typeof(offset);\n            if(type === 'undefined') return this;\n\n            var offsetMS = 0;\n            if(type === 'string') {\n                switch(offset) {\n                    case 'hour':    offsetMS = 1000*60*60; break;\n                    case 'day':     offsetMS = 1000*60*60*24; break;\n                    case 'week':    offsetMS = 1000*60*60*24*7; break;\n                    case 'month':   offsetMS = 1000*60*60*24*31; break;\n                    case 'year':    offsetMS = 1000*60*60*24*365; break;\n                }\n            } else if(type === 'number') {\n                offsetMS = offset;\n            } else return this;\n\n            var d = this;\n            return new Date(d.getTime() + offsetMS);\n        };\n    }\n\n    if(typeof(Date.prototype.random) === 'undefined') {\n        Date.prototype.random = function(threshold) {\n\n            var type = typeof(threshold);\n            if(type === 'undefined') return this;\n\n            var offsetMS = 0;\n            if(type === 'string') {\n                switch(threshold) {\n                    case 'hour':    offsetMS = 1000*60*60; break;\n                    case 'day':     offsetMS = 1000*60*60*24; break;\n                    case 'week':    offsetMS = 1000*60*60*24*7; break;\n                    case 'month':   offsetMS = 1000*60*60*24*31; break;\n                    case 'year':    offsetMS = 1000*60*60*24*365; break;\n                }\n            } else if(type === 'number') {\n                offsetMS = threshold;\n            } else return this;\n\n            var d = this;\n            return new Date(d.getTime() + Math.floor(Math.random()*offsetMS));\n        };\n    }\n\n})();\n(function(jQuery, angular) {\n    \n    'use strict';\n\n    angular.module('gp-common').directive('gpDatePicker', ['$timeout', function($timeout) {\n\n        return {\n            scope: {\n                label: '@',\n                format: '@',\n                date: '=',\n                onChange: '&?'\n            },\n            template: [\n                '<div class=\"input-group-slick\">',\n                '    <input type=\"text\" class=\"form-control\" placeholder=\"{{::label}}\"',\n                '        datepicker-popup=\"{{format}}\" ng-model=\"date\" is-open=\"opened\" />',\n                '    <span class=\"glyphicon glyphicon-calendar\" ng-click=\"toggle($event)\"></span>',\n                '</div>',\n                '<p class=\"help-block\"><small><em>Ex: \"2015-01-31\" or \"Jan 31 2015\"</em></small></p>'\n            ].join(' '),\n\n            controller: [\"$scope\", \"$element\", \"$attrs\", function($scope, $element, $attrs) {\n\n                //toggle date picker\n                $scope.toggle = function(event) {\n                    event.preventDefault();\n                    event.stopPropagation();\n                    this.opened = !this.opened;\n                };\n\n                if(!$scope.format)\n                    $scope.format = 'MMM dd yyyy';\n\n                var promise = null;\n\n                $scope.debounce = function() {\n                    if(promise) $timeout.cancel(promise);\n                    promise = $timeout(function() { \n                        promise = null;\n                        if($scope.onChange)\n                            $scope.onChange();\n                    }, 200);\n                };\n\n                $scope.$watch('date', function() {\n                    $scope.debounce();\n                });\n\n                var listener = $scope.$on('$destroy', function() {\n                    \n                    listener();             //deregister listener\n                    \n                    if(promise) $timeout.cancel(promise);\n                    promise = null;\n\n                    $scope.opened = false;    //close picker if open\n                    $scope.onChange = null;\n                    $scope.format = null;\n                    $scope.debounce = null;\n                });\n\n            }]\n        };\n\n    }]);\n\n})(jQuery, angular);\n(function(jQuery, angular) {\n    \n    \"use strict\"; \n    \n    angular.module(\"gp-common\")\n\n    /**\n     * Geolocation directive\n     */\n    .directive('gpGeolocation', ['$window',function ($window) {\n        \n        var defaultBtnLabel = \"Locate\";\n\n        return {\n            scope: {\n                label: '=?'\n            },\n            restrict: \"EA\",\n            template: [\n                '<a class=\"btn btn-primary\" ng-click=\"geolocate()\" ng-if=\"available\">',\n                '  <span class=\"glyphicon glyphicon-screenshot\" ng-if=\"!loading\"></span>',\n                '  <span class=\"glyphicon glyphicon-hourglass glyphicon-spin\" ng-if=\"loading\"></span>',\n                '  {{btnLabel}}',\n                '</a>',\n                '<div ng-if=\"error\">{{error}}</div>'\n            ].join(' '),\n            controller: [\"$scope\", function($scope) {\n\n                $scope.btnLabel = $scope.label || defaultBtnLabel;\n                $scope.loading = false;\n                $scope.available = ($window.navigator && $window.navigator.geolocation);\n\n                if(!$scope.available) \n                    $scope.error = \"Your browser does not support determining location\";\n\n                $scope.geolocate = function() {\n\n                    $scope.loading = true;\n                    $window.navigator.geolocation.getCurrentPosition(function(position){\n\n                        $scope.$apply(function() {$scope.loading = false;});\n                        $scope.$emit('map:geolocation', position.coords.latitude, position.coords.longitude);\n\n                    }, function(error) {\n                        switch (error.code) {\n                          case 1:\n                            $scope.error = \"Permission was denied while attempting to determine location\";\n                            break;\n                          case 2:\n                            $scope.error = \"Unable to determine your location\";\n                            break;\n                          case 3:\n                            $scope.error = \"Unable to determine location in a reasonable amount of time\";\n                            break;\n                        }\n                    });\n                }; \n            }]\n        };\n\n    }])\n\n    ;\n\n})(jQuery, angular);\n(function(jQuery, angular) {\n    \n    \"use strict\"; \n    \n    angular.module(\"gp-common\")\n\n\n    /**\n     * Header directive for GeoPlatform Angular-based web applications\n     * \n     * Uses transclusion to inject links into the nav-menu which floats to the right.\n     * The menu already provides a \"Home\" link (to app home) and Sign In/User Info button.\n     * The home link is not enabled by default but can be shown using 'show-home-link=\"true\"' \n     * parameter on the directive.\n     *\n     * Note: any links transcluded should reference '$parent.user' to access authenticated user info\n     * \n     * ex:\n     * \n     *   <div gp-header brand=\"Map Manager\" show-home-link=\"true\" class=\"navbar-fixed-top\">\n     *     <li><a href=\"#/maps\">Maps</a></li>\n     *     <li><a href=\"#/galleries\">Galleries</a></li>\n     *     <li><a ng-if=\"$parent.user!==null\" href=\"#/agol\">AGOL</a></li>\n     *     <li><a href=\"#/help\">Help</a></li>\n     *   </div>\n     */\n    .directive('gpHeader', ['GPConfig', 'AuthenticationService', function(Config, AuthenticationService) {\n\n        return {\n\n            scope: {\n                brand: \"@\",\n                showHomeLink: \"@\"\n            },\n            restrict: \"AE\",\n            transclude: true,\n            replace: true,\n            template: [\n                '<header>',\n                '  <div class=\"container-fluid\">',\n                '    <div class=\"row\">',\n                '      <div class=\"col-md-12\">',\n                '        <ul role=\"menu\" class=\"header__menu\" gp-header-menu>',\n                '          <li ng-if=\"showHomeLink\">',\n                '            <a href=\"#/goHome\">',\n                '                <span class=\"glyphicon glyphicon-home\"></span> ',\n                '                <span class=\"hidden-xs hidden-sm\">Home</span>',\n                '            </a>',\n                '          </li>',\n                '          <div class=\"transcluded\"></div>',\n                '          <li><span gp-login-button></span></li>',\n                '        </ul>',\n                '        <h4 class=\"brand\">',\n                '          <a href=\"{{portalUrl}}\" title=\"Go to the GeoPlatform Home Page\">',\n                '            <span class=\"icon-gp\"></span>',\n                '            <span class=\"hidden-xs\">GeoPlatform</span>',\n                '          </a>',\n                '          {{brand}}',\n                '        </h4>',\n                '      </div>',\n                '    </div>',\n                '  </div>',\n                '</header>'\n            ].join(' '),\n\n            // controller: function($rootScope, $scope, $element) {\n            //     $scope.portalUrl = $rootScope.portalUrl;\n            // }, \n\n            link: function($scope, $element, $attrs, ctrl, transcludeFn) {\n\n                $scope.showHomeLink = $scope.showHomeLink === 'true' || false;\n\n                $scope.portalUrl = Config.portalUrl;\n\n                AuthenticationService.getUserQ().then(function(user) {\n                    $scope.user = user;    \n                });\n                \n                $element.find('.transcluded').replaceWith(transcludeFn());\n            }            \n\n        };\n\n    }])\n\n\n    \n    /**\n     * Header Menu\n     *\n     * Monitors the current page URL and updates the header links \n     * to highlight whichever one is associated with the current page\n     *\n     * Usage: \n     *\n     *  <ul role=\"menu\" class=\"header__menu\" gp-header-menu>\n     *      <li><a href=\"#/maps\">Maps</a></li>\n     *      <li><a href=\"#/galleries\">Galleries</a></li>\n     *      ...\n     *  </ul>\n     *\n     */\n    .directive('gpHeaderMenu', ['$location', function($location) {\n\n        //default href for \"home\" link in header__menu\n        //uses 'goHome' to avoid angular-route issues with empty hash not \n        // triggering a page reload. Relies upon the \"otherwise\" condition\n        // being configured inside a routeProvider within the application.\n        var homeLink = 'goHome';\n\n        function update($element) {\n\n            var path = $location.path();\n            \n            if(path === '/' || path === '/#' || path === '/#/')\n                path = homeLink;\n\n            if(path[0] === '/') \n                path = path.substring(1);\n\n            var menu = $element;\n            menu.find('li.active').removeClass('active');\n            \n            var link = menu.find('li > a[href=\"#/' + path + '\"]');\n            if(link.length) {\n                //check if link is within a dropdown in the header menu\n                var dd = link.closest('.dropdown-menu');\n                if(dd.length) {\n                    //find next ancestor that is a list element and mark it active\n                    dd.closest('li').addClass('active');\n                } else {\n                    //not in a dropdown, mark this link active\n                    link.parent().addClass('active');\n                }\n            }\n            \n            menu.find('li > a').each(function(i,a) {\n                var $a = $(a), href = $a.attr('href');\n                if(!href) return;\n                href = href.replace('#/', '');\n                if(path.indexOf(href) === 0)\n                    $a.parent().addClass('active');\n            });\n        }\n\n        return {\n            scope: {\n                homeHref: '@'\n            },\n            restrict: \"A\",\n            \n            controller: [\"$rootScope\", \"$scope\", \"$element\", function($rootScope, $scope, $element) {\n                if($scope.homeHref)\n                    homeLink = $scope.homeHref;\n            }],\n\n            link: function($scope, $element) {\n\n                update($element);\n\n                $scope.$root.$on('$locationChangeSuccess', function() {\n                    update($element);\n                });\n\n            }\n        };\n    }]);\n\n})(jQuery, angular);\n\n(function(angular) {\n\n\n    \"use strict\";\n\n    angular.module('gp-common').directive('iframeOnload', function(){\n        return {\n            scope: {\n                callback: '&iframeOnload'\n            },\n            link: function(scope, element, attrs){\n                element.on('load', function(event){\n                    element.off('load');\n                    return scope.callback(event);\n                });\n            }\n        };\n    });\n\n}) (angular);\n(function(angular) {\n    \n    \"use strict\";\n\n    angular.module(\"gp-common\").directive('onImgFail', function() {\n        return {\n            scope: {\n                onImgFail: '@'\n            },\n            link: function($scope, $element) {\n                var jqEl = jQuery($element);\n                jqEl.on('error', function() {\n                    jqEl.attr('src', $scope.onImgFail);\n                });\n            }\n        };\n    });\n\n}) (angular);\n(function(angular) {\n    \n    \"use strict\";\n\n\n    angular.module('gp-common')\n\n\n    //\n    .service('NotificationService', ['$rootScope', function($rootScope) {\n        var Service = function() {\n            this.items = [];\n        };\n        Service.prototype = {\n            getItems: function() { return this.items; },\n            /**\n             * @param item object\n             * @return function to cancel the notification\n             */\n            addItem: function(item) { \n                this.items.push(item); \n                $rootScope.$broadcast('gp:notifications:new', item);\n\n                var fn = function(item) { this.removeItem(item); };\n                return fn.bind(this, item);\n            },\n            removeItem: function(item) {\n                var index = this.items.indexOf(item);\n                if(index >= 0)\n                    return this.items.splice(index, 1);\n                return null;\n            },\n            error: function(label, msg, dismiss) { \n                return this.addItem({ type: 'error', label: label, message: msg, canDismiss: dismiss });\n            },\n            success: function(label, msg, dismiss) { \n                return this.addItem({ type: 'success', label: label, message: msg, canDismiss: dismiss });\n            },\n            info: function(label, msg, dismiss) { \n                return this.addItem({ type: 'info', label: label, message: msg, canDismiss: dismiss });\n            }\n        };\n        return new Service();\n    }])\n\n\n    // Usage: <gp-notifications />\n    .directive('gpNotifications', ['$timeout', 'NotificationService', function($timeout, NotificationService) {\n        return {\n            scope: {\n                expiration: '@'\n            },\n            template: [\n                '<div class=\"notifications ng-hide\" ng-show=\"items.length\">',\n                '  <div class=\"notification\" ng-repeat=\"item in items\"',\n                '    ng-class=\"{\\'notification--success\\':item.type===\\'success\\', \\'notification--error\\':item.type===\\'error\\', \\'notification--info\\':item.type===\\'info\\'}\">',\n                '    <h5 class=\"notification__title\">',\n                '        <span class=\"pull-right glyphicon\" ',\n                '            ng-class=\"{\\'glyphicon-ok-sign\\':item.type===\\'success\\',\\'glyphicon-exclamation-sign\\':item.type===\\'error\\',\\'glyphicon-info-sign\\':item.type===\\'info\\'}\">',\n                '        </span>',\n                '        {{item.label}}',\n                '    </h5>',\n                '    <p class=\"notification__content\" ng-bind-html=\"item.message\"></p>',\n                '    <div class=\"notification__actions\" ng-if=\"item.canDismiss\">',\n                '        <button type=\"button\" class=\"btn btn-link\" ng-click=\"dismiss(item)\">dismiss</button>',\n                '    </div>',\n                '  </div>',\n                '</div>'\n            ].join(' '),\n\n            link: function($scope, $element, $attrs) {\n\n                $scope.expiration = ($scope.expiration || 2000)*1;\n\n                $scope.items = [];\n\n\n                function update() {\n                    $scope.items = NotificationService.getItems();\n\n                    //if updated before timer expired, reset timer\n                    if($scope.timer) {\n                        $timeout.cancel($scope.timer);\n                        $scope.timer = null;\n                    }\n\n                    //set timer to kill earliest item after time\n                    $scope.timer = $timeout(function() {\n                        $scope.timer = null;\n                        //will ultimately call update() and thus trigger timeout again\n                        $scope.removeOldest();\n                    }, $scope.expiration);\n                }\n                update();\n\n                $scope.removeOldest = function() {\n                    //find oldest that can be removed\n                    var oldest = $scope.items.find(function(item) {return item.canDismiss;});\n                    if(oldest)\n                        NotificationService.removeItem(oldest);\n                };\n\n                $scope.dismiss = function(item) {\n                    //remove item using service\n                    NotificationService.removeItem(item);\n                };\n\n                $scope.$watchCollection(function() {\n                    return NotificationService.getItems();\n                }, update);\n\n                // $scope.$on('gp:notifications:new', function(event, item) { update(); });\n\n            }\n        };\n    }]);\n\n\n})(angular);\n(function(jQuery, angular) {\n    \n    \"use strict\";\n\n    angular.module('gp-common').directive('gpPagination', function() {\n\n\n        Controller.$inject = [\"$scope\", \"$element\"];\n        function Controller($scope, $element) {\n\n            if(!$scope.pageSizeOpts) {\n                $scope.pageSizeOpts = [5, 10, 25, 50];\n            }\n            if($scope.pageSize && $scope.pageSizeOpts.indexOf($scope.pageSize*1)<0) {\n                $scope.pageSizeOpts.push($scope.pageSize*1).sort();\n            }\n\n            $scope.previous = function() { \n                $scope.start = Math.max(0, $scope.start*1 - $scope.pageSize*1);\n                $scope.$emit('pagination:change', $scope.start, $scope.pageSize);\n            };\n\n            $scope.next = function() {\n                $scope.start = Math.min($scope.total, $scope.start*1 + $scope.pageSize*1);\n                $scope.$emit('pagination:change', $scope.start, $scope.pageSize);\n            };\n\n            $scope.setPage = function(arg) {\n                var page = arg*1;\n                $scope.start = (page-1) * ($scope.pageSize*1);\n                $scope.$emit('pagination:change', $scope.start, $scope.pageSize);\n            };\n\n            $scope.setPageSize = function(size) {\n\n                $scope.pageSize = size*1;\n                //move start cursor to beginning of new current page based on updated pagesize\n                var currentPage = Math.floor($scope.start / $scope.pageSize) + 1;\n                $scope.setPage(currentPage);\n            };\n\n            $scope.hasPrevious = function() {\n                return $scope.start > 0;\n            };\n\n            $scope.hasNext = function() {\n                return ($scope.start+$scope.pageSize) < $scope.total;\n            };\n\n\n            function update() {\n            \n                var ostart = $scope.start*1;\n                var osize = $scope.pageSize*1;\n                \n                //calculate # of pages needed\n                var pages = [];\n                var maxPagination = 5;\n                var maxPaginationMidPoint = ((maxPagination % 2) !== 0) ? Math.ceil(maxPagination / 2) : maxPagination / 2;\n\n                if($scope.total > 0) {\n                    \n                    var numPages = Math.ceil($scope.total / osize);\n                    var currentPage = Math.floor(ostart / osize);\n\n                    var s = 0;\n                    if(currentPage > Math.floor(maxPagination/2)) {     //  1 2 '3' 4 5\n                        s = currentPage-Math.floor(maxPagination/2);    //  1 2 3 '4' 5\n                                                                        //  ...\n\n                    } else {                                            //  '1' 2 3 4 5\n                        s = 0;                                          //  1 '2' 3 4 5\n                                                                        //  ...\n                    }\n\n                    var e = Math.min(s+maxPagination, numPages);\n\n                    //ensure at least <maxPagination> # of page links are shown\n                    // even if near the end of the results\n                    while(s>0 && ((e-s) < maxPagination))\n                        s-=1;\n\n                    for(var i=s; i<e; ++i) {\n                        var pageStart = (i*osize)+1;\n                        var pageEnd = Math.min(pageStart + osize - 1, $scope.total);\n                        pages.push({\n                            label: (i+1)+\"\",\n                            tooltip: \"Results \" + pageStart + \"-\" + pageEnd\n                        });\n                        if(i == currentPage)\n                            pages[pages.length-1].active = true;\n                    }\n\n                }\n\n                $scope.pages = pages;\n\n            }\n\n            update();\n\n            $scope.$watch('start',      update);\n            $scope.$watch('pageSize',   update);\n            $scope.$watch('total',      update);\n\n        }\n\n\n\n        return {\n\n            scope: {\n                start: '=',\n                pageSize: '=',\n                total: '=',\n                pageSizeOpts: '='\n            },\n            replace: true,\n            template: [\n                '<div>',\n                '  <div class=\"visible-xs row\">',\n                '    <div class=\"col-xs-6\">{{total}} results</div>',\n                '    <div class=\"col-xs-6\">',\n                '      <select class=\"form-control\" ng-model=\"pageSize\">',\n                '        <option ng-repeat=\"ps in pageSizeOpts\" ',\n                '          ng-selected=\"pageSize===ps\" ',\n                '          value=\"{{ps}}\">{{ps}} per page</option>',\n                '      </select>',\n                '    </div>',\n                '  </div>',\n                '  <ul class=\"pagination\">',\n                '    <li class=\"info hidden-xs\">',\n                '      <a>{{total}} results</a>',\n                '    </li>',\n                '    <li class=\"pagination-control hidden-xs\" ng-if=\"total>0\">',\n                '      <span uib-dropdown>',\n                '        <a href=\"\" uib-dropdown-toggle title=\"Change the number of results returned\">',\n                '          {{pageSize}} per page <span class=\"caret\"></span>',\n                '        </a>',\n                '        <ul class=\"dropdown-menu\" role=\"menu\">',\n                '          <li ng-repeat=\"ps in pageSizeOpts\"><a ng-click=\"setPageSize(ps)\">{{ps}} per page</a></li>',\n                '        </ul>',\n                '      </span>',\n                '    </li>',\n                '    <li class=\"separator hidden-xs\"></li>',\n                '    <li ng-if=\"hasPrevious()\">',\n                '      <a ng-click=\"previous()\">',\n                '        <span class=\"glyphicon glyphicon-backward\"></span>',\n                '      </a>',\n                '    </li>',\n                '    <li ng-repeat=\"page in pages\" ng-class=\"{active:page.active,disabled:page.disabled}\">',\n                '      <a ng-click=\"setPage(page.label)\" title=\"{{::page.tooltip}}\">{{::page.label}}</a>',\n                '    </li>',\n                '    <li ng-if=\"hasNext()\">',\n                '      <a ng-click=\"next()\">',\n                '        <span class=\"glyphicon glyphicon-forward\"></span>',\n                '      </a>',\n                '    </li>',\n                '  </ul>',\n                '</div>'\n            ].join(' '),\n\n            controller: Controller\n\n        };\n\n    });\n\n\n})(jQuery, angular);\n(function(jQuery, angular) {\n\n    \"use strict\";\n\n\n    angular.module('gp-common')\n\n\n    //helper to determine size of window for responsive breakpoint purposes\n    .provider('responsiveHelper', [\"$windowProvider\", function ($windowProvider) {\n        \n        var $window  = $windowProvider.$get();\n\n        function Helper($window) {\n            this.window = $window;\n        }\n        Helper.prototype = {\n            getWidth: function() { return $window.innerWidth || $window.outerWidth; },\n            isXS: function () { var width = this.getWidth(); return width < 768; },\n            isSM: function () { var width = this.getWidth(); return width >= 768 && width < 992; },\n            isMD: function () { var width = this.getWidth(); return width >= 992 && width < 1200; },\n            isLG: function () { var width = this.getWidth(); return width >= 1200; }\n        };\n\n        var helper = new Helper($window);\n\n        this.$get = function() {\n            return helper;\n        };\n    }])\n\n\n    //directive which appends appropriate responsive breakpoint classNames to the element\n    // on which it's set\n    .directive('gpResponsive', ['$window', 'responsiveHelper', function($window, responsiveHelper) {\n\n        return {\n            restrict: \"A\",\n            link: function($scope, $element, $attrs) {\n\n                function update(el, helper) {\n                    if(helper.isXS())\n                        el.addClass('gp-responsive-xs');\n                    else\n                        el.removeClass('gp-responsive-xs');\n\n                    if(helper.isSM())\n                        el.addClass('gp-responsive-sm');\n                    else \n                        el.removeClass('gp-responsive-sm');\n\n                    if(helper.isMD())\n                        el.addClass('gp-responsive-md');\n                    else \n                        el.removeClass('gp-responsive-md');\n\n                    if(helper.isLG())\n                        el.addClass('gp-responsive-lg');\n                    else \n                        el.removeClass('gp-responsive-lg');\n                }\n\n                update($element, responsiveHelper);\n\n                var resizeFn = function() {\n                    update($element, responsiveHelper);\n                };\n\n                var w = angular.element($window);\n                var listener = w.on('resize', resizeFn);\n\n                $scope.$on('$destroy', function() {\n                    w.off('resize', resizeFn);\n                });\n\n            }\n        };\n\n    }])\n\n\n    .directive('gpResize', [\"$window\", \"$timeout\", function($window, $timeout) {\n        return function($scope, $element, $attr) {\n\n            var resizeFn = function() {\n                var hh = jQuery('header')[0].offsetHeight;\n                // var fh = jQuery('footer')[0].offsetHeight;\n                // console.log('hh & fh', hh, fh);                    \n\n                var tp = hh + 2;\n                // var bt = fh + 2;\n                // console.log('tp & bt', tp, bt);                \n                \n                var changes = {\n                    // bottom: bt + 'px',\n                    top: tp + 'px',\n                };\n                $element.css(changes);\n                $scope.$apply();\n            };\n\n            var w = angular.element($window);\n            w.on('resize', resizeFn);\n\n            $timeout(resizeFn, 200);\n\n            $scope.$on('$destroy', function() {\n                w.off('resize', resizeFn);\n            });\n\n        };\n    }]);\n\n})(jQuery, angular);\n(function(jQuery, angular) {\n    \n    \"use strict\";\n\n\n\n    function inputLinkFunction($scope, $element, $attrs, ngModelController, $timeout) {\n\n        if(!$scope.type) $scope.type = \"text\";\n        if($scope.required === 'true')\n            $scope.required = true;\n        else $scope.required = false;\n\n        $scope.elId = 'input_' + Math.ceil(Math.random()*9999);\n        $scope.size = $scope.size || 'medium';\n        $scope.type = $scope.type || 'text';\n\n\n\n        //listen for changes to the inner value by way of the form-control\n        $element.find('.form-control').on('change', function onChange() { \n            validate($scope.innerValue); \n        });\n        \n        \n\n        /* ------------- private methods --------------- */\n\n        function validate() {\n\n            //check form-control for ng-invalid\n            var input = $element.find('.form-control');\n\n            $scope.isDirty = input.hasClass('ng-dirty');\n\n            if(input.hasClass('ng-invalid')) {\n                if(input.hasClass(\"ng-empty\"))\n                    $scope.error = \"This field requires a value\";\n                else\n                    $scope.error = \"Invalid value provided\";\n            } else\n                $scope.error = null;\n\n        }\n\n        function update(newValue) {\n            // call $parsers pipeline then update $modelValue\n            ngModelController.$setViewValue(newValue);\n            // update the local view\n            ngModelController.$render();\n        }\n\n\n\n        // when model change, update our view (just update the div content)\n        ngModelController.$render = function() {\n                \n            var value = ngModelController.$viewValue;\n\n            //create copy of passed in model value that can be used\n            // by the controls here allowing us to cancel and \n            // commit changes at our own leisure\n            $scope.innerValue = value;\n            \n            $scope.displayValue = value || $scope.placeholder || \"No value provided\";\n\n            validate(value);\n        };\n\n\n        /* ------------- private methods --------------- */\n\n        $scope.isReadOnly = function() {\n            var t = typeof(this.readOnly);\n            if(t === 'undefined') return false;\n            if(t === 'string') return this.readOnly.toLowerCase() === 'true';\n            if(t === 'number') return this.readOnly === 1;\n            if(t === 'boolean') return this.readOnly;\n            return false;\n        };\n\n        //enter edit mode\n        $scope.edit = function() {\n            if($scope.isReadOnly()) return;\n            $scope.editing=true;\n            //auto-focus on form-control when entering edit mode\n            $timeout(function() { $element.find('.form-control').focus().select(); }, 200);\n        };\n        //leave edit mode (regardless of save() or cancel())\n        $scope.done = function() {\n            $scope.editing=false;\n            $scope.error = null;\n        };\n\n\n        $scope.save = function() {\n            //update display with new value\n            update($scope.innerValue);\n            $scope.done();\n        };\n        $scope.cancel = function() {\n            //reset inner value\n            $scope.innerValue = ngModelController.$viewValue;\n            $scope.done();\n        };\n\n\n        $scope.onKeyPress = function($event, code) {\n            // console.log(\"Pressed \" + code);\n            if((code === undefined || code === 0) && $event.which !== undefined)\n                code = $event.which;\n            if($scope.type === 'number') {\n                \n                //NOTE: Chrome does not catch Backspace onKeyPress, so it \n                // skips this handler. FF does, so we need to watch for \n                // backspace, delete, and numbers\n\n                if (code === 8  ||   //backspace\n                    code === 46 ||  //delete  \n                    (code >= 44 && code <= 57))    //comma, hyphen, period and numbers (0-9)\n                    return;\n                \n                //NOTE: keyPress period is 46. keyDown it is 190\n\n                $event.preventDefault();\n                return false;               //ignore key\n            }\n        };\n        $scope.onKeyUp = function($event, code) {\n            // console.log(\"Up \" + code);\n            if((code === undefined || code === 0) && $event.which !== undefined)\n                code = $event.which;\n            if(code === 13 && !$scope.error) $scope.done();  //enter\n            else if(code === 27)             $scope.cancel();//esc\n            else {\n            \n                if(code !== 8 &&                //backspace\n                    code !== 46 &&              //delete\n                    code !== 190 &&             //period\n                    (code < 48 || code > 90) && //letters and numbers (a-z, 0-9)\n                    (code < 106 || code > 111) && \n                    (code < 186)) \n                    return;\n\n                validate();\n            }\n        };\n\n\n        $scope.$destroy = function() {\n            $element.off('change');\n        };\n    }\n\n\n\n    angular.module(\"gp-common\")\n\n    .directive('gpSlickFormInput', ['$timeout', function($timeout) {\n\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                placeholder: '@',\n                help: '=',\n                // validator: '&',\n                // validationExpr: '@',\n                type: '@',\n                pattern: \"@\",\n                required: '@',\n                readOnly: '@',\n                size: '@',\n                icon: '@'\n            },\n            template: INPUT_TEMPLATE,\n            link: function($scope, $element, $attrs, ngModelController) {\n                inputLinkFunction($scope, $element, $attrs, ngModelController, $timeout);\n            }\n        };\n\n    }])\n\n\n    .directive('gpSlickFormTextarea', ['$timeout', function($timeout) {\n\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                placeholder: '@',\n                help: \"@\",\n                readOnly: \"@\",\n                size: \"@\",\n                icon: \"@\"\n            },\n            template: TEXTAREA_TEMPLATE,\n            link: function($scope, $element, $attrs, ngModelController) {\n                inputLinkFunction($scope, $element, $attrs, ngModelController, $timeout);\n            }\n        };\n\n    }])\n\n\n    /**\n     *\n     * Notes:\n     *  - use 'form form-inline' classes for editable date so the field doesn't take up whole line\n     */\n    .directive('gpSlickFormDate', ['$timeout', '$filter', function($timeout, $filter) {\n\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                format: \"@\",\n                placeholder: '@',\n                required: \"@\",\n                readOnly: \"@\",\n                size: '@',\n                icon: '@'\n            },\n            template: DATE_TEMPLATE,\n\n            controller: [\"$scope\", \"$element\", function($scope, $element) {\n                if(!$scope.format || $scope.format.length < 3) $scope.format = \"mediumDate\";\n                $scope.inline = $element.hasClass(\"inline\");\n            }],\n\n            /**\n             *\n             */\n            link: function($scope, $element, $attrs, ngModelController) {\n\n                if($scope.required === 'true')\n                    $scope.required = true;\n                else $scope.required = false;\n                \n                $scope.elId = 'input_' + Math.ceil(Math.random()*9999);\n                $scope.size = $scope.size || 'medium';\n                $scope.type = $scope.type || 'text';\n\n\n                function validate(value) {\n                    // console.log(\"Validating '\" + value + \"'\");\n\n                    //check form-control for ng-invalid\n                    var input = $element.find('.form-control');\n                    if(input.hasClass('ng-invalid')) {\n                        if(input.hasClass(\"ng-empty\"))\n                            $scope.error = \"This field requires a value\";\n                        else\n                            $scope.error = \"Invalid value provided\";\n                    } else\n                        $scope.error = null;\n                }\n\n                function update(newValue) {\n                    // call $parsers pipeline then update $modelValue\n                    ngModelController.$setViewValue(newValue);\n                    // update the local view\n                    ngModelController.$render();\n                }\n\n\n                // when model change, update our view (just update the div content)\n                ngModelController.$render = function() {\n\n                    var value = ngModelController.$viewValue;\n\n                    //create copy of passed in model value that can be used\n                    // by the controls here allowing us to cancel and \n                    // commit changes at our own leisure\n                    $scope.innerValue = value;\n                    \n                    $scope.displayValue = value ? $filter('date')(ngModelController.$modelValue, $scope.format) :\n                        $scope.placeholder || \"No value provided\";\n\n                    validate(value);\n\n                };\n\n\n\n\n                $scope.isReadOnly = function() {\n                    var t = typeof(this.readOnly);\n                    if(t === 'undefined') return false;\n                    if(t === 'string') return this.readOnly.toLowerCase() === 'true';\n                    if(t === 'number') return this.readOnly === 1;\n                    if(t === 'boolean') return this.readOnly;\n                    return false;\n                };\n\n\n                //enter edit mode\n                $scope.edit = function() {\n                    if($scope.isReadOnly()) return;\n                    \n                    $scope.editing=true;\n                    \n                    //auto-focus on form-control when entering edit mode\n                    // $timeout(function() { $element.find('.form-control').focus().select(); }, 200);\n                };\n                //leave edit mode (regardless of save() or cancel())\n                $scope.done = function() {\n                    $scope.opened = false;\n                    $scope.editing=false;\n                    $scope.error = null;\n                };\n\n\n                $scope.save = function() {\n                    //update display with new value\n                    update($scope.innerValue);\n                    $scope.done();\n                };\n                $scope.cancel = function() {\n                    //reset inner value\n                    $scope.innerValue = angular.copy(ngModelController.$modelValue);\n                    $scope.done();\n                };\n\n\n                \n                \n\n                $scope.open = function() {\n                    //must wrap 'opened' variable in an object for \n                    // angular to properly track its value changes\n                    // from within children scope (ie, the date picker)\n                    if (typeof($scope.uibopts) === 'undefined'){\n                       $scope.uibopts = {};\n                    }\n                    $scope.uibopts.opened = true;\n                };\n\n                $scope.onKeyUp = function(code) {\n                    if(code === 13) {   //enter\n                        $scope.done();\n                    } else if(code === 27) {    //esc\n                        $scope.cancel();\n                    }\n                };\n                $scope.onChange = function(date) {\n                    if(isNaN(ngModelController.$modelValue) && $scope.required) {\n                        $scope.error = \"This field requires a value\";\n                    } else $scope.error = null;\n                };\n            }\n        };\n\n    }])\n\n\n\n    .directive('gpSlickFormSelect', ['$timeout', function($timeout) {\n\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                codeList: \"=\",\n                help: '=',\n                required: \"@\",\n                readOnly: \"@\",\n                size: '@',\n                icon: '@'\n            },\n            template: SELECT_TEMPLATE,\n            link: function($scope, $element, $attrs, ngModelController) {\n\n                if(!$scope.type) $scope.type = \"text\";\n                if($scope.required === 'true')\n                    $scope.required = true;\n                else $scope.required = false;\n\n                $scope.elId = 'input_' + Math.ceil(Math.random()*9999);\n                $scope.size = $scope.size || 'medium';\n                $scope.type = $scope.type || 'text';\n\n                var $select = null;\n\n                function getSelect() {\n                    if(!$select || !$select.length)\n                        $select = $element.find('.form-control');\n                    return $select;\n                }\n\n\n                if($scope.codeList) {\n                    $scope.selectOptions = $scope.codeList.map(function(item) {\n                        if(typeof(item) !== 'object' || !item.value)\n                            return {value: item, label: item};\n                        else if(!item.label)\n                            return {value: item.value, label: item.value};\n                        return item;\n                    });\n                } else \n                    $scope.selectOptions = [];\n\n\n\n                //listen for changes to the inner value by way of the form-control\n                // $element.find('.form-control').on('change', function onChange() { \n                //     validate($scope.innerValue); \n                // });\n                \n                \n\n                /* ------------- private methods --------------- */\n\n                function validate() {\n\n                    //check form-control for ng-invalid\n                    var select = getSelect();\n\n                    $scope.isDirty = select.hasClass('ng-dirty');\n\n                    if(select.hasClass('ng-invalid')) {\n                        if(select.hasClass(\"ng-empty\"))\n                            $scope.error = \"This field requires a value\";\n                        else\n                            $scope.error = \"Invalid value provided\";\n                    } else\n                        $scope.error = null;\n\n                }\n\n                function update(newValue) {\n                    // call $parsers pipeline then update $modelValue\n                    ngModelController.$setViewValue(newValue);\n                    // update the local view\n                    ngModelController.$render();\n                }\n\n\n\n                // when model change, update our view (just update the div content)\n                ngModelController.$render = function() {\n                        \n                    var value = ngModelController.$viewValue;\n\n                    //@see https://github.com/angular/angular.js/commit/7fda214c4f65a6a06b25cf5d5aff013a364e9cef\n\n                    //create copy of passed in model value that can be used\n                    // by the controls here allowing us to cancel and \n                    // commit changes at our own leisure\n                    $scope.innerValue = value;\n\n                    $scope.displayValue = $scope.placeholder || \"No value provided\";\n\n                    if(value) {\n                        //values are objects, not literals\n                        var opt = $scope.selectOptions.find(function(o){return o.value==value;});\n                        $scope.displayValue = opt.label;\n                    }\n                    \n                    validate();\n                };\n\n\n                /* ------------- private methods --------------- */\n\n                $scope.onChange = function(value) {\n                    \n                    // console.log(\"Changing value \" + value + \" vs \" + $scope.innerValue);\n                    $scope.innerValue = value;                \n                    $timeout(function() { validate(); }, 200);\n\n                };\n\n                $scope.onTypeaheadSelection = function($item, $model, $label, $event) {\n\n                    $scope.innerValue = $item ? $item.value : null;\n                    $timeout(function() { validate(); }, 200);\n\n                };\n\n                $scope.isReadOnly = function() {\n                    var t = typeof(this.readOnly);\n                    if(t === 'undefined') return false;\n                    if(t === 'string') return this.readOnly.toLowerCase() === 'true';\n                    if(t === 'number') return this.readOnly === 1;\n                    if(t === 'boolean') return this.readOnly;\n                    return false;\n                };\n\n                //enter edit mode\n                $scope.edit = function() {\n                    if($scope.isReadOnly()) return;\n                    $scope.editing=true;\n                    //auto-focus on form-control when entering edit mode\n                    $timeout(function() { $select.focus().select(); }, 200);\n                };\n                //leave edit mode (regardless of save() or cancel())\n                $scope.done = function() {\n                    $scope.editing=false;\n                    $scope.error = null;\n                };\n\n\n                $scope.save = function() {\n                    //update display with new value\n                    update($scope.innerValue);\n                    $scope.done();\n                };\n                $scope.cancel = function() {\n                    //reset inner value\n                    $scope.innerValue = ngModelController.$viewValue;\n                    $scope.done();\n                };\n\n                $scope.onKeyUp = function(code) {\n                    if(code === 13 && !$scope.error) {   //enter\n                        $scope.save();\n                    } else if(code === 27) {    //esc\n                        $scope.cancel();\n                    }\n                };\n\n                $scope.onTypeaheadKeyUp = function(code) {\n                    validate();\n                };\n\n\n                $scope.$destroy = function() {\n                    // $element.off('change');\n                };\n            }\n        };\n\n    }])\n\n\n\n    ;\n\n\n    var INPUT_TEMPLATE = [\n        \n        '<div class=\"form-group form-group-slick\">',\n        \n        '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>',\n        \n        '   <div class=\"input__display\" ',\n        '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error,\\'text-lg\\':size===\\'large\\'}\" ',\n        '       ng-show=\"!editing\" ng-click=\"edit()\" ',\n        '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">',\n        '      {{displayValue}}',\n        '   </div>',\n        \n        '   <div ng-show=\"editing\">',\n        '      <div class=\"input-group\" ng-class=\"{\\'input-group-lg\\':size===\\'large\\'}\">',\n        '           <div class=\"input-group-slick\" ng-class=\"{\\'input-group-slick--lg\\':size===\\'large\\'}\">',\n        \n        '               <span ng-if=\"icon\" class=\"{{::icon}}\"></span>',\n        \n        '               <input id=\"{{::elId}}\" type=\"{{::type}}\" class=\"form-control\" ',\n        '                   pattern=\"{{pattern}}\" ',\n        '                   ng-model=\"innerValue\" ',\n        '                   ng-required=\"{{required}}\" ',\n        '                   ng-keypress=\"onKeyPress($event, $event.keyCode)\" ',\n        '                   ng-keyup=\"onKeyUp($event, $event.keyCode)\" >',\n        \n        '               <span class=\"indicators\">',\n        '                   <span class=\"is-valid glyphicon glyphicon-ok-sign\"></span>',\n        '                  <span class=\"is-invalid glyphicon glyphicon-exclamation-sign\"></span>',\n        '              </span>',\n        \n        '           </div>',\n        \n        '          <span class=\"input-group-btn\">',\n        \n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '                   ng-click=\"cancel()\" title=\"Cancel changes\">',\n        '                   <span class=\"glyphicon glyphicon-ban-circle\"></span>',\n        '              </button>',\n        \n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{disabled:!!error||!isDirty,\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '                   ng-disabled=\"{{!!error}}\" ',\n        '                   ng-click=\"save()\" title=\"Save changes\">',\n        '                  <span class=\"glyphicon glyphicon-ok\"></span>',\n        '               </button>',\n        \n        '           </span>',\n        \n        '       </div>', \n\n        '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>',\n        '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>',\n        \n        '   </div>',\n        \n        '</div>'\n\n    ].join(' ');\n\n    var TEXTAREA_TEMPLATE = [\n        '<div class=\"form-group form-group-slick\">',\n        \n        '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>',\n        \n        '   <div class=\"input__display\" ',\n        '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error,\\'text-lg\\':size===\\'large\\'}\" ',\n        '       ng-show=\"!editing\" ng-click=\"edit()\" ',\n        '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">',\n        '      {{displayValue}}',\n        '   </div>',\n        \n        '   <div ng-show=\"editing\">',\n        '      <div class=\"input-group\" ng-class=\"{\\'input-group-lg\\':size===\\'large\\'}\">',\n        '           <div class=\"input-group-slick\" ng-class=\"{\\'input-group-slick--lg\\':size===\\'large\\'}\">',\n        \n        '               <span ng-if=\"icon\" class=\"{{::icon}}\"></span>',\n        \n        '               <textarea rows=\"3\" id=\"{{::elId}}\" class=\"form-control\" ',\n        '                   ng-required=\"{{required}}\" ng-model=\"innerValue\"',\n        '                   ng-keypress=\"onKeyPress($event, $event.keyCode)\" ',\n        '                   ng-keyup=\"onKeyUp($event, $event.keyCode)\"></textarea>',\n        \n        '               <span class=\"indicators\">',\n        '                   <span class=\"is-valid glyphicon glyphicon-ok-sign\"></span>',\n        '                  <span class=\"is-invalid glyphicon glyphicon-exclamation-sign\"></span>',\n        '              </span>',\n        \n        '           </div>',\n        \n        '          <span class=\"input-group-btn\">',\n        \n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '                   ng-click=\"cancel()\" title=\"Cancel changes\">',\n        '                   <span class=\"glyphicon glyphicon-ban-circle\"></span>',\n        '              </button>',\n        \n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{disabled:!!error||!isDirty,\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '                   ng-disabled=\"{{!!error}}\" ',\n        '                   ng-click=\"save()\" title=\"Save changes\">',\n        '                  <span class=\"glyphicon glyphicon-ok\"></span>',\n        '               </button>',\n        \n        '           </span>',\n        \n        '       </div>', \n\n        '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>',\n        '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>',\n        \n        '   </div>',\n        \n        '</div>'\n    ].join(' ');\n\n    var DATE_TEMPLATE = [\n\n        \n        '<div class=\"form-group form-group-slick\">',\n        \n        '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>',\n\n        '   <div class=\"input__display\" ',\n        '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error}\" ',\n        '       ng-show=\"!editing\" ng-click=\"edit()\" ',\n        '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">',\n        '      {{displayValue}}',\n        '   </div>',\n        \n        '   <div ng-show=\"editing\">',\n        '       <div uib-datepicker ng-required=\"{{required}}\" ng-model=\"innerValue\" datepicker-options=\"{showWeeks:false}\"></div>',\n        \n        '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>',\n        '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>',\n        \n        '       <button type=\"button\" class=\"btn btn-default\" ',\n        '           ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '           ng-click=\"cancel()\" title=\"Cancel changes\">',\n        '           <span class=\"glyphicon glyphicon-ban-circle\"></span>',\n        '      </button>',\n        \n        '      <button type=\"button\" class=\"btn btn-default\" ',\n        '           ng-class=\"{disabled:!!error,\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '          ng-disabled=\"{{!!error}}\" ',\n        '           ng-click=\"save()\" title=\"Save changes\">',\n        '           <span class=\"glyphicon glyphicon-ok\"></span>',\n        '      </button>',\n\n        '   </div>',\n\n        '</div>'\n\n    ].join(' ');\n\n    var SELECT_TEMPLATE = [\n        \n        '<div class=\"form-group form-group-slick\">',\n        \n        '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>',\n        \n        '   <div class=\"input__display\" ',\n        '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error}\" ',\n        '       ng-show=\"!editing\" ng-click=\"edit()\" ',\n        '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">',\n        '      {{displayValue}}',\n        '   </div>',\n        \n        '   <div ng-show=\"editing\">',\n\n        '      <div class=\"input-group\" ng-class=\"{\\'input-group-lg\\':size===\\'large\\'}\">',\n        \n        '           <div class=\"input-group-slick\" ng-class=\"{\\'input-group-slick--lg\\':size===\\'large\\'}\">',\n        \n        '               <span ng-if=\"icon\" class=\"{{::icon}}\"></span>',\n        \n        '               <select class=\"form-control input__field\" ',\n        '                   ng-if=\"codeList.length<=12\" ',\n        '                   ng-model=\"innerValue\" ',\n        '                   ng-options=\"opt.value as opt.label for opt in selectOptions\" ',\n        '                   ng-required=\"{{required}}\" ',\n        '                   ng-change=\"onChange(innerValue)\" ',\n        '                   ng-keyUp=\"onKeyUp($event.keyCode)\" >',\n        '                   <option value=\"\">Select One</option>',\n        '               </select>',\n\n        '               <input type=\"text\" class=\"form-control input__field\" ng-if=\"codeList.length>12\" ',\n        '                   ng-model=\"innerValue\" ',\n        '                   ng-required=\"{{required}}\" ',\n        '                   ng-keyUp=\"onTypeaheadKeyUp($event.keyCode)\" ',\n        '                   typeahead-on-select=\"onTypeaheadSelection($item, $model, $label, $event)\" ',\n        '                   uib-typeahead=\"opt.value as opt.label for opt in selectOptions | filter:{value:$viewValue} | limitTo:12\" ',\n        '                   typeahead-min-length=\"0\" ',\n        '                   typeahead-editable=\"false\">',\n        \n        '               <span class=\"indicators\">',\n        '                   <span class=\"is-valid glyphicon glyphicon-ok-sign\"></span>',\n        '                  <span class=\"is-invalid glyphicon glyphicon-exclamation-sign\"></span>',\n        '              </span>',\n        \n        '           </div>',\n        \n        '          <span class=\"input-group-btn\">',\n        \n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '                   ng-click=\"cancel()\" title=\"Cancel changes\">',\n        '                   <span class=\"glyphicon glyphicon-ban-circle\"></span>',\n        '              </button>',\n        \n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{disabled:!!error||!isDirty,\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '                   ng-disabled=\"{{!!error}}\" ',\n        '                   ng-click=\"save()\" title=\"Save changes\">',\n        '                  <span class=\"glyphicon glyphicon-ok\"></span>',\n        '               </button>',\n        \n        '           </span>',\n        \n        '       </div>',\n        \n        '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>',\n        '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>',\n        \n        '   </div>',\n        \n        '</div>'\n\n    ].join(' ');\n\n})(jQuery, angular);\n(function(angular) {\n    \n    \"use strict\";\n\n    angular.module(\"gp-common\").directive('gpTweetButton', ['$timeout', function($timeout) {\n        \n        function debounce(func, wait, immediate) {\n            var timeout;\n            return function() {\n                var context = this,\n                    args = arguments;\n                var later = function() {\n                    timeout = null;\n                    if (!immediate) func.apply(context, args);\n                };\n                var callNow = immediate && !timeout;\n                clearTimeout(timeout);\n                timeout = setTimeout(later, wait);\n                if (callNow) func.apply(context, args);\n            };\n        }\n\n        return {\n            link: function(scope, element, attr) {\n\n                if(typeof(twttr) === 'undefined') {\n                    element.className += ' disabled';\n                    return;\n                }\n\n                var renderTwitterButton = debounce(function() {\n                    if (attr.url) {\n                        $timeout(function() {\n                            element[0].innerHTML = '';\n                            twttr.widgets.createShareButton(\n                                attr.url,\n                                element[0],\n                                function() {}, {\n                                    count: attr.count,\n                                    text: attr.text,\n                                    via: attr.via,\n                                    size: attr.size,\n                                    hashtags: attr.hashtags,\n                                    dnt: attr.dnt\n                                }\n                            );\n                        });\n                    }\n                }, 75);\n                attr.$observe('url', renderTwitterButton);\n                attr.$observe('text', renderTwitterButton);\n            }\n        };\n    }]);\n\n}) (angular);\n(function(angular) {\n\n    \"use strict\";\n\n    angular.module(\"gp-common\").directive('sortOrder', function() {\n        return {\n            \n            replace: true,\n            require: 'ngModel',\n            \n            template: [\n                '<div>',\n                '<a class=\"btn btn-default\" title=\"Click to sort in ascending order\" href ng-if=\"value===\\'dsc\\'\" ng-click=\"toggle()\">',\n                '    <span class=\"glyphicon glyphicon-sort-by-attributes-alt\"></span>',\n                '</a>',\n                '<a class=\"btn btn-default\" title=\"Click to sort in descending order\" href ng-if=\"value===\\'asc\\'\" ng-click=\"toggle()\">',\n                '    <span class=\"glyphicon glyphicon-sort-by-attributes\"></span>',\n                '</a>',\n                '</div>'\n            ].join(' '),\n\n            link: function($scope, element, attrs, ngModel) {\n                ngModel.$viewChangeListeners.push(function() {\n                    $scope.$eval(attrs.ngChange);\n                });\n                ngModel.$render = function() {\n                    $scope.value = ngModel.$modelValue;\n                };\n                $scope.toggle = function() {\n                    $scope.value = $scope.value === 'asc' ? 'dsc' : 'asc';\n                    ngModel.$setViewValue($scope.value);\n                };\n            }\n        };\n    });\n\n})(angular);\n(function(jQuery, angular) {\n    \n    \"use strict\"; \n    \n    angular.module(\"gp-common\")\n\n    /**\n     * Custom filter to make label values visually helpful by \n     * replacing bad characters with spaces or meaningful equivalents\n     */\n    .filter('fixLabel', function() {\n        return function(input) {\n            input = input || '';\n            return input.replace(/_/g,' ');\n        };\n    })\n\n    .filter('pluralize', function() {\n        return function(text) {\n            if(!text || !text.length) return \"\";\n            if(text.endsWith('ss')) return text + 'es'; //classes, etc\n            if(text.endsWith('s')) return text;         //already plural\n            return text + 's';\n            //TODO support irregular words like \"foot\" -> \"feet\"\n            // and words that need duplicate letters: \"quiz\" -> \"quizzes\"\n        };\n    })    \n\n    .filter('capitalize', function() {\n        return function(text) {\n            return text[0].toUpperCase() + text.substring(1);\n        };\n    })\n\n\n    .filter('facets', function() {\n\n        return function(arr,facetName) {\n            if(!facetName) return arr;\n            if(!arr || !arr.length) return [];\n            return arr.filter(function(f){return f.toLowerCase().startsWith(facetName + \":\");})\n                .map(function(f) {return f.substring(f.indexOf(':')+1, f.length);});\n        };\n\n    })\n\n    .filter('joinBy', function () {\n        return function (input,delimiter,emptyValue) {\n            if(input.length) return input.join(delimiter || ', ');\n            else             return emptyValue || '';\n        };\n    })\n\n\n\n    .filter('defaultValue', function() {\n        return function(text, defVal) {\n            if(typeof(text)==='undefined' || !text.length) return defVal;\n            return text;\n        };\n    })\n\n    .filter('count', function() {\n        return function(input) {\n            if(typeof(input) !== 'undefined') {\n                if(typeof(input.push) === 'function') \n                    return input.length;\n                if(typeof(input) === 'object') {\n                    if(typeof(Object.keys) !== 'undefined') {\n                        return Object.keys(input);\n                    }\n                }\n            }\n            return 0;\n        };\n    })\n\n    ;\n\n})(jQuery, angular);","(function(jQuery, angular) {\n\n    \"use strict\";\n\n\n    angular.module('gp-common')\n\n\n    //helper to determine size of window for responsive breakpoint purposes\n    .provider('responsiveHelper', [\"$windowProvider\", function ($windowProvider) {\n        \n        var $window  = $windowProvider.$get();\n\n        function Helper($window) {\n            this.window = $window;\n        }\n        Helper.prototype = {\n            getWidth: function() { return $window.innerWidth || $window.outerWidth; },\n            isXS: function () { var width = this.getWidth(); return width < 768; },\n            isSM: function () { var width = this.getWidth(); return width >= 768 && width < 992; },\n            isMD: function () { var width = this.getWidth(); return width >= 992 && width < 1200; },\n            isLG: function () { var width = this.getWidth(); return width >= 1200; }\n        };\n\n        var helper = new Helper($window);\n\n        this.$get = function() {\n            return helper;\n        };\n    }])\n\n\n    //directive which appends appropriate responsive breakpoint classNames to the element\n    // on which it's set\n    .directive('gpResponsive', ['$window', 'responsiveHelper', function($window, responsiveHelper) {\n\n        return {\n            restrict: \"A\",\n            link: function($scope, $element, $attrs) {\n\n                function update(el, helper) {\n                    if(helper.isXS())\n                        el.addClass('gp-responsive-xs');\n                    else\n                        el.removeClass('gp-responsive-xs');\n\n                    if(helper.isSM())\n                        el.addClass('gp-responsive-sm');\n                    else \n                        el.removeClass('gp-responsive-sm');\n\n                    if(helper.isMD())\n                        el.addClass('gp-responsive-md');\n                    else \n                        el.removeClass('gp-responsive-md');\n\n                    if(helper.isLG())\n                        el.addClass('gp-responsive-lg');\n                    else \n                        el.removeClass('gp-responsive-lg');\n                }\n\n                update($element, responsiveHelper);\n\n                var resizeFn = function() {\n                    update($element, responsiveHelper);\n                };\n\n                var w = angular.element($window);\n                var listener = w.on('resize', resizeFn);\n\n                $scope.$on('$destroy', function() {\n                    w.off('resize', resizeFn);\n                });\n\n            }\n        };\n\n    }])\n\n\n    .directive('gpResize', function($window, $timeout) {\n        return function($scope, $element, $attr) {\n\n            var resizeFn = function() {\n                var hh = jQuery('header')[0].offsetHeight;\n                // var fh = jQuery('footer')[0].offsetHeight;\n                // console.log('hh & fh', hh, fh);                    \n\n                var tp = hh + 2;\n                // var bt = fh + 2;\n                // console.log('tp & bt', tp, bt);                \n                \n                var changes = {\n                    // bottom: bt + 'px',\n                    top: tp + 'px',\n                };\n                $element.css(changes);\n                $scope.$apply();\n            };\n\n            var w = angular.element($window);\n            w.on('resize', resizeFn);\n\n            $timeout(resizeFn, 200);\n\n            $scope.$on('$destroy', function() {\n                w.off('resize', resizeFn);\n            });\n\n        };\n    });\n\n})(jQuery, angular);","(function(jQuery, angular) {\n    \n    \"use strict\";\n\n\n\n    function inputLinkFunction($scope, $element, $attrs, ngModelController, $timeout) {\n\n        if(!$scope.type) $scope.type = \"text\";\n        if($scope.required === 'true')\n            $scope.required = true;\n        else $scope.required = false;\n\n        $scope.elId = 'input_' + Math.ceil(Math.random()*9999);\n        $scope.size = $scope.size || 'medium';\n        $scope.type = $scope.type || 'text';\n\n\n\n        //listen for changes to the inner value by way of the form-control\n        $element.find('.form-control').on('change', function onChange() { \n            validate($scope.innerValue); \n        });\n        \n        \n\n        /* ------------- private methods --------------- */\n\n        function validate() {\n\n            //check form-control for ng-invalid\n            var input = $element.find('.form-control');\n\n            $scope.isDirty = input.hasClass('ng-dirty');\n\n            if(input.hasClass('ng-invalid')) {\n                if(input.hasClass(\"ng-empty\"))\n                    $scope.error = \"This field requires a value\";\n                else\n                    $scope.error = \"Invalid value provided\";\n            } else\n                $scope.error = null;\n\n        }\n\n        function update(newValue) {\n            // call $parsers pipeline then update $modelValue\n            ngModelController.$setViewValue(newValue);\n            // update the local view\n            ngModelController.$render();\n        }\n\n\n\n        // when model change, update our view (just update the div content)\n        ngModelController.$render = function() {\n                \n            var value = ngModelController.$viewValue;\n\n            //create copy of passed in model value that can be used\n            // by the controls here allowing us to cancel and \n            // commit changes at our own leisure\n            $scope.innerValue = value;\n            \n            $scope.displayValue = value || $scope.placeholder || \"No value provided\";\n\n            validate(value);\n        };\n\n\n        /* ------------- private methods --------------- */\n\n        $scope.isReadOnly = function() {\n            var t = typeof(this.readOnly);\n            if(t === 'undefined') return false;\n            if(t === 'string') return this.readOnly.toLowerCase() === 'true';\n            if(t === 'number') return this.readOnly === 1;\n            if(t === 'boolean') return this.readOnly;\n            return false;\n        };\n\n        //enter edit mode\n        $scope.edit = function() {\n            if($scope.isReadOnly()) return;\n            $scope.editing=true;\n            //auto-focus on form-control when entering edit mode\n            $timeout(function() { $element.find('.form-control').focus().select(); }, 200);\n        };\n        //leave edit mode (regardless of save() or cancel())\n        $scope.done = function() {\n            $scope.editing=false;\n            $scope.error = null;\n        };\n\n\n        $scope.save = function() {\n            //update display with new value\n            update($scope.innerValue);\n            $scope.done();\n        };\n        $scope.cancel = function() {\n            //reset inner value\n            $scope.innerValue = ngModelController.$viewValue;\n            $scope.done();\n        };\n\n\n        $scope.onKeyPress = function($event, code) {\n            // console.log(\"Pressed \" + code);\n            if((code === undefined || code === 0) && $event.which !== undefined)\n                code = $event.which;\n            if($scope.type === 'number') {\n                \n                //NOTE: Chrome does not catch Backspace onKeyPress, so it \n                // skips this handler. FF does, so we need to watch for \n                // backspace, delete, and numbers\n\n                if (code === 8  ||   //backspace\n                    code === 46 ||  //delete  \n                    (code >= 44 && code <= 57))    //comma, hyphen, period and numbers (0-9)\n                    return;\n                \n                //NOTE: keyPress period is 46. keyDown it is 190\n\n                $event.preventDefault();\n                return false;               //ignore key\n            }\n        };\n        $scope.onKeyUp = function($event, code) {\n            // console.log(\"Up \" + code);\n            if((code === undefined || code === 0) && $event.which !== undefined)\n                code = $event.which;\n            if(code === 13 && !$scope.error) $scope.done();  //enter\n            else if(code === 27)             $scope.cancel();//esc\n            else {\n            \n                if(code !== 8 &&                //backspace\n                    code !== 46 &&              //delete\n                    code !== 190 &&             //period\n                    (code < 48 || code > 90) && //letters and numbers (a-z, 0-9)\n                    (code < 106 || code > 111) && \n                    (code < 186)) \n                    return;\n\n                validate();\n            }\n        };\n\n\n        $scope.$destroy = function() {\n            $element.off('change');\n        };\n    }\n\n\n\n    angular.module(\"gp-common\")\n\n    .directive('gpSlickFormInput', ['$timeout', function($timeout) {\n\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                placeholder: '@',\n                help: '=',\n                // validator: '&',\n                // validationExpr: '@',\n                type: '@',\n                pattern: \"@\",\n                required: '@',\n                readOnly: '@',\n                size: '@',\n                icon: '@'\n            },\n            template: INPUT_TEMPLATE,\n            link: function($scope, $element, $attrs, ngModelController) {\n                inputLinkFunction($scope, $element, $attrs, ngModelController, $timeout);\n            }\n        };\n\n    }])\n\n\n    .directive('gpSlickFormTextarea', ['$timeout', function($timeout) {\n\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                placeholder: '@',\n                help: \"@\",\n                readOnly: \"@\",\n                size: \"@\",\n                icon: \"@\"\n            },\n            template: TEXTAREA_TEMPLATE,\n            link: function($scope, $element, $attrs, ngModelController) {\n                inputLinkFunction($scope, $element, $attrs, ngModelController, $timeout);\n            }\n        };\n\n    }])\n\n\n    /**\n     *\n     * Notes:\n     *  - use 'form form-inline' classes for editable date so the field doesn't take up whole line\n     */\n    .directive('gpSlickFormDate', ['$timeout', '$filter', function($timeout, $filter) {\n\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                format: \"@\",\n                placeholder: '@',\n                required: \"@\",\n                readOnly: \"@\",\n                size: '@',\n                icon: '@'\n            },\n            template: DATE_TEMPLATE,\n\n            controller: function($scope, $element) {\n                if(!$scope.format || $scope.format.length < 3) $scope.format = \"mediumDate\";\n                $scope.inline = $element.hasClass(\"inline\");\n            },\n\n            /**\n             *\n             */\n            link: function($scope, $element, $attrs, ngModelController) {\n\n                if($scope.required === 'true')\n                    $scope.required = true;\n                else $scope.required = false;\n                \n                $scope.elId = 'input_' + Math.ceil(Math.random()*9999);\n                $scope.size = $scope.size || 'medium';\n                $scope.type = $scope.type || 'text';\n\n\n                function validate(value) {\n                    // console.log(\"Validating '\" + value + \"'\");\n\n                    //check form-control for ng-invalid\n                    var input = $element.find('.form-control');\n                    if(input.hasClass('ng-invalid')) {\n                        if(input.hasClass(\"ng-empty\"))\n                            $scope.error = \"This field requires a value\";\n                        else\n                            $scope.error = \"Invalid value provided\";\n                    } else\n                        $scope.error = null;\n                }\n\n                function update(newValue) {\n                    // call $parsers pipeline then update $modelValue\n                    ngModelController.$setViewValue(newValue);\n                    // update the local view\n                    ngModelController.$render();\n                }\n\n\n                // when model change, update our view (just update the div content)\n                ngModelController.$render = function() {\n\n                    var value = ngModelController.$viewValue;\n\n                    //create copy of passed in model value that can be used\n                    // by the controls here allowing us to cancel and \n                    // commit changes at our own leisure\n                    $scope.innerValue = value;\n                    \n                    $scope.displayValue = value ? $filter('date')(ngModelController.$modelValue, $scope.format) :\n                        $scope.placeholder || \"No value provided\";\n\n                    validate(value);\n\n                };\n\n\n\n\n                $scope.isReadOnly = function() {\n                    var t = typeof(this.readOnly);\n                    if(t === 'undefined') return false;\n                    if(t === 'string') return this.readOnly.toLowerCase() === 'true';\n                    if(t === 'number') return this.readOnly === 1;\n                    if(t === 'boolean') return this.readOnly;\n                    return false;\n                };\n\n\n                //enter edit mode\n                $scope.edit = function() {\n                    if($scope.isReadOnly()) return;\n                    \n                    $scope.editing=true;\n                    \n                    //auto-focus on form-control when entering edit mode\n                    // $timeout(function() { $element.find('.form-control').focus().select(); }, 200);\n                };\n                //leave edit mode (regardless of save() or cancel())\n                $scope.done = function() {\n                    $scope.opened = false;\n                    $scope.editing=false;\n                    $scope.error = null;\n                };\n\n\n                $scope.save = function() {\n                    //update display with new value\n                    update($scope.innerValue);\n                    $scope.done();\n                };\n                $scope.cancel = function() {\n                    //reset inner value\n                    $scope.innerValue = angular.copy(ngModelController.$modelValue);\n                    $scope.done();\n                };\n\n\n                \n                \n\n                $scope.open = function() {\n                    //must wrap 'opened' variable in an object for \n                    // angular to properly track its value changes\n                    // from within children scope (ie, the date picker)\n                    if (typeof($scope.uibopts) === 'undefined'){\n                       $scope.uibopts = {};\n                    }\n                    $scope.uibopts.opened = true;\n                };\n\n                $scope.onKeyUp = function(code) {\n                    if(code === 13) {   //enter\n                        $scope.done();\n                    } else if(code === 27) {    //esc\n                        $scope.cancel();\n                    }\n                };\n                $scope.onChange = function(date) {\n                    if(isNaN(ngModelController.$modelValue) && $scope.required) {\n                        $scope.error = \"This field requires a value\";\n                    } else $scope.error = null;\n                };\n            }\n        };\n\n    }])\n\n\n\n    .directive('gpSlickFormSelect', ['$timeout', function($timeout) {\n\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                codeList: \"=\",\n                help: '=',\n                required: \"@\",\n                readOnly: \"@\",\n                size: '@',\n                icon: '@'\n            },\n            template: SELECT_TEMPLATE,\n            link: function($scope, $element, $attrs, ngModelController) {\n\n                if(!$scope.type) $scope.type = \"text\";\n                if($scope.required === 'true')\n                    $scope.required = true;\n                else $scope.required = false;\n\n                $scope.elId = 'input_' + Math.ceil(Math.random()*9999);\n                $scope.size = $scope.size || 'medium';\n                $scope.type = $scope.type || 'text';\n\n                var $select = null;\n\n                function getSelect() {\n                    if(!$select || !$select.length)\n                        $select = $element.find('.form-control');\n                    return $select;\n                }\n\n\n                if($scope.codeList) {\n                    $scope.selectOptions = $scope.codeList.map(function(item) {\n                        if(typeof(item) !== 'object' || !item.value)\n                            return {value: item, label: item};\n                        else if(!item.label)\n                            return {value: item.value, label: item.value};\n                        return item;\n                    });\n                } else \n                    $scope.selectOptions = [];\n\n\n\n                //listen for changes to the inner value by way of the form-control\n                // $element.find('.form-control').on('change', function onChange() { \n                //     validate($scope.innerValue); \n                // });\n                \n                \n\n                /* ------------- private methods --------------- */\n\n                function validate() {\n\n                    //check form-control for ng-invalid\n                    var select = getSelect();\n\n                    $scope.isDirty = select.hasClass('ng-dirty');\n\n                    if(select.hasClass('ng-invalid')) {\n                        if(select.hasClass(\"ng-empty\"))\n                            $scope.error = \"This field requires a value\";\n                        else\n                            $scope.error = \"Invalid value provided\";\n                    } else\n                        $scope.error = null;\n\n                }\n\n                function update(newValue) {\n                    // call $parsers pipeline then update $modelValue\n                    ngModelController.$setViewValue(newValue);\n                    // update the local view\n                    ngModelController.$render();\n                }\n\n\n\n                // when model change, update our view (just update the div content)\n                ngModelController.$render = function() {\n                        \n                    var value = ngModelController.$viewValue;\n\n                    //@see https://github.com/angular/angular.js/commit/7fda214c4f65a6a06b25cf5d5aff013a364e9cef\n\n                    //create copy of passed in model value that can be used\n                    // by the controls here allowing us to cancel and \n                    // commit changes at our own leisure\n                    $scope.innerValue = value;\n\n                    $scope.displayValue = $scope.placeholder || \"No value provided\";\n\n                    if(value) {\n                        //values are objects, not literals\n                        var opt = $scope.selectOptions.find(function(o){return o.value==value;});\n                        $scope.displayValue = opt.label;\n                    }\n                    \n                    validate();\n                };\n\n\n                /* ------------- private methods --------------- */\n\n                $scope.onChange = function(value) {\n                    \n                    // console.log(\"Changing value \" + value + \" vs \" + $scope.innerValue);\n                    $scope.innerValue = value;                \n                    $timeout(function() { validate(); }, 200);\n\n                };\n\n                $scope.onTypeaheadSelection = function($item, $model, $label, $event) {\n\n                    $scope.innerValue = $item ? $item.value : null;\n                    $timeout(function() { validate(); }, 200);\n\n                };\n\n                $scope.isReadOnly = function() {\n                    var t = typeof(this.readOnly);\n                    if(t === 'undefined') return false;\n                    if(t === 'string') return this.readOnly.toLowerCase() === 'true';\n                    if(t === 'number') return this.readOnly === 1;\n                    if(t === 'boolean') return this.readOnly;\n                    return false;\n                };\n\n                //enter edit mode\n                $scope.edit = function() {\n                    if($scope.isReadOnly()) return;\n                    $scope.editing=true;\n                    //auto-focus on form-control when entering edit mode\n                    $timeout(function() { $select.focus().select(); }, 200);\n                };\n                //leave edit mode (regardless of save() or cancel())\n                $scope.done = function() {\n                    $scope.editing=false;\n                    $scope.error = null;\n                };\n\n\n                $scope.save = function() {\n                    //update display with new value\n                    update($scope.innerValue);\n                    $scope.done();\n                };\n                $scope.cancel = function() {\n                    //reset inner value\n                    $scope.innerValue = ngModelController.$viewValue;\n                    $scope.done();\n                };\n\n                $scope.onKeyUp = function(code) {\n                    if(code === 13 && !$scope.error) {   //enter\n                        $scope.save();\n                    } else if(code === 27) {    //esc\n                        $scope.cancel();\n                    }\n                };\n\n                $scope.onTypeaheadKeyUp = function(code) {\n                    validate();\n                };\n\n\n                $scope.$destroy = function() {\n                    // $element.off('change');\n                };\n            }\n        };\n\n    }])\n\n\n\n    ;\n\n\n    var INPUT_TEMPLATE = [\n        \n        '<div class=\"form-group form-group-slick\">',\n        \n        '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>',\n        \n        '   <div class=\"input__display\" ',\n        '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error,\\'text-lg\\':size===\\'large\\'}\" ',\n        '       ng-show=\"!editing\" ng-click=\"edit()\" ',\n        '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">',\n        '      {{displayValue}}',\n        '   </div>',\n        \n        '   <div ng-show=\"editing\">',\n        '      <div class=\"input-group\" ng-class=\"{\\'input-group-lg\\':size===\\'large\\'}\">',\n        '           <div class=\"input-group-slick\" ng-class=\"{\\'input-group-slick--lg\\':size===\\'large\\'}\">',\n        \n        '               <span ng-if=\"icon\" class=\"{{::icon}}\"></span>',\n        \n        '               <input id=\"{{::elId}}\" type=\"{{::type}}\" class=\"form-control\" ',\n        '                   pattern=\"{{pattern}}\" ',\n        '                   ng-model=\"innerValue\" ',\n        '                   ng-required=\"{{required}}\" ',\n        '                   ng-keypress=\"onKeyPress($event, $event.keyCode)\" ',\n        '                   ng-keyup=\"onKeyUp($event, $event.keyCode)\" >',\n        \n        '               <span class=\"indicators\">',\n        '                   <span class=\"is-valid glyphicon glyphicon-ok-sign\"></span>',\n        '                  <span class=\"is-invalid glyphicon glyphicon-exclamation-sign\"></span>',\n        '              </span>',\n        \n        '           </div>',\n        \n        '          <span class=\"input-group-btn\">',\n        \n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '                   ng-click=\"cancel()\" title=\"Cancel changes\">',\n        '                   <span class=\"glyphicon glyphicon-ban-circle\"></span>',\n        '              </button>',\n        \n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{disabled:!!error||!isDirty,\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '                   ng-disabled=\"{{!!error}}\" ',\n        '                   ng-click=\"save()\" title=\"Save changes\">',\n        '                  <span class=\"glyphicon glyphicon-ok\"></span>',\n        '               </button>',\n        \n        '           </span>',\n        \n        '       </div>', \n\n        '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>',\n        '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>',\n        \n        '   </div>',\n        \n        '</div>'\n\n    ].join(' ');\n\n    var TEXTAREA_TEMPLATE = [\n        '<div class=\"form-group form-group-slick\">',\n        \n        '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>',\n        \n        '   <div class=\"input__display\" ',\n        '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error,\\'text-lg\\':size===\\'large\\'}\" ',\n        '       ng-show=\"!editing\" ng-click=\"edit()\" ',\n        '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">',\n        '      {{displayValue}}',\n        '   </div>',\n        \n        '   <div ng-show=\"editing\">',\n        '      <div class=\"input-group\" ng-class=\"{\\'input-group-lg\\':size===\\'large\\'}\">',\n        '           <div class=\"input-group-slick\" ng-class=\"{\\'input-group-slick--lg\\':size===\\'large\\'}\">',\n        \n        '               <span ng-if=\"icon\" class=\"{{::icon}}\"></span>',\n        \n        '               <textarea rows=\"3\" id=\"{{::elId}}\" class=\"form-control\" ',\n        '                   ng-required=\"{{required}}\" ng-model=\"innerValue\"',\n        '                   ng-keypress=\"onKeyPress($event, $event.keyCode)\" ',\n        '                   ng-keyup=\"onKeyUp($event, $event.keyCode)\"></textarea>',\n        \n        '               <span class=\"indicators\">',\n        '                   <span class=\"is-valid glyphicon glyphicon-ok-sign\"></span>',\n        '                  <span class=\"is-invalid glyphicon glyphicon-exclamation-sign\"></span>',\n        '              </span>',\n        \n        '           </div>',\n        \n        '          <span class=\"input-group-btn\">',\n        \n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '                   ng-click=\"cancel()\" title=\"Cancel changes\">',\n        '                   <span class=\"glyphicon glyphicon-ban-circle\"></span>',\n        '              </button>',\n        \n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{disabled:!!error||!isDirty,\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '                   ng-disabled=\"{{!!error}}\" ',\n        '                   ng-click=\"save()\" title=\"Save changes\">',\n        '                  <span class=\"glyphicon glyphicon-ok\"></span>',\n        '               </button>',\n        \n        '           </span>',\n        \n        '       </div>', \n\n        '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>',\n        '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>',\n        \n        '   </div>',\n        \n        '</div>'\n    ].join(' ');\n\n    var DATE_TEMPLATE = [\n\n        \n        '<div class=\"form-group form-group-slick\">',\n        \n        '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>',\n\n        '   <div class=\"input__display\" ',\n        '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error}\" ',\n        '       ng-show=\"!editing\" ng-click=\"edit()\" ',\n        '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">',\n        '      {{displayValue}}',\n        '   </div>',\n        \n        '   <div ng-show=\"editing\">',\n        '       <div uib-datepicker ng-required=\"{{required}}\" ng-model=\"innerValue\" datepicker-options=\"{showWeeks:false}\"></div>',\n        \n        '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>',\n        '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>',\n        \n        '       <button type=\"button\" class=\"btn btn-default\" ',\n        '           ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '           ng-click=\"cancel()\" title=\"Cancel changes\">',\n        '           <span class=\"glyphicon glyphicon-ban-circle\"></span>',\n        '      </button>',\n        \n        '      <button type=\"button\" class=\"btn btn-default\" ',\n        '           ng-class=\"{disabled:!!error,\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '          ng-disabled=\"{{!!error}}\" ',\n        '           ng-click=\"save()\" title=\"Save changes\">',\n        '           <span class=\"glyphicon glyphicon-ok\"></span>',\n        '      </button>',\n\n        '   </div>',\n\n        '</div>'\n\n    ].join(' ');\n\n    var SELECT_TEMPLATE = [\n        \n        '<div class=\"form-group form-group-slick\">',\n        \n        '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>',\n        \n        '   <div class=\"input__display\" ',\n        '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error}\" ',\n        '       ng-show=\"!editing\" ng-click=\"edit()\" ',\n        '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">',\n        '      {{displayValue}}',\n        '   </div>',\n        \n        '   <div ng-show=\"editing\">',\n\n        '      <div class=\"input-group\" ng-class=\"{\\'input-group-lg\\':size===\\'large\\'}\">',\n        \n        '           <div class=\"input-group-slick\" ng-class=\"{\\'input-group-slick--lg\\':size===\\'large\\'}\">',\n        \n        '               <span ng-if=\"icon\" class=\"{{::icon}}\"></span>',\n        \n        '               <select class=\"form-control input__field\" ',\n        '                   ng-if=\"codeList.length<=12\" ',\n        '                   ng-model=\"innerValue\" ',\n        '                   ng-options=\"opt.value as opt.label for opt in selectOptions\" ',\n        '                   ng-required=\"{{required}}\" ',\n        '                   ng-change=\"onChange(innerValue)\" ',\n        '                   ng-keyUp=\"onKeyUp($event.keyCode)\" >',\n        '                   <option value=\"\">Select One</option>',\n        '               </select>',\n\n        '               <input type=\"text\" class=\"form-control input__field\" ng-if=\"codeList.length>12\" ',\n        '                   ng-model=\"innerValue\" ',\n        '                   ng-required=\"{{required}}\" ',\n        '                   ng-keyUp=\"onTypeaheadKeyUp($event.keyCode)\" ',\n        '                   typeahead-on-select=\"onTypeaheadSelection($item, $model, $label, $event)\" ',\n        '                   uib-typeahead=\"opt.value as opt.label for opt in selectOptions | filter:{value:$viewValue} | limitTo:12\" ',\n        '                   typeahead-min-length=\"0\" ',\n        '                   typeahead-editable=\"false\">',\n        \n        '               <span class=\"indicators\">',\n        '                   <span class=\"is-valid glyphicon glyphicon-ok-sign\"></span>',\n        '                  <span class=\"is-invalid glyphicon glyphicon-exclamation-sign\"></span>',\n        '              </span>',\n        \n        '           </div>',\n        \n        '          <span class=\"input-group-btn\">',\n        \n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '                   ng-click=\"cancel()\" title=\"Cancel changes\">',\n        '                   <span class=\"glyphicon glyphicon-ban-circle\"></span>',\n        '              </button>',\n        \n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{disabled:!!error||!isDirty,\\'btn-lg\\':size===\\'large\\'}\"' ,\n        '                   ng-disabled=\"{{!!error}}\" ',\n        '                   ng-click=\"save()\" title=\"Save changes\">',\n        '                  <span class=\"glyphicon glyphicon-ok\"></span>',\n        '               </button>',\n        \n        '           </span>',\n        \n        '       </div>',\n        \n        '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>',\n        '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>',\n        \n        '   </div>',\n        \n        '</div>'\n\n    ].join(' ');\n\n})(jQuery, angular);","(function(angular) {\n    \n    \"use strict\";\n\n    angular.module(\"gp-common\").directive('gpTweetButton', ['$timeout', function($timeout) {\n        \n        function debounce(func, wait, immediate) {\n            var timeout;\n            return function() {\n                var context = this,\n                    args = arguments;\n                var later = function() {\n                    timeout = null;\n                    if (!immediate) func.apply(context, args);\n                };\n                var callNow = immediate && !timeout;\n                clearTimeout(timeout);\n                timeout = setTimeout(later, wait);\n                if (callNow) func.apply(context, args);\n            };\n        }\n\n        return {\n            link: function(scope, element, attr) {\n\n                if(typeof(twttr) === 'undefined') {\n                    element.className += ' disabled';\n                    return;\n                }\n\n                var renderTwitterButton = debounce(function() {\n                    if (attr.url) {\n                        $timeout(function() {\n                            element[0].innerHTML = '';\n                            twttr.widgets.createShareButton(\n                                attr.url,\n                                element[0],\n                                function() {}, {\n                                    count: attr.count,\n                                    text: attr.text,\n                                    via: attr.via,\n                                    size: attr.size,\n                                    hashtags: attr.hashtags,\n                                    dnt: attr.dnt\n                                }\n                            );\n                        });\n                    }\n                }, 75);\n                attr.$observe('url', renderTwitterButton);\n                attr.$observe('text', renderTwitterButton);\n            }\n        };\n    }]);\n\n}) (angular);","(function(angular) {\n\n    \"use strict\";\n\n    angular.module(\"gp-common\").directive('sortOrder', function() {\n        return {\n            \n            replace: true,\n            require: 'ngModel',\n            \n            template: [\n                '<div>',\n                '<a class=\"btn btn-default\" title=\"Click to sort in ascending order\" href ng-if=\"value===\\'dsc\\'\" ng-click=\"toggle()\">',\n                '    <span class=\"glyphicon glyphicon-sort-by-attributes-alt\"></span>',\n                '</a>',\n                '<a class=\"btn btn-default\" title=\"Click to sort in descending order\" href ng-if=\"value===\\'asc\\'\" ng-click=\"toggle()\">',\n                '    <span class=\"glyphicon glyphicon-sort-by-attributes\"></span>',\n                '</a>',\n                '</div>'\n            ].join(' '),\n\n            link: function($scope, element, attrs, ngModel) {\n                ngModel.$viewChangeListeners.push(function() {\n                    $scope.$eval(attrs.ngChange);\n                });\n                ngModel.$render = function() {\n                    $scope.value = ngModel.$modelValue;\n                };\n                $scope.toggle = function() {\n                    $scope.value = $scope.value === 'asc' ? 'dsc' : 'asc';\n                    ngModel.$setViewValue($scope.value);\n                };\n            }\n        };\n    });\n\n})(angular);","(function(jQuery, angular) {\n    \n    \"use strict\"; \n    \n    angular.module(\"gp-common\")\n\n    /**\n     * Custom filter to make label values visually helpful by \n     * replacing bad characters with spaces or meaningful equivalents\n     */\n    .filter('fixLabel', function() {\n        return function(input) {\n            input = input || '';\n            return input.replace(/_/g,' ');\n        };\n    })\n\n    .filter('pluralize', function() {\n        return function(text) {\n            if(!text || !text.length) return \"\";\n            if(text.endsWith('ss')) return text + 'es'; //classes, etc\n            if(text.endsWith('s')) return text;         //already plural\n            return text + 's';\n            //TODO support irregular words like \"foot\" -> \"feet\"\n            // and words that need duplicate letters: \"quiz\" -> \"quizzes\"\n        };\n    })    \n\n    .filter('capitalize', function() {\n        return function(text) {\n            return text[0].toUpperCase() + text.substring(1);\n        };\n    })\n\n\n    .filter('facets', function() {\n\n        return function(arr,facetName) {\n            if(!facetName) return arr;\n            if(!arr || !arr.length) return [];\n            return arr.filter(function(f){return f.toLowerCase().startsWith(facetName + \":\");})\n                .map(function(f) {return f.substring(f.indexOf(':')+1, f.length);});\n        };\n\n    })\n\n    .filter('joinBy', function () {\n        return function (input,delimiter,emptyValue) {\n            if(input.length) return input.join(delimiter || ', ');\n            else             return emptyValue || '';\n        };\n    })\n\n\n\n    .filter('defaultValue', function() {\n        return function(text, defVal) {\n            if(typeof(text)==='undefined' || !text.length) return defVal;\n            return text;\n        };\n    })\n\n    .filter('count', function() {\n        return function(input) {\n            if(typeof(input) !== 'undefined') {\n                if(typeof(input.push) === 'function') \n                    return input.length;\n                if(typeof(input) === 'object') {\n                    if(typeof(Object.keys) !== 'undefined') {\n                        return Object.keys(input);\n                    }\n                }\n            }\n            return 0;\n        };\n    })\n\n    ;\n\n})(jQuery, angular);"]}