{"version":3,"sources":["geoplatform.common.js","module.js","directives/card-details.js","directives/colorpicker.js","directives/datepicker.js","directives/geolocation.js","directives/header-menu.js","directives/iframe.js","directives/image.js","directives/notifications.js","directives/pagination.js","directives/progress-circle.js","directives/responsive.js","directives/slick-forms.js","directives/social.js","directives/sort.js","directives/string-array.js","filters/filters.js","kg/editor.js","kg/section.js","query/community.filter.js","query/createdBy.filter.js","query/publisher.filter.js","query/recommended.term.filter.js","query/similarity.filter.js","query/theme.filter.js","services/browse.service.js","services/socket.js","services/uuid.js","lang.js","auth.js"],"names":["_typeof","Symbol","iterator","obj","constructor","prototype","jQuery","angular","module","constant","missing","field","GeoPlatform","env","ENV","NODE_ENV","AUTH_TYPE","indexOf","value","expected","IDP_BASE_URL","APP_ID","Constants","service","KGFields","RecommenderServiceFactory","calculate","kg","result","forEach","prop","length","Math","floor","getService","type","$resource","baseUrl","ualUrl","query","url","isArray","queryTypes","querySources","factory","for","component","bindings","ngModel","controller","$rootScope","KGHelper","this","$onInit","_this","update","listener","$on","event","item","id","classifiers","$onChanges","$onDestroy","$promise","$resolved","then","model","template","directive","compile","$element","append","$scope","hasPrevious","find","prevAll","hasNext","nextAll","previousDetails","pane","removeClass","element","addClass","nextDetails","invalidRGB","rgb","error","Object","r","parseInt","g","b","x","componentToHex","c","hex","toString","isNaN","rgbToHex","validHex","exec","hexToRgb","shorthandRegex","replace","m","onChange","$timeout","$q","changeRGB","rgbError","self","changeHex","hexError","scope","label","format","date","join","$attrs","toggle","preventDefault","stopPropagation","opened","promise","debounce","cancel","$watch","$window","restrict","btnLabel","loading","available","navigator","geolocation","geolocate","getCurrentPosition","position","$apply","$emit","coords","latitude","longitude","code","Config","AuthenticationService","brand","showHomeLink","transclude","link","ctrl","transcludeFn","portalUrl","getUserQ","user","replaceWith","$location","path","homeLink","substring","menu","dd","closest","parent","each","i","a","$a","$","href","attr","homeHref","$root","callback","attrs","on","off","jqEl","onImgFail","mapThumbnail","buildThumbnail","map","thumbnail","contentData","style","mediaType","width","height","getUrl","catch","e","fallback","elName","isLink","resolve","assetType","assetId","hasThumbnail","Service","items","getItems","addItem","push","$broadcast","removeItem","bind","index","splice","msg","dismiss","message","canDismiss","success","info","NotificationService","expiration","timer","removeOldest","oldest","$watchCollection","PaginationController","options","getPagination","pageSizeDropdown","useSelect","pageSize","size","pageSizeOptions","sizeOptions","o","eventKey","previous","start","max","next","min","total","first","last","lastPage","setPage","arg","page","setPageSize","dashArray","PI","changes","offset","provider","$windowProvider","Helper","window","$get","getWidth","innerWidth","outerWidth","isXS","isSM","isMD","isLG","helper","responsiveHelper","el","resizeFn","w","$attr","hh","offsetHeight","tp","top","css","inputLinkFunction","ngModelController","validate","input","isDirty","hasClass","newValue","$setViewValue","$render","required","elId","ceil","random","innerValue","$viewValue","displayValue","placeholder","isReadOnly","t","readOnly","toLowerCase","edit","editing","focus","select","done","save","onKeyPress","$event","undefined","which","onKeyUp","$destroy","require","help","pattern","icon","INPUT_TEMPLATE","TEXTAREA_TEMPLATE","$filter","DATE_TEMPLATE","inline","$modelValue","copy","open","uibopts","codeList","SELECT_TEMPLATE","getSelect","$select","selectOptions","opt","onTypeaheadSelection","$item","$model","$label","onTypeaheadKeyUp","func","wait","immediate","timeout","context","args","arguments","later","apply","callNow","clearTimeout","setTimeout","twttr","className","renderTwitterButton","innerHTML","widgets","createShareButton","count","text","via","hashtags","dnt","$observe","$viewChangeListeners","$eval","ngChange","fromInput","split","trim","toInput","arr","$parsers","$formatters","filter","charAt","toUpperCase","slice","endsWith","facetName","f","startsWith","delimiter","emptyValue","defVal","keys","str","name","idx","statistics","reliability","KGEditor","fields","displayOptions","completion","descriptions","purpose","function","audience","community","place","category","primarySubject","secondarySubject","primaryTopic","secondaryTopic","calculatePercentage","property","values","onValueClick","classifier","onActivate","ngModelCtrl","SectionController","RecommenderService","noResults","fetching","showSuggested","paging","updateCache","description","eventHandlers","clearOptions","selected","activate","notify","data","handler","fetchOptions","params","q","response","totalResults","suggested","results","_selected","isSelected","finally","clearQuery","remove","removed","uri","found","it","selectValue","onDropdownToggled","$http","collapse","updateValues","hasSelections","getUsedBy","setUsedBy","clear","getCount","facet","getFacet","valObj","buckets","v","get","sort","bust","Date","getTime","newValues","additionalValueCount","selections","existing","nv","concat","console","log","status","statusText","limitToUser","modelOptions","updateOn","default","blur","username","setCreatedBy","toggleLimitToUser","getAgencies","setAgencies","RecommendedTermFilter","termService","displayOpts","empty","suggest","termQuery","hideSuggested","getOptions","removeValue","removed_1","match","applyOption","mapId","useMap","evtName","events","SIMILARITY","layer","clearValue","toggleCurrentMap","bool","getThemes","themes","setThemes","scheme.label","BrowseObjectsService","eventName","dirty","delay","resetStart","doReset","_dirtyPromise","_doUpdate","_options","_isLoading","opts","PARAM_OPTIONS","po","parameter","option","isSet","isArr","k","facets","hasOwnProperty","_selectedFacets","includeFacet","_requestFacets","_fields","svc","_results","_facets","_id","JSON","parse","setOption","fire","key","_pageSizeBase","PAGE_SIZE_BASE_10","pageSizeBase","PAGE_SIZE_BASE_12","FIELDS","FACETS","_onSelectFn","onSelect","LOADING","RESULTS","PAGINATION","SELECTED","ERROR","SELECTED_ADDED","SELECTED_REMOVED","getLoadingStatus","trigger","getResults","getFacetNames","getFacets","addFacet","applyConstraints","p","applyOptions","setQuery","fireUpdate","VAR_QUERY","setTypes","types","VAR_TYPES","getTypes","setUser","userId","VAR_USER","creators","VAR_CREATED_BY","VAR_THEMES","publishers","VAR_PUBLISHERS","ids","VAR_USED_BY","setServiceTypes","svcTypes","VAR_SERVICE_TYPES","getServiceTypes","setSchemes","schemes","VAR_SCHEMES","setVisibility","visibility","VAR_VISIBILITY","setModified","beforeOrAfter","VAR_MODIFIED_BEFORE","VAR_MODIFIED_AFTER","dir","oppProp","getModified","setExtent","bboxStr","VAR_EXTENT","getExtent","getSelected","setSelected","finder","l","err","unshift","selectAll","clearSelected","refresh","setFacet","setFields","andUpdate","getSortOptions","SORT_OPTIONS","getSortValue","getQueryOptions","extend","hasQueryOptions","reset","order","destroy","BrowseServiceFactory","SocketService","socket","tracking","CREATED","UPDATED","DELETED","EDITING","STATUS","io","connect","evt","socketId","getId","emit","close","tracks","end","begin","objId","room","leave","UUID","cache","onClose","onbeforeunload","existing_1","cacheRef","closeDelegate","call","onDelegate","handle","emitDelegate","s","hexDigits","substr","Array","indexOfObj","comparatorFn","len","String","plus","offsetMS","d","threshold","getJWTFromUrl","queryString","location","hash","res","Storage","setObject","setItem","btoa","stringify","getObject","atob","getItem","User","sub","email","org","orgs","groups","exp","toJSON","clone","assign","compare","isAuthorized","role","n","AuthService","init","login","encodeURIComponent","CALLBACK","ALLOWIFRAMELOGIN","LOGIN_URL","logout","LOGOUT_URL","host","removeAuth","forceLogin","getOauthProfile","Q","defer","getJWT","reject","jwt","setAuth","FORCE_LOGIN","history","replaceState","search","getUserFromJWT","parseJwt","getUser","isImplicitJWT","isExpired","check","when","checkWithClient","originalJWT","resp","header","headers","newJWT","getJWTfromLocalStorage","localStorage","gpoauthJWT","clearLocalStorageJWT","parsedJWT","implicit","token","parsed","base64Url","base64","validateJwt","now","defaults","common","Authorization","$injector","authHeader","config","$httpProvider","interceptors","minimal","startAuthIntervalCheck","setInterval","requireLogin","idpUrl","idmUrl"],"mappings":"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rD,EAAAmN,WAAAZ,EAAAa,WACApN,EAAA+N,QAEA/N,EAAAqO,QAAA,SAAA/J,GACA,KAAAA,GAAAtE,EAAAc,MAGA,KAAAwD,GACAtE,EAAAqD,SAHArD,EAAAgO,QAMAhO,EAAA8P,iBAAA,SAAAxL,GACAkI,KAEAxM,EAAAsO,SAAA,iBAMA,IAAAK,IACA,4CACA,uEACA,kCACA,mGACA,+CACA,yEACA,yBACA,YACA,6BACA,mFACA,qGACA,+DACA,gFACA,4CACA,4CACA,iDACA,uEACA,kEACA,2CACA,gFACA,0FACA,wBACA,oBACA,2CACA,gEACA,4DACA,iEACA,0EACA,0BACA,gEACA,uFACA,gDACA,6DACA,iEACA,2BACA,qBACA,gBACA,0GACA,2FACA,YACA,UACA9L,KAAA,KACA+L,GACA,4CACA,uEACA,kCACA,mGACA,+CACA,yEACA,yBACA,YACA,6BACA,mFACA,qGACA,+DACA,0EACA,sEACA,uEACA,4EACA,2CACA,gFACA,0FACA,wBACA,oBACA,2CACA,gEACA,4DACA,iEACA,0EACA,0BACA,gEACA,uFACA,gDACA,6DACA,iEACA,2BACA,qBACA,gBACA,0GACA,2FACA,YACA,UACA/L,KAAA,KACAiM,GACA,4CACA,uEACA,kCACA,0EACA,+CACA,yEACA,yBACA,YACA,6BACA,4HACA,0GACA,2FACA,wDACA,oDACA,yDACA,kEACA,kBACA,uDACA,qEACA,uCACA,qDACA,0DACA,kBACA,YACA,UACAjM,KAAA,KACAwM,GACA,4CACA,uEACA,kCACA,0EACA,+CACA,yEACA,yBACA,YACA,6BACA,mFACA,qGACA,+DACA,4DACA,kDACA,4CACA,mFACA,iDACA,uDACA,0DACA,0DACA,2BACA,kGACA,4CACA,iDACA,kEACA,gGACA,+HACA,+CACA,iDACA,2CACA,gFACA,0FACA,wBACA,oBACA,2CACA,gEACA,4DACA,iEACA,0EACA,0BACA,gEACA,uFACA,gDACA,6DACA,iEACA,2BACA,qBACA,gBACA,0GACA,2FACA,YACA,UACAxM,KAAA;y9QACAhH,O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","file":"geoplatform.common.min.js","sourcesContent":["\"use strict\";\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\n/// <reference path=\"../types.ts\" />\n(function (jQuery, angular) {\n    \"use strict\";\n\n    angular.module(\"gp-common\", []).constant('GPConfig', function () {\n        // throw error if field missing\n        function missing(field) {\n            throw \"ng.common: Required field in GeoPlatform is missing: \" + field + \"/n\" + \"Please see https://github.com/GeoPlatform/ng-common/tree/develop for configuration details\";\n        }\n        // throw error if field invalid\n        function invalid(value, expected) {\n            throw \"ng.common: A field you provided has an invalid value: \" + value + \"/n\" + (\"Expected value was: \" + expected) + \"Please see https://github.com/GeoPlatform/ng-common/tree/develop for configuration details\";\n        }\n        // General\n        if (!GeoPlatform.env && !GeoPlatform.ENV && GeoPlatform.NODE_ENV) {\n            missing(\"\\\"env\\\", \\\"ENV\\\", or \\\"NODE_ENV\\\"\");\n        }\n        // if(!GeoPlatform.portalUrl){ missing(`\"portalUrl\"`) }\n        // Auth Settings\n        if (GeoPlatform.AUTH_TYPE && ['token', 'grant'].indexOf(GeoPlatform.AUTH_TYPE) === -1) {\n            // Not set is ok as well\n            invalid(GeoPlatform.AUTH_TYPE, 'token | grant');\n        }\n        if (GeoPlatform.AUTH_TYPE === 'token') {\n            if (!GeoPlatform.IDP_BASE_URL) missing('IDP_BASE_URL');\n            if (!GeoPlatform.APP_ID) missing('APP_ID');\n        }\n        return GeoPlatform;\n    }());\n})(jQuery, angular);\n\n/**\n *\n * KnowledgeGraph property on RIM Asset renamed to Classifiers\n *\n */\n(function (jQuery, angular, Constants) {\n    'use strict';\n\n    angular.module('gp-common-kg', []).constant('KGFields', ['purposes', 'functions', 'primaryTopics', 'secondaryTopics', 'primarySubjects', 'secondarySubjects', 'communities', 'audiences', 'places', 'categories']).service('KGHelper', ['KGFields', 'RecommenderServiceFactory', function (KGFields, RecommenderServiceFactory) {\n        return {\n            calculate: function calculate(kg) {\n                if (!kg) return 0;\n                var result = 0;\n                angular.forEach(KGFields, function (prop) {\n                    if (kg[prop] && kg[prop].length) result += 7 + Math.floor((kg[prop].length - 1) / 2);\n                    // result += kg[prop] ? kg[prop].length*5 : 0;\n                });\n                return result;\n            },\n            getService: function getService(type) {\n                return RecommenderServiceFactory(type);\n            }\n        };\n    }]).service(\"RecommenderService\", function ($resource) {\n        var baseUrl = Constants.ualUrl + '/api/recommender';\n        return $resource(baseUrl, {}, {\n            query: {\n                url: baseUrl + '/suggest',\n                isArray: false\n            },\n            queryTypes: {\n                url: baseUrl + '/types',\n                isArray: false\n            },\n            querySources: {\n                url: baseUrl + '/sources',\n                isArray: false\n            }\n        });\n    }).factory(\"RecommenderServiceFactory\", function ($resource) {\n        return function (type) {\n            var baseUrl = Constants.ualUrl + '/api/recommender';\n            return $resource(baseUrl, { 'for': type }, {\n                query: {\n                    url: baseUrl + '/suggest',\n                    isArray: false\n                },\n                queryTypes: {\n                    url: baseUrl + '/types',\n                    isArray: false\n                },\n                querySources: {\n                    url: baseUrl + '/sources',\n                    isArray: false\n                }\n            });\n        };\n    }).component('kgCompletionDisplay', {\n        bindings: {\n            ngModel: '<' // the Asset containing the knowledge graph ('classifiers') property\n        },\n        controller: function controller($rootScope, KGHelper) {\n            this.$onInit = function () {\n                var _this = this;\n                this.update();\n                this.listener = $rootScope.$on('gp:kg:updated', function (event, item) {\n                    if (item && item.id === _this.id) {\n                        //in case kg didn't exist, \n                        if (!_this.ngModel.classifiers) _this.ngModel.classifiers = item.classifiers;\n                        _this.value = KGHelper.calculate(_this.ngModel.classifiers);\n                    }\n                });\n            };\n            this.$onChanges = function () {\n                this.update();\n            };\n            this.$onDestroy = function () {\n                this.listener();\n                this.listener = null;\n            };\n            this.update = function () {\n                var _this = this;\n                if (this.ngModel.$promise && !this.ngModel.$resolved) {\n                    this.ngModel.$promise.then(function (model) {\n                        _this.update();\n                    });\n                    return;\n                }\n                this.id = this.ngModel ? this.ngModel.id : null;\n                this.value = KGHelper.calculate(this.ngModel.classifiers);\n            };\n        },\n        template: \"\\n            <span>{{$ctrl.value||0}}%</span>\\n            <span class=\\\"glyphicon glyphicon-dashboard\\\"></span>\\n        \"\n    });\n})(jQuery, angular, GeoPlatform);\n\n(function (angular) {\n    \"use strict\";\n\n    var ACTIVATORS_HTML = \"\\n            <div class=\\\"gp-ui-card__details-activator--left\\\" title=\\\"Show previous details\\\"\\n                ng-class=\\\"{disabled:!hasPrevious()}\\\" ng-click=\\\"previousDetails()\\\">\\n                <span class=\\\"glyphicon glyphicon-chevron-left\\\"></span>\\n            </div>\\n            <div class=\\\"gp-ui-card__details-activator--right\\\" title=\\\"Show next details\\\"\\n                ng-class=\\\"{disabled:!hasNext()}\\\" ng-click=\\\"nextDetails()\\\">\\n                <span class=\\\"glyphicon glyphicon-chevron-right\\\"></span>\\n            </div>\\n        \";\n    /*\n     * Appends carousel-like activators onto a card section\n     * Usage:\n     *\n     *  <div class=\"text--supporting\" card-details-carousel-activator>\n     *      <div class=\"gp-ui-card__details active\" id=\"description\">...</div>\n     *      <div class=\"gp-ui-card__details\" id=\"author\">...</div>\n     *  </div>\n     */\n    angular.module(\"gp-common\").directive('cardDetailsCarouselActivator', function () {\n        return {\n            compile: function compile($element) {\n                $element.append(ACTIVATORS_HTML);\n            },\n            controller: function controller($scope, $element) {\n                $scope.hasPrevious = function () {\n                    var pane = $element.find('.gp-ui-card__details.active');\n                    return pane.prevAll('.gp-ui-card__details').length;\n                };\n                $scope.hasNext = function () {\n                    var pane = $element.find('.gp-ui-card__details.active');\n                    return pane.nextAll('.gp-ui-card__details').length;\n                };\n                $scope.previousDetails = function () {\n                    if (!$scope.hasPrevious()) return;\n                    var pane = $element.find('.gp-ui-card__details.active');\n                    pane.removeClass('active');\n                    pane = pane.prevAll('.gp-ui-card__details');\n                    if (pane.length) angular.element(pane[0]).addClass('active');\n                };\n                $scope.nextDetails = function () {\n                    if (!$scope.hasNext()) return;\n                    var pane = $element.find('.gp-ui-card__details.active');\n                    pane.removeClass('active');\n                    pane = pane.nextAll('.gp-ui-card__details');\n                    if (pane.length) angular.element(pane[0]).addClass('active');\n                };\n            }\n        };\n    });\n})(angular);\n\n(function (jQuery, angular) {\n    'use strict';\n    /**\n     * determines whether an rgb value is invalid\n     * the value starts as false (the rbg value is valid)\n     * and is invalidated if the value(s) are empty, greater than 255 or less than 0\n     *\n     * @param rgb either an object { r: 0, g: 0, b: 0 } or a single value\n     * @returns {boolean} whether the rgb value is invalid\n     */\n\n    function invalidRGB(rgb) {\n        var error = false;\n        if (rgb instanceof Object) {\n            var r = parseInt(rgb.r, 10);\n            var g = parseInt(rgb.g, 10);\n            var b = parseInt(rgb.b, 10);\n            if (r > 255 || r < 0 || !r && r !== 0) error = true;\n            if (g > 255 || g < 0 || !g && g !== 0) error = true;\n            if (b > 255 || b < 0 || !b && b !== 0) error = true;\n        } else {\n            var x = parseInt(rgb, 10);\n            if (x > 255 || x < 0 || !x && x !== 0) error = true;\n        }\n        return error;\n    }\n    /**\n     * converts a decimal (base 10) number to hex (base 16) string\n     *\n     * @param c base 10 number\n     * @returns {*} base 16 string\n     */\n    function componentToHex(c) {\n        var hex = c.toString(16),\n            result = null;\n        if (!isNaN(c) && !invalidRGB(c)) result = hex.length == 1 ? '0' + hex : hex;\n        return result;\n    }\n    /**\n     * converts an rgb object to a hexadecimal string\n     *\n     * @param rgb object { r: 0, g: 0, b: 0 }\n     * @returns {*} hexadecimal string\n     */\n    function rgbToHex(rgb) {\n        var result = null;\n        var r = componentToHex(parseInt(rgb.r, 10));\n        var g = componentToHex(parseInt(rgb.g, 10));\n        var b = componentToHex(parseInt(rgb.b, 10));\n        if (r && g && b) result = '#' + r + g + b;\n        return result;\n    }\n    /**\n     * determines whether a hex value is valid\n     *\n     * @param hex string value\n     * @returns hex value or null if hex is invalid\n     */\n    function validHex(hex) {\n        return (/^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex) || null\n        );\n    }\n    /**\n     * converts a hex string to rgb object\n     *\n     * @param hex string\n     * @returns {*} rgb object { r: 0, g: 0, b: 0 }\n     */\n    function hexToRgb(hex) {\n        // Expand shorthand form (e.g. '03F') to full form (e.g. '0033FF')\n        var shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n        hex = hex.replace(shorthandRegex, function (m, r, g, b) {\n            return r + r + g + g + b + b;\n        });\n        var result = validHex(hex);\n        return result ? {\n            r: parseInt(result[1], 16),\n            g: parseInt(result[2], 16),\n            b: parseInt(result[3], 16)\n        } : null;\n    }\n    /**\n     * Advanced Color Picker Directive (advanced-color-picker)\n     * This color picker is meant to augment the functionality in angular-bootstrap-colorpicker\n     * It adds the ability to change the color with RGB and Hex\n     * It needs to be used in a container that has at least 160px of vertical real estate\n     *\n     * You must pass in the following:\n     *   - ngModel  (a hexadecimal string color value)\n     *   - onChange (the event to be fired when the value changes)\n     *\n     * Usage Example:\n     * <div advanced-color-picker ng-model=\"hexColor\" ng-change=\"changeEvent()\"></div>\n     */\n    angular.module('gp-common').component('gpColorPicker', {\n        bindings: {\n            ngModel: '=',\n            onChange: '&'\n        },\n        controller: function controller($timeout, $q) {\n            // fired when an rgb value is changed\n            this.changeRGB = function () {\n                // make sure rgb color value is correct\n                this.rgbError = invalidRGB(this.rgb);\n                // parse it anyways leaving hex value blank until valid rbg\n                this.ngModel = rgbToHex(this.rgb);\n                // have to use timeout to make sure ngModel is set before\n                // firing change event upstream\n                var self = this;\n                $timeout(function () {\n                    self.onChange({ value: self.ngModel });\n                });\n            };\n            // fired when a hex value is changed\n            this.changeHex = function () {\n                // make sure the hex color value is correct\n                if (!validHex(this.ngModel)) this.hexError = 'Invalid hex color value';else this.hexError = false;\n                // parse it anyway leaving rgb values blank until it's a valid hex\n                this.rgb = hexToRgb(this.ngModel);\n                // have to use timeout to make sure ngModel is set before\n                // firing change event upstream\n                var self = this;\n                $timeout(function () {\n                    self.onChange({ value: self.ngModel });\n                });\n            };\n            this.$onInit = function () {\n                this.rgb = hexToRgb(this.ngModel);\n            };\n        },\n        template: \"\\n            <div class=\\\"gp-colorpicker\\\">\\n                <div class=\\\"form-group hex-form-group\\\" ng-class=\\\"{'has-error':$ctrl.hexError}\\\">\\n                    <input type=\\\"text\\\" class=\\\"form-control\\\"\\n                        ng-model=\\\"$ctrl.ngModel\\\" ng-keyup=\\\"$ctrl.changeHex()\\\">\\n                </div>\\n                <div class=\\\"gp-colorpicker__wrapper\\\">\\n                    <div colorpicker colorpicker-inline=\\\"true\\\" colorpicker-parent=\\\"true\\\" \\n                        ng-model=\\\"$ctrl.ngModel\\\" ng-change=\\\"$ctrl.changeHex()\\\"></div>\\n                </div>\\n                <div class=\\\"form-group rgb-form-group\\\" ng-class=\\\"{'has-error':$ctrl.rgbError}\\\">\\n                    <input type=\\\"text\\\" class=\\\"form-control\\\"\\n                        placeholder=\\\"R\\\" ng-model=\\\"$ctrl.rgb.r\\\" ng-keyup=\\\"$ctrl.changeRGB()\\\" title=\\\"R\\\">\\n                    <input type=\\\"text\\\" class=\\\"form-control\\\"\\n                        placeholder=\\\"G\\\" ng-model=\\\"$ctrl.rgb.g\\\" ng-keyup=\\\"$ctrl.changeRGB()\\\" title=\\\"G\\\">\\n                    <input type=\\\"text\\\" class=\\\"form-control\\\"\\n                        placeholder=\\\"B\\\" ng-model=\\\"$ctrl.rgb.b\\\" ng-keyup=\\\"$ctrl.changeRGB()\\\" title=\\\"B\\\">\\n                </div>\\n            </div>\\n        \"\n    });\n})(jQuery, angular);\n\n(function (jQuery, angular) {\n    'use strict';\n\n    angular.module('gp-common').directive('gpDatePicker', ['$timeout', function ($timeout) {\n        return {\n            scope: {\n                label: '@',\n                format: '@',\n                date: '=',\n                onChange: '&?'\n            },\n            template: ['<div class=\"input-group-slick\">', '    <input type=\"text\" class=\"form-control\" placeholder=\"{{::label}}\"', '        datepicker-popup=\"{{format}}\" ng-model=\"date\" is-open=\"opened\" />', '    <span class=\"glyphicon glyphicon-calendar\" ng-click=\"toggle($event)\"></span>', '</div>', '<p class=\"help-block\"><small><em>Ex: \"2015-01-31\" or \"Jan 31 2015\"</em></small></p>'].join(' '),\n            controller: function controller($scope, $element, $attrs) {\n                //toggle date picker\n                $scope.toggle = function (event) {\n                    event.preventDefault();\n                    event.stopPropagation();\n                    this.opened = !this.opened;\n                };\n                if (!$scope.format) $scope.format = 'MMM dd yyyy';\n                var promise = null;\n                $scope.debounce = function () {\n                    if (promise) $timeout.cancel(promise);\n                    promise = $timeout(function () {\n                        promise = null;\n                        if ($scope.onChange) $scope.onChange();\n                    }, 200);\n                };\n                $scope.$watch('date', function () {\n                    $scope.debounce();\n                });\n                var listener = $scope.$on('$destroy', function () {\n                    listener(); //deregister listener\n                    if (promise) $timeout.cancel(promise);\n                    promise = null;\n                    $scope.opened = false; //close picker if open\n                    $scope.onChange = null;\n                    $scope.format = null;\n                    $scope.debounce = null;\n                });\n            }\n        };\n    }]);\n})(jQuery, angular);\n\n(function (jQuery, angular) {\n    \"use strict\";\n\n    angular.module(\"gp-common\").directive('gpGeolocation', ['$window', function ($window) {\n        var defaultBtnLabel = \"Locate\";\n        return {\n            scope: {\n                label: '=?'\n            },\n            restrict: \"EA\",\n            template: ['<a class=\"btn btn-primary\" ng-click=\"geolocate()\" ng-if=\"available\">', '  <span class=\"glyphicon glyphicon-screenshot\" ng-if=\"!loading\"></span>', '  <span class=\"glyphicon glyphicon-hourglass glyphicon-spin\" ng-if=\"loading\"></span>', '  {{btnLabel}}', '</a>', '<div ng-if=\"error\">{{error}}</div>'].join(' '),\n            controller: function controller($scope) {\n                $scope.btnLabel = $scope.label || defaultBtnLabel;\n                $scope.loading = false;\n                $scope.available = $window.navigator && $window.navigator.geolocation;\n                if (!$scope.available) $scope.error = \"Your browser does not support determining location\";\n                $scope.geolocate = function () {\n                    $scope.loading = true;\n                    $window.navigator.geolocation.getCurrentPosition(function (position) {\n                        $scope.$apply(function () {\n                            $scope.loading = false;\n                        });\n                        $scope.$emit('map:geolocation', position.coords.latitude, position.coords.longitude);\n                    }, function (error) {\n                        switch (error.code) {\n                            case 1:\n                                $scope.error = \"Permission was denied while attempting to determine location\";\n                                break;\n                            case 2:\n                                $scope.error = \"Unable to determine your location\";\n                                break;\n                            case 3:\n                                $scope.error = \"Unable to determine location in a reasonable amount of time\";\n                                break;\n                        }\n                    });\n                };\n            }\n        };\n    }]);\n})(jQuery, angular);\n\n(function (jQuery, angular) {\n    \"use strict\";\n\n    angular.module(\"gp-common\").directive('gpHeader', ['GPConfig', 'AuthenticationService', function (Config, AuthenticationService) {\n        return {\n            scope: {\n                brand: \"@\",\n                showHomeLink: \"@\"\n            },\n            restrict: \"AE\",\n            transclude: true,\n            replace: true,\n            template: ['<header>', '  <div class=\"container-fluid\">', '    <div class=\"row\">', '      <div class=\"col-md-12\">', '        <ul role=\"menu\" class=\"header__menu\" gp-header-menu>', '          <li ng-if=\"showHomeLink\">', '            <a href=\"#/goHome\">', '                <span class=\"glyphicon glyphicon-home\"></span> ', '                <span class=\"hidden-xs hidden-sm\">Home</span>', '            </a>', '          </li>', '          <div class=\"transcluded\"></div>', '          <li><span gp-login-button></span></li>', '        </ul>', '        <h4 class=\"brand\">', '          <a href=\"{{portalUrl}}\" title=\"Go to the GeoPlatform Home Page\">', '            <span class=\"icon-gp\"></span>', '            <span class=\"hidden-xs\">GeoPlatform</span>', '          </a>', '          {{brand}}', '        </h4>', '      </div>', '    </div>', '  </div>', '  <gp-login-modal></gp-login-modal>', '</header>'].join(' '),\n            // controller: function($rootScope, $scope, $element) {\n            //     $scope.portalUrl = $rootScope.portalUrl;\n            // }, \n            link: function link($scope, $element, $attrs, ctrl, transcludeFn) {\n                $scope.showHomeLink = $scope.showHomeLink === 'true' || false;\n                $scope.portalUrl = Config.portalUrl;\n                AuthenticationService.getUserQ().then(function (user) {\n                    $scope.user = user;\n                });\n                $element.find('.transcluded').replaceWith(transcludeFn());\n            }\n        };\n    }]).directive('gpHeaderMenu', ['$location', function ($location) {\n        //default href for \"home\" link in header__menu\n        //uses 'goHome' to avoid angular-route issues with empty hash not \n        // triggering a page reload. Relies upon the \"otherwise\" condition\n        // being configured inside a routeProvider within the application.\n        var homeLink = 'goHome';\n        function update($element) {\n            var path = $location.path();\n            if (path === '/' || path === '/#' || path === '/#/') path = homeLink;\n            if (path[0] === '/') path = path.substring(1);\n            var menu = $element;\n            menu.find('li.active').removeClass('active');\n            var link = menu.find('li > a[href=\"#/' + path + '\"]');\n            if (link.length) {\n                //check if link is within a dropdown in the header menu\n                var dd = link.closest('.dropdown-menu');\n                if (dd.length) {\n                    //find next ancestor that is a list element and mark it active\n                    dd.closest('li').addClass('active');\n                } else {\n                    //not in a dropdown, mark this link active\n                    link.parent().addClass('active');\n                }\n            }\n            menu.find('li > a').each(function (i, a) {\n                var $a = $(a),\n                    href = $a.attr('href');\n                if (!href) return;\n                href = href.replace('#/', '');\n                if (path.indexOf(href) === 0) $a.parent().addClass('active');\n            });\n        }\n        return {\n            scope: {\n                homeHref: '@'\n            },\n            restrict: \"A\",\n            controller: function controller($rootScope, $scope, $element) {\n                if ($scope.homeHref) homeLink = $scope.homeHref;\n            },\n            link: function link($scope, $element) {\n                update($element);\n                $scope.$root.$on('$locationChangeSuccess', function () {\n                    update($element);\n                });\n            }\n        };\n    }]).directive('gpFlexHeader', ['GPConfig', 'AuthenticationService', function (Config, AuthenticationService) {\n        return {\n            scope: {\n                brand: \"@\",\n                showHomeLink: \"@\"\n            },\n            restrict: \"AE\",\n            transclude: true,\n            replace: true,\n            template: \"\\n                <header>\\n                    <h4 class=\\\"brand\\\">\\n                        <a href=\\\"{{portalUrl}}\\\" title=\\\"Go to the GeoPlatform Home Page\\\">\\n                            <span class=\\\"icon-gp\\\"></span>\\n                            <span class=\\\"hidden-xs\\\">GeoPlatform</span>\\n                        </a>\\n                        {{brand}}\\n                    </h4>\\n                    <ul role=\\\"menu\\\" class=\\\"header__menu\\\" gp-header-menu>\\n                        <li ng-if=\\\"showHomeLink\\\">\\n                            <a href=\\\"/\\\">\\n                                <span class=\\\"glyphicon glyphicon-home\\\"></span> \\n                                <span class=\\\"hidden-xs hidden-sm\\\">Home</span>\\n                            </a>\\n                        </li>\\n                        <div class=\\\"transcluded\\\"></div>\\n                        <li><span gp-login-button></span></li>\\n                    </ul>\\n                </header>\\n            \",\n            link: function link($scope, $element, $attrs, ctrl, transcludeFn) {\n                $scope.showHomeLink = $scope.showHomeLink === 'true' || false;\n                $scope.portalUrl = Config.portalUrl;\n                AuthenticationService.getUserQ().then(function (user) {\n                    $scope.user = user;\n                });\n                $element.find('.transcluded').replaceWith(transcludeFn());\n            }\n        };\n    }]);\n})(jQuery, angular);\n\n(function (angular) {\n    \"use strict\";\n\n    angular.module('gp-common').directive('iframeOnload', function () {\n        return {\n            scope: {\n                callback: '&iframeOnload'\n            },\n            link: function link(scope, element, attrs) {\n                element.on('load', function (event) {\n                    element.off('load');\n                    return scope.callback(event);\n                });\n            }\n        };\n    });\n})(angular);\n\n(function (angular, Constants) {\n    \"use strict\";\n\n    angular.module(\"gp-common\").directive('onImgFail', function () {\n        return {\n            restrict: \"A\",\n            link: function link($scope, $element, $attrs) {\n                var jqEl = jQuery($element);\n                jqEl.on('error', function () {\n                    jqEl.off('error');\n                    jqEl.attr('src', $attrs.onImgFail);\n                });\n            }\n        };\n    }).directive('mapThumbnail', [function () {\n        return {\n            restrict: \"A\",\n            scope: {\n                mapThumbnail: '='\n            },\n            link: function link($scope, $element, $attrs) {\n                var map = $scope.mapThumbnail;\n                if (map.$promise && !map.$resolved) {\n                    map.$promise.then(function (m) {\n                        if (typeof m.thumbnail === 'string') $element.attr('src', getUrl(m));else buildThumbnail(m); //open map model\n                    }).catch(function (e) {\n                        $element.attr('src', null);\n                    });\n                } else {\n                    if (typeof map.thumbnail === 'string') $element.attr('src', getUrl(map));else buildThumbnail(map);\n                }\n                function buildThumbnail(map) {\n                    if (!map.thumbnail) {\n                        $element.attr('src', null);\n                    } else if (map.thumbnail.contentData) {\n                        var style = 'background-size:contain;' + 'background-repeat:no-repeat;' + 'background-image: url(data:' + (map.thumbnail.mediaType || 'image/png') + ';base64,' + map.thumbnail.contentData + ');';\n                        //if directive is on a responsive item (aka, in a gp-ui-card), \n                        // ignore thumbnail dimensions. Otherwise, use them\n                        if ($element.attr('class').indexOf('embed-responsive-item') < 0) {\n                            style += 'width:' + (map.thumbnail.width || '32') + 'px;' + 'height:' + (map.thumbnail.height || '32') + 'px;';\n                        }\n                        $element.attr('style', style);\n                    } else if (map.thumbnail.url) {\n                        $element.attr('src', map.thumbnail.url);\n                    } else $element.attr('src', null);\n                }\n                function getUrl(map) {\n                    var url = map.thumbnail;\n                    if (!url || !url.length) url = Constants.ualUrl + '/api/maps/' + map.id + '/thumbnail';else if (url.indexOf(\"http\") !== 0) {\n                        if (url[0] !== '/') url = Constants.ualUrl + '/' + url;else url = Constants.ualUrl + url;\n                    }\n                    return url;\n                }\n            }\n        };\n    }]).directive('itemThumbnail', ['$q', function ($q) {\n        return {\n            restrict: \"E\",\n            replace: true,\n            scope: {\n                item: '=',\n                fallback: '@',\n                link: '@'\n            },\n            template: \"\\n                <a ng-show=\\\"hasThumbnail\\\" class=\\\"media embed-responsive embed-responsive-16by9\\\">\\n                    <img class=\\\"embed-responsive-item\\\" on-img-error=\\\"{{fallback||'/img/img-404.jpg'}}\\\">\\n                </a>\\n            \",\n            controller: function controller($scope) {\n                $scope.elName = 'div';\n                $scope.isLink = !!$scope.link;\n                if ($scope.isLink) {\n                    $scope.elName = 'a';\n                }\n            },\n            link: function link($scope, $element, $attrs) {\n                var item = $scope.item;\n                (item.$promise || $q.resolve(item)).then(function (obj) {\n                    var url = $scope.fallback;\n                    //maps\n                    if (obj.type && obj.type === 'Map') url = Constants.ualUrl + \"/api/maps/\" + obj.id + \"/thumbnail\";else if (obj.assetType && obj.assetType === 'Map') url = Constants.ualUrl + \"/api/maps/\" + obj.assetId + \"/thumbnail\";else if (obj.thumbnail && obj.thumbnail.url) url = obj.thumbnail.url;else if (obj.thumbnail && obj.thumbnail.contentData) {\n                        var style = 'background-size:contain;' + 'background-repeat:no-repeat;' + 'background-image: url(data:' + (obj.thumbnail.mediaType || 'image/png') + ';base64,' + obj.thumbnail.contentData + ');';\n                        //if directive is on a responsive item (aka, in a gp-ui-card), \n                        // ignore thumbnail dimensions. Otherwise, use them\n                        if ($element.attr('class').indexOf('embed-responsive-item') < 0) {\n                            style += 'width:' + (obj.thumbnail.width || '32') + 'px;' + 'height:' + (obj.thumbnail.height || '32') + 'px;';\n                        }\n                        $element.find('img').attr('style', style);\n                    }\n                    $scope.hasThumbnail = !!url;\n                    $element.find('img').attr('src', url);\n                    if ($scope.isLink) {\n                        //$element is a.media because of 'replace:true'\n                        $element.attr('href', $scope.link).attr('target', '_blank');\n                    }\n                }).catch(function (e) {\n                    $element.find('img').attr('src', $scope.fallback);\n                });\n            }\n        };\n    }]);\n})(angular, GeoPlatform);\n\n(function (angular) {\n    \"use strict\";\n\n    angular.module('gp-common').service('NotificationService', ['$rootScope', function ($rootScope) {\n        var Service = function Service() {\n            this.items = [];\n        };\n        Service.prototype = {\n            getItems: function getItems() {\n                return this.items;\n            },\n            /**\n             * @param item object\n             * @return function to cancel the notification\n             */\n            addItem: function addItem(item) {\n                this.items.push(item);\n                $rootScope.$broadcast('gp:notifications:new', item);\n                var fn = function fn(item) {\n                    this.removeItem(item);\n                };\n                return fn.bind(this, item);\n            },\n            removeItem: function removeItem(item) {\n                var index = this.items.indexOf(item);\n                if (index >= 0) return this.items.splice(index, 1);\n                return null;\n            },\n            error: function error(label, msg, dismiss) {\n                return this.addItem({ type: 'error', label: label, message: msg, canDismiss: dismiss });\n            },\n            success: function success(label, msg, dismiss) {\n                return this.addItem({ type: 'success', label: label, message: msg, canDismiss: dismiss });\n            },\n            info: function info(label, msg, dismiss) {\n                return this.addItem({ type: 'info', label: label, message: msg, canDismiss: dismiss });\n            }\n        };\n        return new Service();\n    }]).directive('gpNotifications', ['$timeout', 'NotificationService', function ($timeout, NotificationService) {\n        return {\n            scope: {\n                expiration: '@'\n            },\n            template: ['<div class=\"notifications ng-hide\" ng-show=\"items.length\">', '  <div class=\"notification\" ng-repeat=\"item in items\"', '    ng-class=\"{\\'notification--success\\':item.type===\\'success\\', \\'notification--error\\':item.type===\\'error\\', \\'notification--info\\':item.type===\\'info\\'}\">', '    <h5 class=\"notification__title\">', '        <span class=\"pull-right glyphicon\" ', '            ng-class=\"{\\'glyphicon-ok-sign\\':item.type===\\'success\\',\\'glyphicon-exclamation-sign\\':item.type===\\'error\\',\\'glyphicon-info-sign\\':item.type===\\'info\\'}\">', '        </span>', '        {{item.label}}', '    </h5>', '    <p class=\"notification__content\" ng-bind-html=\"item.message\"></p>', '    <div class=\"notification__actions\" ng-if=\"item.canDismiss\">', '        <button type=\"button\" class=\"btn btn-link\" ng-click=\"dismiss(item)\">dismiss</button>', '    </div>', '  </div>', '</div>'].join(' '),\n            link: function link($scope, $element, $attrs) {\n                $scope.expiration = ($scope.expiration || 2000) * 1;\n                $scope.items = [];\n                function update() {\n                    $scope.items = NotificationService.getItems();\n                    //if updated before timer expired, reset timer\n                    if ($scope.timer) {\n                        $timeout.cancel($scope.timer);\n                        $scope.timer = null;\n                    }\n                    //set timer to kill earliest item after time\n                    $scope.timer = $timeout(function () {\n                        $scope.timer = null;\n                        //will ultimately call update() and thus trigger timeout again\n                        $scope.removeOldest();\n                    }, $scope.expiration);\n                }\n                update();\n                $scope.removeOldest = function () {\n                    //find oldest that can be removed\n                    var oldest = $scope.items.find(function (item) {\n                        return item.canDismiss;\n                    });\n                    if (oldest) NotificationService.removeItem(oldest);\n                };\n                $scope.dismiss = function (item) {\n                    //remove item using service\n                    NotificationService.removeItem(item);\n                };\n                $scope.$watchCollection(function () {\n                    return NotificationService.getItems();\n                }, update);\n                // $scope.$on('gp:notifications:new', function(event, item) { update(); });\n            }\n        };\n    }]);\n})(angular);\n\n(function (jQuery, angular) {\n    \"use strict\";\n    /*\n     * Usage:\n     *\n     *      <gp-pagination service=\"$ctrl.service\" event-key=\"maps\"></gp-pagination>\n     *\n     *  Expects a BrowseObjService instance for the 'service' binding, or at least\n     * one that provides the same pagination and options API.\n     */\n    /**\n     * Requires a service which exposes the following methods:\n     *   - getPagination() : returns {object} defining 'start', 'size', and 'total'\n     *   - start(int) : takes {int} defining which index to start requesting\n     *   - size(int) : takes {int} defining how many items to request\n     *   - on(eventName, listener) : must support event \"gp:browse:<key>:pagination\" where 'key' may be 'objects' or a custom key\n     */\n\n    var PaginationController = /** @class */function () {\n        function PaginationController() {\n            'ngInject';\n        }\n        PaginationController.prototype.$onInit = function () {\n            var _this = this;\n            if (!this.service) return;\n            this.options = this.service.getPagination();\n            //support using a traditional select instead of a uib dropdown menu\n            // in case the pagination control itself is wrapped in a dropdown menu.\n            //in this case, we use objects with labels and values in order to display\n            // the 'per page' text along with whatever the page size is.\n            this.pageSizeDropdown = true;\n            this.useSelect = typeof this.useSelect !== 'undefined' && (this.useSelect === true || this.useSelect === 'true' || this.useSelect === 1);\n            if (this.useSelect) {\n                this.pageSizeDropdown = false;\n                this.pageSize = this.options.size;\n                this.pageSizeOptions = (this.options.sizeOptions || [5, 10, 20, 50]).map(function (o) {\n                    return { label: o + ' per page', value: o };\n                });\n            }\n            var event = 'gp:browse:';\n            if (this.eventKey) event = 'gp:browse:' + this.eventKey + \":\";else event = 'gp:browse:objects:';\n            this.listener = this.service.on(event + 'pagination', function () {\n                _this.options = _this.service.getPagination();\n            });\n        };\n        PaginationController.prototype.$onDestroy = function () {\n            //remove listener from service if exists\n            if (this.listener) this.listener();\n            this.service = null;\n        };\n        PaginationController.prototype.previous = function () {\n            if (this.service && this.hasPrevious()) {\n                this.service.start(Math.max(0, this.options.start * 1 - this.options.size * 1), true);\n            }\n        };\n        PaginationController.prototype.next = function () {\n            if (this.service && this.hasNext()) {\n                this.service.start(Math.min(this.options.total, this.options.start * 1 + this.options.size * 1), true);\n            }\n        };\n        PaginationController.prototype.first = function () {\n            if (this.service && this.hasPrevious()) {\n                this.service.start(0, true);\n            }\n        };\n        PaginationController.prototype.last = function () {\n            if (this.service && this.hasNext()) {\n                var lastPage = Math.floor(this.options.total / this.options.size);\n                this.setPage(lastPage);\n            }\n        };\n        PaginationController.prototype.setPage = function (arg) {\n            if (this.service) {\n                var page = arg * 1;\n                this.service.start(page * (this.options.size * 1), true);\n            }\n        };\n        PaginationController.prototype.setPageSize = function (size) {\n            if (this.service) {\n                this.service.size(size * 1, true);\n            }\n        };\n        PaginationController.prototype.hasPrevious = function () {\n            return this.options && this.options.start > 0;\n        };\n        PaginationController.prototype.hasNext = function () {\n            return this.options && this.options.start + this.options.size < this.options.total;\n        };\n        return PaginationController;\n    }();\n    angular.module('gp-common').component('gpPagination', {\n        bindings: {\n            service: '=',\n            eventKey: '@',\n            useSelect: '@'\n        },\n        controller: PaginationController,\n        template: \"\\n            <div class=\\\"c-pagination\\\">\\n                <div class=\\\"c-pagination__total\\\">{{$ctrl.options.total||0}} results</div>\\n                <div class=\\\"c-pagination__page-size\\\" ng-if=\\\"$ctrl.pageSizeDropdown\\\">\\n                    <span uib-dropdown>\\n                        <a href=\\\"\\\" uib-dropdown-toggle title=\\\"Change the number of results returned\\\">\\n                            {{$ctrl.options.size}} per page <span class=\\\"caret\\\"></span>\\n                        </a>\\n                        <ul class=\\\"dropdown-menu\\\" role=\\\"menu\\\">\\n                            <li ng-repeat=\\\"size in $ctrl.options.sizeOptions track by $index\\\">\\n                                <a ng-click=\\\"$ctrl.setPageSize(size)\\\">{{size}} per page</a>\\n                            </li>\\n                        </ul>\\n                    </span>\\n                </div>\\n                <div class=\\\"c-pagination__page-size\\\" ng-if=\\\"!$ctrl.pageSizeDropdown\\\">\\n                    <select class=\\\"form-control\\\" \\n                        ng-model=\\\"$ctrl.pageSize\\\" ng-change=\\\"$ctrl.setPageSize($ctrl.pageSize)\\\"\\n                        ng-options=\\\"opt.value as opt.label for opt in $ctrl.pageSizeOptions\\\">\\n                    </select>\\n                </div>\\n                <div class=\\\"c-pagination__pages\\\">\\n                    <div class=\\\"c-pagination__button\\\" \\n                        ng-class=\\\"{'is-disabled':!$ctrl.hasPrevious()}\\\"\\n                        ng-click=\\\"$ctrl.first()\\\">\\n                        <span class=\\\"glyphicon glyphicon-fast-backward\\\"></span>\\n                    </div>\\n                    <div class=\\\"c-pagination__button\\\" \\n                        ng-class=\\\"{'is-disabled':!$ctrl.hasPrevious()}\\\"\\n                        ng-click=\\\"$ctrl.previous()\\\">\\n                        <span class=\\\"glyphicon glyphicon-backward\\\"></span>\\n                    </div>\\n                    <div class=\\\"c-pagination__page\\\">\\n                        {{$ctrl.options.start+1}} - {{$ctrl.options.start+$ctrl.options.size}}\\n                    </div>\\n                    <div class=\\\"c-pagination__button\\\" \\n                        ng-class=\\\"{'is-disabled':!$ctrl.hasNext()}\\\"\\n                        ng-click=\\\"$ctrl.next()\\\">\\n                        <span class=\\\"glyphicon glyphicon-forward\\\"></span>\\n                    </div>\\n                    <div class=\\\"c-pagination__button\\\" \\n                        ng-class=\\\"{'is-disabled':!$ctrl.hasNext()}\\\"\\n                        ng-click=\\\"$ctrl.last()\\\">\\n                        <span class=\\\"glyphicon glyphicon-fast-forward\\\"></span>\\n                    </div>\\n                </div>\\n            </div>\\n        \"\n    });\n})(jQuery, angular);\n\n(function (angular) {\n    \"use strict\";\n    /**\n     * Usage:\n     *  <gp-progress-circle ng-model=\"$ctrl.amount\"></gp-progress-circle>\n     */\n\n    angular.module('gp-common').component('gpProgressCircle', {\n        bindings: {\n            ngModel: '<' //amount out of 100\n        },\n        controller: function controller() {\n            this.$onInit = function () {\n                this.dashArray = 2 * Math.PI * 45 /*radius*/;\n                if (!this.ngModel) this.ngModel = 0;\n                this.update();\n            };\n            this.$onChanges = function (changes) {\n                if (changes.ngModel) this.update();\n            };\n            this.update = function () {\n                var offset = 2 * Math.PI * 45 * (1 - this.ngModel / 100);\n                this.value = offset;\n            };\n        },\n        template: \"\\n            <svg class=\\\"c-progress--circle\\\" viewBox=\\\"0 0 100 100\\\">\\n                <circle class=\\\"c-progress__meter\\\" cx=\\\"50\\\" cy=\\\"50\\\" r=\\\"45\\\" stroke-width=\\\"10\\\" />\\n                <circle class=\\\"c-progress__value\\\" cx=\\\"50\\\" cy=\\\"50\\\" r=\\\"45\\\" stroke-width=\\\"10\\\" \\n                    stroke-dasharray=\\\"{{$ctrl.dashArray}}\\\" stroke-dashoffset=\\\"{{$ctrl.value}}\\\"/>\\n                <text class=\\\"c-progress__label\\\" x=\\\"50\\\" y=\\\"-40\\\" text-anchor=\\\"middle\\\">{{$ctrl.ngModel}}%</text>\\n            </svg>\\n        \"\n    });\n})(angular);\n\n(function (jQuery, angular) {\n    \"use strict\";\n\n    angular.module('gp-common').provider('responsiveHelper', [\"$windowProvider\", function ($windowProvider) {\n        var $window = $windowProvider.$get();\n        function Helper($window) {\n            this.window = $window;\n        }\n        Helper.prototype = {\n            getWidth: function getWidth() {\n                return $window.innerWidth || $window.outerWidth;\n            },\n            isXS: function isXS() {\n                var width = this.getWidth();return width < 768;\n            },\n            isSM: function isSM() {\n                var width = this.getWidth();return width >= 768 && width < 992;\n            },\n            isMD: function isMD() {\n                var width = this.getWidth();return width >= 992 && width < 1200;\n            },\n            isLG: function isLG() {\n                var width = this.getWidth();return width >= 1200;\n            }\n        };\n        var helper = new Helper($window);\n        this.$get = function () {\n            return helper;\n        };\n    }]).directive('gpResponsive', ['$window', 'responsiveHelper', function ($window, responsiveHelper) {\n        return {\n            restrict: \"A\",\n            link: function link($scope, $element, $attrs) {\n                function update(el, helper) {\n                    if (helper.isXS()) el.addClass('gp-responsive-xs');else el.removeClass('gp-responsive-xs');\n                    if (helper.isSM()) el.addClass('gp-responsive-sm');else el.removeClass('gp-responsive-sm');\n                    if (helper.isMD()) el.addClass('gp-responsive-md');else el.removeClass('gp-responsive-md');\n                    if (helper.isLG()) el.addClass('gp-responsive-lg');else el.removeClass('gp-responsive-lg');\n                }\n                update($element, responsiveHelper);\n                var resizeFn = function resizeFn() {\n                    update($element, responsiveHelper);\n                };\n                var w = angular.element($window);\n                var listener = w.on('resize', resizeFn);\n                $scope.$on('$destroy', function () {\n                    w.off('resize', resizeFn);\n                });\n            }\n        };\n    }]).directive('gpResize', function ($window, $timeout) {\n        return function ($scope, $element, $attr) {\n            var resizeFn = function resizeFn() {\n                var hh = jQuery('header')[0].offsetHeight;\n                // var fh = jQuery('footer')[0].offsetHeight;\n                // console.log('hh & fh', hh, fh);                    \n                var tp = hh + 2;\n                // var bt = fh + 2;\n                // console.log('tp & bt', tp, bt);                \n                var changes = {\n                    // bottom: bt + 'px',\n                    top: tp + 'px'\n                };\n                $element.css(changes);\n                $scope.$apply();\n            };\n            var w = angular.element($window);\n            w.on('resize', resizeFn);\n            $timeout(resizeFn, 200);\n            $scope.$on('$destroy', function () {\n                w.off('resize', resizeFn);\n            });\n        };\n    });\n})(jQuery, angular);\n\n(function (jQuery, angular) {\n    \"use strict\";\n\n    function inputLinkFunction($scope, $element, $attrs, ngModelController, $timeout) {\n        if (!$scope.type) $scope.type = \"text\";\n        if ($scope.required === 'true') $scope.required = true;else $scope.required = false;\n        $scope.elId = 'input_' + Math.ceil(Math.random() * 9999);\n        $scope.size = $scope.size || 'medium';\n        $scope.type = $scope.type || 'text';\n        //listen for changes to the inner value by way of the form-control\n        $element.find('.form-control').on('change', function onChange() {\n            validate($scope.innerValue);\n        });\n        /* ------------- private methods --------------- */\n        function validate() {\n            //check form-control for ng-invalid\n            var input = $element.find('.form-control');\n            $scope.isDirty = input.hasClass('ng-dirty');\n            if (input.hasClass('ng-invalid')) {\n                if (input.hasClass(\"ng-empty\")) $scope.error = \"This field requires a value\";else $scope.error = \"Invalid value provided\";\n            } else $scope.error = null;\n        }\n        function update(newValue) {\n            // call $parsers pipeline then update $modelValue\n            ngModelController.$setViewValue(newValue);\n            // update the local view\n            ngModelController.$render();\n        }\n        // when model change, update our view (just update the div content)\n        ngModelController.$render = function () {\n            var value = ngModelController.$viewValue;\n            //create copy of passed in model value that can be used\n            // by the controls here allowing us to cancel and \n            // commit changes at our own leisure\n            $scope.innerValue = value;\n            $scope.displayValue = value || $scope.placeholder || \"No value provided\";\n            validate(value);\n        };\n        /* ------------- private methods --------------- */\n        $scope.isReadOnly = function () {\n            var t = _typeof(this.readOnly);\n            if (t === 'undefined') return false;\n            if (t === 'string') return this.readOnly.toLowerCase() === 'true';\n            if (t === 'number') return this.readOnly === 1;\n            if (t === 'boolean') return this.readOnly;\n            return false;\n        };\n        //enter edit mode\n        $scope.edit = function () {\n            if ($scope.isReadOnly()) return;\n            $scope.editing = true;\n            //auto-focus on form-control when entering edit mode\n            $timeout(function () {\n                $element.find('.form-control').focus().select();\n            }, 200);\n        };\n        //leave edit mode (regardless of save() or cancel())\n        $scope.done = function () {\n            $scope.editing = false;\n            $scope.error = null;\n        };\n        $scope.save = function () {\n            //update display with new value\n            update($scope.innerValue);\n            $scope.done();\n        };\n        $scope.cancel = function () {\n            //reset inner value\n            $scope.innerValue = ngModelController.$viewValue;\n            $scope.done();\n        };\n        $scope.onKeyPress = function ($event, code) {\n            // console.log(\"Pressed \" + code);\n            if ((code === undefined || code === 0) && $event.which !== undefined) code = $event.which;\n            if ($scope.type === 'number') {\n                //NOTE: Chrome does not catch Backspace onKeyPress, so it \n                // skips this handler. FF does, so we need to watch for \n                // backspace, delete, and numbers\n                if (code === 8 || //backspace\n                code === 46 || //delete  \n                code >= 44 && code <= 57) return;\n                //NOTE: keyPress period is 46. keyDown it is 190\n                $event.preventDefault();\n                return false; //ignore key\n            }\n        };\n        $scope.onKeyUp = function ($event, code) {\n            // console.log(\"Up \" + code);\n            if ((code === undefined || code === 0) && $event.which !== undefined) code = $event.which;\n            if (code === 13 && !$scope.error) $scope.done(); //enter\n            else if (code === 27) $scope.cancel(); //esc\n                else {\n                        if (code !== 8 && //backspace\n                        code !== 46 && //delete\n                        code !== 190 && ( //period\n                        code < 48 || code > 90) && ( //letters and numbers (a-z, 0-9)\n                        code < 106 || code > 111) && code < 186) return;\n                        validate();\n                    }\n        };\n        $scope.$destroy = function () {\n            $element.off('change');\n        };\n    }\n    angular.module(\"gp-common\").directive('gpSlickFormInput', ['$timeout', function ($timeout) {\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                placeholder: '@',\n                help: '=',\n                // validator: '&',\n                // validationExpr: '@',\n                type: '@',\n                pattern: \"@\",\n                required: '@',\n                readOnly: '@',\n                size: '@',\n                icon: '@'\n            },\n            template: INPUT_TEMPLATE,\n            link: function link($scope, $element, $attrs, ngModelController) {\n                inputLinkFunction($scope, $element, $attrs, ngModelController, $timeout);\n            }\n        };\n    }]).directive('gpSlickFormTextarea', ['$timeout', function ($timeout) {\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                placeholder: '@',\n                help: \"@\",\n                readOnly: \"@\",\n                size: \"@\",\n                icon: \"@\"\n            },\n            template: TEXTAREA_TEMPLATE,\n            link: function link($scope, $element, $attrs, ngModelController) {\n                inputLinkFunction($scope, $element, $attrs, ngModelController, $timeout);\n            }\n        };\n    }]).directive('gpSlickFormDate', ['$timeout', '$filter', function ($timeout, $filter) {\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                format: \"@\",\n                placeholder: '@',\n                required: \"@\",\n                readOnly: \"@\",\n                size: '@',\n                icon: '@'\n            },\n            template: DATE_TEMPLATE,\n            controller: function controller($scope, $element) {\n                if (!$scope.format || $scope.format.length < 3) $scope.format = \"mediumDate\";\n                $scope.inline = $element.hasClass(\"inline\");\n            },\n            /**\n             *\n             */\n            link: function link($scope, $element, $attrs, ngModelController) {\n                if ($scope.required === 'true') $scope.required = true;else $scope.required = false;\n                $scope.elId = 'input_' + Math.ceil(Math.random() * 9999);\n                $scope.size = $scope.size || 'medium';\n                $scope.type = $scope.type || 'text';\n                function validate(value) {\n                    // console.log(\"Validating '\" + value + \"'\");\n                    //check form-control for ng-invalid\n                    var input = $element.find('.form-control');\n                    if (input.hasClass('ng-invalid')) {\n                        if (input.hasClass(\"ng-empty\")) $scope.error = \"This field requires a value\";else $scope.error = \"Invalid value provided\";\n                    } else $scope.error = null;\n                }\n                function update(newValue) {\n                    // call $parsers pipeline then update $modelValue\n                    ngModelController.$setViewValue(newValue);\n                    // update the local view\n                    ngModelController.$render();\n                }\n                // when model change, update our view (just update the div content)\n                ngModelController.$render = function () {\n                    var value = ngModelController.$viewValue;\n                    //create copy of passed in model value that can be used\n                    // by the controls here allowing us to cancel and \n                    // commit changes at our own leisure\n                    $scope.innerValue = value;\n                    $scope.displayValue = value ? $filter('date')(ngModelController.$modelValue, $scope.format) : $scope.placeholder || \"No value provided\";\n                    validate(value);\n                };\n                $scope.isReadOnly = function () {\n                    var t = _typeof(this.readOnly);\n                    if (t === 'undefined') return false;\n                    if (t === 'string') return this.readOnly.toLowerCase() === 'true';\n                    if (t === 'number') return this.readOnly === 1;\n                    if (t === 'boolean') return this.readOnly;\n                    return false;\n                };\n                //enter edit mode\n                $scope.edit = function () {\n                    if ($scope.isReadOnly()) return;\n                    $scope.editing = true;\n                    //auto-focus on form-control when entering edit mode\n                    // $timeout(function() { $element.find('.form-control').focus().select(); }, 200);\n                };\n                //leave edit mode (regardless of save() or cancel())\n                $scope.done = function () {\n                    $scope.opened = false;\n                    $scope.editing = false;\n                    $scope.error = null;\n                };\n                $scope.save = function () {\n                    //update display with new value\n                    update($scope.innerValue);\n                    $scope.done();\n                };\n                $scope.cancel = function () {\n                    //reset inner value\n                    $scope.innerValue = angular.copy(ngModelController.$modelValue);\n                    $scope.done();\n                };\n                $scope.open = function () {\n                    //must wrap 'opened' variable in an object for \n                    // angular to properly track its value changes\n                    // from within children scope (ie, the date picker)\n                    if (typeof $scope.uibopts === 'undefined') {\n                        $scope.uibopts = {};\n                    }\n                    $scope.uibopts.opened = true;\n                };\n                $scope.onKeyUp = function (code) {\n                    if (code === 13) {\n                        $scope.done();\n                    } else if (code === 27) {\n                        $scope.cancel();\n                    }\n                };\n                $scope.onChange = function (date) {\n                    if (isNaN(ngModelController.$modelValue) && $scope.required) {\n                        $scope.error = \"This field requires a value\";\n                    } else $scope.error = null;\n                };\n            }\n        };\n    }]).directive('gpSlickFormSelect', ['$timeout', function ($timeout) {\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                codeList: \"=\",\n                help: '=',\n                required: \"@\",\n                readOnly: \"@\",\n                size: '@',\n                icon: '@'\n            },\n            template: SELECT_TEMPLATE,\n            link: function link($scope, $element, $attrs, ngModelController) {\n                if (!$scope.type) $scope.type = \"text\";\n                if ($scope.required === 'true') $scope.required = true;else $scope.required = false;\n                $scope.elId = 'input_' + Math.ceil(Math.random() * 9999);\n                $scope.size = $scope.size || 'medium';\n                $scope.type = $scope.type || 'text';\n                var $select = null;\n                function getSelect() {\n                    if (!$select || !$select.length) $select = $element.find('.form-control');\n                    return $select;\n                }\n                if ($scope.codeList) {\n                    $scope.selectOptions = $scope.codeList.map(function (item) {\n                        if ((typeof item === \"undefined\" ? \"undefined\" : _typeof(item)) !== 'object' || !item.value) return { value: item, label: item };else if (!item.label) return { value: item.value, label: item.value };\n                        return item;\n                    });\n                } else $scope.selectOptions = [];\n                //listen for changes to the inner value by way of the form-control\n                // $element.find('.form-control').on('change', function onChange() { \n                //     validate($scope.innerValue); \n                // });\n                /* ------------- private methods --------------- */\n                function validate() {\n                    //check form-control for ng-invalid\n                    var select = getSelect();\n                    $scope.isDirty = select.hasClass('ng-dirty');\n                    if (select.hasClass('ng-invalid')) {\n                        if (select.hasClass(\"ng-empty\")) $scope.error = \"This field requires a value\";else $scope.error = \"Invalid value provided\";\n                    } else $scope.error = null;\n                }\n                function update(newValue) {\n                    // call $parsers pipeline then update $modelValue\n                    ngModelController.$setViewValue(newValue);\n                    // update the local view\n                    ngModelController.$render();\n                }\n                // when model change, update our view (just update the div content)\n                ngModelController.$render = function () {\n                    var value = ngModelController.$viewValue;\n                    //@see https://github.com/angular/angular.js/commit/7fda214c4f65a6a06b25cf5d5aff013a364e9cef\n                    //create copy of passed in model value that can be used\n                    // by the controls here allowing us to cancel and \n                    // commit changes at our own leisure\n                    $scope.innerValue = value;\n                    $scope.displayValue = $scope.placeholder || \"No value provided\";\n                    if (value) {\n                        //values are objects, not literals\n                        var opt = $scope.selectOptions.find(function (o) {\n                            return o.value == value;\n                        });\n                        $scope.displayValue = opt.label;\n                    }\n                    validate();\n                };\n                /* ------------- private methods --------------- */\n                $scope.onChange = function (value) {\n                    // console.log(\"Changing value \" + value + \" vs \" + $scope.innerValue);\n                    $scope.innerValue = value;\n                    $timeout(function () {\n                        validate();\n                    }, 200);\n                };\n                $scope.onTypeaheadSelection = function ($item, $model, $label, $event) {\n                    $scope.innerValue = $item ? $item.value : null;\n                    $timeout(function () {\n                        validate();\n                    }, 200);\n                };\n                $scope.isReadOnly = function () {\n                    var t = _typeof(this.readOnly);\n                    if (t === 'undefined') return false;\n                    if (t === 'string') return this.readOnly.toLowerCase() === 'true';\n                    if (t === 'number') return this.readOnly === 1;\n                    if (t === 'boolean') return this.readOnly;\n                    return false;\n                };\n                //enter edit mode\n                $scope.edit = function () {\n                    if ($scope.isReadOnly()) return;\n                    $scope.editing = true;\n                    //auto-focus on form-control when entering edit mode\n                    $timeout(function () {\n                        $select.focus().select();\n                    }, 200);\n                };\n                //leave edit mode (regardless of save() or cancel())\n                $scope.done = function () {\n                    $scope.editing = false;\n                    $scope.error = null;\n                };\n                $scope.save = function () {\n                    //update display with new value\n                    update($scope.innerValue);\n                    $scope.done();\n                };\n                $scope.cancel = function () {\n                    //reset inner value\n                    $scope.innerValue = ngModelController.$viewValue;\n                    $scope.done();\n                };\n                $scope.onKeyUp = function (code) {\n                    if (code === 13 && !$scope.error) {\n                        $scope.save();\n                    } else if (code === 27) {\n                        $scope.cancel();\n                    }\n                };\n                $scope.onTypeaheadKeyUp = function (code) {\n                    validate();\n                };\n                $scope.$destroy = function () {\n                    // $element.off('change');\n                };\n            }\n        };\n    }]);\n    var INPUT_TEMPLATE = ['<div class=\"form-group form-group-slick\">', '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>', '   <div class=\"input__display\" ', '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error,\\'text-lg\\':size===\\'large\\'}\" ', '       ng-show=\"!editing\" ng-click=\"edit()\" ', '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">', '      {{displayValue}}', '   </div>', '   <div ng-show=\"editing\">', '      <div class=\"input-group\" ng-class=\"{\\'input-group-lg\\':size===\\'large\\'}\">', '           <div class=\"input-group-slick\" ng-class=\"{\\'input-group-slick--lg\\':size===\\'large\\'}\">', '               <span ng-if=\"icon\" class=\"{{::icon}}\"></span>', '               <input id=\"{{::elId}}\" type=\"{{::type}}\" class=\"form-control\" ', '                   pattern=\"{{pattern}}\" ', '                   ng-model=\"innerValue\" ', '                   ng-required=\"{{required}}\" ', '                   ng-keypress=\"onKeyPress($event, $event.keyCode)\" ', '                   ng-keyup=\"onKeyUp($event, $event.keyCode)\" >', '               <span class=\"indicators\">', '                   <span class=\"is-valid glyphicon glyphicon-ok-sign\"></span>', '                  <span class=\"is-invalid glyphicon glyphicon-exclamation-sign\"></span>', '              </span>', '           </div>', '          <span class=\"input-group-btn\">', '               <button type=\"button\" class=\"btn btn-default\" ', '                   ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"', '                   ng-click=\"cancel()\" title=\"Cancel changes\">', '                   <span class=\"glyphicon glyphicon-ban-circle\"></span>', '              </button>', '               <button type=\"button\" class=\"btn btn-default\" ', '                   ng-class=\"{disabled:!!error||!isDirty,\\'btn-lg\\':size===\\'large\\'}\"', '                   ng-disabled=\"{{!!error}}\" ', '                   ng-click=\"save()\" title=\"Save changes\">', '                  <span class=\"glyphicon glyphicon-ok\"></span>', '               </button>', '           </span>', '       </div>', '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>', '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>', '   </div>', '</div>'].join(' ');\n    var TEXTAREA_TEMPLATE = ['<div class=\"form-group form-group-slick\">', '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>', '   <div class=\"input__display\" ', '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error,\\'text-lg\\':size===\\'large\\'}\" ', '       ng-show=\"!editing\" ng-click=\"edit()\" ', '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">', '      {{displayValue}}', '   </div>', '   <div ng-show=\"editing\">', '      <div class=\"input-group\" ng-class=\"{\\'input-group-lg\\':size===\\'large\\'}\">', '           <div class=\"input-group-slick\" ng-class=\"{\\'input-group-slick--lg\\':size===\\'large\\'}\">', '               <span ng-if=\"icon\" class=\"{{::icon}}\"></span>', '               <textarea rows=\"3\" id=\"{{::elId}}\" class=\"form-control\" ', '                   ng-required=\"{{required}}\" ng-model=\"innerValue\"', '                   ng-keypress=\"onKeyPress($event, $event.keyCode)\" ', '                   ng-keyup=\"onKeyUp($event, $event.keyCode)\"></textarea>', '               <span class=\"indicators\">', '                   <span class=\"is-valid glyphicon glyphicon-ok-sign\"></span>', '                  <span class=\"is-invalid glyphicon glyphicon-exclamation-sign\"></span>', '              </span>', '           </div>', '          <span class=\"input-group-btn\">', '               <button type=\"button\" class=\"btn btn-default\" ', '                   ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"', '                   ng-click=\"cancel()\" title=\"Cancel changes\">', '                   <span class=\"glyphicon glyphicon-ban-circle\"></span>', '              </button>', '               <button type=\"button\" class=\"btn btn-default\" ', '                   ng-class=\"{disabled:!!error||!isDirty,\\'btn-lg\\':size===\\'large\\'}\"', '                   ng-disabled=\"{{!!error}}\" ', '                   ng-click=\"save()\" title=\"Save changes\">', '                  <span class=\"glyphicon glyphicon-ok\"></span>', '               </button>', '           </span>', '       </div>', '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>', '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>', '   </div>', '</div>'].join(' ');\n    var DATE_TEMPLATE = ['<div class=\"form-group form-group-slick\">', '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>', '   <div class=\"input__display\" ', '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error}\" ', '       ng-show=\"!editing\" ng-click=\"edit()\" ', '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">', '      {{displayValue}}', '   </div>', '   <div ng-show=\"editing\">', '       <div uib-datepicker ng-required=\"{{required}}\" ng-model=\"innerValue\" datepicker-options=\"{showWeeks:false}\"></div>', '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>', '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>', '       <button type=\"button\" class=\"btn btn-default\" ', '           ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"', '           ng-click=\"cancel()\" title=\"Cancel changes\">', '           <span class=\"glyphicon glyphicon-ban-circle\"></span>', '      </button>', '      <button type=\"button\" class=\"btn btn-default\" ', '           ng-class=\"{disabled:!!error,\\'btn-lg\\':size===\\'large\\'}\"', '          ng-disabled=\"{{!!error}}\" ', '           ng-click=\"save()\" title=\"Save changes\">', '           <span class=\"glyphicon glyphicon-ok\"></span>', '      </button>', '   </div>', '</div>'].join(' ');\n    var SELECT_TEMPLATE = ['<div class=\"form-group form-group-slick\">', '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>', '   <div class=\"input__display\" ', '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error}\" ', '       ng-show=\"!editing\" ng-click=\"edit()\" ', '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">', '      {{displayValue}}', '   </div>', '   <div ng-show=\"editing\">', '      <div class=\"input-group\" ng-class=\"{\\'input-group-lg\\':size===\\'large\\'}\">', '           <div class=\"input-group-slick\" ng-class=\"{\\'input-group-slick--lg\\':size===\\'large\\'}\">', '               <span ng-if=\"icon\" class=\"{{::icon}}\"></span>', '               <select class=\"form-control input__field\" ', '                   ng-if=\"codeList.length<=12\" ', '                   ng-model=\"innerValue\" ', '                   ng-options=\"opt.value as opt.label for opt in selectOptions\" ', '                   ng-required=\"{{required}}\" ', '                   ng-change=\"onChange(innerValue)\" ', '                   ng-keyUp=\"onKeyUp($event.keyCode)\" >', '                   <option value=\"\">Select One</option>', '               </select>', '               <input type=\"text\" class=\"form-control input__field\" ng-if=\"codeList.length>12\" ', '                   ng-model=\"innerValue\" ', '                   ng-required=\"{{required}}\" ', '                   ng-keyUp=\"onTypeaheadKeyUp($event.keyCode)\" ', '                   typeahead-on-select=\"onTypeaheadSelection($item, $model, $label, $event)\" ', '                   uib-typeahead=\"opt.value as opt.label for opt in selectOptions | filter:{value:$viewValue} | limitTo:12\" ', '                   typeahead-min-length=\"0\" ', '                   typeahead-editable=\"false\">', '               <span class=\"indicators\">', '                   <span class=\"is-valid glyphicon glyphicon-ok-sign\"></span>', '                  <span class=\"is-invalid glyphicon glyphicon-exclamation-sign\"></span>', '              </span>', '           </div>', '          <span class=\"input-group-btn\">', '               <button type=\"button\" class=\"btn btn-default\" ', '                   ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"', '                   ng-click=\"cancel()\" title=\"Cancel changes\">', '                   <span class=\"glyphicon glyphicon-ban-circle\"></span>', '              </button>', '               <button type=\"button\" class=\"btn btn-default\" ', '                   ng-class=\"{disabled:!!error||!isDirty,\\'btn-lg\\':size===\\'large\\'}\"', '                   ng-disabled=\"{{!!error}}\" ', '                   ng-click=\"save()\" title=\"Save changes\">', '                  <span class=\"glyphicon glyphicon-ok\"></span>', '               </button>', '           </span>', '       </div>', '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>', '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>', '   </div>', '</div>'].join(' ');\n})(jQuery, angular);\n\n(function (angular) {\n    \"use strict\";\n\n    angular.module(\"gp-common\").directive('gpTweetButton', ['$timeout', function ($timeout) {\n        function debounce(func, wait, immediate) {\n            var timeout;\n            return function () {\n                var context = this,\n                    args = arguments;\n                var later = function later() {\n                    timeout = null;\n                    if (!immediate) func.apply(context, args);\n                };\n                var callNow = immediate && !timeout;\n                clearTimeout(timeout);\n                timeout = setTimeout(later, wait);\n                if (callNow) func.apply(context, args);\n            };\n        }\n        return {\n            link: function link(scope, element, attr) {\n                if (typeof twttr === 'undefined') {\n                    element.className += ' disabled';\n                    return;\n                }\n                var renderTwitterButton = debounce(function () {\n                    if (attr.url) {\n                        $timeout(function () {\n                            element[0].innerHTML = '';\n                            twttr.widgets.createShareButton(attr.url, element[0], function () {}, {\n                                count: attr.count,\n                                text: attr.text,\n                                via: attr.via,\n                                size: attr.size,\n                                hashtags: attr.hashtags,\n                                dnt: attr.dnt\n                            });\n                        });\n                    }\n                }, 75);\n                attr.$observe('url', renderTwitterButton);\n                attr.$observe('text', renderTwitterButton);\n            }\n        };\n    }]);\n})(angular);\n\n(function (angular) {\n    \"use strict\";\n\n    angular.module(\"gp-common\").directive('sortOrder', function () {\n        return {\n            replace: true,\n            require: 'ngModel',\n            template: ['<div>', '<a class=\"btn btn-default\" title=\"Click to sort in ascending order\" href ng-if=\"value===\\'dsc\\'\" ng-click=\"toggle()\">', '    <span class=\"glyphicon glyphicon-sort-by-attributes-alt\"></span>', '</a>', '<a class=\"btn btn-default\" title=\"Click to sort in descending order\" href ng-if=\"value===\\'asc\\'\" ng-click=\"toggle()\">', '    <span class=\"glyphicon glyphicon-sort-by-attributes\"></span>', '</a>', '</div>'].join(' '),\n            link: function link($scope, element, attrs, ngModel) {\n                ngModel.$viewChangeListeners.push(function () {\n                    $scope.$eval(attrs.ngChange);\n                });\n                ngModel.$render = function () {\n                    $scope.value = ngModel.$modelValue;\n                };\n                $scope.toggle = function () {\n                    $scope.value = $scope.value === 'asc' ? 'dsc' : 'asc';\n                    ngModel.$setViewValue($scope.value);\n                };\n            }\n        };\n    });\n})(angular);\n\n(function (angular) {\n    'use strict';\n    /**\n     * directive used in conjunction with ng-model to map arrays of strings\n     * to form field controls for editing.\n     *\n     * Usage:  <input ng-model=\"arrOfStr\" string-array-input></input>\n     *\n     */\n\n    angular.module('gp-common').directive('stringArrayInput', function () {\n        return {\n            restrict: 'A',\n            require: 'ngModel',\n            link: function link(scope, element, attr, ngModel) {\n                function fromInput(text) {\n                    var result = null;\n                    if (text && text.length) result = text.split(',').map(function (i) {\n                        return i.trim();\n                    });\n                    return result;\n                }\n                function toInput(arr) {\n                    var result = null;\n                    if (arr && typeof arr.push !== 'undefined') result = arr.join(', ');\n                    return result;\n                }\n                ngModel.$parsers.push(fromInput);\n                ngModel.$formatters.push(toInput);\n            }\n        };\n    });\n})(angular);\n\n(function (jQuery, angular) {\n    \"use strict\";\n\n    angular.module(\"gp-common\").filter('fixLabel', function () {\n        return function (value) {\n            if (!value || typeof value !== 'string' || !value.length) return 'Untitled';\n            var result = value.replace(/([a-z])([A-Z])/g, \"$1 $2\").replace(/_/g, \" \").trim();\n            return result.charAt(0).toUpperCase() + result.slice(1);\n        };\n    }).filter('pluralize', function () {\n        return function (text) {\n            if (!text || !text.length) return \"\";\n            if (text.endsWith('ss')) return text + 'es'; //classes, etc\n            if (text.endsWith('s')) return text; //already plural\n            return text + 's';\n            //TODO support irregular words like \"foot\" -> \"feet\"\n            // and words that need duplicate letters: \"quiz\" -> \"quizzes\"\n        };\n    }).filter('capitalize', function () {\n        return function (text) {\n            return text[0].toUpperCase() + text.substring(1);\n        };\n    }).filter('facets', function () {\n        return function (arr, facetName) {\n            if (!facetName) return arr;\n            if (!arr || !arr.length) return [];\n            return arr.filter(function (f) {\n                return f.toLowerCase().startsWith(facetName + \":\");\n            }).map(function (f) {\n                return f.substring(f.indexOf(':') + 1, f.length);\n            });\n        };\n    }).filter('joinBy', function () {\n        return function (input, delimiter, emptyValue) {\n            if (input && typeof input.push !== 'undefined' && input.length) return input.join(delimiter || ', ');else return emptyValue || '';\n        };\n    }).filter('defaultValue', function () {\n        return function (text, defVal) {\n            if (typeof text === 'undefined' || !text.length) return defVal;\n            return text;\n        };\n    }).filter('count', function () {\n        return function (input) {\n            if (typeof input !== 'undefined') {\n                if (typeof input.push === 'function') return input.length;\n                if ((typeof input === \"undefined\" ? \"undefined\" : _typeof(input)) === 'object') {\n                    if (typeof Object.keys !== 'undefined') {\n                        return Object.keys(input);\n                    }\n                }\n            }\n            return 0;\n        };\n    }).filter('gpObjTypeMapper', function () {\n        return function (str) {\n            if (!str || typeof str !== 'string' || str.length === 0) return str;\n            var name = str;\n            var idx = str.indexOf(\":\");\n            if (~idx) name = str.substring(idx + 1);\n            if ('VCard' === name) return 'Contact';\n            return name;\n        };\n    }).filter('gpReliabilityGrade', function () {\n        return function (arg) {\n            var o = arg;\n            if ((typeof o === \"undefined\" ? \"undefined\" : _typeof(o)) === 'object') {\n                if (o.statistics) o = o.statistics.reliability || null;else if (o.reliability) o = o.reliability;else o = null;\n            }\n            if (!isNaN(o)) {\n                o = o * 1;\n                if (o === null || typeof o === 'undefined') return 'X';else if (o > 90) return 'A';else if (o > 80) return 'B';else if (o > 70) return 'C';else if (o > 60) return 'D';else return 'F';\n                // if (value >= 97) letter = 'A+';\n                // else if (value >= 93) letter = 'A';\n                // else if (value >= 90) letter = 'A-';\n                // else if (value >= 87) letter = 'B+';\n                // else if (value >= 83) letter = 'B';\n                // else if (value >= 80) letter = 'B-';\n                // else if (value >= 77) letter = 'C+';\n                // else if (value >= 73) letter = 'C';\n                // else if (value >= 70) letter = 'C-';\n                // else if (value >= 67) letter = 'D+';\n                // else if (value >= 63) letter = 'D';\n                // else if (value >= 60) letter = 'D-';\n            }\n            return \"X\";\n        };\n    });\n})(jQuery, angular);\n\n(function (angular, Constants) {\n    'use strict';\n\n    var KGEditor = /** @class */function () {\n        function KGEditor($rootScope, $element, KGFields, KGHelper) {\n            'ngInject';\n\n            this.$rootScope = $rootScope;\n            this.$element = $element;\n            this.fields = KGFields.slice(0);\n            this.helper = KGHelper;\n        }\n        KGEditor.prototype.$onInit = function () {\n            this.displayOptions = {};\n            this.completion = 0;\n            this.service = this.helper.getService(this.ngModel.type);\n            this.descriptions = {\n                purpose: 'The intended use or reason for the Object (i.e., layer, map, gallery) e.g., environmental impact of an oil spill.',\n                'function': 'The business actions, activities, or tasks this Object is intended to support (i.e., the role it plays in supporting an activity).  e.g., environmental impact assessment.',\n                audience: 'The group of people for which this Object was intended to be used. e.g., general public, disaster recovery personnel, Congress.',\n                community: 'The GeoPlatform community this Object was produced for. e.g., \"Ecosystems and Biodiversity\" community',\n                place: 'The central locale or common names for the place where the Subjects of the Object occur. e.g.,  USA/Gulf Coast',\n                category: 'The type or category of the Object.  e.g., topographic map, elevation layer',\n                primarySubject: 'The selected things, events, or concepts forming part of or represented by the Object. e.g., Deep Water Horizon oil rig, oil slick extent, oil slick movement over time, predicted oil slick movement, impacted sites, impact severity.',\n                secondarySubject: 'Second-order subjects derived by machine processing/ analysis of the target Object',\n                primaryTopic: 'The central branch of knowledge or theme pertaining to the thing, concept, situation, issue, or event of interest. e.g., environmental impact of oil spill.',\n                secondaryTopic: 'Second-order topics derived by machine processing/ analysis of the target Object'\n            };\n            if (!this.ngModel.classifiers) this.ngModel.classifiers = {};\n            this.calculatePercentage();\n        };\n        KGEditor.prototype.$onDestroy = function () {\n            this.$rootScope = null;\n            this.ngModel = null;\n            this.helper = null;\n            this.fields = null;\n            this.service = null;\n        };\n        /**\n         * @param {string} property - name of KG property being modified\n         * @param {array[object]} values - new values to assign to the property (includes old values)\n         */\n        KGEditor.prototype.onChange = function (property, values) {\n            // console.log(\"Changed \" + property + \" with \" + (values?values.length:0) + \" values\");\n            this.ngModel.classifiers[property] = values;\n            this.calculatePercentage();\n        };\n        /**\n         * @param {string} classifier - KG property whose value has been activated\n         * @param {object} value - selected value being activated\n         */\n        KGEditor.prototype.onValueClick = function (classifier, value) {\n            if (this.onActivate) {\n                this.onActivate({ classifier: classifier, value: value });\n            }\n        };\n        /**\n         *\n         */\n        KGEditor.prototype.calculatePercentage = function () {\n            this.completion = this.helper.calculate(this.ngModel.classifiers);\n        };\n        return KGEditor;\n    }();\n    angular.module('gp-common-kg').component('kgEditor', {\n        require: {\n            // formCtrl: '^form', \n            ngModelCtrl: 'ngModel'\n        },\n        bindings: {\n            ngModel: '=',\n            onActivate: '&' //function to invoke on KG item activation (click)\n        },\n        controller: KGEditor,\n        template: \"\\n            <div class=\\\"c-kg-editor\\\">\\n                <div class=\\\"c-kg-editor__header l-flex-container flex-justify-between flex-align-center\\\">\\n                    <div class=\\\"flex-1\\\">\\n                        <h4>Knowledge Graph</h4>\\n                        <div class=\\\"u-text--sm\\\">\\n                            Knowledge graphs (KGs) are formed from classifiers for several dimensions of GeoPlatform items \\n                            (layers, maps, galleries, etc), including <em>Purpose</em>, <em>Scope</em>, \\n                            <em>Fitness for Use</em>, and <em>Social Context</em>. \\n                            <br>\\n                            <br>\\n                            Knowledge graphs are used to answer questions about items, such as:\\n                            <ul>\\n                            <li>Why was the item created?</li>\\n                            <li>Why is it useful for others?</li>\\n                            <li>Why is it appropriate to be used?</li>\\n                            </ul>\\n                        </div>\\n                    </div>\\n                    <gp-progress-circle ng-model=\\\"$ctrl.completion\\\" class=\\\"u-mg-left--xlg u-mg-right--xlg\\\"></gp-progress-circle>\\n                </div>\\n\\n                <div class=\\\"c-kg-editor__content\\\">\\n\\n                    <div class=\\\"c-kg-editor__section\\\">\\n                        <h4 class=\\\"t-fg--accent\\\">Purpose</h4>\\n\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.purposes\\\"\\n                            on-change=\\\"$ctrl.onChange('purposes', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('purposes', value)\\\"\\n                            type=\\\"Purpose\\\"\\n                            label=\\\"Purpose\\\" \\n                            description=\\\"{{$ctrl.descriptions.purpose}}\\\">\\n                        </kg-section>\\n                    </div>\\n\\n\\n                    <div class=\\\"c-kg-editor__section\\\">\\n                        <h4 class=\\\"t-fg--accent\\\">Scope</h4>\\n\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.primaryTopics\\\"\\n                            on-change=\\\"$ctrl.onChange('primaryTopics', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('primaryTopics', value)\\\"\\n                            type=\\\"Topic\\\" \\n                            label=\\\"Primary Topics\\\" \\n                            description=\\\"{{$ctrl.descriptions.primaryTopic}}\\\">\\n                        </kg-section>\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.secondaryTopics\\\"\\n                            on-change=\\\"$ctrl.onChange('secondaryTopics', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('secondaryTopics', value)\\\"\\n                            type=\\\"Topic\\\" \\n                            label=\\\"Secondary Topics\\\" \\n                            description=\\\"{{$ctrl.descriptions.secondaryTopic}}\\\">\\n                        </kg-section>\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.primarySubjects\\\"\\n                            on-change=\\\"$ctrl.onChange('primarySubjects', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('primarySubjects', value)\\\"\\n                            type=\\\"Subject\\\" \\n                            label=\\\"Primary Subjects\\\" \\n                            description=\\\"{{$ctrl.descriptions.primarySubject}}\\\">\\n                        </kg-section>\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.secondarySubjects\\\"\\n                            on-change=\\\"$ctrl.onChange('secondarySubjects', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('secondarySubjects', value)\\\"\\n                            type=\\\"Subject\\\" \\n                            label=\\\"Secondary Subjects\\\" \\n                            description=\\\"{{$ctrl.descriptions.secondarySubject}}\\\">\\n                        </kg-section>\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.categories\\\"\\n                            on-change=\\\"$ctrl.onChange('categories', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('categories', value)\\\"\\n                            type=\\\"Category\\\" \\n                            label=\\\"Categories\\\" \\n                            description=\\\"{{$ctrl.descriptions.category}}\\\">\\n                        </kg-section>\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.communities\\\"\\n                            on-change=\\\"$ctrl.onChange('communities', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('communities', value)\\\"\\n                            type=\\\"Community\\\" \\n                            label=\\\"Communities\\\" \\n                            description=\\\"{{$ctrl.descriptions.community}}\\\">\\n                        </kg-section>\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.places\\\"\\n                            on-change=\\\"$ctrl.onChange('places', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('places', value)\\\"\\n                            type=\\\"Place\\\" \\n                            label=\\\"Places\\\" \\n                            description=\\\"{{$ctrl.descriptions.place}}\\\">\\n                        </kg-section> \\n                    </div> \\n\\n                    <div class=\\\"c-kg-editor__section\\\">\\n                        <h4 class=\\\"t-fg--accent\\\">Fitness for Use</h4>\\n\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.functions\\\"\\n                            on-change=\\\"$ctrl.onChange('functions', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('functions', value)\\\"\\n                            type=\\\"Function\\\" \\n                            label=\\\"Function\\\" \\n                            description=\\\"{{$ctrl.descriptions.function}}\\\">\\n                        </kg-section>\\n                    </div>\\n\\n                    <div class=\\\"c-kg-editor__section\\\">\\n                        <h4 class=\\\"t-fg--accent\\\">Social Context</h4>\\n\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.audiences\\\"\\n                            on-change=\\\"$ctrl.onChange('audiences', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('audiences', value)\\\"\\n                            type=\\\"Audience\\\" \\n                            label=\\\"Audiences\\\" \\n                            description=\\\"{{$ctrl.descriptions.audience}}\\\">\\n                        </kg-section>\\n                    </div>\\n\\n                </div>\\n            </div>\\n        \"\n    });\n})(angular, GeoPlatform);\n\n(function (angular, Constants) {\n    'use strict';\n\n    var SectionController = /** @class */function () {\n        function SectionController($timeout, RecommenderService) {\n            'ngInject';\n\n            this.$timeout = $timeout;\n            // this.service = RecommenderService;\n        }\n        SectionController.prototype.$onInit = function () {\n            this.noResults = false;\n            this.query = '';\n            this.displayOptions = {\n                fetching: false,\n                showSuggested: false\n            };\n            this.paging = {\n                start: 0,\n                size: 5,\n                sizeOptions: [5, 10, 20]\n            };\n            this.updateCache();\n            //default section description if one was not provided\n            if (!this.description) this.description = '<em>No description provided</em>';\n        };\n        /**\n         * Update cache when bound 'ngModel' is actually assigned in the component lifecycle\n         */\n        SectionController.prototype.$onChanges = function () {\n            this.updateCache();\n        };\n        SectionController.prototype.$onDestroy = function () {\n            this.eventHandlers = null;\n            this.clearOptions();\n            this.selected = null;\n            this.service = null;\n            this.$timeout = null;\n        };\n        /**\n         *\n         * @param {object} item - selected value being activated (clicked on for navigation)\n         */\n        SectionController.prototype.activate = function (item) {\n            if (this.onActivate) this.onActivate({ value: item });\n        };\n        SectionController.prototype.on = function (event, callback) {\n            this.eventHandlers = this.eventHandlers || {};\n            this.eventHandlers[event] = this.eventHandlers[event] || [];\n            this.eventHandlers[event].push(callback);\n        };\n        SectionController.prototype.notify = function (event, data) {\n            if (!this.eventHandlers || !this.eventHandlers[event]) return;\n            angular.forEach(this.eventHandlers[event], function (handler) {\n                try {\n                    handler(data);\n                } catch (e) {}\n            });\n        };\n        /**\n         * @param {string} query - keywords provided by user input\n         * @return {Promise} resolving an array of results\n         */\n        SectionController.prototype.fetchOptions = function (query) {\n            var _this = this;\n            //need this timeout or else 'this.query' isn't being \n            // seen as having the same value as 'query'\n            this.$timeout(function () {\n                _this.query = query;\n            }, 10);\n            this.displayOptions.fetching = true;\n            var params = {\n                type: this.type,\n                q: query,\n                page: Math.floor(this.paging.start / this.paging.size),\n                size: this.paging.size\n            };\n            // if(this.forType)\n            //     params['for'] = this.forType;\n            return this.service.query(params).$promise.then(function (response) {\n                _this.paging.total = response.totalResults;\n                _this.notify('gp:browse:suggestions:pagination', _this.paging);\n                _this.suggested = response.results.map(function (result) {\n                    result._selected = _this.isSelected(result);\n                    return result;\n                });\n                _this.displayOptions.showSuggested = true;\n                return _this.suggested;\n            }).catch(function (e) {\n                _this.paging.total = 0;\n                _this.notify('gp:browse:suggestions:pagination', _this.paging);\n                _this.suggested = [];\n                return _this.suggested;\n            }).finally(function () {\n                return _this.displayOptions.fetching = false;\n            });\n        };\n        SectionController.prototype.clearQuery = function () {\n            this.query = '';\n            this.fetchOptions(this.query);\n        };\n        SectionController.prototype.clearOptions = function () {\n            //clear query and available options\n            this.query = '';\n            this.suggested = null;\n            //reset paging\n            this.paging.start = 0;\n            this.paging.total = 0;\n            // this.notify('gp:browse:suggestions:pagination', this.paging);\n            //hide available options\n            this.displayOptions.showSuggested = false;\n        };\n        /**\n         * @param {integer} index - position in selected array of item removed\n         */\n        SectionController.prototype.remove = function (index) {\n            var removed = this.ngModel[index].uri;\n            this.ngModel.splice(index, 1);\n            //remove from suggested list if one is populated (being shown)\n            if (this.suggested && this.suggested.length) {\n                var found = this.suggested.find(function (it) {\n                    return it.uri === removed;\n                });\n                if (found) found._selected = false;\n            }\n            this.updateCache(); //update cache of selected ids\n            if (this.onChange) this.onChange({ values: this.ngModel }); //notify others of change\n        };\n        /**\n         * @param {object} value - item being checked for selection\n         * @return {boolean}\n         */\n        SectionController.prototype.isSelected = function (value) {\n            return value._selected || ~this.selected.indexOf(value.uri);\n        };\n        /**\n         * @param {object} value - item being selected\n         */\n        SectionController.prototype.selectValue = function (value) {\n            if (value._selected) return; //already selected\n            value._selected = true;\n            this.ngModel = this.ngModel || [];\n            this.ngModel.push(value);\n            this.updateCache();\n            if (this.onChange) this.onChange({ values: this.ngModel });\n        };\n        SectionController.prototype.updateCache = function () {\n            this.selected = (this.ngModel || []).map(function (o) {\n                return o.uri;\n            });\n        };\n        SectionController.prototype.onDropdownToggled = function (open) {\n            if (!open) this.clearOptions();\n        };\n        /* -------- pagination methods ----------- */\n        SectionController.prototype.getPagination = function () {\n            return this.paging;\n        };\n        SectionController.prototype.start = function (index) {\n            this.paging.start = index;\n            this.fetchOptions(this.query);\n        };\n        SectionController.prototype.size = function (value) {\n            this.paging.size = value;\n            this.fetchOptions(this.query);\n        };\n        return SectionController;\n    }();\n    angular.module('gp-common-kg').component('kgSection', {\n        bindings: {\n            ngModel: '<',\n            service: '<',\n            label: '@',\n            description: '@',\n            type: '@',\n            onChange: '&?',\n            onActivate: '&?' //fire when selected value link is clicked\n        },\n        controller: SectionController,\n        template: \"\\n            <h5>{{$ctrl.label}}</h5>\\n            <p class=\\\"u-text--sm\\\" ng-bind-html=\\\"$ctrl.description\\\"></p>\\n\\n            <div class=\\\"list-group list-group-sm\\\">\\n                <div ng-repeat=\\\"item in $ctrl.ngModel track by $index\\\" class=\\\"list-group-item\\\">\\n                    <button type=\\\"button\\\" class=\\\"btn btn-link\\\" ng-click=\\\"$ctrl.remove($index)\\\">\\n                        <span class=\\\"glyphicon glyphicon-remove-circle t-fg--danger\\\"></span> \\n                    </button>\\n                    <div class=\\\"flex-1 u-pd--md\\\">\\n                        <div class=\\\"u-pd-bottom--sm t-text--strong\\\">\\n                            <a ng-click=\\\"$ctrl.activate(item)\\\" ng-if=\\\"$ctrl.onActivate\\\"\\n                                 class=\\\"u-break--all\\\">{{item.label}}</a>\\n                            <span ng-if=\\\"!$ctrl.onActivate\\\">{{item.label}}</span>\\n                        </div>\\n                        <div class=\\\"u-text--sm t-text--italic\\\">\\n                            <a href=\\\"{{item.uri}}\\\" target=\\\"_blank\\\" class=\\\"u-break--all\\\"\\n                                title=\\\"Open source info in new window\\\">{{item.uri}}</a>\\n                        </div>\\n                        <div class=\\\"description\\\" ng-if=\\\"item.description\\\" ng-bind-html=\\\"item.description\\\"></div>\\n                    </div>\\n                </div>\\n            </div>\\n\\n            <div class=\\\"t-fg--gray-md\\\" ng-if=\\\"!$ctrl.ngModel.length\\\"><em>No values specified</em></div>            \\n\\n            <hr>\\n\\n            <div uib-dropdown is-open=\\\"$ctrl.displayOptions.showSuggested\\\" \\n                auto-close=\\\"outsideClick\\\" on-toggle=\\\"$ctrl.onDropdownToggled(open)\\\">\\n\\n                <div class=\\\"l-flex-container flex-justify-between flex-align-center\\\">\\n                    <div class=\\\"input-group-slick flex-1\\\">\\n                        <span class=\\\"glyphicon\\\"\\n                            ng-class=\\\"{'glyphicon-search':!$ctrl.displayOptions.fetching, 'glyphicon-hourglass spin':$ctrl.displayOptions.fetching}\\\"></span>\\n                        <input type=\\\"text\\\" class=\\\"form-control\\\" \\n                            ng-model=\\\"$ctrl.query\\\" \\n                            ng-model-options=\\\"{ debounce: 250 }\\\"\\n                            ng-change=\\\"$ctrl.fetchOptions($ctrl.query)\\\"\\n                            placeholder=\\\"Find values to add...\\\">\\n                    </div>\\n                </div>\\n                \\n                <div class=\\\"dropdown-menu\\\" uib-dropdown-menu>\\n                    \\n                    <div class=\\\"form-group l-flex-container flex-justify-between flex-align-center\\\">\\n                        <div class=\\\"input-group-slick flex-1\\\">\\n                            <span class=\\\"glyphicon\\\"\\n                                ng-class=\\\"{'glyphicon-search':!$ctrl.displayOptions.fetching, 'glyphicon-hourglass spin':$ctrl.displayOptions.fetching}\\\"></span>\\n                            <input type=\\\"text\\\" class=\\\"form-control\\\" \\n                                ng-model=\\\"$ctrl.query\\\" \\n                                ng-model-options=\\\"{ debounce: 250 }\\\"\\n                                ng-change=\\\"$ctrl.fetchOptions($ctrl.query)\\\"\\n                                placeholder=\\\"Find values to add...\\\">\\n                            <span class=\\\"glyphicon glyphicon-remove\\\"\\n                                ng-if=\\\"$ctrl.query.length\\\"\\n                                ng-click=\\\"$event.stopPropagation();$ctrl.clearQuery()\\\"></span>\\n                        </div>\\n                        <button type=\\\"button\\\" class=\\\"btn btn-info u-mg-left--xlg animated-show\\\"\\n                            ng-click=\\\"$ctrl.clearOptions();\\\">\\n                            Done\\n                        </button>\\n                    </div>\\n                    \\n                    <gp-pagination service=\\\"$ctrl\\\" event-key=\\\"suggestions\\\" use-select=\\\"true\\\"></gp-pagination>\\n\\n                    <div class=\\\"list-group list-group-sm u-text--sm\\\">\\n                        <div ng-repeat=\\\"item in $ctrl.suggested track by $index\\\" class=\\\"list-group-item\\\">\\n                            <button type=\\\"button\\\" class=\\\"btn btn-link\\\" ng-click=\\\"$ctrl.selectValue(item)\\\"\\n                                ng-class=\\\"{disabled:item._selected}\\\">\\n                                <span class=\\\"glyphicon glyphicon-ok t-fg--gray-md\\\" ng-show=\\\"item._selected\\\"></span> \\n                                <span class=\\\"glyphicon glyphicon-plus-sign t-fg--success\\\" ng-show=\\\"!item._selected\\\"></span> \\n                            </button>\\n                            <div class=\\\"flex-1 u-pd--md\\\">\\n                                <div class=\\\"u-break--all t-text--strong u-pd-bottom--sm\\\">{{item.prefLabel}}</div>\\n                                <a href=\\\"{{item.uri}}\\\" target=\\\"_blank\\\" \\n                                    class=\\\"u-break--all u-text--sm t-text--italic\\\"\\n                                    title=\\\"Open source info in new window\\\">\\n                                    {{item.uri}}\\n                                </a>\\n                                <div class=\\\"description\\\">{{item.description||\\\"No description provided\\\"}}</div>\\n                            </div>\\n                        </div>\\n                        <div ng-if=\\\"!$ctrl.suggested.length\\\" class=\\\"list-group-item disabled u-pd--md\\\">\\n                            No results match your query\\n                        </div>\\n                    </div>\\n                </div>\\n            </div>\\n        \"\n    });\n})(angular, GeoPlatform);\n\n(function (angular, Constants) {\n    'use strict';\n\n    var FACET_NAME = 'usedBy.id';\n    angular.module('gp-common').component('communityFilter', {\n        bindings: {\n            name: '@',\n            service: \"<\"\n        },\n        controller: function controller($http) {\n            this.$onInit = function () {\n                this.collapse = true;\n                this.updateValues();\n            };\n            this.$onDestroy = function () {\n                this.values = null;\n            };\n            this.hasSelections = function () {\n                return (this.service.getUsedBy() || []).length;\n            };\n            this.isSelected = function (value) {\n                var selected = this.service.getUsedBy() || [];\n                return ~selected.indexOf(value.id);\n            };\n            this.toggle = function (value) {\n                var selected = this.service.getUsedBy() || [];\n                var idx = selected.indexOf(value.id);\n                if (idx >= 0) selected.splice(idx, 1);else selected.push(value.id);\n                this.service.setUsedBy(selected);\n            };\n            this.clear = function () {\n                var selected = this.service.getUsedBy() || [];\n                if (!selected || !selected.length) this.collapse = !this.collapse; //toggle collapsed state\n                else this.service.setUsedBy([]);\n            };\n            this.getCount = function (value) {\n                var facet = this.service.getFacet(FACET_NAME);\n                if (!facet) return '';\n                var valObj = facet.buckets.find(function (v) {\n                    return v.label === value.id;\n                });\n                if (!valObj) return '';\n                return valObj.count;\n            };\n            this.updateValues = function (query) {\n                var _this = this;\n                return $http.get(Constants.ualUrl + '/api/communities', {\n                    params: {\n                        sort: 'label,asc',\n                        q: query,\n                        size: 20,\n                        bust: new Date().getTime()\n                    }\n                }).then(function (response) {\n                    var total = response.data.totalResults;\n                    var newValues = response.data.results.slice(0);\n                    _this.additionalValueCount = total - newValues.length;\n                    var selections = _this.service.getUsedBy();\n                    if (selections && selections.length && _this.values && _this.values.length) {\n                        var existing = _this.values.filter(function (v) {\n                            //find existing values that are selected\n                            return ~selections.indexOf(v.id) &&\n                            // but not in new set of values\n                            !newValues.filter(function (nv) {\n                                return nv.id === v.id;\n                            }).length;\n                        });\n                        newValues = existing.concat(newValues);\n                    }\n                    _this.values = newValues;\n                }).catch(function (response) {\n                    console.log(\"(\" + response.status + \") \" + response.statusText);\n                });\n            };\n        },\n        template: \"\\n            <div class=\\\"card\\\">\\n                <h5 class=\\\"card-title l-flex-container flex-justify-between flex-align-center\\\">\\n                    <span class=\\\"flex-1\\\">Filter by Communities</span>\\n                    <button type=\\\"button\\\" class=\\\"btn btn-sm btn-link\\\"\\n                        title=\\\"{{$ctrl.collapse?'Expand':'Collapse'}}\\\"\\n                        ng-click=\\\"$ctrl.collapse = !$ctrl.collapse\\\">\\n                        <span class=\\\"glyphicon\\\" ng-class=\\\"{'glyphicon-chevron-up':!$ctrl.collapse,'glyphicon-chevron-down':$ctrl.collapse}\\\"></span>\\n                    </button>\\n                </h5>\\n                <div class=\\\"card-content\\\">\\n                    <div class=\\\"c-facets\\\" ng-class=\\\"{'is-collapsed':$ctrl.collapse}\\\">\\n\\n                        <div class=\\\"c-facet__value\\\">\\n                            <div class=\\\"input-group-slick\\\">\\n                                <input name=\\\"scheme-typeahead\\\" type=\\\"text\\\" class=\\\"form-control\\\"\\n                                    ng-model=\\\"$ctrl.typeaheadValue\\\"\\n                                    ng-change=\\\"$ctrl.updateValues($ctrl.typeaheadValue)\\\"\\n                                    ng-model-options=\\\"{debounce:200}\\\"\\n                                    placeholder=\\\"Search by name\\\">\\n                                <span class=\\\"glyphicon glyphicon-remove\\\"\\n                                    title=\\\"Clear query\\\"\\n                                    ng-if=\\\"$ctrl.typeaheadValue.length\\\"\\n                                    ng-click=\\\"$ctrl.updateValues($ctrl.typeaheadValue=null)\\\">\\n                                </span>\\n                            </div>\\n                        </div>\\n\\n                        <a class=\\\"c-facet__value\\\" ng-click=\\\"$ctrl.clear()\\\"\\n                            ng-class=\\\"{active:!$ctrl.hasSelections()}\\\">\\n                            <span class=\\\"glyphicon\\\"\\n                                ng-class=\\\"{'glyphicon-check':!$ctrl.hasSelections(), 'glyphicon-unchecked t-fg--gray-lt':$ctrl.hasSelections()}\\\">\\n                            </span>\\n                            Any Community\\n                        </a>\\n                        <a  ng-repeat=\\\"value in $ctrl.values track by $index\\\"\\n                            class=\\\"c-facet__value\\\"\\n                            ng-click=\\\"$ctrl.toggle(value)\\\"\\n                            ng-class=\\\"{active:$ctrl.isSelected(value)}\\\">\\n\\n                            <span class=\\\"badge pull-right\\\">{{$ctrl.getCount(value)}}</span>\\n                            <span class=\\\"glyphicon\\\"\\n                                ng-class=\\\"{'glyphicon-check':$ctrl.isSelected(value),'glyphicon-unchecked t-fg--gray-lt':!$ctrl.isSelected(value)}\\\"></span>\\n                            {{value.label}}\\n                        </a>\\n                        <div class=\\\"c-facet__value t-fg--gray-md\\\"\\n                            ng-if=\\\"$ctrl.additionalValueCount\\\">\\n                            <em>plus {{$ctrl.additionalValueCount}} more options</em>\\n                        </div>\\n                    </div>\\n                </div>\\n            </div>\\n        \"\n    });\n})(angular, GeoPlatform);\n\n(function (angular) {\n    'use strict';\n\n    angular.module('gp-common').component('createdByFilter', {\n        bindings: {\n            service: '<' //service filtering by\n        },\n        controller: function controller(AuthenticationService) {\n            this.$onInit = function () {\n                var _this = this;\n                this.value = null; //input from user for \"created by\" value\n                this.collapse = true; //hide show controls\n                this.limitToUser = false; //filter using current user\n                this.modelOptions = {\n                    'updateOn': 'default blur',\n                    'debounce': {\n                        'default': 250,\n                        'blur': 0\n                    }\n                };\n                AuthenticationService.getUserQ().then(function (user) {\n                    _this.username = user ? user.username : null;\n                });\n            };\n            this.$onDestroy = function () {\n                this.value = null;\n                this.collapse = null;\n                this.limitToUser = null;\n                this.username = null;\n            };\n            this.filter = function () {\n                var value = this.limitToUser ? this.username : this.value;\n                if (typeof value !== 'undefined' && value !== null && value.trim().length === 0) value = null; //don't accept empty strings\n                this.service.setCreatedBy(value, true);\n            };\n            this.toggleLimitToUser = function () {\n                this.limitToUser = !this.limitToUser;\n                this.filter();\n            };\n            this.clear = function () {\n                this.value = null;\n                this.filter();\n            };\n        },\n        template: \"\\n            <div class=\\\"card\\\">\\n                <h5 class=\\\"card-title l-flex-container flex-justify-between flex-align-center\\\">\\n                    <span class=\\\"flex-1\\\">Filter by Author</span>\\n                    <button type=\\\"button\\\" class=\\\"btn btn-sm btn-link\\\"\\n                        title=\\\"{{$ctrl.collapse?'Expand':'Collapse'}}\\\"\\n                        ng-click=\\\"$ctrl.collapse = !$ctrl.collapse\\\">\\n                        <span class=\\\"glyphicon\\\" ng-class=\\\"{'glyphicon-chevron-up':!$ctrl.collapse,'glyphicon-chevron-down':$ctrl.collapse}\\\"></span>\\n                    </button>\\n                </h5>\\n                <div class=\\\"card-content\\\" ng-hide=\\\"$ctrl.collapse\\\">\\n\\n                    <div class=\\\"input-group-slick\\\">\\n                        <span class=\\\"glyphicon glyphicon-user\\\"></span>\\n                        <input type=\\\"text\\\" class=\\\"form-control\\\" placeholder=\\\"Specify author username\\\"\\n                            ng-disabled=\\\"$ctrl.limitToUser\\\"\\n                            ng-model=\\\"$ctrl.value\\\"\\n                            ng-model-options=\\\"$ctrl.modelOptions\\\"\\n                            ng-change=\\\"$ctrl.filter()\\\">\\n                        <span class=\\\"glyphicon glyphicon-remove\\\" title=\\\"Clear author\\\"\\n                            ng-if=\\\"$ctrl.value.length&&!$ctrl.limitToUser\\\" ng-click=\\\"$ctrl.clear()\\\"></span>\\n                    </div>\\n\\n                    <label class=\\\"control-label u-text--sm text-muted u-pd-top--sm\\\" ng-if=\\\"$ctrl.username\\\">\\n                        <input type=\\\"checkbox\\\" ng-model=\\\"$ctrl.limitToUser\\\" ng-change=\\\"$ctrl.filter()\\\">\\n                        Only show my maps\\n                    </label>\\n                </div>\\n            </div>\\n        \"\n    });\n})(angular);\n\n(function (angular, Constants) {\n    'use strict';\n\n    var PUBLISHER_FACET = 'publishers';\n    angular.module('gp-common').component('publisherFilter', {\n        bindings: {\n            name: '@',\n            service: \"<\"\n        },\n        controller: function controller($http) {\n            this.$onInit = function () {\n                this.collapse = true;\n                this.updateValues();\n            };\n            this.$onDestroy = function () {\n                this.values = null;\n            };\n            this.hasSelections = function () {\n                return (this.service.getAgencies() || []).length;\n            };\n            this.isSelected = function (value) {\n                var selected = this.service.getAgencies() || [];\n                return ~selected.indexOf(value.id);\n            };\n            this.toggle = function (value) {\n                var selected = this.service.getAgencies() || [];\n                var idx = selected.indexOf(value.id);\n                if (idx >= 0) selected.splice(idx, 1);else selected.push(value.id);\n                this.service.setAgencies(selected);\n            };\n            this.clear = function () {\n                var selected = this.service.getAgencies() || [];\n                if (!selected || !selected.length) this.collapse = !this.collapse; //toggle collapsed state\n                else this.service.setAgencies([]);\n            };\n            this.getCount = function (value) {\n                var facet = this.service.getFacet(PUBLISHER_FACET);\n                if (!facet) return '';\n                var valObj = facet.buckets.find(function (v) {\n                    return v.label === value.id;\n                });\n                if (!valObj) return '';\n                return valObj.count;\n            };\n            this.updateValues = function (query) {\n                var _this = this;\n                return $http.get(Constants.ualUrl + '/api/items', {\n                    params: {\n                        type: 'org:Organization',\n                        sort: 'label,asc',\n                        q: query,\n                        size: 20,\n                        bust: new Date().getTime()\n                    }\n                }).then(function (response) {\n                    var total = response.data.totalResults;\n                    var newValues = response.data.results.slice(0);\n                    _this.additionalValueCount = total - newValues.length;\n                    var selections = _this.service.getAgencies();\n                    if (selections && selections.length && _this.values && _this.values.length) {\n                        var existing = _this.values.filter(function (v) {\n                            //find existing values that are selected\n                            return ~selections.indexOf(v.id) &&\n                            // but not in new set of values\n                            !newValues.filter(function (nv) {\n                                return nv.id === v.id;\n                            }).length;\n                        });\n                        newValues = existing.concat(newValues);\n                    }\n                    _this.values = newValues;\n                }, function (response) {\n                    console.log(\"(\" + response.status + \") \" + response.statusText);\n                });\n            };\n        },\n        template: \"\\n            <div class=\\\"card\\\">\\n                <h5 class=\\\"card-title l-flex-container flex-justify-between flex-align-center\\\">\\n                    <span class=\\\"flex-1\\\">Filter by Publisher(s)</span>\\n                    <button type=\\\"button\\\" class=\\\"btn btn-sm btn-link\\\"\\n                        title=\\\"{{$ctrl.collapse?'Expand':'Collapse'}}\\\"\\n                        ng-click=\\\"$ctrl.collapse = !$ctrl.collapse\\\">\\n                        <span class=\\\"glyphicon\\\" ng-class=\\\"{'glyphicon-chevron-up':!$ctrl.collapse,'glyphicon-chevron-down':$ctrl.collapse}\\\"></span>\\n                    </button>\\n                </h5>\\n                <div class=\\\"card-content\\\">\\n                    <div class=\\\"c-facets\\\" ng-class=\\\"{'is-collapsed':$ctrl.collapse}\\\">\\n\\n                        <div class=\\\"c-facet__value\\\">\\n                            <div class=\\\"input-group-slick\\\">\\n                                <input name=\\\"scheme-typeahead\\\" type=\\\"text\\\" class=\\\"form-control\\\"\\n                                    ng-model=\\\"$ctrl.typeaheadValue\\\"\\n                                    ng-change=\\\"$ctrl.updateValues($ctrl.typeaheadValue)\\\"\\n                                    ng-model-options=\\\"{debounce:200}\\\"\\n                                    placeholder=\\\"Search by name\\\">\\n                                <span class=\\\"glyphicon glyphicon-remove\\\"\\n                                    title=\\\"Clear query\\\"\\n                                    ng-if=\\\"$ctrl.typeaheadValue.length\\\"\\n                                    ng-click=\\\"$ctrl.updateValues($ctrl.typeaheadValue=null)\\\">\\n                                </span>\\n                            </div>\\n                        </div>\\n\\n                        <a class=\\\"c-facet__value\\\" ng-click=\\\"$ctrl.clear()\\\"\\n                            ng-class=\\\"{active:!$ctrl.hasSelections()}\\\">\\n                            <span class=\\\"glyphicon\\\"\\n                                ng-class=\\\"{'glyphicon-check':!$ctrl.hasSelections(), 'glyphicon-unchecked t-fg--gray-lt':$ctrl.hasSelections()}\\\">\\n                            </span>\\n                            Any Publisher\\n                        </a>\\n                        <a  ng-repeat=\\\"value in $ctrl.values track by $index\\\"\\n                            class=\\\"c-facet__value\\\"\\n                            ng-click=\\\"$ctrl.toggle(value)\\\"\\n                            ng-class=\\\"{active:$ctrl.isSelected(value)}\\\">\\n\\n                            <span class=\\\"badge pull-right\\\">{{$ctrl.getCount(value)}}</span>\\n                            <span class=\\\"glyphicon\\\"\\n                                ng-class=\\\"{'glyphicon-check':$ctrl.isSelected(value),'glyphicon-unchecked t-fg--gray-lt':!$ctrl.isSelected(value)}\\\"></span>\\n                            {{value.label}}\\n                        </a>\\n                        <div class=\\\"c-facet__value t-fg--gray-md\\\"\\n                            ng-if=\\\"$ctrl.additionalValueCount\\\">\\n                            <em>plus {{$ctrl.additionalValueCount}} more options</em>\\n                        </div>\\n                    </div>\\n                </div>\\n            </div>\\n        \"\n    });\n})(angular, GeoPlatform);\n\n(function (angular) {\n    'use strict';\n\n    var PARAMETER = \"concepts\";\n    var RecommendedTermFilter = /** @class */function () {\n        function RecommendedTermFilter($timeout, RecommenderService) {\n            'ngInject';\n\n            this.termService = RecommenderService;\n            this.$timeout = $timeout;\n        }\n        RecommendedTermFilter.prototype.$onInit = function () {\n            this.displayOpts = {\n                fetching: false,\n                empty: false,\n                collapse: false,\n                suggest: false\n            };\n            this.values = [];\n            this.suggested = [];\n            this.termQuery = null;\n            this.paging = {\n                start: 0,\n                size: 5,\n                sizeOptions: [5, 10, 20]\n            };\n        };\n        RecommendedTermFilter.prototype.$onDestroy = function () {\n            this.$timeout = null;\n            this.displayOpts = null;\n            this.values = null;\n            this.suggested = null;\n            this.service = null;\n            this.termService = null;\n            this.termQuery = null;\n            this.paging = null;\n            this.eventHandlers = null;\n        };\n        /* ----------------- typeahead methods ------------------ */\n        // onSelection ($item, $model, $label, $event) {\n        //     this.values.push($model);   //append selection to list\n        //     this.termQuery = null;      //clear the typeahead field\n        //     this.update();\n        // }\n        //\n        // getOptions (text) {\n        //\n        //     this.displayOpts.fetching = true;\n        //     this.displayOpts.empty = false;\n        //\n        //     let params = {\n        //         q:text,\n        //         size:12\n        //     };\n        //     if(this.type)\n        //         params['for'] = this.type;\n        //\n        //     return this.termService.query(params).$promise\n        //     .then( response => {\n        //         let results = response.results;\n        //         this.displayOpts.empty = !results.length;\n        //         return results;\n        //     })\n        //     .catch( e => {\n        //         this.displayOpts.empty = true;\n        //         console.log(\"Error finding semantic terms: \" + e.message);\n        //     })\n        //     .finally( () => {\n        //         this.displayOpts.fetching = false;\n        //     });\n        // }\n        RecommendedTermFilter.prototype.hideSuggested = function () {\n            this.displayOpts.suggest = this.displayOpts.fetching = this.displayOpts.empty = false;\n            this.termQuery = null;\n            this.suggested = [];\n            this.paging.start = this.paging.total = 0;\n        };\n        RecommendedTermFilter.prototype.select = function (item) {\n            item._selected = true; //update status to show it's already _selected\n            this.values.push(item); //append selection to list\n            this.update(); //update overall browse query with new selection\n        };\n        RecommendedTermFilter.prototype.getOptions = function () {\n            var _this = this;\n            var text = this.termQuery;\n            // console.log(\"Querying using '\" + text + \"'\");\n            //if empty value was provided, don't search.\n            if (!text || !text.length) {\n                this.suggested = [];\n                // this.suggestedTotal = this.suggestedCount = 0;\n                this.paging.start = this.paging.total = 0;\n                this.notify('gp:browse:suggestions:pagination', this.paging);\n                // this.displayOpts.suggest = false;\n                return;\n            }\n            //reset variables\n            this.suggested = [];\n            // this.suggestedTotal = this.suggestedCount = 0;\n            this.displayOpts.suggest = true;\n            this.displayOpts.fetching = true;\n            this.displayOpts.empty = false;\n            var params = {\n                q: text,\n                page: Math.floor(this.paging.start / this.paging.size),\n                size: this.paging.size\n            };\n            if (this.type) params['for'] = this.type;\n            this.termService.query(params).$promise.then(function (response) {\n                var results = response.results;\n                _this.displayOpts.empty = !results.length;\n                _this.suggested = results.map(function (result) {\n                    result._selected = _this.isSelected(result);\n                    return result;\n                });\n                _this.paging.total = response.totalResults;\n                _this.notify('gp:browse:suggestions:pagination', _this.paging);\n            }).catch(function (e) {\n                _this.displayOpts.empty = true;\n                _this.suggested = [];\n                _this.paging.total = 0;\n                _this.notify('gp:browse:suggestions:pagination', _this.paging);\n                console.log(\"Error finding semantic terms: \" + e.message);\n            }).finally(function () {\n                _this.displayOpts.fetching = false;\n                // this.displayOpts.suggest = true;\n            });\n        };\n        RecommendedTermFilter.prototype.hasSelections = function () {\n            return this.values.length;\n        };\n        RecommendedTermFilter.prototype.isSelected = function (item) {\n            return this.values.filter(function (v) {\n                return v.uri === item.uri;\n            }).length;\n        };\n        RecommendedTermFilter.prototype.removeValue = function (index) {\n            if (this.values.length >= index) {\n                var removed_1 = this.values.splice(index, 1)[0]; //remove from selected\n                this.update(); //update overall browse query\n                //update associated item in suggested list (if visible)\n                if (this.suggested.length) {\n                    var match = this.suggested.find(function (i) {\n                        return i.uri === removed_1.uri;\n                    });\n                    if (match) match._selected = false;\n                }\n            }\n        };\n        RecommendedTermFilter.prototype.clear = function () {\n            this.values = [];\n            this.update();\n        };\n        RecommendedTermFilter.prototype.update = function () {\n            var value = this.values.length ? this.values.map(function (v) {\n                return v.uri;\n            }) : null;\n            this.service.applyOption(PARAMETER, value, true);\n        };\n        /* -------- pagination methods ----------- */\n        RecommendedTermFilter.prototype.on = function (event, callback) {\n            this.eventHandlers = this.eventHandlers || {};\n            this.eventHandlers[event] = this.eventHandlers[event] || [];\n            this.eventHandlers[event].push(callback);\n        };\n        RecommendedTermFilter.prototype.notify = function (event, data) {\n            var _this = this;\n            if (!this.$timeout || !this.eventHandlers || !this.eventHandlers[event]) return;\n            this.$timeout(function () {\n                angular.forEach(_this.eventHandlers[event], function (handler) {\n                    try {\n                        handler(data);\n                    } catch (e) {}\n                });\n            }, 100);\n        };\n        RecommendedTermFilter.prototype.getPagination = function () {\n            return this.paging;\n        };\n        RecommendedTermFilter.prototype.start = function (index) {\n            this.paging.start = index;\n            this.getOptions();\n        };\n        RecommendedTermFilter.prototype.size = function (value) {\n            this.paging.size = value;\n            this.getOptions();\n        };\n        return RecommendedTermFilter;\n    }();\n    angular.module('gp-common').component('recommendedTermFilter', {\n        bindings: {\n            //type of object being searched (ie, Layer, Map)\n            type: '@',\n            //BrowseObjectService the filter will affect\n            service: \"<\"\n        },\n        controller: RecommendedTermFilter,\n        template: \"\\n            <div class=\\\"card c-filter__recommended-terms\\\">\\n\\n                <h5 class=\\\"card-title l-flex-container flex-justify-between flex-align-center\\\">\\n\\n                    Filter using Semantic Concepts\\n\\n                    <button type=\\\"button\\\" class=\\\"btn btn-sm btn-link\\\"\\n                        title=\\\"{{$ctrl.displayOpts.collapse?'Expand':'Collapse'}}\\\"\\n                        ng-click=\\\"$ctrl.displayOpts.collapse = !$ctrl.displayOpts.collapse\\\">\\n                        <span class=\\\"glyphicon\\\"\\n                            ng-class=\\\"{'glyphicon-chevron-up':!$ctrl.displayOpts.collapse,'glyphicon-chevron-down':$ctrl.displayOpts.collapse}\\\"></span>\\n                    </button>\\n                </h5>\\n\\n                <div class=\\\"c-facets\\\" ng-class=\\\"{'is-collapsed':$ctrl.displayOpts.collapse}\\\">\\n\\n                    <!--\\n                    <div class=\\\"c-facet__value\\\">\\n\\n                        <div class=\\\"input-group-slick\\\">\\n                            <input name=\\\"termQuery\\\" type=\\\"text\\\" class=\\\"form-control\\\"\\n                              ng-model=\\\"$ctrl.termQuery\\\"\\n                              typeahead-on-select=\\\"$ctrl.onSelection($item, $model, $label, $event)\\\"\\n                              uib-typeahead=\\\"opt as ' (' + opt.context + ') ' + opt.label for opt in $ctrl.getOptions($viewValue)\\\"\\n                              typeahead-loading=\\\"$ctrl.displayOpts.fetching\\\"\\n                              typeahead-no-results=\\\"$ctrl.displayOpts.empty\\\"\\n                              ng-model-options=\\\"{ debounce: 250 }\\\"\\n                              typeahead-min-length=\\\"2\\\"\\n                              typeahead-editable=\\\"false\\\"\\n                              placeholder=\\\"Find a concept\\\">\\n                            <span class=\\\"glyphicon glyphicon-hourglass spin\\\" ng-if=\\\"$ctrl.displayOpts.fetching\\\"></span>\\n                        </div>\\n\\n                        <div ng-show=\\\"$ctrl.displayOpts.empty\\\">No Results Found</div>\\n\\n                    </div>\\n                    -->\\n\\n                    <div ng-hide=\\\"$ctrl.displayOpts.collapse\\\">\\n\\n                        <div class=\\\"input-group-slick\\\">\\n                            <span class=\\\"glyphicon\\\"\\n                                ng-class=\\\"{'glyphicon-search':!$ctrl.displayOpts.fetching, 'glyphicon-hourglass spin':$ctrl.displayOpts.fetching}\\\"></span>\\n                            <input type=\\\"text\\\" class=\\\"form-control\\\"\\n                                ng-model=\\\"$ctrl.termQuery\\\"\\n                                ng-model-options=\\\"{ debounce: 250 }\\\"\\n                                ng-change=\\\"$ctrl.getOptions()\\\"\\n                                placeholder=\\\"Find concepts\\\">\\n                            <span class=\\\"glyphicon glyphicon-remove\\\" ng-if=\\\"$ctrl.displayOpts.suggest\\\"\\n                                ng-click=\\\"$ctrl.hideSuggested()\\\"></span>\\n                        </div>\\n\\n                        <gp-pagination service=\\\"$ctrl\\\" event-key=\\\"suggestions\\\" use-select=\\\"true\\\"\\n                            ng-if=\\\"$ctrl.displayOpts.suggest\\\">\\n                        </gp-pagination>\\n\\n                        <div class=\\\"list-group list-group-sm u-text--sm\\\"\\n                            ng-if=\\\"$ctrl.displayOpts.suggest && !$ctrl.displayOpts.fetching\\\">\\n\\n                            <a ng-repeat=\\\"item in $ctrl.suggested track by $index\\\"\\n                                class=\\\"list-group-item\\\"\\n                                ng-class=\\\"{disabled:item._selected}\\\"\\n                                ng-click=\\\"$ctrl.select(item)\\\">\\n                                <span class=\\\"u-break--all t-text--strong u-pd-bottom--sm\\\">{{item.prefLabel}}</span>\\n                                <br>\\n                                <span class=\\\"u-break--all u-text--sm t-text--italic\\\">{{item.uri}}</span>\\n                            </a>\\n\\n                            <div ng-if=\\\"$ctrl.displayOpts.empty\\\" class=\\\"list-group-item disabled u-pd--md\\\">\\n                                No concepts found\\n                            </div>\\n\\n                        </div>\\n\\n                    </div>\\n\\n\\n                    <!-- selected terms -->\\n                    <div ng-repeat=\\\"term in $ctrl.values\\\" class=\\\"c-facet__value active\\\"\\n                        title=\\\"Remove this term from the query\\\"\\n                        ng-click=\\\"$ctrl.removeValue($index)\\\">\\n\\n                        <div class=\\\"u-break--all t-text--strong u-pd-bottom--sm\\\">\\n                            <span class=\\\"glyphicon glyphicon-check\\\"></span>\\n                            {{term.prefLabel}}\\n                        </div>\\n                        <div class=\\\"u-break--all u-text--sm t-text--italic\\\">{{term.uri}}</div>\\n                    </div>\\n\\n                </div>\\n\\n            </div>\\n        \"\n    });\n})(angular);\n\n(function (angular) {\n    'use strict';\n\n    angular.module('gp-common').component('similarityFilter', {\n        bindings: {\n            //type of object being searched (ie, Layer, Map)\n            type: '@',\n            //BrowseObjectService the filter will affect\n            service: \"<\",\n            //optional, id of current map (if one exists)\n            mapId: '@'\n        },\n        controller: function controller() {\n            this.$onInit = function () {\n                var _this = this;\n                this.collapse = true;\n                this.value = null;\n                this.useMap = false;\n                var evtName = this.service.events.SIMILARITY;\n                this.listener = this.service.on(evtName, function (event, layer) {\n                    _this.value = layer;\n                    _this.service.applyOption('similarTo', _this.value.id, true);\n                });\n                if (!this.type) this.type = \"item\";\n            };\n            this.$onDestroy = function () {\n                this.listener(); //dispose of listener\n                this.collapse = null;\n                this.value = null;\n                this.service = null;\n                this.mapId = null;\n            };\n            this.hasSelections = function () {\n                return !!this.value;\n            };\n            this.clearValue = function () {\n                if (this.useMap) {\n                    this.useMap = false;\n                    this.service.applyOption('similarTo', this.value.id, true);\n                } else {\n                    this.value = null;\n                    this.service.applyOption('similarTo', null, true);\n                }\n            };\n            this.toggleCurrentMap = function (bool) {\n                if (this.useMap) {\n                    this.useMap = false;\n                    if (this.value) {\n                        this.service.applyOption('similarTo', this.value.id, true);\n                    } else {\n                        this.service.applyOption('similarTo', false, true);\n                    }\n                } else {\n                    this.useMap = true;\n                    this.service.applyOption('similarTo', this.mapId, true);\n                }\n            };\n        },\n        template: \"\\n            <div class=\\\"card\\\" ng-if=\\\"$ctrl.value\\\">\\n\\n                <h5 class=\\\"card-title\\\">Find Similar</h5>\\n                <div class=\\\"card-content\\\">\\n\\n                    <p class=\\\"u-text--sm\\\">Searching for {{$ctrl.type}}s similar to the following: </p>\\n\\n                    <div class=\\\"c-facets\\\">\\n\\n                        <a class=\\\"c-facet__value\\\" ng-if=\\\"$ctrl.value\\\" ng-click=\\\"$ctrl.clearValue()\\\">\\n                            <span class=\\\"glyphicon glyphicon-remove-circle\\\"></span>\\n                            {{$ctrl.value.label}}\\n                        </a>\\n\\n                        <!--\\n                        <a ng-if=\\\"$ctrl.mapId\\\" class=\\\"c-facet__value\\\"\\n                            ng-click=\\\"$ctrl.toggleCurrentMap()\\\" ng-class=\\\"{active:$ctrl.useMap}\\\">\\n                            <span class=\\\"glyphicon glyphicon-check\\\" ng-show=\\\"$ctrl.useMap\\\"></span>\\n                            <span class=\\\"glyphicon glyphicon-unchecked\\\" ng-show=\\\"!$ctrl.useMap\\\"></span>\\n                            Find similar to my current map\\n                        </a>\\n                        -->\\n\\n                    </div>\\n\\n                    <br>\\n                    <p class=\\\"u-text--sm\\\">Note that query filters below are still being applied.</p>\\n\\n                </div>\\n            </div>\\n        \"\n    });\n})(angular);\n\n(function (angular, Constants) {\n    'use strict';\n    /*\n        <themes-filter></themes-filter>\n     */\n\n    angular.module('gp-common').component('themeFilter', {\n        bindings: {\n            name: '@',\n            service: '<'\n        },\n        controller: function controller($http) {\n            this.$onInit = function () {\n                this.collapse = true;\n                this.updateValues();\n            };\n            this.$onDestroy = function () {\n                this.values = null;\n                this.service = null;\n            };\n            this.hasSelections = function () {\n                return (this.service.getThemes() || []).length;\n            };\n            this.isSelected = function (value) {\n                var themes = this.service.getThemes() || [];\n                return ~themes.indexOf(value.id);\n            };\n            this.toggle = function (value) {\n                var themes = this.service.getThemes() || [];\n                var idx = themes.indexOf(value.id);\n                if (idx >= 0) themes.splice(idx, 1);else themes.push(value.id);\n                this.service.setThemes(themes);\n            };\n            this.clear = function () {\n                var themes = this.service.getThemes() || [];\n                if (!themes || !themes.length) this.collapse = !this.collapse; //toggle collapsed state\n                else this.service.setThemes([]);\n            };\n            this.getCount = function (value) {\n                var facet = this.service.getFacet('themes');\n                if (!facet) return '';\n                var valObj = facet.buckets.find(function (v) {\n                    return v.label === value.id;\n                });\n                if (!valObj) return '';\n                return valObj.count;\n            };\n            this.updateValues = function (query) {\n                var _this = this;\n                return $http.get(Constants.ualUrl + '/api/items', {\n                    params: {\n                        type: 'skos:Concept',\n                        'scheme.label': 'NGDA Portfolio Themes',\n                        fields: 'scheme',\n                        size: 9999,\n                        sort: 'label,asc',\n                        bust: new Date().getTime()\n                    }\n                }).then(function (response) {\n                    // let total = response.data.totalResults;\n                    _this.values = response.data.results.slice(0);\n                }, function (response) {\n                    console.log(\"(\" + response.status + \") \" + response.statusText);\n                }).catch(function (e) {\n                    console.log(\"Error fetching NGDA Themes: \" + e.message);\n                });\n            };\n        },\n        template: \"\\n            <div class=\\\"card c-browse-filter\\\">\\n                <h5 class=\\\"card-title l-flex-container flex-justify-between flex-align-center\\\">\\n                    Filter by NGDA Themes\\n                    <button type=\\\"button\\\" class=\\\"btn btn-sm btn-link\\\"\\n                        title=\\\"{{$ctrl.collapse?'Expand':'Collapse'}}\\\"\\n                        ng-click=\\\"$ctrl.collapse = !$ctrl.collapse\\\">\\n                        <span class=\\\"glyphicon\\\" ng-class=\\\"{'glyphicon-chevron-up':!$ctrl.collapse,'glyphicon-chevron-down':$ctrl.collapse}\\\"></span>\\n                    </button>\\n                </h5>\\n                <div class=\\\"card-content\\\">\\n                    <div class=\\\"c-facets\\\" ng-class=\\\"{'is-collapsed':$ctrl.collapse}\\\">\\n                        <a class=\\\"c-facet__value\\\" ng-click=\\\"$ctrl.clear()\\\"\\n                            ng-class=\\\"{active:!$ctrl.hasSelections()}\\\">\\n                            <span class=\\\"glyphicon\\\"\\n                                ng-class=\\\"{'glyphicon-check':!$ctrl.hasSelections(), 'glyphicon-unchecked t-fg--gray-lt':$ctrl.hasSelections()}\\\">\\n                            </span>\\n                            Any Theme\\n                        </a>\\n                        <a ng-repeat=\\\"theme in $ctrl.values track by $index\\\"\\n                            class=\\\"c-facet__value\\\" ng-click=\\\"$ctrl.toggle(theme)\\\"\\n                            ng-class=\\\"{active:$ctrl.isSelected(theme)}\\\">\\n                                <span class=\\\"badge pull-right\\\">{{$ctrl.getCount(theme)}}</span>\\n                                <span class=\\\"glyphicon\\\"\\n                                    ng-class=\\\"{'glyphicon-check':$ctrl.isSelected(theme),'glyphicon-unchecked t-fg--gray-lt':!$ctrl.isSelected(theme)}\\\"></span>\\n                                {{theme.label}}\\n                            </a>\\n                        </div>\\n                    </div>\\n                </div>\\n            </div>\\n        \"\n    });\n})(angular, GeoPlatform);\n\n(function (angular, Constants) {\n    \"use strict\";\n    //fields list sent to MDR in order to have these properties for display in search results\n\n    var FIELDS = ['created', 'modified', 'publishers', 'themes', 'description', 'extent'];\n    //facets list sent to MDR in order to get aggregation numbers\n    var FACETS = ['types', 'themes', 'publishers', 'serviceTypes', 'schemes', 'visibility', 'createdBy'];\n    var SORT_OPTIONS = [{ value: \"label,asc\", label: \"Name (A-Z)\" }, { value: \"label,desc\", label: \"Name (Z-A)\" }, { value: \"type,asc\", label: \"Type (A-Z)\" }, { value: \"type,desc\", label: \"Type (Z-A)\" }, { value: \"modified,desc\", label: \"Most recently modified\" }, { value: \"modified,asc\", label: \"Least recently modified\" }, { value: \"_score,desc\", label: \"Relevance\" }];\n    //list of _options variables for mapping to parameters\n    var VAR_TYPES = 'types';\n    var VAR_THEMES = 'themes';\n    var VAR_PUBLISHERS = 'publishers';\n    var VAR_USED_BY = 'usedBy';\n    var VAR_USER = 'user';\n    var VAR_CREATED_BY = 'createdBy';\n    var VAR_SERVICE_TYPES = 'serviceTypes';\n    var VAR_SCHEMES = 'schemes';\n    var VAR_VISIBILITY = \"visibility\";\n    var VAR_QUERY = 'query';\n    var VAR_EXTENT = 'bbox';\n    var VAR_MODIFIED_BEFORE = 'modified.max';\n    var VAR_MODIFIED_AFTER = 'modified.min';\n    //parameter names for various query constraints used in requests to MDR for results\n    var PARAMETER_TYPE = 'type';\n    var PARAMETER_THEME = 'theme.id';\n    var PARAMETER_PUBLISHER = 'publisher.id';\n    var PARAMETER_USED_BY = 'usedBy.id';\n    var PARAMETER_CREATED_BY = 'createdBy';\n    var PARAMETER_CONTRIBUTED_BY = 'contributedBy';\n    var PARAMETER_CREATOR = 'creator.id';\n    var PARAMETER_SVC_TYPE = 'serviceType.id';\n    var PARAMETER_IN_SCHEME = 'scheme.id';\n    var PARAMETER_VISIBILITY = 'visibility';\n    var PARAMETER_QUERY = 'q';\n    var PARAMETER_EXTENT = 'extent';\n    var PARAMETER_MODIFIED_BEFORE = 'modified.max';\n    var PARAMETER_MODIFIED_AFTER = 'modified.min';\n    // const PARAMETER_CONTRIBUTOR     = 'contributor.id';\n    var PARAM_OPTIONS = [{ option: VAR_TYPES, parameter: PARAMETER_TYPE }, { option: VAR_THEMES, parameter: PARAMETER_THEME }, { option: VAR_PUBLISHERS, parameter: PARAMETER_PUBLISHER }, { option: VAR_USED_BY, parameter: PARAMETER_USED_BY }, { option: VAR_USER, parameter: PARAMETER_CREATOR }, { option: VAR_CREATED_BY, parameter: PARAMETER_CREATED_BY }, { option: VAR_SERVICE_TYPES, parameter: PARAMETER_SVC_TYPE }, { option: VAR_SCHEMES, parameter: PARAMETER_IN_SCHEME }, { option: VAR_VISIBILITY, parameter: PARAMETER_VISIBILITY }, { option: VAR_QUERY, parameter: PARAMETER_QUERY }, { option: VAR_EXTENT, parameter: PARAMETER_EXTENT }, { option: VAR_MODIFIED_BEFORE, parameter: PARAMETER_MODIFIED_BEFORE }, { option: VAR_MODIFIED_AFTER, parameter: PARAMETER_MODIFIED_AFTER }];\n    var PAGE_SIZE_BASE_10 = [10, 20, 50, 100];\n    var PAGE_SIZE_BASE_12 = [12, 24, 48, 96];\n    /**\n     *\n     *\n     */\n    function BrowseObjectsService($rootScope, $timeout, $resource, options) {\n        /* -------- private data ----------- */\n        var url = options && options.url ? options.url + \"/:id\" : Constants.ualUrl + '/api/items/:id';\n        var eventKey = 'gp:browse:' + (options && options.key ? options.key : 'objects') + \":\";\n        var svc = $resource(url, { id: '@id' }, {\n            query: {\n                isArray: false\n            }\n        });\n        var _pageSizeBase = PAGE_SIZE_BASE_10.slice(0);\n        if (options && options.pageSizeBase && options.pageSizeBase === 12) _pageSizeBase = PAGE_SIZE_BASE_12.slice(0);\n        var _options = {\n            start: 0,\n            size: _pageSizeBase[0],\n            total: 0,\n            sort: options && options.sort ? options.sort : \"modified,desc\",\n            facets: {}\n        };\n        //list of field names to request in response\n        var _fields = options && options.fields ? options.fields : FIELDS.slice(0);\n        //list of facet names to request\n        var _requestFacets = options && options.facets ? options.facets : FACETS.slice(0);\n        var _facets = [];\n        var _selectedFacets = [];\n        var _results = [];\n        var _dirtyPromise = null;\n        var _isLoading = false;\n        var _selected = [];\n        var _onSelectFn = options && options.onSelect ? options.onSelect : null;\n        /**\n         *\n         */\n        function notify(eventName, arg) {\n            // console.log(\"Notifying of \" + eventName + \" with \" + arg);\n            $rootScope.$broadcast(eventName, arg);\n        }\n        /**\n         * when marked as dirty, debounce for rapid fire events like onKeyUp\n         */\n        function dirty(delay, resetStart) {\n            var doReset = typeof resetStart === 'undefined' || resetStart === true;\n            if (_dirtyPromise) $timeout.cancel(_dirtyPromise);\n            _dirtyPromise = $timeout(function () {\n                _dirtyPromise = null;\n                _doUpdate(doReset);\n            }, delay || 100);\n        }\n        /**\n         *\n         */\n        function _doUpdate(resetStart) {\n            if (resetStart) _options.start = 0;\n            _isLoading = true;\n            notify(eventKey + 'querying');\n            var params = {};\n            // -------- QUERY FILTERS --------\n            //create a temporary options object\n            var opts = angular.copy(_options);\n            //apply options as parameters\n            angular.forEach(PARAM_OPTIONS, function (po) {\n                var name = po.parameter;\n                var value = opts[po.option];\n                var isSet = value !== null && typeof value !== 'undefined';\n                var isArr = isSet && typeof value.push !== 'undefined';\n                if (isSet && (!isArr || value.length)) {\n                    params[name] = isArr ? value.join(',') : value;\n                } else {\n                    delete params[name];\n                }\n                delete opts[po.option]; //remove from temp opts\n            });\n            //apply remaining options to query\n            // these are not keyed with specific parameters (ie, custom params)\n            angular.forEach(opts, function (value, name) {\n                if (value !== null && typeof value !== 'undefined') {\n                    var isArr = typeof value.push !== 'undefined';\n                    params[name] = isArr ? value.join(',') : value;\n                } else {\n                    //make sure it doesn't get sent if no value provided\n                    delete params[name];\n                }\n            });\n            // -------- QUERY FILTERS --------\n            var arr = [];\n            for (var k in _options.facets) {\n                if (_options.facets.hasOwnProperty(k)) {\n                    //encode commas in facet name since it's used to separate multiple\n                    // facet values\n                    arr.push(k + \":\" + _options.facets[k].replace(/,/g, '%2C'));\n                }\n            }\n            _selectedFacets = arr;\n            var start = _options.start;\n            if (isNaN(start)) start = 0;else start = start * 1;\n            params.page = Math.floor(start / _options.size);\n            params.size = _options.size;\n            params.sort = _options.sort;\n            if (arr.length) params.facets = arr.join(',');\n            //prevent CORS cache bug in Chrome\n            params.bust = new Date().getTime();\n            //request facets\n            params.includeFacet = _requestFacets.join(',');\n            //request fields\n            params.fields = _fields.join(',');\n            svc.query(params).$promise.then(function (response) {\n                _results = response.results;\n                _facets = response.facets || [];\n                //auto select objects if user has marked it as selected previously\n                // this is needed to maintain selections across pagination pages\n                _selected.each(function (id) {\n                    var map = _results.find(function (map) {\n                        return map._id === id;\n                    });\n                    if (map) map.selected = true;\n                });\n                //will trigger update on pagination directive\n                _options.total = response.totalResults;\n                _isLoading = false;\n                notify(eventKey + 'results');\n                notify(eventKey + 'pagination');\n            }).catch(function (response) {\n                _isLoading = false;\n                //fallback\n                var obj = { error: \"An Error Occurred\", message: \"No details provided\" };\n                //http response error\n                if (response && response.data) obj = response.data;else if (response && response.message) obj = response;\n                //serialized json\n                if (typeof obj === 'string') {\n                    try {\n                        obj = JSON.parse(obj);\n                    } catch (e) {\n                        obj.message = \"Bad response from server\";\n                    }\n                }\n                var error = {\n                    label: obj.error || \"An Error Occurred\",\n                    message: obj.message || \"No details provided\"\n                };\n                notify(eventKey + 'error', error);\n            });\n        }\n        function setOption(name, value, fire) {\n            _options[name] = value;\n            if (typeof fire === 'undefined' || !!fire) {\n                var delay = 500;\n                if (value === null || value === undefined) delay = 0;\n                if (value && typeof value.push !== 'undefined' && value.length) delay = 0; //arrays\n                else if (value && value.length) delay = 0; //strings\n                dirty(delay);\n            }\n        }\n        /* ------------ public api ------------- */\n        return {\n            events: {\n                LOADING: eventKey + 'querying',\n                RESULTS: eventKey + 'results',\n                PAGINATION: eventKey + 'pagination',\n                SELECTED: eventKey + 'selected',\n                ERROR: eventKey + 'error',\n                SELECTED_ADDED: eventKey + 'selected:added',\n                SELECTED_REMOVED: eventKey + 'selected:removed',\n                SIMILARITY: eventKey + 'similarTo'\n            },\n            /**\n             * @return {bool}\n             */\n            getLoadingStatus: function getLoadingStatus() {\n                return _isLoading;\n            },\n            /**\n             * NOTE: Make sure event names are prefixed with\n             *  eventKey + ''\n             * @param {string} eventName\n             * @param {function} listener\n             */\n            on: function on(eventName, listener) {\n                // if(eventName.indexOf(eventKey + \":\") !== 0)\n                //     eventName = eventKey + '' + eventName;\n                return $rootScope.$on(eventName, listener);\n            },\n            /**\n             * @param {string} eventName\n             * @param {*} args\n             */\n            trigger: function trigger(eventName, args) {\n                notify(eventName, args);\n            },\n            /**\n             * @return {array[object]}\n             */\n            getResults: function getResults() {\n                return _results;\n            },\n            /**\n             * @return {array[string]} list of facet names\n             */\n            getFacetNames: function getFacetNames() {\n                return FACETS.slice(0);\n            },\n            /**\n             * @return {object} in form of <facet>: [<values>]\n             */\n            getFacets: function getFacets() {\n                return _facets;\n            },\n            /**\n             * @param {string} name\n             * @return {object|null}\n             */\n            getFacet: function getFacet(name) {\n                if (_facets) {\n                    return _facets.find(function (facet) {\n                        return facet.name === name;\n                    });\n                }\n                return null;\n            },\n            addFacet: function addFacet(name) {\n                _requestFacets.push(name);\n            },\n            applyConstraints: function applyConstraints(obj) {\n                // _options[VAR_QUERY] = obj.query;\n                // _options[VAR_TYPES] = obj.types;\n                // _options[VAR_THEMES] = obj.themes;\n                // _options[VAR_PUBLISHERS] = obj.publishers;\n                // _options[VAR_USER] = obj.user;\n                // _options[VAR_CREATED_BY] = obj.createdBy;\n                // _options[VAR_SERVICE_TYPES] = obj.serviceTypes;\n                // _options[VAR_SCHEMES] = obj.schemes;\n                // _options[VAR_VISIBILITY] = obj.visibility;\n                // //do we need to set extent here too?\n                for (var p in obj) {\n                    if (obj.hasOwnProperty(p)) {\n                        _options[p] = obj[p];\n                    }\n                }\n                _doUpdate(true);\n            },\n            applyOption: function applyOption(key, value, fire) {\n                setOption(key, value, fire);\n            },\n            applyOptions: function applyOptions(opts, fire) {\n                angular.forEach(opts, function (value, key) {\n                    setOption(key, value, false);\n                });\n                if (fire) _doUpdate(true);\n            },\n            /**\n             * @param {string} text - free text query\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setQuery: function setQuery(text, fireUpdate) {\n                setOption(VAR_QUERY, text, fireUpdate);\n            },\n            /**\n             * @param {array[string]} types - name of class(es) to request\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setTypes: function setTypes(types, fireUpdate) {\n                setOption(VAR_TYPES, types, fireUpdate);\n            },\n            getTypes: function getTypes() {\n                return _options[VAR_TYPES];\n            },\n            /**\n             * @param {string} userId - identifier of user\n             * @param {boolean} fireUpdate -\n             */\n            setUser: function setUser(userId, fireUpdate) {\n                setOption(VAR_USER, userId, fireUpdate);\n            },\n            /**\n             * @param {array[string]} creators - ids of creators\n             * @param {boolean} fireUpdate -\n             */\n            setCreatedBy: function setCreatedBy(creators, fireUpdate) {\n                setOption(VAR_CREATED_BY, creators, fireUpdate);\n            },\n            /**\n             * @param {array[string]} themes - name of class(es) to request\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setThemes: function setThemes(themes, fireUpdate) {\n                setOption(VAR_THEMES, themes, fireUpdate);\n            },\n            getThemes: function getThemes() {\n                return _options[VAR_THEMES];\n            },\n            /**\n             * @param {array[string]} publishers - name of class(es) to request\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setAgencies: function setAgencies(publishers, fireUpdate) {\n                setOption(VAR_PUBLISHERS, publishers, fireUpdate);\n            },\n            getAgencies: function getAgencies() {\n                return _options[VAR_PUBLISHERS];\n            },\n            /**\n             * @param {array[string]} ids - ids of agents using this item\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setUsedBy: function setUsedBy(ids, fireUpdate) {\n                setOption(VAR_USED_BY, ids, fireUpdate);\n            },\n            getUsedBy: function getUsedBy() {\n                return _options[VAR_USED_BY];\n            },\n            /**\n             * @param {array[string]} svcTypes - ids\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setServiceTypes: function setServiceTypes(svcTypes, fireUpdate) {\n                setOption(VAR_SERVICE_TYPES, svcTypes, fireUpdate);\n            },\n            getServiceTypes: function getServiceTypes() {\n                return _options[VAR_SERVICE_TYPES];\n            },\n            /**\n             * @param {array[string]} schemes - ids\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setSchemes: function setSchemes(schemes, fireUpdate) {\n                setOption(VAR_SCHEMES, schemes, fireUpdate);\n            },\n            /**\n             * @param {string} visibility - one of 'public' or 'private'\n             * @param {boolean} fireUpdate\n             */\n            setVisibility: function setVisibility(visibility, fireUpdate) {\n                setOption(VAR_VISIBILITY, visibility, fireUpdate);\n            },\n            /**\n             * @param {Date} date - date to compare against\n             * @param {boolean} beforeOrAfter - flag specifying which boundary condition (true = before, false = after)\n             * @param {boolean} fireUpdate - flag specifying whether to trigger update automatically\n             */\n            setModified: function setModified(date, beforeOrAfter, fireUpdate) {\n                //if no date was supplied, consider it \"unset\" for both properties\n                if (!date) {\n                    setOption(VAR_MODIFIED_BEFORE, null, false);\n                    setOption(VAR_MODIFIED_AFTER, null, true);\n                    return;\n                }\n                var dir = beforeOrAfter && (beforeOrAfter === true || beforeOrAfter === \"true\");\n                var prop = dir ? VAR_MODIFIED_BEFORE : VAR_MODIFIED_AFTER; //property being set\n                var oppProp = dir ? VAR_MODIFIED_AFTER : VAR_MODIFIED_BEFORE; //unset opposite property\n                var arg = date && date.getTime ? date.getTime() : date;\n                setOption(oppProp, null, false);\n                setOption(prop, arg, true);\n            },\n            getModified: function getModified() {\n                return this._options[VAR_MODIFIED_BEFORE] || this._options[VAR_MODIFIED_AFTER];\n            },\n            /**\n             * @param {string} bboxStr - form of \"minx,miny,maxx,maxy\"\n             * @param {boolean} fireUpdate\n             */\n            setExtent: function setExtent(bboxStr) {\n                setOption(VAR_EXTENT, bboxStr, true);\n            },\n            /**\n             * @return {string} bbox string or null if not set\n             */\n            getExtent: function getExtent() {\n                return _options[VAR_EXTENT];\n            },\n            /**\n             * @return {array} list of selected items from current search results\n             */\n            getSelected: function getSelected() {\n                return _selected;\n            },\n            /**\n             * @param {array} arr - list of items to select in current search results\n             */\n            setSelected: function setSelected(arr) {\n                _selected = arr;\n                notify(this.events.SELECTED, _selected);\n            },\n            /**\n             * @param {string} id - identifier of item in current search results to add to selected list\n             */\n            select: function select(id) {\n                var finder = function finder(l) {\n                    return l.id === id;\n                };\n                var existing = _selected.find(finder);\n                if (existing) {\n                    var idx = _selected.indexOf(existing);\n                    if (idx >= 0) {\n                        _selected.splice(idx, 1);\n                        notify(eventKey + 'selected:removed', existing);\n                    }\n                } else {\n                    var obj = _results.find(finder);\n                    if (obj) {\n                        if (_onSelectFn) {\n                            _onSelectFn(id, function (err, item) {\n                                if (item) {\n                                    _selected.unshift(item);\n                                    notify(eventKey + 'selected:added', item);\n                                }\n                            });\n                        } else {\n                            _selected.unshift(obj);\n                            notify(eventKey + 'selected:added', obj);\n                        }\n                    }\n                }\n                notify(this.events.SELECTED, _selected);\n            },\n            /**\n             * @param {string} id - identifier of item to check\n             * @return {boolean} true if selected, false otherwise\n             */\n            isSelected: function isSelected(id) {\n                return _selected.find(function (obj) {\n                    return obj.id === id;\n                });\n            },\n            /**\n             * select all items in current page of results\n             */\n            selectAll: function selectAll() {\n                var _this = this;\n                angular.forEach(_results, function (obj) {\n                    if (!_this.isSelected(obj.id)) _selected.unshift(obj);\n                });\n                notify(this.events.SELECTED, _selected);\n            },\n            /**\n             * empty list of selected items\n             */\n            clearSelected: function clearSelected() {\n                _selected = [];\n                notify(this.events.SELECTED, []);\n            },\n            /**\n             *\n             */\n            clear: function clear(refresh) {\n                for (var prop in _options) {\n                    if (!_options.hasOwnProperty(prop)) continue;\n                    if ('start' === prop) _options[prop] = 0;else if ('size' === prop) {} else if ('sort' === prop) _options[prop] = 'modified,desc';else if ('facets' === prop) _options[prop] = {};else _options[prop] = null;\n                }\n                if (refresh || typeof refresh === 'undefined') _doUpdate(true);\n            },\n            /*\n             * @param {string} category - name of facet\n             * @param {string} value - value of facet\n             */\n            setFacet: function setFacet(category, value) {\n                var f = _options.facets[category];\n                if (!f) _options.facets[category] = value;else {\n                    if (f === value) {\n                        //unset it\n                        delete _options.facets[category];\n                    } else {\n                        //set it\n                        _options.facets[category] = value;\n                    }\n                }\n                _doUpdate(true);\n            },\n            /**\n             * @param {array[string]} fields - list of field names to request for each search result\n             */\n            setFields: function setFields(fields) {\n                if (fields && typeof fields.push !== 'undefined') _fields = fields;\n            },\n            /**\n             * @param {int} start - beginning index of results to request\n             * @param {bool} andUpdate - trigger update (default is true)\n             */\n            start: function start(_start, andUpdate) {\n                _options.start = _start;\n                if (andUpdate && andUpdate === true) _doUpdate(false);\n            },\n            /**\n             * @param {int} size - page size to request\n             * @param {bool} andUpdate - trigger update (default is true)\n             */\n            size: function size(_size, andUpdate) {\n                _options.size = _size;\n                //find out which page in the new scheme the current first-result of current page\n                // will show up in, and set start so that it shows up with the new page size\n                var page = Math.floor(_options.start * 1 / _options.size * 1);\n                _options.start = page * (_options.size * 1);\n                if (andUpdate && andUpdate === true) _doUpdate(false);\n            },\n            /**\n             * @param {int} size - number of items to return in each page of results\n             */\n            pageSize: function pageSize(size) {\n                this.size(size, true);\n            },\n            /**\n             * @param {string} sort - form of <field>,<dir>\n             */\n            sort: function sort(_sort) {\n                _options.sort = _sort;\n                _doUpdate(false);\n            },\n            /**\n             * return {object} containing start index, page size, and total results\n             */\n            getPagination: function getPagination() {\n                return {\n                    start: _options.start,\n                    size: _options.size,\n                    pageSize: _options.size,\n                    total: _options.total,\n                    sizeOptions: _pageSizeBase\n                };\n            },\n            /**\n             * @return {array} list of key-value pairs of sort options\n             */\n            getSortOptions: function getSortOptions() {\n                return SORT_OPTIONS.slice(0);\n            },\n            /**\n             * @return {string} sorting parameter (field,order)\n             */\n            getSortValue: function getSortValue() {\n                return _options.sort;\n            },\n            /**\n             * @return {object} clone of the current set of query options\n             */\n            getQueryOptions: function getQueryOptions() {\n                return jQuery.extend({}, _options);\n            },\n            /**\n             *\n             */\n            hasQueryOptions: function hasQueryOptions() {\n                var result = false;\n                for (var k in _options) {\n                    if (_options.hasOwnProperty(k)) {\n                        if ('start' === k || 'size' === k || 'total' === k || 'sort' === k || 'order' === k || 'within' === k || 'facets' === k) continue;\n                        if (_selectedFacets.length) result = true;\n                        if (typeof _options[k] !== 'undefined' && _options[k] !== null) {\n                            result = true;\n                        }\n                    }\n                }\n                return result;\n            },\n            /**\n             * Triggers a refresh of current search results\n             * @param {boolean} resetStart - reset 'start' to 0 flag\n             */\n            update: function update(resetStart) {\n                dirty(0, resetStart);\n            },\n            reset: function reset() {\n                _options = {\n                    start: 0,\n                    size: _pageSizeBase[0],\n                    total: 0,\n                    sort: \"modified,desc\", order: \"asc\",\n                    facets: {}\n                };\n                _facets = [];\n                _selectedFacets = [];\n                _results = [];\n                _isLoading = false;\n                _selected = [];\n                if (_dirtyPromise) $timeout.cancel(_dirtyPromise);\n                _dirtyPromise = null;\n            },\n            destroy: function destroy() {\n                if (_dirtyPromise) $timeout.cancel(_dirtyPromise);\n            }\n        };\n    }\n    /**\n     * Factory for creating instances of BrowseObjectsService\n     */\n    function BrowseServiceFactory($rootScope, $timeout, $resource) {\n        return function (options) {\n            var svc = BrowseObjectsService($rootScope, $timeout, $resource, options);\n            if (options && options.params) svc.applyOptions(options.params);\n            return svc;\n        };\n    }\n    angular.module('gp-common').service(\"BrowseObjectsService\", ['$rootScope', '$timeout', '$resource', BrowseObjectsService]).factory(\"BrowseServiceFactory\", ['$rootScope', '$timeout', '$resource', 'BrowseObjectsService', BrowseServiceFactory]);\n    /*\n        Example of how to use the factory to customize a service\n    \n        //layer-specific browse service\n        .service('BrowseLayerObjService', ['BrowseServiceFactory', function(BrowseServiceFactory) {\n            let service = BrowseServiceFactory({\n                key: 'layers',\n                url: Constants.ualUrl + '/api/layers'\n            });\n    \n            //add custom methods here\n    \n            return service;\n        }])\n    */\n})(angular, GeoPlatform);\n\n(function (angular) {\n    'use strict';\n    /* *********************************************\n     * Requires socket.io be in the global namespace\n     * tested with version 2.x\n     * ********************************************* */\n    /*\n       Usage:\n        let service = ...\n        let svcId = service.getId();\n        //listen to events from the server\n       service.on('testing', (event) => {\n           if(event.clientId === svcId) return; //ignore our own events\n           ... do something ...\n       });\n       \n       //sends out a message to others\n       service.emit( service.events.CREATED, 'test');\n        //sends out a message to others\n       service.begin(service.events.EDITING, 'test');\n        //sends out a message to others\n       service.end(service.events.EDITING, 'test');\n        //stop listening and close the socket\n       service.close();\n      */\n    /**\n     *\n     */\n\n    var SocketService = /** @class */function () {\n        function SocketService(url, options) {\n            'ngInject';\n\n            var _this = this;\n            var opts = (typeof options === \"undefined\" ? \"undefined\" : _typeof(options)) === 'object' ? options : {};\n            for (var key in opts) {\n                this[key] = opts[key];\n            }this.socket = null;\n            //list of ids of things being tracked, such as \n            // items edited, in order to send messages\n            // about the things lifecycle\n            this.tracking = {};\n            //events supported.\n            // Note that lifecycles can be added by using the \n            // begin() and end() methods on the service,\n            // which appends '_start' and '_end' respectively\n            this.events = {\n                CREATED: 'created',\n                UPDATED: 'updated',\n                DELETED: 'deleted',\n                EDITING: 'editing',\n                STATUS: 'status'\n            };\n            if (typeof io === 'undefined') {\n                console.log(\"Socket.IO not found in global namespace\");\n                return;\n            }\n            if (!url) {\n                console.log(\"No web socket URL configured for this app to communicate with\");\n                return;\n            }\n            //make connection\n            this.socket = io.connect(url);\n            //listen for the init event indicating connection has been made\n            // and to get the socket's id from the server\n            this.socket.on(\"init\", function (evt) {\n                _this.socketId = evt.id;\n            });\n            //if unable to connect\n            this.socket.on('error', function () {\n                console.log(\"Unable to connect to \" + url + \" with websockets\");\n            });\n        }\n        /**\n         *\n         */\n        SocketService.prototype.getId = function () {\n            return this.socketId;\n        };\n        /**\n         * @param {string} eventName\n         * @param {Function} callback\n         * @return {Function} to remove the listener\n         */\n        SocketService.prototype.on = function (eventName, callback) {\n            var _this = this;\n            if (!this.socket) return function () {};\n            //add the listener to the socket\n            this.socket.on(eventName, callback);\n            //return an 'off' function to remove the listener\n            return function () {\n                _this.socket.off(eventName, callback);\n            };\n        };\n        /**\n         *\n         */\n        SocketService.prototype.emit = function (eventName, data, callback) {\n            if (!this.socket) return;\n            this.socket.emit(eventName, data, callback);\n        };\n        /**\n         * Closes this service's socket\n         */\n        SocketService.prototype.close = function () {\n            var _this = this;\n            //if this app was tracking an obj, \n            // notify listeners that it is no longer\n            for (var event in this.tracking) {\n                if (this.tracking.hasOwnProperty(event)) {\n                    var tracks = this.tracking[event];\n                    if (tracks && tracks.length) {\n                        /* jshint ignore:start */\n                        angular.forEach(tracks, function (id) {\n                            _this.end(event, id);\n                        });\n                        /* jshint ignore:end */\n                    }\n                }\n            }\n            if (this.socket) {\n                this.socket.close();\n                this.socket = null;\n            }\n            return null;\n        };\n        /**\n         * @param {string} event - name of the event being started\n         * @param {string} objId - identifier of the item being tracked\n         */\n        SocketService.prototype.begin = function (event, objId) {\n            var _this = this;\n            this.tracking[event] = this.tracking[event] || [];\n            this.tracking[event].push(objId);\n            var room = objId + \"_\" + event.toLowerCase();\n            this.join(room, function () {\n                _this.socket.emit(event, room, _this.socketId, true);\n            });\n        };\n        /**\n         * @param {string} event - name of the event being ended\n         * @param {string} objId - identifier of the item being tracked\n         */\n        SocketService.prototype.end = function (event, objId) {\n            var _this = this;\n            this.tracking[event] = this.tracking[event] || [];\n            if (!this.tracking[event].length) return; //empty, ignore request\n            var idx = this.tracking[event].indexOf(objId);\n            if (idx < 0)\n                //remove tracker\n                this.tracking[event].splice(idx, 1);\n            //send event to server about client stopping it's tracking\n            var room = objId + \"_\" + event.toLowerCase();\n            this.socket.emit(event, room, this.socketId, false, function () {\n                _this.leave(room);\n            });\n        };\n        /**\n         *\n         */\n        SocketService.prototype.join = function (objId, callback) {\n            this.emit('join', objId, callback);\n        };\n        /**\n         *\n         */\n        SocketService.prototype.leave = function (objId, callback) {\n            this.emit('leave', objId, callback);\n        };\n        return SocketService;\n    }();\n    /**\n     * Factory to get a Service used to listen for WebSocket messages from a server\n     *\n     * Usage:\n     *\n     * let wsUrl = ...\n     * let service = SocketServiceFactory(wsUrl);\n     *\n     */\n    angular.module('gp-common').factory('SocketServiceFactory', function ($rootScope, $window, UUID) {\n        var cache = {};\n        //disconnect whenever the app is closed\n        var onClose = function onClose(e) {\n            for (var key in cache) {\n                if (cache.hasOwnProperty(key)) {\n                    cache[key].close();\n                    cache[key] = null;\n                }\n            }\n            cache = null;\n            return null;\n        };\n        //needed for reload/backbtn\n        if ($window.onbeforeunload === 'function') {\n            var existing_1 = $window.onbeforeunload;\n            $window.onbeforeunload = function (e) {\n                onClose(e);\n                return existing_1(e);\n            };\n        } else {\n            $window.onbeforeunload = onClose;\n        }\n        $rootScope.$on('$destroy', onClose);\n        //-------------------\n        return function (url) {\n            // if(!url) return null;\n            // if(cache[url]) return cache[url];\n            var cacheRef = UUID();\n            var service = new SocketService(url, $rootScope, { cacheRef: cacheRef });\n            var closeDelegate = service.close;\n            service.close = function () {\n                var id = service.cacheRef;\n                closeDelegate.call(service); //have service disconnect and clean up itself\n                //then clean up cache reference\n                delete cache[id];\n            };\n            var onDelegate = service.on;\n            service.on = function (event, callback) {\n                if (typeof callback === 'function') {\n                    //have to use old-school refs instead of arrow functions\n                    // or else the arguments get scrambled\n                    var handle = function handle() {\n                        var args = arguments;\n                        $rootScope.$apply(function () {\n                            callback.apply(service.socket, args);\n                        });\n                    };\n                    return onDelegate.call(service, event, handle);\n                } else {\n                    return onDelegate.call(service, event);\n                }\n            };\n            var emitDelegate = service.emit;\n            service.emit = function (event, data, callback) {\n                if (typeof callback === 'function') {\n                    //have to use old-school refs instead of arrow functions\n                    // or else the arguments get scrambled\n                    var handle = function handle() {\n                        var args = arguments;\n                        $rootScope.$apply(function () {\n                            callback.apply(service.socket, args);\n                        });\n                    };\n                    emitDelegate.call(service, event, data, handle);\n                } else {\n                    emitDelegate.call(service, event, data);\n                }\n            };\n            // cache[url] = service;\n            cache[cacheRef] = service;\n            return service;\n        };\n    });\n})(angular);\n\n(function (angular) {\n    'use strict';\n\n    angular.module(\"gp-common\").factory('UUID', function () {\n        function s4() {\n            return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);\n        }\n        /*\n        return function() {\n                return s4() + s4() + '-' + s4() + '-' + s4() + '-' +\n                    s4() + '-' + s4() + s4() + s4();\n            }\n         */\n        return function () {\n            // http://www.ietf.org/rfc/rfc4122.txt\n            var s = [];\n            var hexDigits = \"0123456789abcdef\";\n            for (var i = 0; i < 36; i++) {\n                s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);\n            }\n            s[14] = \"4\"; // bits 12-15 of the time_hi_and_version field to 0010\n            s[19] = hexDigits.substr(s[19] & 0x3 | 0x8, 1); // bits 6-7 of the clock_seq_hi_and_reserved to 01\n            s[8] = s[13] = s[18] = s[23] = \"-\";\n            return s.join(\"\");\n        };\n    });\n})(angular);\n\n(function () {\n    \"use strict\";\n\n    if (typeof Array.prototype.find === 'undefined') {\n        Array.prototype.find = function (callback) {\n            for (var i = 0; i < this.length; ++i) {\n                if (callback(this[i], i, this)) return this[i];\n            }\n            return null;\n        };\n    }\n    if (typeof Array.prototype.filter === 'undefined') {\n        Array.prototype.filter = function (callback) {\n            var results = [];\n            for (var i = 0; i < this.length; ++i) {\n                if (callback(this[i], i, this)) results.push(this[i]);\n            }\n            return results;\n        };\n    }\n    if (typeof Array.prototype.each === 'undefined') {\n        Array.prototype.each = function (callback) {\n            for (var i = 0; i < this.length; ++i) {\n                callback(this[i], i, this);\n            }\n        };\n    }\n    if (typeof Array.prototype.indexOfObj === 'undefined') {\n        Array.prototype.indexOfObj = function (obj, comparatorFn) {\n            var arr = this,\n                len = arr.length;\n            if (typeof comparatorFn !== 'function') comparatorFn = function comparatorFn(a, b) {\n                return a === b;\n            };\n            for (var i = 0; i < len; ++i) {\n                if (comparatorFn(obj, arr[i])) return i;\n            }\n            return -1;\n        };\n    }\n    if (typeof String.prototype.startsWith === 'undefined') {\n        String.prototype.startsWith = function (value) {\n            var str = this;\n            if (!str.length) return false;\n            if (!value.length) return false;\n            if (str.length < value.length) return false;\n            return str.indexOf(value) === 0;\n        };\n    }\n    if (typeof String.prototype.endsWith === 'undefined') {\n        String.prototype.endsWith = function (value) {\n            var str = this;\n            if (!str.length) return false;\n            if (!value.length) return false;\n            if (str.length < value.length) return false;\n            var substr = str.substring(str.length - value.length, str.length);\n            return substr == value;\n        };\n    }\n    if (typeof Date.prototype.plus === 'undefined') {\n        Date.prototype.plus = function (offset) {\n            var type = typeof offset === \"undefined\" ? \"undefined\" : _typeof(offset);\n            if (type === 'undefined') return this;\n            var offsetMS = 0;\n            if (type === 'string') {\n                switch (offset) {\n                    case 'hour':\n                        offsetMS = 1000 * 60 * 60;\n                        break;\n                    case 'day':\n                        offsetMS = 1000 * 60 * 60 * 24;\n                        break;\n                    case 'week':\n                        offsetMS = 1000 * 60 * 60 * 24 * 7;\n                        break;\n                    case 'month':\n                        offsetMS = 1000 * 60 * 60 * 24 * 31;\n                        break;\n                    case 'year':\n                        offsetMS = 1000 * 60 * 60 * 24 * 365;\n                        break;\n                }\n            } else if (type === 'number') {\n                offsetMS = offset;\n            } else return this;\n            var d = this;\n            return new Date(d.getTime() + offsetMS);\n        };\n    }\n    if (typeof Date.prototype.random === 'undefined') {\n        Date.prototype.random = function (threshold) {\n            var type = typeof threshold === \"undefined\" ? \"undefined\" : _typeof(threshold);\n            if (type === 'undefined') return this;\n            var offsetMS = 0;\n            if (type === 'string') {\n                switch (threshold) {\n                    case 'hour':\n                        offsetMS = 1000 * 60 * 60;\n                        break;\n                    case 'day':\n                        offsetMS = 1000 * 60 * 60 * 24;\n                        break;\n                    case 'week':\n                        offsetMS = 1000 * 60 * 60 * 24 * 7;\n                        break;\n                    case 'month':\n                        offsetMS = 1000 * 60 * 60 * 24 * 31;\n                        break;\n                    case 'year':\n                        offsetMS = 1000 * 60 * 60 * 24 * 365;\n                        break;\n                }\n            } else if (type === 'number') {\n                offsetMS = threshold;\n            } else return this;\n            var d = this;\n            return new Date(d.getTime() + Math.floor(Math.random() * offsetMS));\n        };\n    }\n})();\n\n/// <reference path=\"../types.ts\" />\n(function (angular) {\n    'use strict';\n    //flag on whether we're in dev env\n    // function isDEV() {\n    //     return \"localhost\" === window.location.hostname ||\n    //         ~window.location.hostname.indexOf(\"192.168\")||\n    //         ~window.location.hostname.indexOf(\"localhost\")||\n    //         ~window.location.hostname.indexOf(\"10.0\");\n    // }\n    /**\n     * Get token from query string\n     *\n     * Note:\n     *  Lifted outside of any Angular service to prevent cyclical service dependencies.\n     *\n     * @method getJWTFromUrl\n     * @returns {String} token - token in query string or undefined\n     */\n\n    function getJWTFromUrl() {\n        var queryString = window.location.hash ? window.location.hash : window.location.href;\n        var res = queryString.match(/access_token=([^\\&]*)/);\n        return res && res[1];\n    }\n    ;\n    /**\n     * GeoPlatform Common Module Authentication Support\n     *\n     * Contains re-usable services, directives, and other angular components\n     *\n     *\n     * NOTE: This module uses certain variables in $rootScope in order to\n     * perform actions like authentication.  The following variables should be\n     * set before using any service/directive in this file:\n     *\n     *   - idspUrl : the url to the identity service provider server\n     *   - idmUrl : the url to the identity management server\n     *   - portalUrl : the url to the main landing page of GeoPlatform (www.geoplatform.gov in production)\n     */\n    angular.module('gp-common').service('AuthenticationService', ['$q', '$http', '$location', '$rootScope', '$window', 'GPConfig', function ($q, $http, $location, $rootScope, $window, Config) {\n        //extend Storage prototype\n        Storage.prototype.setObject = function (key, value) {\n            this.setItem(key, btoa(JSON.stringify(value)));\n        };\n        Storage.prototype.getObject = function (key) {\n            var value = atob(this.getItem(key));\n            return value && JSON.parse(value);\n        };\n        var User = /** @class */function () {\n            function User(opts) {\n                this.id = opts.sub;\n                this.username = opts.username;\n                this.name = opts.name;\n                this.email = opts.email;\n                this.org = opts.orgs[0] && opts.orgs[0].name;\n                this.groups = opts.groups;\n                this.exp = opts.exp;\n            }\n            User.prototype.toJSON = function () {\n                return JSON.parse(JSON.stringify(this));\n            };\n            ;\n            User.prototype.clone = function () {\n                return Object.assign({}, this);\n            };\n            ;\n            User.prototype.compare = function (arg) {\n                if (arg instanceof User) {\n                    return this.id === arg.id;\n                } else if ((typeof arg === \"undefined\" ? \"undefined\" : _typeof(arg)) === 'object') {\n                    return typeof arg.id !== 'undefined' && arg.id === this.id;\n                }\n                return false;\n            };\n            ;\n            User.prototype.isAuthorized = function (role) {\n                var env = Config.env || Config.ENV || Config.NODE_ENV;\n                if (env === 'dev' || env === 'development') return true;\n                return this.groups && !!this.groups.map(function (g) {\n                    return g.name;\n                }).filter(function (n) {\n                    return n === role;\n                }).length;\n            };\n            ;\n            return User;\n        }();\n        /**\n         * Authentication Service\n         */\n        var AuthService = /** @class */function () {\n            function AuthService() {\n                this.init();\n            }\n            /**\n             * Redirects or displays login window the page to the login site\n             */\n            AuthService.prototype.login = function () {\n                // Check implicit we need to actually redirect them\n                if (Config.AUTH_TYPE === 'token') {\n                    window.location.href = Config.IDP_BASE_URL + '/auth/authorize?client_id=' + Config.APP_ID + '&response_type=' + Config.AUTH_TYPE + '&redirect_uri=' + encodeURIComponent(Config.CALLBACK || '/login');\n                    // Otherwise pop up the login modal\n                } else {\n                    // Iframe login\n                    if (Config.ALLOWIFRAMELOGIN === true || Config.ALLOWIFRAMELOGIN === 'true') {\n                        $rootScope.$broadcast('auth:requireLogin');\n                        // Redirect login\n                    } else {\n                        window.location.href = Config.LOGIN_URL || \"/login\" + (\"?redirect_url=\" + encodeURIComponent(window.location.href));\n                    }\n                }\n            };\n            ;\n            /**\n             * Performs background logout and requests jwt revokation\n             */\n            AuthService.prototype.logout = function () {\n                var self = this;\n                $http.get(Config.IDP_BASE_URL + '/auth/revoke').then(function (response) {\n                    window.location.href = Config.LOGOUT_URL ? Config.LOGOUT_URL : window.location.host;\n                }).catch(function (err) {\n                    return console.log(err);\n                }).finally(function () {\n                    return self.removeAuth();\n                });\n            };\n            ;\n            /**\n             * Optional force redirect for non-public services\n             */\n            AuthService.prototype.forceLogin = function () {\n                this.login();\n            };\n            ;\n            /**\n             * Get protected user profile\n             */\n            AuthService.prototype.getOauthProfile = function () {\n                var Q = $q.defer();\n                //check to make sure we can make called\n                if (this.getJWT()) {\n                    $http.get(Config.IDP_BASE_URL + '/api/profile').then(function (response) {\n                        return Q.resolve(response);\n                    }).catch(function (err) {\n                        return Q.reject(err);\n                    });\n                } else {\n                    Q.reject(null);\n                }\n                return Q.promise;\n            };\n            ;\n            /**\n             * Unpacks JWT to see if session is valid.\n             *\n             * Side Effects:\n             *  - Will redirect user to login url if FORCE_LOGIN is set an no valid user is found\n             *\n             * @return {User} - the authenticated user or undefined\n             */\n            AuthService.prototype.init = function () {\n                var jwt = this.getJWT();\n                if (jwt) {\n                    this.setAuth(jwt); // Save JWT in Auhorization Header\n                    // No valid userdata found\n                } else {\n                    // Redirect if settings set\n                    if (Config.FORCE_LOGIN === true) this.forceLogin();\n                }\n                //clean hosturl on redirect from oauth\n                if (getJWTFromUrl()) {\n                    if (window.history && window.history.replaceState) {\n                        window.history.replaceState({}, 'Remove token from URL', $window.location.href.replace(/[\\?\\&\\%3F]access_token=[^\\&]*\\&token_type=Bearer/, ''));\n                    } else {\n                        $window.location.search.replace(/[\\?\\&]access_token=[^\\&]*\\&token_type=Bearer/, '');\n                    }\n                }\n                // return the user\n                return this.getUserFromJWT(jwt);\n            };\n            ;\n            /**\n             * Get User object from the JWT.\n             *\n             * If no JWT is provided it will be looked for at the normal JWT\n             * locations (localStorage or URL queryString).\n             *\n             * @param {JWT} [jwt] - the JWT to extract user from.\n             */\n            AuthService.prototype.getUserFromJWT = function (jwt) {\n                var user = this.parseJwt(jwt);\n                return user ? new User(Object.assign({}, user, { id: user.sub })) : null;\n            };\n            /**\n             * If the callback parameter is specified, this method\n             * will return undefined. Otherwise, it returns the user (or null).\n             *\n             * Side Effects:\n             *  - Will redirect users if no valid JWT was found\n             *\n             * @param callback optional function to invoke with the user\n             * @return object representing current user\n             */\n            AuthService.prototype.getUser = function (callback) {\n                var jwt = this.getJWT();\n                // If callback provided we can treat async and call server\n                if (callback && typeof callback === 'function') {\n                    this.check().then(function (user) {\n                        return callback(user);\n                    });\n                    // If no callback we have to provide a sync response (no network)\n                } else {\n                    // We allow front end to get user data if grant type and expired\n                    // because they will recieve a new token automatically when\n                    // making a call to the client(application)\n                    return this.isImplicitJWT(jwt) && this.isExpired(jwt) ? null : this.getUserFromJWT(jwt);\n                }\n            };\n            //$q version of getUser\n            AuthService.prototype.getUserQ = function () {\n                return this.check();\n            };\n            ;\n            /**\n             * Check function being used by some front end apps already.\n             * (wrapper for getUser)\n             *\n             * @method check\n             * @returns {User} - ng-common user object or null\n             */\n            AuthService.prototype.check = function () {\n                var _this = this;\n                var jwt = this.getJWT();\n                if (!jwt) return $q.when(null);\n                if (!this.isImplicitJWT(jwt)) {\n                    return this.isExpired(jwt) ? this.checkWithClient(jwt).then(function (jwt) {\n                        return _this.getUserFromJWT(jwt);\n                    }) : // Check with server\n                    $q.when(this.getUserFromJWT(jwt));\n                } else {\n                    return this.isExpired(jwt) ? $q.reject(null) : $q.when(this.getUserFromJWT(jwt));\n                }\n            };\n            /**\n             * Makes a call to a service hosting node-gpoauth to allow for a\n             * token refresh on an expired token, or a token that has been\n             * invalidated to be revoked.\n             *\n             * Note: Client as in hosting application:\n             *    https://www.digitalocean.com/community/tutorials/an-introduction-to-oauth-2\n             *\n             * @method checkWithClient\n             * @param {jwt} - encoded accessToken/JWT\n             *\n             * @return {Promise<jwt>} - promise resolving with a JWT\n             */\n            AuthService.prototype.checkWithClient = function (originalJWT) {\n                var _this = this;\n                return $http.get('/checktoken').then(function (resp) {\n                    var header = resp.headers('Authorization');\n                    var newJWT = header && header.replace('Bearer ', '');\n                    if (newJWT) _this.setAuth(newJWT);\n                    return newJWT ? newJWT : originalJWT;\n                });\n            };\n            //=====================================================\n            /**\n             * Extract token from current URL\n             *\n             * @method getJWTFromUrl\n             *\n             * @return {String | undefined} - JWT Token (raw string)\n             */\n            AuthService.prototype.getJWTFromUrl = function () {\n                var queryString = $window && $window.location && $window.location.hash ? $window.location.hash : $location.url();\n                var res = queryString.match(/access_token=([^\\&]*)/);\n                return res && res[1];\n            };\n            ;\n            /**\n             * Load the JWT stored in local storage.\n             *\n             * @method getJWTfromLocalStorage\n             *\n             * @return {JWT | undefined} An object wih the following format:\n             */\n            AuthService.prototype.getJWTfromLocalStorage = function () {\n                return window.localStorage.gpoauthJWT;\n            };\n            ;\n            /**\n             * Attempt and pull JWT from the following locations (in order):\n             *  - URL query parameter 'access_token' (returned from IDP)\n             *  - Browser local storage (saved from previous request)\n             *\n             * NOTE:\n             *  This call will redirect user to login if the Config.FORCE_LOGIN\n             *  option is set to true.\n             *\n             * @method getJWT\n             *\n             * @return {JWT | undefined}\n             */\n            AuthService.prototype.getJWT = function () {\n                var jwt = this.getJWTFromUrl() || this.getJWTfromLocalStorage();\n                // Only deny implicit tokens that have expired\n                if (!jwt || jwt && this.isExpired(jwt) && this.isImplicitJWT(jwt)) {\n                    this.removeAuth();\n                    if (Config.FORCE_LOGIN === true) this.forceLogin();\n                    return null;\n                } else {\n                    return jwt;\n                }\n            };\n            ;\n            /**\n             * Remove the JWT saved in local storge.\n             *\n             * @method clearLocalStorageJWT\n             *\n             * @return  {undefined}\n             */\n            AuthService.prototype.clearLocalStorageJWT = function () {\n                delete window.localStorage.gpoauthJWT;\n            };\n            ;\n            /**\n             * Is a token expired.\n             *\n             * @method isExpired\n             * @param {JWT} jwt - A JWT\n             *\n             * @return {boolean}\n             */\n            AuthService.prototype.isExpired = function (jwt) {\n                var parsedJWT = this.parseJwt(jwt);\n                if (parsedJWT) {\n                    var now = new Date().getTime() / 1000;\n                    return now > parsedJWT.exp;\n                }\n                return true;\n            };\n            ;\n            /**\n             * Is the JWT an implicit JWT?\n             * @param jwt\n             */\n            AuthService.prototype.isImplicitJWT = function (jwt) {\n                var parsedJWT = this.parseJwt(jwt);\n                return parsedJWT && parsedJWT.implicit;\n            };\n            /**\n             * Unsafe (signature not checked) unpacking of JWT.\n             *\n             * @param {string} token - Access Token (JWT)\n             *\n             * @return {Object} the parsed payload in the JWT\n             */\n            AuthService.prototype.parseJwt = function (token) {\n                var parsed;\n                if (token) {\n                    try {\n                        var base64Url = token.split('.')[1];\n                        var base64 = base64Url.replace('-', '+').replace('_', '/');\n                        parsed = JSON.parse(atob(base64));\n                    } catch (e) {}\n                }\n                return parsed;\n            };\n            ;\n            /**\n             * Simple front end validion to verify JWT is complete and not\n             * expired.\n             *\n             * Note:\n             *  Signature validation is the only truly save method. This is done\n             *  automatically in the node-gpoauth module.\n             */\n            AuthService.prototype.validateJwt = function (token) {\n                var parsed = this.parseJwt(token);\n                var valid = parsed && parsed.exp && parsed.exp * 1000 > Date.now() ? true : false;\n                return valid;\n            };\n            ;\n            /**\n             * Save JWT to localStorage and in the request headers for accessing\n             * protected resources.\n             *\n             * @param {JWT} jwt\n             */\n            AuthService.prototype.setAuth = function (jwt) {\n                window.localStorage.gpoauthJWT = jwt;\n                $http.defaults.headers.common.Authorization = 'Bearer ' + jwt;\n                // $http.defaults.useXDomain = true;\n            };\n            ;\n            /**\n             * Purge the JWT from localStorage and authorization headers.\n             */\n            AuthService.prototype.removeAuth = function () {\n                delete window.localStorage.gpoauthJWT;\n                delete $http.defaults.headers.common.Authorization;\n                $rootScope.$broadcast(\"userSignOut\");\n                // $http.defaults.useXDomain = false;\n            };\n            ;\n            return AuthService;\n        }();\n        return new AuthService();\n    }]).factory('ng-common-AuthenticationInterceptor', function ($injector, $window) {\n        // Interceptor\n        return {\n            response: function response(resp) {\n                var jwt = getJWTFromUrl();\n                var authHeader = resp.headers('Authorization');\n                if (jwt) {\n                    var AuthenticationService = $injector.get('AuthenticationService');\n                    AuthenticationService.setAuth(jwt);\n                } else if (authHeader) {\n                    var AuthenticationService = $injector.get('AuthenticationService');\n                    var token = authHeader.replace('Bearer', '').trim();\n                    AuthenticationService.setAuth(token);\n                }\n                return resp;\n            }\n        };\n    }).config(function myAppConfig($httpProvider) {\n        $httpProvider.interceptors.push('ng-common-AuthenticationInterceptor');\n    }).directive('gpLoginModal', ['$rootScope', 'AuthenticationService', 'GPConfig', function ($rootScope, AuthenticationService, Config) {\n        return {\n            scope: {\n                minimal: '@'\n            },\n            replace: true,\n            template: ['<div class=\"gpLoginCover\" ng-if=\"requireLogin\">' + '   <div class=\"gpLoginWindow\">' + '     <iframe src=\"/login\"></iframe>' + '   </div>' + '</div>'].join(' '),\n            controller: function controller($scope, $element) {\n                $scope.requireLogin = false;\n                function startAuthIntervalCheck(delay) {\n                    // Setup check for localstorage set and close iframe when set\n                    var timeout = setInterval(function () {\n                        AuthenticationService.check().then(function (user) {\n                            if (user) {\n                                // close iframe\n                                $scope.requireLogin = false;\n                                $rootScope.$broadcast(\"userAuthenticated\", user);\n                                clearTimeout(timeout); // All Done here\n                                AuthenticationService.init();\n                            }\n                        });\n                    }, delay);\n                }\n                // Catch the request to display login modal\n                $scope.$on('auth:requireLogin', function () {\n                    $scope.requireLogin = true;\n                    startAuthIntervalCheck(500);\n                });\n            }\n        };\n    }]).directive('gpLoginButton', ['$rootScope', '$timeout', 'AuthenticationService', 'GPConfig', function ($rootScope, $timeout, AuthenticationService, Config) {\n        return {\n            scope: {\n                minimal: '@'\n            },\n            replace: true,\n            template: ['<div class=\"btn-account btn-group\">' +\n            //not logged in\n            '  <a class=\"btn btn-link\" ng-click=\"login()\" ng-if=\"!user\">Sign In</a>' +\n            //logged in\n            '  <button type=\"button\" class=\"btn btn-link dropdown-toggle\" data-toggle=\"dropdown\" ' + '   aria-expanded=\"false\" ng-if=\"user\">' + '     <span class=\"glyphicon glyphicon-user\"></span> ' + '     <span class=\"hidden-xs\">{{::user.name}}</span> ' + '     <span class=\"caret\"></span>' + '  </button>' + '  <ul class=\"dropdown-menu dropdown-menu-right\" role=\"menu\" ng-if=\"user\">' + '    <li class=\"account-details\">' + '      <div class=\"media\">' + '        <div class=\"media-left\">' + '          <div class=\"media-object\">' + '            <span class=\"glyphicon glyphicon-user glyphicon-xlg\"></span>' + '          </div>' + '        </div>' + '        <div class=\"media-body\">' + '          <div class=\"media-heading\">{{::user.name}}</div>' + '          <div><em>{{::user.username}}</em></div>' + '          <div>{{::user.email}}</div>' + '          <div>{{::user.org}}</div>' + '        </div>' + '      </div>' + '    </li>' + '    <li class=\"divider\"></li>' + '    <li><a href=\"{{::idpUrl}}/modifyuser.html\">Edit Info</a></li>' + '    <li><a href=\"{{::idpUrl}}/changepassword.html\">Change Password</a></li>' + '    <li><a href ng-click=\"logout()\">Sign Out</a></li>' + '  </ul>' + '</div>'].join(' '),\n            controller: function controller($scope, $element) {\n                if ($scope.minimal === 'true') $scope.minimal = true;\n                if ($scope.minimal !== true) $scope.minimal = false;\n                $scope.idpUrl = Config.idmUrl;\n                // console.log(\"IDM Base Url: \" + Config.idmUrl);\n                AuthenticationService.getUser(function (user) {\n                    $timeout(function () {\n                        $scope.user = user;\n                    }, 100);\n                });\n                $scope.login = function () {\n                    $scope.user = AuthenticationService.login();\n                };\n                $scope.logout = function () {\n                    $scope.user = AuthenticationService.logout();\n                };\n                $rootScope.$on('userAuthenticated', function (event, user) {\n                    $scope.user = user;\n                });\n            }\n        };\n    }]).directive('gpAccountDetails', ['$timeout', 'AuthenticationService', 'GPConfig', function ($timeout, AuthenticationService, Config) {\n        return {\n            scope: {},\n            replace: true,\n            template: ['<div>' + '  <div class=\"media\">', '    <div class=\"media-left\">', '        <div class=\"media-object\">', '            <span class=\"glyphicon glyphicon-user glyphicon-xlg\"></span>', '        </div>', '    </div>', '    <div class=\"media-body\" ng-if=\"user\">', '       <div class=\"media-heading\">{{::user.name}}</div>' + '       <div><small><em>{{::user.username}}</em></small></div>' + '       <div><small>{{::user.email}}</small></div>' + '       <div><small>{{::user.org}}</small></div>' + '    </div>', '    <div class=\"media-body\" ng-if=\"!user\">', '       <div class=\"media-heading\">Please Sign In</div>' + '       <div><small>Sign in to your GeoPlatform account or register a new account.</small></div>' + '    </div>', '  </div>', '  <hr/>', '  <div ng-if=\"user\">', '    <button type=\"button\" class=\"btn btn-sm btn-accent pull-right\" ng-click=\"logout()\">Sign Out</button>' + '    <a class=\"btn btn-sm btn-default\" href=\"{{::idpUrl}}/modifyuser.html\">Edit Details</a>' + '  </div>', '  <div ng-if=\"!user\">', '    <button type=\"button\" class=\"btn btn-sm btn-accent pull-right\" ng-click=\"login()\">Sign In</button>' + '    <a class=\"btn btn-sm btn-default\" href=\"{{::idpUrl}}/registeruser.html\">Register</a>' + '  </div>', '</div>'].join(' '),\n            controller: function controller($scope, $element) {\n                $scope.idpUrl = Config.idmUrl;\n                AuthenticationService.getUser(function (user /* TODO: lift User */) {\n                    $timeout(function () {\n                        $scope.user = user;\n                    }, 100);\n                });\n                $scope.login = function () {\n                    $scope.user = AuthenticationService.login();\n                };\n                $scope.logout = function () {\n                    $scope.user = AuthenticationService.logout();\n                };\n            }\n        };\n    }]);\n})(angular);","/**\n *\n * KnowledgeGraph property on RIM Asset renamed to Classifiers\n *\n */\n(function (jQuery, angular, Constants) {\n    'use strict';\n    angular.module('gp-common-kg', [])\n        .constant('KGFields', [\n        'purposes', 'functions', 'primaryTopics', 'secondaryTopics',\n        'primarySubjects', 'secondarySubjects', 'communities', 'audiences',\n        'places', 'categories'\n    ])\n        .service('KGHelper', ['KGFields', 'RecommenderServiceFactory',\n        function (KGFields, RecommenderServiceFactory) {\n            return {\n                calculate: function (kg) {\n                    if (!kg)\n                        return 0;\n                    var result = 0;\n                    angular.forEach(KGFields, function (prop) {\n                        if (kg[prop] && kg[prop].length)\n                            result += 7 + Math.floor((kg[prop].length - 1) / 2);\n                        // result += kg[prop] ? kg[prop].length*5 : 0;\n                    });\n                    return result;\n                },\n                getService: function (type) {\n                    return RecommenderServiceFactory(type);\n                }\n            };\n        }])\n        .service(\"RecommenderService\", function ($resource) {\n        var baseUrl = Constants.ualUrl + '/api/recommender';\n        return $resource(baseUrl, {}, {\n            query: {\n                url: baseUrl + '/suggest',\n                isArray: false\n            },\n            queryTypes: {\n                url: baseUrl + '/types',\n                isArray: false\n            },\n            querySources: {\n                url: baseUrl + '/sources',\n                isArray: false\n            }\n        });\n    })\n        .factory(\"RecommenderServiceFactory\", function ($resource) {\n        return function (type) {\n            var baseUrl = Constants.ualUrl + '/api/recommender';\n            return $resource(baseUrl, { 'for': type }, {\n                query: {\n                    url: baseUrl + '/suggest',\n                    isArray: false\n                },\n                queryTypes: {\n                    url: baseUrl + '/types',\n                    isArray: false\n                },\n                querySources: {\n                    url: baseUrl + '/sources',\n                    isArray: false\n                }\n            });\n        };\n    })\n        .component('kgCompletionDisplay', {\n        bindings: {\n            ngModel: '<' // the Asset containing the knowledge graph ('classifiers') property\n        },\n        controller: function ($rootScope, KGHelper) {\n            this.$onInit = function () {\n                var _this = this;\n                this.update();\n                this.listener = $rootScope.$on('gp:kg:updated', function (event, item) {\n                    if (item && item.id === _this.id) {\n                        //in case kg didn't exist, \n                        if (!_this.ngModel.classifiers)\n                            _this.ngModel.classifiers = item.classifiers;\n                        _this.value = KGHelper.calculate(_this.ngModel.classifiers);\n                    }\n                });\n            };\n            this.$onChanges = function () {\n                this.update();\n            };\n            this.$onDestroy = function () {\n                this.listener();\n                this.listener = null;\n            };\n            this.update = function () {\n                var _this = this;\n                if (this.ngModel.$promise && !this.ngModel.$resolved) {\n                    this.ngModel.$promise.then(function (model) { _this.update(); });\n                    return;\n                }\n                this.id = this.ngModel ? this.ngModel.id : null;\n                this.value = KGHelper.calculate(this.ngModel.classifiers);\n            };\n        },\n        template: \"\\n            <span>{{$ctrl.value||0}}%</span>\\n            <span class=\\\"glyphicon glyphicon-dashboard\\\"></span>\\n        \"\n    });\n})(jQuery, angular, GeoPlatform);\n","(function (angular) {\n    \"use strict\";\n    var ACTIVATORS_HTML = \"\\n            <div class=\\\"gp-ui-card__details-activator--left\\\" title=\\\"Show previous details\\\"\\n                ng-class=\\\"{disabled:!hasPrevious()}\\\" ng-click=\\\"previousDetails()\\\">\\n                <span class=\\\"glyphicon glyphicon-chevron-left\\\"></span>\\n            </div>\\n            <div class=\\\"gp-ui-card__details-activator--right\\\" title=\\\"Show next details\\\"\\n                ng-class=\\\"{disabled:!hasNext()}\\\" ng-click=\\\"nextDetails()\\\">\\n                <span class=\\\"glyphicon glyphicon-chevron-right\\\"></span>\\n            </div>\\n        \";\n    /*\n     * Appends carousel-like activators onto a card section\n     * Usage:\n     *\n     *  <div class=\"text--supporting\" card-details-carousel-activator>\n     *      <div class=\"gp-ui-card__details active\" id=\"description\">...</div>\n     *      <div class=\"gp-ui-card__details\" id=\"author\">...</div>\n     *  </div>\n     */\n    angular.module(\"gp-common\").directive('cardDetailsCarouselActivator', function () {\n        return {\n            compile: function ($element) {\n                $element.append(ACTIVATORS_HTML);\n            },\n            controller: function ($scope, $element) {\n                $scope.hasPrevious = function () {\n                    var pane = $element.find('.gp-ui-card__details.active');\n                    return pane.prevAll('.gp-ui-card__details').length;\n                };\n                $scope.hasNext = function () {\n                    var pane = $element.find('.gp-ui-card__details.active');\n                    return pane.nextAll('.gp-ui-card__details').length;\n                };\n                $scope.previousDetails = function () {\n                    if (!$scope.hasPrevious())\n                        return;\n                    var pane = $element.find('.gp-ui-card__details.active');\n                    pane.removeClass('active');\n                    pane = pane.prevAll('.gp-ui-card__details');\n                    if (pane.length)\n                        angular.element(pane[0]).addClass('active');\n                };\n                $scope.nextDetails = function () {\n                    if (!$scope.hasNext())\n                        return;\n                    var pane = $element.find('.gp-ui-card__details.active');\n                    pane.removeClass('active');\n                    pane = pane.nextAll('.gp-ui-card__details');\n                    if (pane.length)\n                        angular.element(pane[0]).addClass('active');\n                };\n            }\n        };\n    });\n})(angular);\n","(function (jQuery, angular) {\n    'use strict';\n    /**\n     * determines whether an rgb value is invalid\n     * the value starts as false (the rbg value is valid)\n     * and is invalidated if the value(s) are empty, greater than 255 or less than 0\n     *\n     * @param rgb either an object { r: 0, g: 0, b: 0 } or a single value\n     * @returns {boolean} whether the rgb value is invalid\n     */\n    function invalidRGB(rgb) {\n        var error = false;\n        if (rgb instanceof Object) {\n            var r = parseInt(rgb.r, 10);\n            var g = parseInt(rgb.g, 10);\n            var b = parseInt(rgb.b, 10);\n            if (r > 255 || r < 0 || (!r && r !== 0))\n                error = true;\n            if (g > 255 || g < 0 || (!g && g !== 0))\n                error = true;\n            if (b > 255 || b < 0 || (!b && b !== 0))\n                error = true;\n        }\n        else {\n            var x = parseInt(rgb, 10);\n            if (x > 255 || x < 0 || (!x && x !== 0))\n                error = true;\n        }\n        return error;\n    }\n    /**\n     * converts a decimal (base 10) number to hex (base 16) string\n     *\n     * @param c base 10 number\n     * @returns {*} base 16 string\n     */\n    function componentToHex(c) {\n        var hex = c.toString(16), result = null;\n        if (!isNaN(c) && !invalidRGB(c))\n            result = hex.length == 1 ? '0' + hex : hex;\n        return result;\n    }\n    /**\n     * converts an rgb object to a hexadecimal string\n     *\n     * @param rgb object { r: 0, g: 0, b: 0 }\n     * @returns {*} hexadecimal string\n     */\n    function rgbToHex(rgb) {\n        var result = null;\n        var r = componentToHex(parseInt(rgb.r, 10));\n        var g = componentToHex(parseInt(rgb.g, 10));\n        var b = componentToHex(parseInt(rgb.b, 10));\n        if (r && g && b)\n            result = '#' + r + g + b;\n        return result;\n    }\n    /**\n     * determines whether a hex value is valid\n     *\n     * @param hex string value\n     * @returns hex value or null if hex is invalid\n     */\n    function validHex(hex) {\n        return (/^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i).exec(hex) || null;\n    }\n    /**\n     * converts a hex string to rgb object\n     *\n     * @param hex string\n     * @returns {*} rgb object { r: 0, g: 0, b: 0 }\n     */\n    function hexToRgb(hex) {\n        // Expand shorthand form (e.g. '03F') to full form (e.g. '0033FF')\n        var shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n        hex = hex.replace(shorthandRegex, function (m, r, g, b) {\n            return r + r + g + g + b + b;\n        });\n        var result = validHex(hex);\n        return result ? {\n            r: parseInt(result[1], 16),\n            g: parseInt(result[2], 16),\n            b: parseInt(result[3], 16)\n        } : null;\n    }\n    /**\n     * Advanced Color Picker Directive (advanced-color-picker)\n     * This color picker is meant to augment the functionality in angular-bootstrap-colorpicker\n     * It adds the ability to change the color with RGB and Hex\n     * It needs to be used in a container that has at least 160px of vertical real estate\n     *\n     * You must pass in the following:\n     *   - ngModel  (a hexadecimal string color value)\n     *   - onChange (the event to be fired when the value changes)\n     *\n     * Usage Example:\n     * <div advanced-color-picker ng-model=\"hexColor\" ng-change=\"changeEvent()\"></div>\n     */\n    angular.module('gp-common').component('gpColorPicker', {\n        bindings: {\n            ngModel: '=',\n            onChange: '&'\n        },\n        controller: function ($timeout, $q) {\n            // fired when an rgb value is changed\n            this.changeRGB = function () {\n                // make sure rgb color value is correct\n                this.rgbError = invalidRGB(this.rgb);\n                // parse it anyways leaving hex value blank until valid rbg\n                this.ngModel = rgbToHex(this.rgb);\n                // have to use timeout to make sure ngModel is set before\n                // firing change event upstream\n                var self = this;\n                $timeout(function () {\n                    self.onChange({ value: self.ngModel });\n                });\n            };\n            // fired when a hex value is changed\n            this.changeHex = function () {\n                // make sure the hex color value is correct\n                if (!validHex(this.ngModel))\n                    this.hexError = 'Invalid hex color value';\n                else\n                    this.hexError = false;\n                // parse it anyway leaving rgb values blank until it's a valid hex\n                this.rgb = hexToRgb(this.ngModel);\n                // have to use timeout to make sure ngModel is set before\n                // firing change event upstream\n                var self = this;\n                $timeout(function () {\n                    self.onChange({ value: self.ngModel });\n                });\n            };\n            this.$onInit = function () {\n                this.rgb = hexToRgb(this.ngModel);\n            };\n        },\n        template: \"\\n            <div class=\\\"gp-colorpicker\\\">\\n                <div class=\\\"form-group hex-form-group\\\" ng-class=\\\"{'has-error':$ctrl.hexError}\\\">\\n                    <input type=\\\"text\\\" class=\\\"form-control\\\"\\n                        ng-model=\\\"$ctrl.ngModel\\\" ng-keyup=\\\"$ctrl.changeHex()\\\">\\n                </div>\\n                <div class=\\\"gp-colorpicker__wrapper\\\">\\n                    <div colorpicker colorpicker-inline=\\\"true\\\" colorpicker-parent=\\\"true\\\" \\n                        ng-model=\\\"$ctrl.ngModel\\\" ng-change=\\\"$ctrl.changeHex()\\\"></div>\\n                </div>\\n                <div class=\\\"form-group rgb-form-group\\\" ng-class=\\\"{'has-error':$ctrl.rgbError}\\\">\\n                    <input type=\\\"text\\\" class=\\\"form-control\\\"\\n                        placeholder=\\\"R\\\" ng-model=\\\"$ctrl.rgb.r\\\" ng-keyup=\\\"$ctrl.changeRGB()\\\" title=\\\"R\\\">\\n                    <input type=\\\"text\\\" class=\\\"form-control\\\"\\n                        placeholder=\\\"G\\\" ng-model=\\\"$ctrl.rgb.g\\\" ng-keyup=\\\"$ctrl.changeRGB()\\\" title=\\\"G\\\">\\n                    <input type=\\\"text\\\" class=\\\"form-control\\\"\\n                        placeholder=\\\"B\\\" ng-model=\\\"$ctrl.rgb.b\\\" ng-keyup=\\\"$ctrl.changeRGB()\\\" title=\\\"B\\\">\\n                </div>\\n            </div>\\n        \"\n    });\n})(jQuery, angular);\n","(function (jQuery, angular) {\n    'use strict';\n    angular.module('gp-common').directive('gpDatePicker', ['$timeout', function ($timeout) {\n            return {\n                scope: {\n                    label: '@',\n                    format: '@',\n                    date: '=',\n                    onChange: '&?'\n                },\n                template: [\n                    '<div class=\"input-group-slick\">',\n                    '    <input type=\"text\" class=\"form-control\" placeholder=\"{{::label}}\"',\n                    '        datepicker-popup=\"{{format}}\" ng-model=\"date\" is-open=\"opened\" />',\n                    '    <span class=\"glyphicon glyphicon-calendar\" ng-click=\"toggle($event)\"></span>',\n                    '</div>',\n                    '<p class=\"help-block\"><small><em>Ex: \"2015-01-31\" or \"Jan 31 2015\"</em></small></p>'\n                ].join(' '),\n                controller: function ($scope, $element, $attrs) {\n                    //toggle date picker\n                    $scope.toggle = function (event) {\n                        event.preventDefault();\n                        event.stopPropagation();\n                        this.opened = !this.opened;\n                    };\n                    if (!$scope.format)\n                        $scope.format = 'MMM dd yyyy';\n                    var promise = null;\n                    $scope.debounce = function () {\n                        if (promise)\n                            $timeout.cancel(promise);\n                        promise = $timeout(function () {\n                            promise = null;\n                            if ($scope.onChange)\n                                $scope.onChange();\n                        }, 200);\n                    };\n                    $scope.$watch('date', function () {\n                        $scope.debounce();\n                    });\n                    var listener = $scope.$on('$destroy', function () {\n                        listener(); //deregister listener\n                        if (promise)\n                            $timeout.cancel(promise);\n                        promise = null;\n                        $scope.opened = false; //close picker if open\n                        $scope.onChange = null;\n                        $scope.format = null;\n                        $scope.debounce = null;\n                    });\n                }\n            };\n        }]);\n})(jQuery, angular);\n","(function (jQuery, angular) {\n    \"use strict\";\n    angular.module(\"gp-common\")\n        .directive('gpGeolocation', ['$window', function ($window) {\n            var defaultBtnLabel = \"Locate\";\n            return {\n                scope: {\n                    label: '=?'\n                },\n                restrict: \"EA\",\n                template: [\n                    '<a class=\"btn btn-primary\" ng-click=\"geolocate()\" ng-if=\"available\">',\n                    '  <span class=\"glyphicon glyphicon-screenshot\" ng-if=\"!loading\"></span>',\n                    '  <span class=\"glyphicon glyphicon-hourglass glyphicon-spin\" ng-if=\"loading\"></span>',\n                    '  {{btnLabel}}',\n                    '</a>',\n                    '<div ng-if=\"error\">{{error}}</div>'\n                ].join(' '),\n                controller: function ($scope) {\n                    $scope.btnLabel = $scope.label || defaultBtnLabel;\n                    $scope.loading = false;\n                    $scope.available = ($window.navigator && $window.navigator.geolocation);\n                    if (!$scope.available)\n                        $scope.error = \"Your browser does not support determining location\";\n                    $scope.geolocate = function () {\n                        $scope.loading = true;\n                        $window.navigator.geolocation.getCurrentPosition(function (position) {\n                            $scope.$apply(function () { $scope.loading = false; });\n                            $scope.$emit('map:geolocation', position.coords.latitude, position.coords.longitude);\n                        }, function (error) {\n                            switch (error.code) {\n                                case 1:\n                                    $scope.error = \"Permission was denied while attempting to determine location\";\n                                    break;\n                                case 2:\n                                    $scope.error = \"Unable to determine your location\";\n                                    break;\n                                case 3:\n                                    $scope.error = \"Unable to determine location in a reasonable amount of time\";\n                                    break;\n                            }\n                        });\n                    };\n                }\n            };\n        }]);\n})(jQuery, angular);\n","(function (jQuery, angular) {\n    \"use strict\";\n    angular.module(\"gp-common\")\n        .directive('gpHeader', ['GPConfig', 'AuthenticationService', function (Config, AuthenticationService) {\n            return {\n                scope: {\n                    brand: \"@\",\n                    showHomeLink: \"@\"\n                },\n                restrict: \"AE\",\n                transclude: true,\n                replace: true,\n                template: [\n                    '<header>',\n                    '  <div class=\"container-fluid\">',\n                    '    <div class=\"row\">',\n                    '      <div class=\"col-md-12\">',\n                    '        <ul role=\"menu\" class=\"header__menu\" gp-header-menu>',\n                    '          <li ng-if=\"showHomeLink\">',\n                    '            <a href=\"#/goHome\">',\n                    '                <span class=\"glyphicon glyphicon-home\"></span> ',\n                    '                <span class=\"hidden-xs hidden-sm\">Home</span>',\n                    '            </a>',\n                    '          </li>',\n                    '          <div class=\"transcluded\"></div>',\n                    '          <li><span gp-login-button></span></li>',\n                    '        </ul>',\n                    '        <h4 class=\"brand\">',\n                    '          <a href=\"{{portalUrl}}\" title=\"Go to the GeoPlatform Home Page\">',\n                    '            <span class=\"icon-gp\"></span>',\n                    '            <span class=\"hidden-xs\">GeoPlatform</span>',\n                    '          </a>',\n                    '          {{brand}}',\n                    '        </h4>',\n                    '      </div>',\n                    '    </div>',\n                    '  </div>',\n                    '  <gp-login-modal></gp-login-modal>',\n                    '</header>',\n                ].join(' '),\n                // controller: function($rootScope, $scope, $element) {\n                //     $scope.portalUrl = $rootScope.portalUrl;\n                // }, \n                link: function ($scope, $element, $attrs, ctrl, transcludeFn) {\n                    $scope.showHomeLink = $scope.showHomeLink === 'true' || false;\n                    $scope.portalUrl = Config.portalUrl;\n                    AuthenticationService.getUserQ().then(function (user) {\n                        $scope.user = user;\n                    });\n                    $element.find('.transcluded').replaceWith(transcludeFn());\n                }\n            };\n        }])\n        .directive('gpHeaderMenu', ['$location', function ($location) {\n            //default href for \"home\" link in header__menu\n            //uses 'goHome' to avoid angular-route issues with empty hash not \n            // triggering a page reload. Relies upon the \"otherwise\" condition\n            // being configured inside a routeProvider within the application.\n            var homeLink = 'goHome';\n            function update($element) {\n                var path = $location.path();\n                if (path === '/' || path === '/#' || path === '/#/')\n                    path = homeLink;\n                if (path[0] === '/')\n                    path = path.substring(1);\n                var menu = $element;\n                menu.find('li.active').removeClass('active');\n                var link = menu.find('li > a[href=\"#/' + path + '\"]');\n                if (link.length) {\n                    //check if link is within a dropdown in the header menu\n                    var dd = link.closest('.dropdown-menu');\n                    if (dd.length) {\n                        //find next ancestor that is a list element and mark it active\n                        dd.closest('li').addClass('active');\n                    }\n                    else {\n                        //not in a dropdown, mark this link active\n                        link.parent().addClass('active');\n                    }\n                }\n                menu.find('li > a').each(function (i, a) {\n                    var $a = $(a), href = $a.attr('href');\n                    if (!href)\n                        return;\n                    href = href.replace('#/', '');\n                    if (path.indexOf(href) === 0)\n                        $a.parent().addClass('active');\n                });\n            }\n            return {\n                scope: {\n                    homeHref: '@'\n                },\n                restrict: \"A\",\n                controller: function ($rootScope, $scope, $element) {\n                    if ($scope.homeHref)\n                        homeLink = $scope.homeHref;\n                },\n                link: function ($scope, $element) {\n                    update($element);\n                    $scope.$root.$on('$locationChangeSuccess', function () {\n                        update($element);\n                    });\n                }\n            };\n        }])\n        .directive('gpFlexHeader', ['GPConfig', 'AuthenticationService', function (Config, AuthenticationService) {\n            return {\n                scope: {\n                    brand: \"@\",\n                    showHomeLink: \"@\"\n                },\n                restrict: \"AE\",\n                transclude: true,\n                replace: true,\n                template: \"\\n                <header>\\n                    <h4 class=\\\"brand\\\">\\n                        <a href=\\\"{{portalUrl}}\\\" title=\\\"Go to the GeoPlatform Home Page\\\">\\n                            <span class=\\\"icon-gp\\\"></span>\\n                            <span class=\\\"hidden-xs\\\">GeoPlatform</span>\\n                        </a>\\n                        {{brand}}\\n                    </h4>\\n                    <ul role=\\\"menu\\\" class=\\\"header__menu\\\" gp-header-menu>\\n                        <li ng-if=\\\"showHomeLink\\\">\\n                            <a href=\\\"/\\\">\\n                                <span class=\\\"glyphicon glyphicon-home\\\"></span> \\n                                <span class=\\\"hidden-xs hidden-sm\\\">Home</span>\\n                            </a>\\n                        </li>\\n                        <div class=\\\"transcluded\\\"></div>\\n                        <li><span gp-login-button></span></li>\\n                    </ul>\\n                </header>\\n            \",\n                link: function ($scope, $element, $attrs, ctrl, transcludeFn) {\n                    $scope.showHomeLink = $scope.showHomeLink === 'true' || false;\n                    $scope.portalUrl = Config.portalUrl;\n                    AuthenticationService.getUserQ().then(function (user) {\n                        $scope.user = user;\n                    });\n                    $element.find('.transcluded').replaceWith(transcludeFn());\n                }\n            };\n        }]);\n})(jQuery, angular);\n","(function (angular) {\n    \"use strict\";\n    angular.module('gp-common').directive('iframeOnload', function () {\n        return {\n            scope: {\n                callback: '&iframeOnload'\n            },\n            link: function (scope, element, attrs) {\n                element.on('load', function (event) {\n                    element.off('load');\n                    return scope.callback(event);\n                });\n            }\n        };\n    });\n})(angular);\n","(function (angular, Constants) {\n    \"use strict\";\n    angular.module(\"gp-common\")\n        .directive('onImgFail', function () {\n        return {\n            restrict: \"A\",\n            link: function ($scope, $element, $attrs) {\n                var jqEl = jQuery($element);\n                jqEl.on('error', function () {\n                    jqEl.off('error');\n                    jqEl.attr('src', $attrs.onImgFail);\n                });\n            }\n        };\n    })\n        .directive('mapThumbnail', [function () {\n            return {\n                restrict: \"A\",\n                scope: {\n                    mapThumbnail: '='\n                },\n                link: function ($scope, $element, $attrs) {\n                    var map = $scope.mapThumbnail;\n                    if (map.$promise && !map.$resolved) {\n                        map.$promise\n                            .then(function (m) {\n                            if (typeof (m.thumbnail) === 'string')\n                                $element.attr('src', getUrl(m));\n                            else\n                                buildThumbnail(m); //open map model\n                        })\n                            .catch(function (e) { $element.attr('src', null); });\n                    }\n                    else {\n                        if (typeof (map.thumbnail) === 'string')\n                            $element.attr('src', getUrl(map));\n                        else\n                            buildThumbnail(map);\n                    }\n                    function buildThumbnail(map) {\n                        if (!map.thumbnail) {\n                            $element.attr('src', null);\n                        }\n                        else if (map.thumbnail.contentData) {\n                            var style = 'background-size:contain;' +\n                                'background-repeat:no-repeat;' +\n                                'background-image: url(data:' +\n                                (map.thumbnail.mediaType || 'image/png') + ';base64,' +\n                                map.thumbnail.contentData + ');';\n                            //if directive is on a responsive item (aka, in a gp-ui-card), \n                            // ignore thumbnail dimensions. Otherwise, use them\n                            if ($element.attr('class').indexOf('embed-responsive-item') < 0) {\n                                style += 'width:' + (map.thumbnail.width || '32') + 'px;' +\n                                    'height:' + (map.thumbnail.height || '32') + 'px;';\n                            }\n                            $element.attr('style', style);\n                        }\n                        else if (map.thumbnail.url) {\n                            $element.attr('src', map.thumbnail.url);\n                        }\n                        else\n                            $element.attr('src', null);\n                    }\n                    function getUrl(map) {\n                        var url = map.thumbnail;\n                        if (!url || !url.length)\n                            url = Constants.ualUrl + '/api/maps/' + map.id + '/thumbnail';\n                        else if (url.indexOf(\"http\") !== 0) {\n                            if (url[0] !== '/')\n                                url = Constants.ualUrl + '/' + url;\n                            else\n                                url = Constants.ualUrl + url;\n                        }\n                        return url;\n                    }\n                }\n            };\n        }])\n        .directive('itemThumbnail', ['$q', function ($q) {\n            return {\n                restrict: \"E\",\n                replace: true,\n                scope: {\n                    item: '=',\n                    fallback: '@',\n                    link: '@'\n                },\n                template: \"\\n                <a ng-show=\\\"hasThumbnail\\\" class=\\\"media embed-responsive embed-responsive-16by9\\\">\\n                    <img class=\\\"embed-responsive-item\\\" on-img-error=\\\"{{fallback||'/img/img-404.jpg'}}\\\">\\n                </a>\\n            \",\n                controller: function ($scope) {\n                    $scope.elName = 'div';\n                    $scope.isLink = !!$scope.link;\n                    if ($scope.isLink) {\n                        $scope.elName = 'a';\n                    }\n                },\n                link: function ($scope, $element, $attrs) {\n                    var item = $scope.item;\n                    (item.$promise || $q.resolve(item)).then(function (obj) {\n                        var url = $scope.fallback;\n                        //maps\n                        if (obj.type && obj.type === 'Map')\n                            url = Constants.ualUrl + \"/api/maps/\" + obj.id + \"/thumbnail\";\n                        else if (obj.assetType && obj.assetType === 'Map')\n                            url = Constants.ualUrl + \"/api/maps/\" + obj.assetId + \"/thumbnail\";\n                        else if (obj.thumbnail && obj.thumbnail.url)\n                            url = obj.thumbnail.url;\n                        else if (obj.thumbnail && obj.thumbnail.contentData) {\n                            var style = 'background-size:contain;' +\n                                'background-repeat:no-repeat;' +\n                                'background-image: url(data:' +\n                                (obj.thumbnail.mediaType || 'image/png') + ';base64,' +\n                                obj.thumbnail.contentData + ');';\n                            //if directive is on a responsive item (aka, in a gp-ui-card), \n                            // ignore thumbnail dimensions. Otherwise, use them\n                            if ($element.attr('class').indexOf('embed-responsive-item') < 0) {\n                                style += 'width:' + (obj.thumbnail.width || '32') + 'px;' +\n                                    'height:' + (obj.thumbnail.height || '32') + 'px;';\n                            }\n                            $element.find('img').attr('style', style);\n                        }\n                        $scope.hasThumbnail = !!url;\n                        $element.find('img').attr('src', url);\n                        if ($scope.isLink) {\n                            //$element is a.media because of 'replace:true'\n                            $element.attr('href', $scope.link).attr('target', '_blank');\n                        }\n                    })\n                        .catch(function (e) {\n                        $element.find('img').attr('src', $scope.fallback);\n                    });\n                }\n            };\n        }]);\n})(angular, GeoPlatform);\n","(function (angular) {\n    \"use strict\";\n    angular.module('gp-common')\n        .service('NotificationService', ['$rootScope', function ($rootScope) {\n            var Service = function () {\n                this.items = [];\n            };\n            Service.prototype = {\n                getItems: function () { return this.items; },\n                /**\n                 * @param item object\n                 * @return function to cancel the notification\n                 */\n                addItem: function (item) {\n                    this.items.push(item);\n                    $rootScope.$broadcast('gp:notifications:new', item);\n                    var fn = function (item) { this.removeItem(item); };\n                    return fn.bind(this, item);\n                },\n                removeItem: function (item) {\n                    var index = this.items.indexOf(item);\n                    if (index >= 0)\n                        return this.items.splice(index, 1);\n                    return null;\n                },\n                error: function (label, msg, dismiss) {\n                    return this.addItem({ type: 'error', label: label, message: msg, canDismiss: dismiss });\n                },\n                success: function (label, msg, dismiss) {\n                    return this.addItem({ type: 'success', label: label, message: msg, canDismiss: dismiss });\n                },\n                info: function (label, msg, dismiss) {\n                    return this.addItem({ type: 'info', label: label, message: msg, canDismiss: dismiss });\n                }\n            };\n            return new Service();\n        }])\n        .directive('gpNotifications', ['$timeout', 'NotificationService', function ($timeout, NotificationService) {\n            return {\n                scope: {\n                    expiration: '@'\n                },\n                template: [\n                    '<div class=\"notifications ng-hide\" ng-show=\"items.length\">',\n                    '  <div class=\"notification\" ng-repeat=\"item in items\"',\n                    '    ng-class=\"{\\'notification--success\\':item.type===\\'success\\', \\'notification--error\\':item.type===\\'error\\', \\'notification--info\\':item.type===\\'info\\'}\">',\n                    '    <h5 class=\"notification__title\">',\n                    '        <span class=\"pull-right glyphicon\" ',\n                    '            ng-class=\"{\\'glyphicon-ok-sign\\':item.type===\\'success\\',\\'glyphicon-exclamation-sign\\':item.type===\\'error\\',\\'glyphicon-info-sign\\':item.type===\\'info\\'}\">',\n                    '        </span>',\n                    '        {{item.label}}',\n                    '    </h5>',\n                    '    <p class=\"notification__content\" ng-bind-html=\"item.message\"></p>',\n                    '    <div class=\"notification__actions\" ng-if=\"item.canDismiss\">',\n                    '        <button type=\"button\" class=\"btn btn-link\" ng-click=\"dismiss(item)\">dismiss</button>',\n                    '    </div>',\n                    '  </div>',\n                    '</div>'\n                ].join(' '),\n                link: function ($scope, $element, $attrs) {\n                    $scope.expiration = ($scope.expiration || 2000) * 1;\n                    $scope.items = [];\n                    function update() {\n                        $scope.items = NotificationService.getItems();\n                        //if updated before timer expired, reset timer\n                        if ($scope.timer) {\n                            $timeout.cancel($scope.timer);\n                            $scope.timer = null;\n                        }\n                        //set timer to kill earliest item after time\n                        $scope.timer = $timeout(function () {\n                            $scope.timer = null;\n                            //will ultimately call update() and thus trigger timeout again\n                            $scope.removeOldest();\n                        }, $scope.expiration);\n                    }\n                    update();\n                    $scope.removeOldest = function () {\n                        //find oldest that can be removed\n                        var oldest = $scope.items.find(function (item) { return item.canDismiss; });\n                        if (oldest)\n                            NotificationService.removeItem(oldest);\n                    };\n                    $scope.dismiss = function (item) {\n                        //remove item using service\n                        NotificationService.removeItem(item);\n                    };\n                    $scope.$watchCollection(function () {\n                        return NotificationService.getItems();\n                    }, update);\n                    // $scope.$on('gp:notifications:new', function(event, item) { update(); });\n                }\n            };\n        }]);\n})(angular);\n","(function (jQuery, angular) {\n    \"use strict\";\n    /*\n     * Usage:\n     *\n     *      <gp-pagination service=\"$ctrl.service\" event-key=\"maps\"></gp-pagination>\n     *\n     *  Expects a BrowseObjService instance for the 'service' binding, or at least\n     * one that provides the same pagination and options API.\n     */\n    /**\n     * Requires a service which exposes the following methods:\n     *   - getPagination() : returns {object} defining 'start', 'size', and 'total'\n     *   - start(int) : takes {int} defining which index to start requesting\n     *   - size(int) : takes {int} defining how many items to request\n     *   - on(eventName, listener) : must support event \"gp:browse:<key>:pagination\" where 'key' may be 'objects' or a custom key\n     */\n    var PaginationController = /** @class */ (function () {\n        function PaginationController() {\n            'ngInject';\n        }\n        PaginationController.prototype.$onInit = function () {\n            var _this = this;\n            if (!this.service)\n                return;\n            this.options = this.service.getPagination();\n            //support using a traditional select instead of a uib dropdown menu\n            // in case the pagination control itself is wrapped in a dropdown menu.\n            //in this case, we use objects with labels and values in order to display\n            // the 'per page' text along with whatever the page size is.\n            this.pageSizeDropdown = true;\n            this.useSelect = typeof (this.useSelect) !== 'undefined' &&\n                (this.useSelect === true || this.useSelect === 'true' || this.useSelect === 1);\n            if (this.useSelect) {\n                this.pageSizeDropdown = false;\n                this.pageSize = this.options.size;\n                this.pageSizeOptions = (this.options.sizeOptions || [5, 10, 20, 50]).map(function (o) {\n                    return { label: o + ' per page', value: o };\n                });\n            }\n            var event = 'gp:browse:';\n            if (this.eventKey)\n                event = 'gp:browse:' + this.eventKey + \":\";\n            else\n                event = 'gp:browse:objects:';\n            this.listener = this.service.on(event + 'pagination', function () {\n                _this.options = _this.service.getPagination();\n            });\n        };\n        PaginationController.prototype.$onDestroy = function () {\n            //remove listener from service if exists\n            if (this.listener)\n                this.listener();\n            this.service = null;\n        };\n        PaginationController.prototype.previous = function () {\n            if (this.service && this.hasPrevious()) {\n                this.service.start(Math.max(0, this.options.start * 1 - this.options.size * 1), true);\n            }\n        };\n        PaginationController.prototype.next = function () {\n            if (this.service && this.hasNext()) {\n                this.service.start(Math.min(this.options.total, this.options.start * 1 + this.options.size * 1), true);\n            }\n        };\n        PaginationController.prototype.first = function () {\n            if (this.service && this.hasPrevious()) {\n                this.service.start(0, true);\n            }\n        };\n        PaginationController.prototype.last = function () {\n            if (this.service && this.hasNext()) {\n                var lastPage = Math.floor(this.options.total / this.options.size);\n                this.setPage(lastPage);\n            }\n        };\n        PaginationController.prototype.setPage = function (arg) {\n            if (this.service) {\n                var page = arg * 1;\n                this.service.start(page * (this.options.size * 1), true);\n            }\n        };\n        PaginationController.prototype.setPageSize = function (size) {\n            if (this.service) {\n                this.service.size(size * 1, true);\n            }\n        };\n        PaginationController.prototype.hasPrevious = function () {\n            return this.options && this.options.start > 0;\n        };\n        PaginationController.prototype.hasNext = function () {\n            return this.options && (this.options.start + this.options.size) < this.options.total;\n        };\n        return PaginationController;\n    }());\n    angular.module('gp-common').component('gpPagination', {\n        bindings: {\n            service: '=',\n            eventKey: '@',\n            useSelect: '@'\n        },\n        controller: PaginationController,\n        template: \"\\n            <div class=\\\"c-pagination\\\">\\n                <div class=\\\"c-pagination__total\\\">{{$ctrl.options.total||0}} results</div>\\n                <div class=\\\"c-pagination__page-size\\\" ng-if=\\\"$ctrl.pageSizeDropdown\\\">\\n                    <span uib-dropdown>\\n                        <a href=\\\"\\\" uib-dropdown-toggle title=\\\"Change the number of results returned\\\">\\n                            {{$ctrl.options.size}} per page <span class=\\\"caret\\\"></span>\\n                        </a>\\n                        <ul class=\\\"dropdown-menu\\\" role=\\\"menu\\\">\\n                            <li ng-repeat=\\\"size in $ctrl.options.sizeOptions track by $index\\\">\\n                                <a ng-click=\\\"$ctrl.setPageSize(size)\\\">{{size}} per page</a>\\n                            </li>\\n                        </ul>\\n                    </span>\\n                </div>\\n                <div class=\\\"c-pagination__page-size\\\" ng-if=\\\"!$ctrl.pageSizeDropdown\\\">\\n                    <select class=\\\"form-control\\\" \\n                        ng-model=\\\"$ctrl.pageSize\\\" ng-change=\\\"$ctrl.setPageSize($ctrl.pageSize)\\\"\\n                        ng-options=\\\"opt.value as opt.label for opt in $ctrl.pageSizeOptions\\\">\\n                    </select>\\n                </div>\\n                <div class=\\\"c-pagination__pages\\\">\\n                    <div class=\\\"c-pagination__button\\\" \\n                        ng-class=\\\"{'is-disabled':!$ctrl.hasPrevious()}\\\"\\n                        ng-click=\\\"$ctrl.first()\\\">\\n                        <span class=\\\"glyphicon glyphicon-fast-backward\\\"></span>\\n                    </div>\\n                    <div class=\\\"c-pagination__button\\\" \\n                        ng-class=\\\"{'is-disabled':!$ctrl.hasPrevious()}\\\"\\n                        ng-click=\\\"$ctrl.previous()\\\">\\n                        <span class=\\\"glyphicon glyphicon-backward\\\"></span>\\n                    </div>\\n                    <div class=\\\"c-pagination__page\\\">\\n                        {{$ctrl.options.start+1}} - {{$ctrl.options.start+$ctrl.options.size}}\\n                    </div>\\n                    <div class=\\\"c-pagination__button\\\" \\n                        ng-class=\\\"{'is-disabled':!$ctrl.hasNext()}\\\"\\n                        ng-click=\\\"$ctrl.next()\\\">\\n                        <span class=\\\"glyphicon glyphicon-forward\\\"></span>\\n                    </div>\\n                    <div class=\\\"c-pagination__button\\\" \\n                        ng-class=\\\"{'is-disabled':!$ctrl.hasNext()}\\\"\\n                        ng-click=\\\"$ctrl.last()\\\">\\n                        <span class=\\\"glyphicon glyphicon-fast-forward\\\"></span>\\n                    </div>\\n                </div>\\n            </div>\\n        \"\n    });\n})(jQuery, angular);\n","(function (angular) {\n    \"use strict\";\n    /**\n     * Usage:\n     *  <gp-progress-circle ng-model=\"$ctrl.amount\"></gp-progress-circle>\n     */\n    angular.module('gp-common').component('gpProgressCircle', {\n        bindings: {\n            ngModel: '<' //amount out of 100\n        },\n        controller: function () {\n            this.$onInit = function () {\n                this.dashArray = 2 * Math.PI * 45 /*radius*/;\n                if (!this.ngModel)\n                    this.ngModel = 0;\n                this.update();\n            };\n            this.$onChanges = function (changes) {\n                if (changes.ngModel)\n                    this.update();\n            };\n            this.update = function () {\n                var offset = 2 * Math.PI * 45 * (1 - (this.ngModel / 100));\n                this.value = offset;\n            };\n        },\n        template: \"\\n            <svg class=\\\"c-progress--circle\\\" viewBox=\\\"0 0 100 100\\\">\\n                <circle class=\\\"c-progress__meter\\\" cx=\\\"50\\\" cy=\\\"50\\\" r=\\\"45\\\" stroke-width=\\\"10\\\" />\\n                <circle class=\\\"c-progress__value\\\" cx=\\\"50\\\" cy=\\\"50\\\" r=\\\"45\\\" stroke-width=\\\"10\\\" \\n                    stroke-dasharray=\\\"{{$ctrl.dashArray}}\\\" stroke-dashoffset=\\\"{{$ctrl.value}}\\\"/>\\n                <text class=\\\"c-progress__label\\\" x=\\\"50\\\" y=\\\"-40\\\" text-anchor=\\\"middle\\\">{{$ctrl.ngModel}}%</text>\\n            </svg>\\n        \"\n    });\n})(angular);\n","(function (jQuery, angular) {\n    \"use strict\";\n    angular.module('gp-common')\n        .provider('responsiveHelper', [\"$windowProvider\", function ($windowProvider) {\n            var $window = $windowProvider.$get();\n            function Helper($window) {\n                this.window = $window;\n            }\n            Helper.prototype = {\n                getWidth: function () { return $window.innerWidth || $window.outerWidth; },\n                isXS: function () { var width = this.getWidth(); return width < 768; },\n                isSM: function () { var width = this.getWidth(); return width >= 768 && width < 992; },\n                isMD: function () { var width = this.getWidth(); return width >= 992 && width < 1200; },\n                isLG: function () { var width = this.getWidth(); return width >= 1200; }\n            };\n            var helper = new Helper($window);\n            this.$get = function () {\n                return helper;\n            };\n        }])\n        .directive('gpResponsive', ['$window', 'responsiveHelper', function ($window, responsiveHelper) {\n            return {\n                restrict: \"A\",\n                link: function ($scope, $element, $attrs) {\n                    function update(el, helper) {\n                        if (helper.isXS())\n                            el.addClass('gp-responsive-xs');\n                        else\n                            el.removeClass('gp-responsive-xs');\n                        if (helper.isSM())\n                            el.addClass('gp-responsive-sm');\n                        else\n                            el.removeClass('gp-responsive-sm');\n                        if (helper.isMD())\n                            el.addClass('gp-responsive-md');\n                        else\n                            el.removeClass('gp-responsive-md');\n                        if (helper.isLG())\n                            el.addClass('gp-responsive-lg');\n                        else\n                            el.removeClass('gp-responsive-lg');\n                    }\n                    update($element, responsiveHelper);\n                    var resizeFn = function () {\n                        update($element, responsiveHelper);\n                    };\n                    var w = angular.element($window);\n                    var listener = w.on('resize', resizeFn);\n                    $scope.$on('$destroy', function () {\n                        w.off('resize', resizeFn);\n                    });\n                }\n            };\n        }])\n        .directive('gpResize', function ($window, $timeout) {\n        return function ($scope, $element, $attr) {\n            var resizeFn = function () {\n                var hh = jQuery('header')[0].offsetHeight;\n                // var fh = jQuery('footer')[0].offsetHeight;\n                // console.log('hh & fh', hh, fh);                    \n                var tp = hh + 2;\n                // var bt = fh + 2;\n                // console.log('tp & bt', tp, bt);                \n                var changes = {\n                    // bottom: bt + 'px',\n                    top: tp + 'px',\n                };\n                $element.css(changes);\n                $scope.$apply();\n            };\n            var w = angular.element($window);\n            w.on('resize', resizeFn);\n            $timeout(resizeFn, 200);\n            $scope.$on('$destroy', function () {\n                w.off('resize', resizeFn);\n            });\n        };\n    });\n})(jQuery, angular);\n","(function (jQuery, angular) {\n    \"use strict\";\n    function inputLinkFunction($scope, $element, $attrs, ngModelController, $timeout) {\n        if (!$scope.type)\n            $scope.type = \"text\";\n        if ($scope.required === 'true')\n            $scope.required = true;\n        else\n            $scope.required = false;\n        $scope.elId = 'input_' + Math.ceil(Math.random() * 9999);\n        $scope.size = $scope.size || 'medium';\n        $scope.type = $scope.type || 'text';\n        //listen for changes to the inner value by way of the form-control\n        $element.find('.form-control').on('change', function onChange() {\n            validate($scope.innerValue);\n        });\n        /* ------------- private methods --------------- */\n        function validate() {\n            //check form-control for ng-invalid\n            var input = $element.find('.form-control');\n            $scope.isDirty = input.hasClass('ng-dirty');\n            if (input.hasClass('ng-invalid')) {\n                if (input.hasClass(\"ng-empty\"))\n                    $scope.error = \"This field requires a value\";\n                else\n                    $scope.error = \"Invalid value provided\";\n            }\n            else\n                $scope.error = null;\n        }\n        function update(newValue) {\n            // call $parsers pipeline then update $modelValue\n            ngModelController.$setViewValue(newValue);\n            // update the local view\n            ngModelController.$render();\n        }\n        // when model change, update our view (just update the div content)\n        ngModelController.$render = function () {\n            var value = ngModelController.$viewValue;\n            //create copy of passed in model value that can be used\n            // by the controls here allowing us to cancel and \n            // commit changes at our own leisure\n            $scope.innerValue = value;\n            $scope.displayValue = value || $scope.placeholder || \"No value provided\";\n            validate(value);\n        };\n        /* ------------- private methods --------------- */\n        $scope.isReadOnly = function () {\n            var t = typeof (this.readOnly);\n            if (t === 'undefined')\n                return false;\n            if (t === 'string')\n                return this.readOnly.toLowerCase() === 'true';\n            if (t === 'number')\n                return this.readOnly === 1;\n            if (t === 'boolean')\n                return this.readOnly;\n            return false;\n        };\n        //enter edit mode\n        $scope.edit = function () {\n            if ($scope.isReadOnly())\n                return;\n            $scope.editing = true;\n            //auto-focus on form-control when entering edit mode\n            $timeout(function () { $element.find('.form-control').focus().select(); }, 200);\n        };\n        //leave edit mode (regardless of save() or cancel())\n        $scope.done = function () {\n            $scope.editing = false;\n            $scope.error = null;\n        };\n        $scope.save = function () {\n            //update display with new value\n            update($scope.innerValue);\n            $scope.done();\n        };\n        $scope.cancel = function () {\n            //reset inner value\n            $scope.innerValue = ngModelController.$viewValue;\n            $scope.done();\n        };\n        $scope.onKeyPress = function ($event, code) {\n            // console.log(\"Pressed \" + code);\n            if ((code === undefined || code === 0) && $event.which !== undefined)\n                code = $event.which;\n            if ($scope.type === 'number') {\n                //NOTE: Chrome does not catch Backspace onKeyPress, so it \n                // skips this handler. FF does, so we need to watch for \n                // backspace, delete, and numbers\n                if (code === 8 || //backspace\n                    code === 46 || //delete  \n                    (code >= 44 && code <= 57))\n                    return;\n                //NOTE: keyPress period is 46. keyDown it is 190\n                $event.preventDefault();\n                return false; //ignore key\n            }\n        };\n        $scope.onKeyUp = function ($event, code) {\n            // console.log(\"Up \" + code);\n            if ((code === undefined || code === 0) && $event.which !== undefined)\n                code = $event.which;\n            if (code === 13 && !$scope.error)\n                $scope.done(); //enter\n            else if (code === 27)\n                $scope.cancel(); //esc\n            else {\n                if (code !== 8 && //backspace\n                    code !== 46 && //delete\n                    code !== 190 && //period\n                    (code < 48 || code > 90) && //letters and numbers (a-z, 0-9)\n                    (code < 106 || code > 111) &&\n                    (code < 186))\n                    return;\n                validate();\n            }\n        };\n        $scope.$destroy = function () {\n            $element.off('change');\n        };\n    }\n    angular.module(\"gp-common\")\n        .directive('gpSlickFormInput', ['$timeout', function ($timeout) {\n            return {\n                restrict: 'AE',\n                require: 'ngModel',\n                scope: {\n                    label: \"@\",\n                    placeholder: '@',\n                    help: '=',\n                    // validator: '&',\n                    // validationExpr: '@',\n                    type: '@',\n                    pattern: \"@\",\n                    required: '@',\n                    readOnly: '@',\n                    size: '@',\n                    icon: '@'\n                },\n                template: INPUT_TEMPLATE,\n                link: function ($scope, $element, $attrs, ngModelController) {\n                    inputLinkFunction($scope, $element, $attrs, ngModelController, $timeout);\n                }\n            };\n        }])\n        .directive('gpSlickFormTextarea', ['$timeout', function ($timeout) {\n            return {\n                restrict: 'AE',\n                require: 'ngModel',\n                scope: {\n                    label: \"@\",\n                    placeholder: '@',\n                    help: \"@\",\n                    readOnly: \"@\",\n                    size: \"@\",\n                    icon: \"@\"\n                },\n                template: TEXTAREA_TEMPLATE,\n                link: function ($scope, $element, $attrs, ngModelController) {\n                    inputLinkFunction($scope, $element, $attrs, ngModelController, $timeout);\n                }\n            };\n        }])\n        .directive('gpSlickFormDate', ['$timeout', '$filter', function ($timeout, $filter) {\n            return {\n                restrict: 'AE',\n                require: 'ngModel',\n                scope: {\n                    label: \"@\",\n                    format: \"@\",\n                    placeholder: '@',\n                    required: \"@\",\n                    readOnly: \"@\",\n                    size: '@',\n                    icon: '@'\n                },\n                template: DATE_TEMPLATE,\n                controller: function ($scope, $element) {\n                    if (!$scope.format || $scope.format.length < 3)\n                        $scope.format = \"mediumDate\";\n                    $scope.inline = $element.hasClass(\"inline\");\n                },\n                /**\n                 *\n                 */\n                link: function ($scope, $element, $attrs, ngModelController) {\n                    if ($scope.required === 'true')\n                        $scope.required = true;\n                    else\n                        $scope.required = false;\n                    $scope.elId = 'input_' + Math.ceil(Math.random() * 9999);\n                    $scope.size = $scope.size || 'medium';\n                    $scope.type = $scope.type || 'text';\n                    function validate(value) {\n                        // console.log(\"Validating '\" + value + \"'\");\n                        //check form-control for ng-invalid\n                        var input = $element.find('.form-control');\n                        if (input.hasClass('ng-invalid')) {\n                            if (input.hasClass(\"ng-empty\"))\n                                $scope.error = \"This field requires a value\";\n                            else\n                                $scope.error = \"Invalid value provided\";\n                        }\n                        else\n                            $scope.error = null;\n                    }\n                    function update(newValue) {\n                        // call $parsers pipeline then update $modelValue\n                        ngModelController.$setViewValue(newValue);\n                        // update the local view\n                        ngModelController.$render();\n                    }\n                    // when model change, update our view (just update the div content)\n                    ngModelController.$render = function () {\n                        var value = ngModelController.$viewValue;\n                        //create copy of passed in model value that can be used\n                        // by the controls here allowing us to cancel and \n                        // commit changes at our own leisure\n                        $scope.innerValue = value;\n                        $scope.displayValue = value ? $filter('date')(ngModelController.$modelValue, $scope.format) :\n                            $scope.placeholder || \"No value provided\";\n                        validate(value);\n                    };\n                    $scope.isReadOnly = function () {\n                        var t = typeof (this.readOnly);\n                        if (t === 'undefined')\n                            return false;\n                        if (t === 'string')\n                            return this.readOnly.toLowerCase() === 'true';\n                        if (t === 'number')\n                            return this.readOnly === 1;\n                        if (t === 'boolean')\n                            return this.readOnly;\n                        return false;\n                    };\n                    //enter edit mode\n                    $scope.edit = function () {\n                        if ($scope.isReadOnly())\n                            return;\n                        $scope.editing = true;\n                        //auto-focus on form-control when entering edit mode\n                        // $timeout(function() { $element.find('.form-control').focus().select(); }, 200);\n                    };\n                    //leave edit mode (regardless of save() or cancel())\n                    $scope.done = function () {\n                        $scope.opened = false;\n                        $scope.editing = false;\n                        $scope.error = null;\n                    };\n                    $scope.save = function () {\n                        //update display with new value\n                        update($scope.innerValue);\n                        $scope.done();\n                    };\n                    $scope.cancel = function () {\n                        //reset inner value\n                        $scope.innerValue = angular.copy(ngModelController.$modelValue);\n                        $scope.done();\n                    };\n                    $scope.open = function () {\n                        //must wrap 'opened' variable in an object for \n                        // angular to properly track its value changes\n                        // from within children scope (ie, the date picker)\n                        if (typeof ($scope.uibopts) === 'undefined') {\n                            $scope.uibopts = {};\n                        }\n                        $scope.uibopts.opened = true;\n                    };\n                    $scope.onKeyUp = function (code) {\n                        if (code === 13) {\n                            $scope.done();\n                        }\n                        else if (code === 27) {\n                            $scope.cancel();\n                        }\n                    };\n                    $scope.onChange = function (date) {\n                        if (isNaN(ngModelController.$modelValue) && $scope.required) {\n                            $scope.error = \"This field requires a value\";\n                        }\n                        else\n                            $scope.error = null;\n                    };\n                }\n            };\n        }])\n        .directive('gpSlickFormSelect', ['$timeout', function ($timeout) {\n            return {\n                restrict: 'AE',\n                require: 'ngModel',\n                scope: {\n                    label: \"@\",\n                    codeList: \"=\",\n                    help: '=',\n                    required: \"@\",\n                    readOnly: \"@\",\n                    size: '@',\n                    icon: '@'\n                },\n                template: SELECT_TEMPLATE,\n                link: function ($scope, $element, $attrs, ngModelController) {\n                    if (!$scope.type)\n                        $scope.type = \"text\";\n                    if ($scope.required === 'true')\n                        $scope.required = true;\n                    else\n                        $scope.required = false;\n                    $scope.elId = 'input_' + Math.ceil(Math.random() * 9999);\n                    $scope.size = $scope.size || 'medium';\n                    $scope.type = $scope.type || 'text';\n                    var $select = null;\n                    function getSelect() {\n                        if (!$select || !$select.length)\n                            $select = $element.find('.form-control');\n                        return $select;\n                    }\n                    if ($scope.codeList) {\n                        $scope.selectOptions = $scope.codeList.map(function (item) {\n                            if (typeof (item) !== 'object' || !item.value)\n                                return { value: item, label: item };\n                            else if (!item.label)\n                                return { value: item.value, label: item.value };\n                            return item;\n                        });\n                    }\n                    else\n                        $scope.selectOptions = [];\n                    //listen for changes to the inner value by way of the form-control\n                    // $element.find('.form-control').on('change', function onChange() { \n                    //     validate($scope.innerValue); \n                    // });\n                    /* ------------- private methods --------------- */\n                    function validate() {\n                        //check form-control for ng-invalid\n                        var select = getSelect();\n                        $scope.isDirty = select.hasClass('ng-dirty');\n                        if (select.hasClass('ng-invalid')) {\n                            if (select.hasClass(\"ng-empty\"))\n                                $scope.error = \"This field requires a value\";\n                            else\n                                $scope.error = \"Invalid value provided\";\n                        }\n                        else\n                            $scope.error = null;\n                    }\n                    function update(newValue) {\n                        // call $parsers pipeline then update $modelValue\n                        ngModelController.$setViewValue(newValue);\n                        // update the local view\n                        ngModelController.$render();\n                    }\n                    // when model change, update our view (just update the div content)\n                    ngModelController.$render = function () {\n                        var value = ngModelController.$viewValue;\n                        //@see https://github.com/angular/angular.js/commit/7fda214c4f65a6a06b25cf5d5aff013a364e9cef\n                        //create copy of passed in model value that can be used\n                        // by the controls here allowing us to cancel and \n                        // commit changes at our own leisure\n                        $scope.innerValue = value;\n                        $scope.displayValue = $scope.placeholder || \"No value provided\";\n                        if (value) {\n                            //values are objects, not literals\n                            var opt = $scope.selectOptions.find(function (o) { return o.value == value; });\n                            $scope.displayValue = opt.label;\n                        }\n                        validate();\n                    };\n                    /* ------------- private methods --------------- */\n                    $scope.onChange = function (value) {\n                        // console.log(\"Changing value \" + value + \" vs \" + $scope.innerValue);\n                        $scope.innerValue = value;\n                        $timeout(function () { validate(); }, 200);\n                    };\n                    $scope.onTypeaheadSelection = function ($item, $model, $label, $event) {\n                        $scope.innerValue = $item ? $item.value : null;\n                        $timeout(function () { validate(); }, 200);\n                    };\n                    $scope.isReadOnly = function () {\n                        var t = typeof (this.readOnly);\n                        if (t === 'undefined')\n                            return false;\n                        if (t === 'string')\n                            return this.readOnly.toLowerCase() === 'true';\n                        if (t === 'number')\n                            return this.readOnly === 1;\n                        if (t === 'boolean')\n                            return this.readOnly;\n                        return false;\n                    };\n                    //enter edit mode\n                    $scope.edit = function () {\n                        if ($scope.isReadOnly())\n                            return;\n                        $scope.editing = true;\n                        //auto-focus on form-control when entering edit mode\n                        $timeout(function () { $select.focus().select(); }, 200);\n                    };\n                    //leave edit mode (regardless of save() or cancel())\n                    $scope.done = function () {\n                        $scope.editing = false;\n                        $scope.error = null;\n                    };\n                    $scope.save = function () {\n                        //update display with new value\n                        update($scope.innerValue);\n                        $scope.done();\n                    };\n                    $scope.cancel = function () {\n                        //reset inner value\n                        $scope.innerValue = ngModelController.$viewValue;\n                        $scope.done();\n                    };\n                    $scope.onKeyUp = function (code) {\n                        if (code === 13 && !$scope.error) {\n                            $scope.save();\n                        }\n                        else if (code === 27) {\n                            $scope.cancel();\n                        }\n                    };\n                    $scope.onTypeaheadKeyUp = function (code) {\n                        validate();\n                    };\n                    $scope.$destroy = function () {\n                        // $element.off('change');\n                    };\n                }\n            };\n        }]);\n    var INPUT_TEMPLATE = [\n        '<div class=\"form-group form-group-slick\">',\n        '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>',\n        '   <div class=\"input__display\" ',\n        '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error,\\'text-lg\\':size===\\'large\\'}\" ',\n        '       ng-show=\"!editing\" ng-click=\"edit()\" ',\n        '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">',\n        '      {{displayValue}}',\n        '   </div>',\n        '   <div ng-show=\"editing\">',\n        '      <div class=\"input-group\" ng-class=\"{\\'input-group-lg\\':size===\\'large\\'}\">',\n        '           <div class=\"input-group-slick\" ng-class=\"{\\'input-group-slick--lg\\':size===\\'large\\'}\">',\n        '               <span ng-if=\"icon\" class=\"{{::icon}}\"></span>',\n        '               <input id=\"{{::elId}}\" type=\"{{::type}}\" class=\"form-control\" ',\n        '                   pattern=\"{{pattern}}\" ',\n        '                   ng-model=\"innerValue\" ',\n        '                   ng-required=\"{{required}}\" ',\n        '                   ng-keypress=\"onKeyPress($event, $event.keyCode)\" ',\n        '                   ng-keyup=\"onKeyUp($event, $event.keyCode)\" >',\n        '               <span class=\"indicators\">',\n        '                   <span class=\"is-valid glyphicon glyphicon-ok-sign\"></span>',\n        '                  <span class=\"is-invalid glyphicon glyphicon-exclamation-sign\"></span>',\n        '              </span>',\n        '           </div>',\n        '          <span class=\"input-group-btn\">',\n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"',\n        '                   ng-click=\"cancel()\" title=\"Cancel changes\">',\n        '                   <span class=\"glyphicon glyphicon-ban-circle\"></span>',\n        '              </button>',\n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{disabled:!!error||!isDirty,\\'btn-lg\\':size===\\'large\\'}\"',\n        '                   ng-disabled=\"{{!!error}}\" ',\n        '                   ng-click=\"save()\" title=\"Save changes\">',\n        '                  <span class=\"glyphicon glyphicon-ok\"></span>',\n        '               </button>',\n        '           </span>',\n        '       </div>',\n        '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>',\n        '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>',\n        '   </div>',\n        '</div>'\n    ].join(' ');\n    var TEXTAREA_TEMPLATE = [\n        '<div class=\"form-group form-group-slick\">',\n        '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>',\n        '   <div class=\"input__display\" ',\n        '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error,\\'text-lg\\':size===\\'large\\'}\" ',\n        '       ng-show=\"!editing\" ng-click=\"edit()\" ',\n        '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">',\n        '      {{displayValue}}',\n        '   </div>',\n        '   <div ng-show=\"editing\">',\n        '      <div class=\"input-group\" ng-class=\"{\\'input-group-lg\\':size===\\'large\\'}\">',\n        '           <div class=\"input-group-slick\" ng-class=\"{\\'input-group-slick--lg\\':size===\\'large\\'}\">',\n        '               <span ng-if=\"icon\" class=\"{{::icon}}\"></span>',\n        '               <textarea rows=\"3\" id=\"{{::elId}}\" class=\"form-control\" ',\n        '                   ng-required=\"{{required}}\" ng-model=\"innerValue\"',\n        '                   ng-keypress=\"onKeyPress($event, $event.keyCode)\" ',\n        '                   ng-keyup=\"onKeyUp($event, $event.keyCode)\"></textarea>',\n        '               <span class=\"indicators\">',\n        '                   <span class=\"is-valid glyphicon glyphicon-ok-sign\"></span>',\n        '                  <span class=\"is-invalid glyphicon glyphicon-exclamation-sign\"></span>',\n        '              </span>',\n        '           </div>',\n        '          <span class=\"input-group-btn\">',\n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"',\n        '                   ng-click=\"cancel()\" title=\"Cancel changes\">',\n        '                   <span class=\"glyphicon glyphicon-ban-circle\"></span>',\n        '              </button>',\n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{disabled:!!error||!isDirty,\\'btn-lg\\':size===\\'large\\'}\"',\n        '                   ng-disabled=\"{{!!error}}\" ',\n        '                   ng-click=\"save()\" title=\"Save changes\">',\n        '                  <span class=\"glyphicon glyphicon-ok\"></span>',\n        '               </button>',\n        '           </span>',\n        '       </div>',\n        '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>',\n        '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>',\n        '   </div>',\n        '</div>'\n    ].join(' ');\n    var DATE_TEMPLATE = [\n        '<div class=\"form-group form-group-slick\">',\n        '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>',\n        '   <div class=\"input__display\" ',\n        '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error}\" ',\n        '       ng-show=\"!editing\" ng-click=\"edit()\" ',\n        '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">',\n        '      {{displayValue}}',\n        '   </div>',\n        '   <div ng-show=\"editing\">',\n        '       <div uib-datepicker ng-required=\"{{required}}\" ng-model=\"innerValue\" datepicker-options=\"{showWeeks:false}\"></div>',\n        '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>',\n        '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>',\n        '       <button type=\"button\" class=\"btn btn-default\" ',\n        '           ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"',\n        '           ng-click=\"cancel()\" title=\"Cancel changes\">',\n        '           <span class=\"glyphicon glyphicon-ban-circle\"></span>',\n        '      </button>',\n        '      <button type=\"button\" class=\"btn btn-default\" ',\n        '           ng-class=\"{disabled:!!error,\\'btn-lg\\':size===\\'large\\'}\"',\n        '          ng-disabled=\"{{!!error}}\" ',\n        '           ng-click=\"save()\" title=\"Save changes\">',\n        '           <span class=\"glyphicon glyphicon-ok\"></span>',\n        '      </button>',\n        '   </div>',\n        '</div>'\n    ].join(' ');\n    var SELECT_TEMPLATE = [\n        '<div class=\"form-group form-group-slick\">',\n        '   <label for=\"{{::elId}}\" class=\"control-label\">{{::label}}</label>',\n        '   <div class=\"input__display\" ',\n        '       ng-class=\"{\\'is-read-only\\':isReadOnly(), \\'has-error\\':!!error}\" ',\n        '       ng-show=\"!editing\" ng-click=\"edit()\" ',\n        '       title=\"{{!!error?error:(!isReadOnly()?\\'Click to edit\\':\\'\\')}}\">',\n        '      {{displayValue}}',\n        '   </div>',\n        '   <div ng-show=\"editing\">',\n        '      <div class=\"input-group\" ng-class=\"{\\'input-group-lg\\':size===\\'large\\'}\">',\n        '           <div class=\"input-group-slick\" ng-class=\"{\\'input-group-slick--lg\\':size===\\'large\\'}\">',\n        '               <span ng-if=\"icon\" class=\"{{::icon}}\"></span>',\n        '               <select class=\"form-control input__field\" ',\n        '                   ng-if=\"codeList.length<=12\" ',\n        '                   ng-model=\"innerValue\" ',\n        '                   ng-options=\"opt.value as opt.label for opt in selectOptions\" ',\n        '                   ng-required=\"{{required}}\" ',\n        '                   ng-change=\"onChange(innerValue)\" ',\n        '                   ng-keyUp=\"onKeyUp($event.keyCode)\" >',\n        '                   <option value=\"\">Select One</option>',\n        '               </select>',\n        '               <input type=\"text\" class=\"form-control input__field\" ng-if=\"codeList.length>12\" ',\n        '                   ng-model=\"innerValue\" ',\n        '                   ng-required=\"{{required}}\" ',\n        '                   ng-keyUp=\"onTypeaheadKeyUp($event.keyCode)\" ',\n        '                   typeahead-on-select=\"onTypeaheadSelection($item, $model, $label, $event)\" ',\n        '                   uib-typeahead=\"opt.value as opt.label for opt in selectOptions | filter:{value:$viewValue} | limitTo:12\" ',\n        '                   typeahead-min-length=\"0\" ',\n        '                   typeahead-editable=\"false\">',\n        '               <span class=\"indicators\">',\n        '                   <span class=\"is-valid glyphicon glyphicon-ok-sign\"></span>',\n        '                  <span class=\"is-invalid glyphicon glyphicon-exclamation-sign\"></span>',\n        '              </span>',\n        '           </div>',\n        '          <span class=\"input-group-btn\">',\n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{\\'btn-lg\\':size===\\'large\\'}\"',\n        '                   ng-click=\"cancel()\" title=\"Cancel changes\">',\n        '                   <span class=\"glyphicon glyphicon-ban-circle\"></span>',\n        '              </button>',\n        '               <button type=\"button\" class=\"btn btn-default\" ',\n        '                   ng-class=\"{disabled:!!error||!isDirty,\\'btn-lg\\':size===\\'large\\'}\"',\n        '                   ng-disabled=\"{{!!error}}\" ',\n        '                   ng-click=\"save()\" title=\"Save changes\">',\n        '                  <span class=\"glyphicon glyphicon-ok\"></span>',\n        '               </button>',\n        '           </span>',\n        '       </div>',\n        '       <div ng-if=\"error && error.length\"><small class=\"help-block text-danger\">{{error}}</small></div>',\n        '       <div ng-if=\"help && help.length\"><small class=\"help-block\">{{help}}</small></div>',\n        '   </div>',\n        '</div>'\n    ].join(' ');\n})(jQuery, angular);\n","(function (angular) {\n    \"use strict\";\n    angular.module(\"gp-common\").directive('gpTweetButton', ['$timeout', function ($timeout) {\n            function debounce(func, wait, immediate) {\n                var timeout;\n                return function () {\n                    var context = this, args = arguments;\n                    var later = function () {\n                        timeout = null;\n                        if (!immediate)\n                            func.apply(context, args);\n                    };\n                    var callNow = immediate && !timeout;\n                    clearTimeout(timeout);\n                    timeout = setTimeout(later, wait);\n                    if (callNow)\n                        func.apply(context, args);\n                };\n            }\n            return {\n                link: function (scope, element, attr) {\n                    if (typeof (twttr) === 'undefined') {\n                        element.className += ' disabled';\n                        return;\n                    }\n                    var renderTwitterButton = debounce(function () {\n                        if (attr.url) {\n                            $timeout(function () {\n                                element[0].innerHTML = '';\n                                twttr.widgets.createShareButton(attr.url, element[0], function () { }, {\n                                    count: attr.count,\n                                    text: attr.text,\n                                    via: attr.via,\n                                    size: attr.size,\n                                    hashtags: attr.hashtags,\n                                    dnt: attr.dnt\n                                });\n                            });\n                        }\n                    }, 75);\n                    attr.$observe('url', renderTwitterButton);\n                    attr.$observe('text', renderTwitterButton);\n                }\n            };\n        }]);\n})(angular);\n","(function (angular) {\n    \"use strict\";\n    angular.module(\"gp-common\").directive('sortOrder', function () {\n        return {\n            replace: true,\n            require: 'ngModel',\n            template: [\n                '<div>',\n                '<a class=\"btn btn-default\" title=\"Click to sort in ascending order\" href ng-if=\"value===\\'dsc\\'\" ng-click=\"toggle()\">',\n                '    <span class=\"glyphicon glyphicon-sort-by-attributes-alt\"></span>',\n                '</a>',\n                '<a class=\"btn btn-default\" title=\"Click to sort in descending order\" href ng-if=\"value===\\'asc\\'\" ng-click=\"toggle()\">',\n                '    <span class=\"glyphicon glyphicon-sort-by-attributes\"></span>',\n                '</a>',\n                '</div>'\n            ].join(' '),\n            link: function ($scope, element, attrs, ngModel) {\n                ngModel.$viewChangeListeners.push(function () {\n                    $scope.$eval(attrs.ngChange);\n                });\n                ngModel.$render = function () {\n                    $scope.value = ngModel.$modelValue;\n                };\n                $scope.toggle = function () {\n                    $scope.value = $scope.value === 'asc' ? 'dsc' : 'asc';\n                    ngModel.$setViewValue($scope.value);\n                };\n            }\n        };\n    });\n})(angular);\n","(function (angular) {\n    'use strict';\n    /**\n     * directive used in conjunction with ng-model to map arrays of strings\n     * to form field controls for editing.\n     *\n     * Usage:  <input ng-model=\"arrOfStr\" string-array-input></input>\n     *\n     */\n    angular.module('gp-common').directive('stringArrayInput', function () {\n        return {\n            restrict: 'A',\n            require: 'ngModel',\n            link: function (scope, element, attr, ngModel) {\n                function fromInput(text) {\n                    var result = null;\n                    if (text && text.length)\n                        result = text.split(',').map(function (i) { return i.trim(); });\n                    return result;\n                }\n                function toInput(arr) {\n                    var result = null;\n                    if (arr && typeof (arr.push) !== 'undefined')\n                        result = arr.join(', ');\n                    return result;\n                }\n                ngModel.$parsers.push(fromInput);\n                ngModel.$formatters.push(toInput);\n            }\n        };\n    });\n})(angular);\n","(function (jQuery, angular) {\n    \"use strict\";\n    angular.module(\"gp-common\")\n        .filter('fixLabel', function () {\n        return function (value) {\n            if (!value || typeof (value) !== 'string' || !value.length)\n                return 'Untitled';\n            var result = value.replace(/([a-z])([A-Z])/g, \"$1 $2\").replace(/_/g, \" \").trim();\n            return result.charAt(0).toUpperCase() + result.slice(1);\n        };\n    })\n        .filter('pluralize', function () {\n        return function (text) {\n            if (!text || !text.length)\n                return \"\";\n            if (text.endsWith('ss'))\n                return text + 'es'; //classes, etc\n            if (text.endsWith('s'))\n                return text; //already plural\n            return text + 's';\n            //TODO support irregular words like \"foot\" -> \"feet\"\n            // and words that need duplicate letters: \"quiz\" -> \"quizzes\"\n        };\n    })\n        .filter('capitalize', function () {\n        return function (text) {\n            return text[0].toUpperCase() + text.substring(1);\n        };\n    })\n        .filter('facets', function () {\n        return function (arr, facetName) {\n            if (!facetName)\n                return arr;\n            if (!arr || !arr.length)\n                return [];\n            return arr.filter(function (f) { return f.toLowerCase().startsWith(facetName + \":\"); })\n                .map(function (f) { return f.substring(f.indexOf(':') + 1, f.length); });\n        };\n    })\n        .filter('joinBy', function () {\n        return function (input, delimiter, emptyValue) {\n            if (input && typeof (input.push) !== 'undefined' && input.length)\n                return input.join(delimiter || ', ');\n            else\n                return emptyValue || '';\n        };\n    })\n        .filter('defaultValue', function () {\n        return function (text, defVal) {\n            if (typeof (text) === 'undefined' || !text.length)\n                return defVal;\n            return text;\n        };\n    })\n        .filter('count', function () {\n        return function (input) {\n            if (typeof (input) !== 'undefined') {\n                if (typeof (input.push) === 'function')\n                    return input.length;\n                if (typeof (input) === 'object') {\n                    if (typeof (Object.keys) !== 'undefined') {\n                        return Object.keys(input);\n                    }\n                }\n            }\n            return 0;\n        };\n    })\n        .filter('gpObjTypeMapper', function () {\n        return function (str) {\n            if (!str || typeof (str) !== 'string' || str.length === 0)\n                return str;\n            var name = str;\n            var idx = str.indexOf(\":\");\n            if (~idx)\n                name = str.substring(idx + 1);\n            if ('VCard' === name)\n                return 'Contact';\n            return name;\n        };\n    })\n        .filter('gpReliabilityGrade', function () {\n        return function (arg) {\n            var o = arg;\n            if (typeof (o) === 'object') {\n                if (o.statistics)\n                    o = o.statistics.reliability || null;\n                else if (o.reliability)\n                    o = o.reliability;\n                else\n                    o = null;\n            }\n            if (!isNaN(o)) {\n                o = o * 1;\n                if (o === null || typeof (o) === 'undefined')\n                    return 'X';\n                else if (o > 90)\n                    return 'A';\n                else if (o > 80)\n                    return 'B';\n                else if (o > 70)\n                    return 'C';\n                else if (o > 60)\n                    return 'D';\n                else\n                    return 'F';\n                // if (value >= 97) letter = 'A+';\n                // else if (value >= 93) letter = 'A';\n                // else if (value >= 90) letter = 'A-';\n                // else if (value >= 87) letter = 'B+';\n                // else if (value >= 83) letter = 'B';\n                // else if (value >= 80) letter = 'B-';\n                // else if (value >= 77) letter = 'C+';\n                // else if (value >= 73) letter = 'C';\n                // else if (value >= 70) letter = 'C-';\n                // else if (value >= 67) letter = 'D+';\n                // else if (value >= 63) letter = 'D';\n                // else if (value >= 60) letter = 'D-';\n            }\n            return \"X\";\n        };\n    });\n})(jQuery, angular);\n","(function (angular, Constants) {\n    'use strict';\n    var KGEditor = /** @class */ (function () {\n        function KGEditor($rootScope, $element, KGFields, KGHelper) {\n            'ngInject';\n            this.$rootScope = $rootScope;\n            this.$element = $element;\n            this.fields = KGFields.slice(0);\n            this.helper = KGHelper;\n        }\n        KGEditor.prototype.$onInit = function () {\n            this.displayOptions = {};\n            this.completion = 0;\n            this.service = this.helper.getService(this.ngModel.type);\n            this.descriptions = {\n                purpose: 'The intended use or reason for the Object (i.e., layer, map, gallery) e.g., environmental impact of an oil spill.',\n                'function': 'The business actions, activities, or tasks this Object is intended to support (i.e., the role it plays in supporting an activity).  e.g., environmental impact assessment.',\n                audience: 'The group of people for which this Object was intended to be used. e.g., general public, disaster recovery personnel, Congress.',\n                community: 'The GeoPlatform community this Object was produced for. e.g., \"Ecosystems and Biodiversity\" community',\n                place: 'The central locale or common names for the place where the Subjects of the Object occur. e.g.,  USA/Gulf Coast',\n                category: 'The type or category of the Object.  e.g., topographic map, elevation layer',\n                primarySubject: 'The selected things, events, or concepts forming part of or represented by the Object. e.g., Deep Water Horizon oil rig, oil slick extent, oil slick movement over time, predicted oil slick movement, impacted sites, impact severity.',\n                secondarySubject: 'Second-order subjects derived by machine processing/ analysis of the target Object',\n                primaryTopic: 'The central branch of knowledge or theme pertaining to the thing, concept, situation, issue, or event of interest. e.g., environmental impact of oil spill.',\n                secondaryTopic: 'Second-order topics derived by machine processing/ analysis of the target Object'\n            };\n            if (!this.ngModel.classifiers)\n                this.ngModel.classifiers = {};\n            this.calculatePercentage();\n        };\n        KGEditor.prototype.$onDestroy = function () {\n            this.$rootScope = null;\n            this.ngModel = null;\n            this.helper = null;\n            this.fields = null;\n            this.service = null;\n        };\n        /**\n         * @param {string} property - name of KG property being modified\n         * @param {array[object]} values - new values to assign to the property (includes old values)\n         */\n        KGEditor.prototype.onChange = function (property, values) {\n            // console.log(\"Changed \" + property + \" with \" + (values?values.length:0) + \" values\");\n            this.ngModel.classifiers[property] = values;\n            this.calculatePercentage();\n        };\n        /**\n         * @param {string} classifier - KG property whose value has been activated\n         * @param {object} value - selected value being activated\n         */\n        KGEditor.prototype.onValueClick = function (classifier, value) {\n            if (this.onActivate) {\n                this.onActivate({ classifier: classifier, value: value });\n            }\n        };\n        /**\n         *\n         */\n        KGEditor.prototype.calculatePercentage = function () {\n            this.completion = this.helper.calculate(this.ngModel.classifiers);\n        };\n        return KGEditor;\n    }());\n    angular.module('gp-common-kg').component('kgEditor', {\n        require: {\n            // formCtrl: '^form', \n            ngModelCtrl: 'ngModel'\n        },\n        bindings: {\n            ngModel: '=',\n            onActivate: '&' //function to invoke on KG item activation (click)\n        },\n        controller: KGEditor,\n        template: \"\\n            <div class=\\\"c-kg-editor\\\">\\n                <div class=\\\"c-kg-editor__header l-flex-container flex-justify-between flex-align-center\\\">\\n                    <div class=\\\"flex-1\\\">\\n                        <h4>Knowledge Graph</h4>\\n                        <div class=\\\"u-text--sm\\\">\\n                            Knowledge graphs (KGs) are formed from classifiers for several dimensions of GeoPlatform items \\n                            (layers, maps, galleries, etc), including <em>Purpose</em>, <em>Scope</em>, \\n                            <em>Fitness for Use</em>, and <em>Social Context</em>. \\n                            <br>\\n                            <br>\\n                            Knowledge graphs are used to answer questions about items, such as:\\n                            <ul>\\n                            <li>Why was the item created?</li>\\n                            <li>Why is it useful for others?</li>\\n                            <li>Why is it appropriate to be used?</li>\\n                            </ul>\\n                        </div>\\n                    </div>\\n                    <gp-progress-circle ng-model=\\\"$ctrl.completion\\\" class=\\\"u-mg-left--xlg u-mg-right--xlg\\\"></gp-progress-circle>\\n                </div>\\n\\n                <div class=\\\"c-kg-editor__content\\\">\\n\\n                    <div class=\\\"c-kg-editor__section\\\">\\n                        <h4 class=\\\"t-fg--accent\\\">Purpose</h4>\\n\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.purposes\\\"\\n                            on-change=\\\"$ctrl.onChange('purposes', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('purposes', value)\\\"\\n                            type=\\\"Purpose\\\"\\n                            label=\\\"Purpose\\\" \\n                            description=\\\"{{$ctrl.descriptions.purpose}}\\\">\\n                        </kg-section>\\n                    </div>\\n\\n\\n                    <div class=\\\"c-kg-editor__section\\\">\\n                        <h4 class=\\\"t-fg--accent\\\">Scope</h4>\\n\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.primaryTopics\\\"\\n                            on-change=\\\"$ctrl.onChange('primaryTopics', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('primaryTopics', value)\\\"\\n                            type=\\\"Topic\\\" \\n                            label=\\\"Primary Topics\\\" \\n                            description=\\\"{{$ctrl.descriptions.primaryTopic}}\\\">\\n                        </kg-section>\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.secondaryTopics\\\"\\n                            on-change=\\\"$ctrl.onChange('secondaryTopics', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('secondaryTopics', value)\\\"\\n                            type=\\\"Topic\\\" \\n                            label=\\\"Secondary Topics\\\" \\n                            description=\\\"{{$ctrl.descriptions.secondaryTopic}}\\\">\\n                        </kg-section>\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.primarySubjects\\\"\\n                            on-change=\\\"$ctrl.onChange('primarySubjects', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('primarySubjects', value)\\\"\\n                            type=\\\"Subject\\\" \\n                            label=\\\"Primary Subjects\\\" \\n                            description=\\\"{{$ctrl.descriptions.primarySubject}}\\\">\\n                        </kg-section>\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.secondarySubjects\\\"\\n                            on-change=\\\"$ctrl.onChange('secondarySubjects', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('secondarySubjects', value)\\\"\\n                            type=\\\"Subject\\\" \\n                            label=\\\"Secondary Subjects\\\" \\n                            description=\\\"{{$ctrl.descriptions.secondarySubject}}\\\">\\n                        </kg-section>\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.categories\\\"\\n                            on-change=\\\"$ctrl.onChange('categories', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('categories', value)\\\"\\n                            type=\\\"Category\\\" \\n                            label=\\\"Categories\\\" \\n                            description=\\\"{{$ctrl.descriptions.category}}\\\">\\n                        </kg-section>\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.communities\\\"\\n                            on-change=\\\"$ctrl.onChange('communities', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('communities', value)\\\"\\n                            type=\\\"Community\\\" \\n                            label=\\\"Communities\\\" \\n                            description=\\\"{{$ctrl.descriptions.community}}\\\">\\n                        </kg-section>\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.places\\\"\\n                            on-change=\\\"$ctrl.onChange('places', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('places', value)\\\"\\n                            type=\\\"Place\\\" \\n                            label=\\\"Places\\\" \\n                            description=\\\"{{$ctrl.descriptions.place}}\\\">\\n                        </kg-section> \\n                    </div> \\n\\n                    <div class=\\\"c-kg-editor__section\\\">\\n                        <h4 class=\\\"t-fg--accent\\\">Fitness for Use</h4>\\n\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.functions\\\"\\n                            on-change=\\\"$ctrl.onChange('functions', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('functions', value)\\\"\\n                            type=\\\"Function\\\" \\n                            label=\\\"Function\\\" \\n                            description=\\\"{{$ctrl.descriptions.function}}\\\">\\n                        </kg-section>\\n                    </div>\\n\\n                    <div class=\\\"c-kg-editor__section\\\">\\n                        <h4 class=\\\"t-fg--accent\\\">Social Context</h4>\\n\\n                        <kg-section \\n                            service=\\\"$ctrl.service\\\"\\n                            ng-model=\\\"$ctrl.ngModel.classifiers.audiences\\\"\\n                            on-change=\\\"$ctrl.onChange('audiences', values)\\\"\\n                            on-activate=\\\"$ctrl.onValueClick('audiences', value)\\\"\\n                            type=\\\"Audience\\\" \\n                            label=\\\"Audiences\\\" \\n                            description=\\\"{{$ctrl.descriptions.audience}}\\\">\\n                        </kg-section>\\n                    </div>\\n\\n                </div>\\n            </div>\\n        \"\n    });\n})(angular, GeoPlatform);\n","(function (angular, Constants) {\n    'use strict';\n    var SectionController = /** @class */ (function () {\n        function SectionController($timeout, RecommenderService) {\n            'ngInject';\n            this.$timeout = $timeout;\n            // this.service = RecommenderService;\n        }\n        SectionController.prototype.$onInit = function () {\n            this.noResults = false;\n            this.query = '';\n            this.displayOptions = {\n                fetching: false,\n                showSuggested: false\n            };\n            this.paging = {\n                start: 0,\n                size: 5,\n                sizeOptions: [5, 10, 20]\n            };\n            this.updateCache();\n            //default section description if one was not provided\n            if (!this.description)\n                this.description = '<em>No description provided</em>';\n        };\n        /**\n         * Update cache when bound 'ngModel' is actually assigned in the component lifecycle\n         */\n        SectionController.prototype.$onChanges = function () {\n            this.updateCache();\n        };\n        SectionController.prototype.$onDestroy = function () {\n            this.eventHandlers = null;\n            this.clearOptions();\n            this.selected = null;\n            this.service = null;\n            this.$timeout = null;\n        };\n        /**\n         *\n         * @param {object} item - selected value being activated (clicked on for navigation)\n         */\n        SectionController.prototype.activate = function (item) {\n            if (this.onActivate)\n                this.onActivate({ value: item });\n        };\n        SectionController.prototype.on = function (event, callback) {\n            this.eventHandlers = this.eventHandlers || {};\n            this.eventHandlers[event] = this.eventHandlers[event] || [];\n            this.eventHandlers[event].push(callback);\n        };\n        SectionController.prototype.notify = function (event, data) {\n            if (!this.eventHandlers || !this.eventHandlers[event])\n                return;\n            angular.forEach(this.eventHandlers[event], function (handler) {\n                try {\n                    handler(data);\n                }\n                catch (e) { }\n            });\n        };\n        /**\n         * @param {string} query - keywords provided by user input\n         * @return {Promise} resolving an array of results\n         */\n        SectionController.prototype.fetchOptions = function (query) {\n            var _this = this;\n            //need this timeout or else 'this.query' isn't being \n            // seen as having the same value as 'query'\n            this.$timeout(function () { _this.query = query; }, 10);\n            this.displayOptions.fetching = true;\n            var params = {\n                type: this.type,\n                q: query,\n                page: Math.floor(this.paging.start / this.paging.size),\n                size: this.paging.size\n            };\n            // if(this.forType)\n            //     params['for'] = this.forType;\n            return this.service.query(params).$promise\n                .then(function (response) {\n                _this.paging.total = response.totalResults;\n                _this.notify('gp:browse:suggestions:pagination', _this.paging);\n                _this.suggested = response.results.map(function (result) {\n                    result._selected = _this.isSelected(result);\n                    return result;\n                });\n                _this.displayOptions.showSuggested = true;\n                return _this.suggested;\n            })\n                .catch(function (e) {\n                _this.paging.total = 0;\n                _this.notify('gp:browse:suggestions:pagination', _this.paging);\n                _this.suggested = [];\n                return _this.suggested;\n            })\n                .finally(function () { return _this.displayOptions.fetching = false; });\n        };\n        SectionController.prototype.clearQuery = function () {\n            this.query = '';\n            this.fetchOptions(this.query);\n        };\n        SectionController.prototype.clearOptions = function () {\n            //clear query and available options\n            this.query = '';\n            this.suggested = null;\n            //reset paging\n            this.paging.start = 0;\n            this.paging.total = 0;\n            // this.notify('gp:browse:suggestions:pagination', this.paging);\n            //hide available options\n            this.displayOptions.showSuggested = false;\n        };\n        /**\n         * @param {integer} index - position in selected array of item removed\n         */\n        SectionController.prototype.remove = function (index) {\n            var removed = this.ngModel[index].uri;\n            this.ngModel.splice(index, 1);\n            //remove from suggested list if one is populated (being shown)\n            if (this.suggested && this.suggested.length) {\n                var found = this.suggested.find(function (it) { return it.uri === removed; });\n                if (found)\n                    found._selected = false;\n            }\n            this.updateCache(); //update cache of selected ids\n            if (this.onChange)\n                this.onChange({ values: this.ngModel }); //notify others of change\n        };\n        /**\n         * @param {object} value - item being checked for selection\n         * @return {boolean}\n         */\n        SectionController.prototype.isSelected = function (value) {\n            return value._selected || ~this.selected.indexOf(value.uri);\n        };\n        /**\n         * @param {object} value - item being selected\n         */\n        SectionController.prototype.selectValue = function (value) {\n            if (value._selected)\n                return; //already selected\n            value._selected = true;\n            this.ngModel = this.ngModel || [];\n            this.ngModel.push(value);\n            this.updateCache();\n            if (this.onChange)\n                this.onChange({ values: this.ngModel });\n        };\n        SectionController.prototype.updateCache = function () {\n            this.selected = (this.ngModel || []).map(function (o) { return o.uri; });\n        };\n        SectionController.prototype.onDropdownToggled = function (open) {\n            if (!open)\n                this.clearOptions();\n        };\n        /* -------- pagination methods ----------- */\n        SectionController.prototype.getPagination = function () {\n            return this.paging;\n        };\n        SectionController.prototype.start = function (index) {\n            this.paging.start = index;\n            this.fetchOptions(this.query);\n        };\n        SectionController.prototype.size = function (value) {\n            this.paging.size = value;\n            this.fetchOptions(this.query);\n        };\n        return SectionController;\n    }());\n    angular.module('gp-common-kg').component('kgSection', {\n        bindings: {\n            ngModel: '<',\n            service: '<',\n            label: '@',\n            description: '@',\n            type: '@',\n            onChange: '&?',\n            onActivate: '&?' //fire when selected value link is clicked\n        },\n        controller: SectionController,\n        template: \"\\n            <h5>{{$ctrl.label}}</h5>\\n            <p class=\\\"u-text--sm\\\" ng-bind-html=\\\"$ctrl.description\\\"></p>\\n\\n            <div class=\\\"list-group list-group-sm\\\">\\n                <div ng-repeat=\\\"item in $ctrl.ngModel track by $index\\\" class=\\\"list-group-item\\\">\\n                    <button type=\\\"button\\\" class=\\\"btn btn-link\\\" ng-click=\\\"$ctrl.remove($index)\\\">\\n                        <span class=\\\"glyphicon glyphicon-remove-circle t-fg--danger\\\"></span> \\n                    </button>\\n                    <div class=\\\"flex-1 u-pd--md\\\">\\n                        <div class=\\\"u-pd-bottom--sm t-text--strong\\\">\\n                            <a ng-click=\\\"$ctrl.activate(item)\\\" ng-if=\\\"$ctrl.onActivate\\\"\\n                                 class=\\\"u-break--all\\\">{{item.label}}</a>\\n                            <span ng-if=\\\"!$ctrl.onActivate\\\">{{item.label}}</span>\\n                        </div>\\n                        <div class=\\\"u-text--sm t-text--italic\\\">\\n                            <a href=\\\"{{item.uri}}\\\" target=\\\"_blank\\\" class=\\\"u-break--all\\\"\\n                                title=\\\"Open source info in new window\\\">{{item.uri}}</a>\\n                        </div>\\n                        <div class=\\\"description\\\" ng-if=\\\"item.description\\\" ng-bind-html=\\\"item.description\\\"></div>\\n                    </div>\\n                </div>\\n            </div>\\n\\n            <div class=\\\"t-fg--gray-md\\\" ng-if=\\\"!$ctrl.ngModel.length\\\"><em>No values specified</em></div>            \\n\\n            <hr>\\n\\n            <div uib-dropdown is-open=\\\"$ctrl.displayOptions.showSuggested\\\" \\n                auto-close=\\\"outsideClick\\\" on-toggle=\\\"$ctrl.onDropdownToggled(open)\\\">\\n\\n                <div class=\\\"l-flex-container flex-justify-between flex-align-center\\\">\\n                    <div class=\\\"input-group-slick flex-1\\\">\\n                        <span class=\\\"glyphicon\\\"\\n                            ng-class=\\\"{'glyphicon-search':!$ctrl.displayOptions.fetching, 'glyphicon-hourglass spin':$ctrl.displayOptions.fetching}\\\"></span>\\n                        <input type=\\\"text\\\" class=\\\"form-control\\\" \\n                            ng-model=\\\"$ctrl.query\\\" \\n                            ng-model-options=\\\"{ debounce: 250 }\\\"\\n                            ng-change=\\\"$ctrl.fetchOptions($ctrl.query)\\\"\\n                            placeholder=\\\"Find values to add...\\\">\\n                    </div>\\n                </div>\\n                \\n                <div class=\\\"dropdown-menu\\\" uib-dropdown-menu>\\n                    \\n                    <div class=\\\"form-group l-flex-container flex-justify-between flex-align-center\\\">\\n                        <div class=\\\"input-group-slick flex-1\\\">\\n                            <span class=\\\"glyphicon\\\"\\n                                ng-class=\\\"{'glyphicon-search':!$ctrl.displayOptions.fetching, 'glyphicon-hourglass spin':$ctrl.displayOptions.fetching}\\\"></span>\\n                            <input type=\\\"text\\\" class=\\\"form-control\\\" \\n                                ng-model=\\\"$ctrl.query\\\" \\n                                ng-model-options=\\\"{ debounce: 250 }\\\"\\n                                ng-change=\\\"$ctrl.fetchOptions($ctrl.query)\\\"\\n                                placeholder=\\\"Find values to add...\\\">\\n                            <span class=\\\"glyphicon glyphicon-remove\\\"\\n                                ng-if=\\\"$ctrl.query.length\\\"\\n                                ng-click=\\\"$event.stopPropagation();$ctrl.clearQuery()\\\"></span>\\n                        </div>\\n                        <button type=\\\"button\\\" class=\\\"btn btn-info u-mg-left--xlg animated-show\\\"\\n                            ng-click=\\\"$ctrl.clearOptions();\\\">\\n                            Done\\n                        </button>\\n                    </div>\\n                    \\n                    <gp-pagination service=\\\"$ctrl\\\" event-key=\\\"suggestions\\\" use-select=\\\"true\\\"></gp-pagination>\\n\\n                    <div class=\\\"list-group list-group-sm u-text--sm\\\">\\n                        <div ng-repeat=\\\"item in $ctrl.suggested track by $index\\\" class=\\\"list-group-item\\\">\\n                            <button type=\\\"button\\\" class=\\\"btn btn-link\\\" ng-click=\\\"$ctrl.selectValue(item)\\\"\\n                                ng-class=\\\"{disabled:item._selected}\\\">\\n                                <span class=\\\"glyphicon glyphicon-ok t-fg--gray-md\\\" ng-show=\\\"item._selected\\\"></span> \\n                                <span class=\\\"glyphicon glyphicon-plus-sign t-fg--success\\\" ng-show=\\\"!item._selected\\\"></span> \\n                            </button>\\n                            <div class=\\\"flex-1 u-pd--md\\\">\\n                                <div class=\\\"u-break--all t-text--strong u-pd-bottom--sm\\\">{{item.prefLabel}}</div>\\n                                <a href=\\\"{{item.uri}}\\\" target=\\\"_blank\\\" \\n                                    class=\\\"u-break--all u-text--sm t-text--italic\\\"\\n                                    title=\\\"Open source info in new window\\\">\\n                                    {{item.uri}}\\n                                </a>\\n                                <div class=\\\"description\\\">{{item.description||\\\"No description provided\\\"}}</div>\\n                            </div>\\n                        </div>\\n                        <div ng-if=\\\"!$ctrl.suggested.length\\\" class=\\\"list-group-item disabled u-pd--md\\\">\\n                            No results match your query\\n                        </div>\\n                    </div>\\n                </div>\\n            </div>\\n        \"\n    });\n})(angular, GeoPlatform);\n","(function (angular, Constants) {\n    'use strict';\n    var FACET_NAME = 'usedBy.id';\n    angular.module('gp-common').component('communityFilter', {\n        bindings: {\n            name: '@',\n            service: \"<\"\n        },\n        controller: function ($http) {\n            this.$onInit = function () {\n                this.collapse = true;\n                this.updateValues();\n            };\n            this.$onDestroy = function () {\n                this.values = null;\n            };\n            this.hasSelections = function () {\n                return (this.service.getUsedBy() || []).length;\n            };\n            this.isSelected = function (value) {\n                var selected = this.service.getUsedBy() || [];\n                return ~selected.indexOf(value.id);\n            };\n            this.toggle = function (value) {\n                var selected = this.service.getUsedBy() || [];\n                var idx = selected.indexOf(value.id);\n                if (idx >= 0)\n                    selected.splice(idx, 1);\n                else\n                    selected.push(value.id);\n                this.service.setUsedBy(selected);\n            };\n            this.clear = function () {\n                var selected = this.service.getUsedBy() || [];\n                if (!selected || !selected.length)\n                    this.collapse = !this.collapse; //toggle collapsed state\n                else\n                    this.service.setUsedBy([]);\n            };\n            this.getCount = function (value) {\n                var facet = this.service.getFacet(FACET_NAME);\n                if (!facet)\n                    return '';\n                var valObj = facet.buckets.find(function (v) { return v.label === value.id; });\n                if (!valObj)\n                    return '';\n                return valObj.count;\n            };\n            this.updateValues = function (query) {\n                var _this = this;\n                return $http.get(Constants.ualUrl + '/api/communities', {\n                    params: {\n                        sort: 'label,asc',\n                        q: query,\n                        size: 20,\n                        bust: new Date().getTime()\n                    }\n                }).then(function (response) {\n                    var total = response.data.totalResults;\n                    var newValues = response.data.results.slice(0);\n                    _this.additionalValueCount = total - newValues.length;\n                    var selections = _this.service.getUsedBy();\n                    if (selections && selections.length && _this.values && _this.values.length) {\n                        var existing = _this.values.filter(function (v) {\n                            //find existing values that are selected\n                            return ~selections.indexOf(v.id) &&\n                                // but not in new set of values\n                                !newValues.filter(function (nv) { return nv.id === v.id; }).length;\n                        });\n                        newValues = existing.concat(newValues);\n                    }\n                    _this.values = newValues;\n                }).catch(function (response) {\n                    console.log(\"(\" + response.status + \") \" + response.statusText);\n                });\n            };\n        },\n        template: \"\\n            <div class=\\\"card\\\">\\n                <h5 class=\\\"card-title l-flex-container flex-justify-between flex-align-center\\\">\\n                    <span class=\\\"flex-1\\\">Filter by Communities</span>\\n                    <button type=\\\"button\\\" class=\\\"btn btn-sm btn-link\\\"\\n                        title=\\\"{{$ctrl.collapse?'Expand':'Collapse'}}\\\"\\n                        ng-click=\\\"$ctrl.collapse = !$ctrl.collapse\\\">\\n                        <span class=\\\"glyphicon\\\" ng-class=\\\"{'glyphicon-chevron-up':!$ctrl.collapse,'glyphicon-chevron-down':$ctrl.collapse}\\\"></span>\\n                    </button>\\n                </h5>\\n                <div class=\\\"card-content\\\">\\n                    <div class=\\\"c-facets\\\" ng-class=\\\"{'is-collapsed':$ctrl.collapse}\\\">\\n\\n                        <div class=\\\"c-facet__value\\\">\\n                            <div class=\\\"input-group-slick\\\">\\n                                <input name=\\\"scheme-typeahead\\\" type=\\\"text\\\" class=\\\"form-control\\\"\\n                                    ng-model=\\\"$ctrl.typeaheadValue\\\"\\n                                    ng-change=\\\"$ctrl.updateValues($ctrl.typeaheadValue)\\\"\\n                                    ng-model-options=\\\"{debounce:200}\\\"\\n                                    placeholder=\\\"Search by name\\\">\\n                                <span class=\\\"glyphicon glyphicon-remove\\\"\\n                                    title=\\\"Clear query\\\"\\n                                    ng-if=\\\"$ctrl.typeaheadValue.length\\\"\\n                                    ng-click=\\\"$ctrl.updateValues($ctrl.typeaheadValue=null)\\\">\\n                                </span>\\n                            </div>\\n                        </div>\\n\\n                        <a class=\\\"c-facet__value\\\" ng-click=\\\"$ctrl.clear()\\\"\\n                            ng-class=\\\"{active:!$ctrl.hasSelections()}\\\">\\n                            <span class=\\\"glyphicon\\\"\\n                                ng-class=\\\"{'glyphicon-check':!$ctrl.hasSelections(), 'glyphicon-unchecked t-fg--gray-lt':$ctrl.hasSelections()}\\\">\\n                            </span>\\n                            Any Community\\n                        </a>\\n                        <a  ng-repeat=\\\"value in $ctrl.values track by $index\\\"\\n                            class=\\\"c-facet__value\\\"\\n                            ng-click=\\\"$ctrl.toggle(value)\\\"\\n                            ng-class=\\\"{active:$ctrl.isSelected(value)}\\\">\\n\\n                            <span class=\\\"badge pull-right\\\">{{$ctrl.getCount(value)}}</span>\\n                            <span class=\\\"glyphicon\\\"\\n                                ng-class=\\\"{'glyphicon-check':$ctrl.isSelected(value),'glyphicon-unchecked t-fg--gray-lt':!$ctrl.isSelected(value)}\\\"></span>\\n                            {{value.label}}\\n                        </a>\\n                        <div class=\\\"c-facet__value t-fg--gray-md\\\"\\n                            ng-if=\\\"$ctrl.additionalValueCount\\\">\\n                            <em>plus {{$ctrl.additionalValueCount}} more options</em>\\n                        </div>\\n                    </div>\\n                </div>\\n            </div>\\n        \"\n    });\n})(angular, GeoPlatform);\n","(function (angular) {\n    'use strict';\n    angular.module('gp-common').component('createdByFilter', {\n        bindings: {\n            service: '<' //service filtering by\n        },\n        controller: function (AuthenticationService) {\n            this.$onInit = function () {\n                var _this = this;\n                this.value = null; //input from user for \"created by\" value\n                this.collapse = true; //hide show controls\n                this.limitToUser = false; //filter using current user\n                this.modelOptions = {\n                    'updateOn': 'default blur',\n                    'debounce': {\n                        'default': 250,\n                        'blur': 0\n                    }\n                };\n                AuthenticationService.getUserQ().then(function (user) {\n                    _this.username = user ? user.username : null;\n                });\n            };\n            this.$onDestroy = function () {\n                this.value = null;\n                this.collapse = null;\n                this.limitToUser = null;\n                this.username = null;\n            };\n            this.filter = function () {\n                var value = (this.limitToUser) ? this.username : this.value;\n                if (typeof (value) !== 'undefined' && value !== null && value.trim().length === 0)\n                    value = null; //don't accept empty strings\n                this.service.setCreatedBy(value, true);\n            };\n            this.toggleLimitToUser = function () {\n                this.limitToUser = !this.limitToUser;\n                this.filter();\n            };\n            this.clear = function () {\n                this.value = null;\n                this.filter();\n            };\n        },\n        template: \"\\n            <div class=\\\"card\\\">\\n                <h5 class=\\\"card-title l-flex-container flex-justify-between flex-align-center\\\">\\n                    <span class=\\\"flex-1\\\">Filter by Author</span>\\n                    <button type=\\\"button\\\" class=\\\"btn btn-sm btn-link\\\"\\n                        title=\\\"{{$ctrl.collapse?'Expand':'Collapse'}}\\\"\\n                        ng-click=\\\"$ctrl.collapse = !$ctrl.collapse\\\">\\n                        <span class=\\\"glyphicon\\\" ng-class=\\\"{'glyphicon-chevron-up':!$ctrl.collapse,'glyphicon-chevron-down':$ctrl.collapse}\\\"></span>\\n                    </button>\\n                </h5>\\n                <div class=\\\"card-content\\\" ng-hide=\\\"$ctrl.collapse\\\">\\n\\n                    <div class=\\\"input-group-slick\\\">\\n                        <span class=\\\"glyphicon glyphicon-user\\\"></span>\\n                        <input type=\\\"text\\\" class=\\\"form-control\\\" placeholder=\\\"Specify author username\\\"\\n                            ng-disabled=\\\"$ctrl.limitToUser\\\"\\n                            ng-model=\\\"$ctrl.value\\\"\\n                            ng-model-options=\\\"$ctrl.modelOptions\\\"\\n                            ng-change=\\\"$ctrl.filter()\\\">\\n                        <span class=\\\"glyphicon glyphicon-remove\\\" title=\\\"Clear author\\\"\\n                            ng-if=\\\"$ctrl.value.length&&!$ctrl.limitToUser\\\" ng-click=\\\"$ctrl.clear()\\\"></span>\\n                    </div>\\n\\n                    <label class=\\\"control-label u-text--sm text-muted u-pd-top--sm\\\" ng-if=\\\"$ctrl.username\\\">\\n                        <input type=\\\"checkbox\\\" ng-model=\\\"$ctrl.limitToUser\\\" ng-change=\\\"$ctrl.filter()\\\">\\n                        Only show my maps\\n                    </label>\\n                </div>\\n            </div>\\n        \"\n    });\n})(angular);\n","(function (angular, Constants) {\n    'use strict';\n    var PUBLISHER_FACET = 'publishers';\n    angular.module('gp-common').component('publisherFilter', {\n        bindings: {\n            name: '@',\n            service: \"<\"\n        },\n        controller: function ($http) {\n            this.$onInit = function () {\n                this.collapse = true;\n                this.updateValues();\n            };\n            this.$onDestroy = function () {\n                this.values = null;\n            };\n            this.hasSelections = function () {\n                return (this.service.getAgencies() || []).length;\n            };\n            this.isSelected = function (value) {\n                var selected = this.service.getAgencies() || [];\n                return ~selected.indexOf(value.id);\n            };\n            this.toggle = function (value) {\n                var selected = this.service.getAgencies() || [];\n                var idx = selected.indexOf(value.id);\n                if (idx >= 0)\n                    selected.splice(idx, 1);\n                else\n                    selected.push(value.id);\n                this.service.setAgencies(selected);\n            };\n            this.clear = function () {\n                var selected = this.service.getAgencies() || [];\n                if (!selected || !selected.length)\n                    this.collapse = !this.collapse; //toggle collapsed state\n                else\n                    this.service.setAgencies([]);\n            };\n            this.getCount = function (value) {\n                var facet = this.service.getFacet(PUBLISHER_FACET);\n                if (!facet)\n                    return '';\n                var valObj = facet.buckets.find(function (v) { return v.label === value.id; });\n                if (!valObj)\n                    return '';\n                return valObj.count;\n            };\n            this.updateValues = function (query) {\n                var _this = this;\n                return $http.get(Constants.ualUrl + '/api/items', {\n                    params: {\n                        type: 'org:Organization',\n                        sort: 'label,asc',\n                        q: query,\n                        size: 20,\n                        bust: new Date().getTime()\n                    }\n                }).then(function (response) {\n                    var total = response.data.totalResults;\n                    var newValues = response.data.results.slice(0);\n                    _this.additionalValueCount = total - newValues.length;\n                    var selections = _this.service.getAgencies();\n                    if (selections && selections.length && _this.values && _this.values.length) {\n                        var existing = _this.values.filter(function (v) {\n                            //find existing values that are selected\n                            return ~selections.indexOf(v.id) &&\n                                // but not in new set of values\n                                !newValues.filter(function (nv) { return nv.id === v.id; }).length;\n                        });\n                        newValues = existing.concat(newValues);\n                    }\n                    _this.values = newValues;\n                }, function (response) {\n                    console.log(\"(\" + response.status + \") \" + response.statusText);\n                });\n            };\n        },\n        template: \"\\n            <div class=\\\"card\\\">\\n                <h5 class=\\\"card-title l-flex-container flex-justify-between flex-align-center\\\">\\n                    <span class=\\\"flex-1\\\">Filter by Publisher(s)</span>\\n                    <button type=\\\"button\\\" class=\\\"btn btn-sm btn-link\\\"\\n                        title=\\\"{{$ctrl.collapse?'Expand':'Collapse'}}\\\"\\n                        ng-click=\\\"$ctrl.collapse = !$ctrl.collapse\\\">\\n                        <span class=\\\"glyphicon\\\" ng-class=\\\"{'glyphicon-chevron-up':!$ctrl.collapse,'glyphicon-chevron-down':$ctrl.collapse}\\\"></span>\\n                    </button>\\n                </h5>\\n                <div class=\\\"card-content\\\">\\n                    <div class=\\\"c-facets\\\" ng-class=\\\"{'is-collapsed':$ctrl.collapse}\\\">\\n\\n                        <div class=\\\"c-facet__value\\\">\\n                            <div class=\\\"input-group-slick\\\">\\n                                <input name=\\\"scheme-typeahead\\\" type=\\\"text\\\" class=\\\"form-control\\\"\\n                                    ng-model=\\\"$ctrl.typeaheadValue\\\"\\n                                    ng-change=\\\"$ctrl.updateValues($ctrl.typeaheadValue)\\\"\\n                                    ng-model-options=\\\"{debounce:200}\\\"\\n                                    placeholder=\\\"Search by name\\\">\\n                                <span class=\\\"glyphicon glyphicon-remove\\\"\\n                                    title=\\\"Clear query\\\"\\n                                    ng-if=\\\"$ctrl.typeaheadValue.length\\\"\\n                                    ng-click=\\\"$ctrl.updateValues($ctrl.typeaheadValue=null)\\\">\\n                                </span>\\n                            </div>\\n                        </div>\\n\\n                        <a class=\\\"c-facet__value\\\" ng-click=\\\"$ctrl.clear()\\\"\\n                            ng-class=\\\"{active:!$ctrl.hasSelections()}\\\">\\n                            <span class=\\\"glyphicon\\\"\\n                                ng-class=\\\"{'glyphicon-check':!$ctrl.hasSelections(), 'glyphicon-unchecked t-fg--gray-lt':$ctrl.hasSelections()}\\\">\\n                            </span>\\n                            Any Publisher\\n                        </a>\\n                        <a  ng-repeat=\\\"value in $ctrl.values track by $index\\\"\\n                            class=\\\"c-facet__value\\\"\\n                            ng-click=\\\"$ctrl.toggle(value)\\\"\\n                            ng-class=\\\"{active:$ctrl.isSelected(value)}\\\">\\n\\n                            <span class=\\\"badge pull-right\\\">{{$ctrl.getCount(value)}}</span>\\n                            <span class=\\\"glyphicon\\\"\\n                                ng-class=\\\"{'glyphicon-check':$ctrl.isSelected(value),'glyphicon-unchecked t-fg--gray-lt':!$ctrl.isSelected(value)}\\\"></span>\\n                            {{value.label}}\\n                        </a>\\n                        <div class=\\\"c-facet__value t-fg--gray-md\\\"\\n                            ng-if=\\\"$ctrl.additionalValueCount\\\">\\n                            <em>plus {{$ctrl.additionalValueCount}} more options</em>\\n                        </div>\\n                    </div>\\n                </div>\\n            </div>\\n        \"\n    });\n})(angular, GeoPlatform);\n","(function (angular) {\n    'use strict';\n    var PARAMETER = \"concepts\";\n    var RecommendedTermFilter = /** @class */ (function () {\n        function RecommendedTermFilter($timeout, RecommenderService) {\n            'ngInject';\n            this.termService = RecommenderService;\n            this.$timeout = $timeout;\n        }\n        RecommendedTermFilter.prototype.$onInit = function () {\n            this.displayOpts = {\n                fetching: false,\n                empty: false,\n                collapse: false,\n                suggest: false\n            };\n            this.values = [];\n            this.suggested = [];\n            this.termQuery = null;\n            this.paging = {\n                start: 0,\n                size: 5,\n                sizeOptions: [5, 10, 20]\n            };\n        };\n        RecommendedTermFilter.prototype.$onDestroy = function () {\n            this.$timeout = null;\n            this.displayOpts = null;\n            this.values = null;\n            this.suggested = null;\n            this.service = null;\n            this.termService = null;\n            this.termQuery = null;\n            this.paging = null;\n            this.eventHandlers = null;\n        };\n        /* ----------------- typeahead methods ------------------ */\n        // onSelection ($item, $model, $label, $event) {\n        //     this.values.push($model);   //append selection to list\n        //     this.termQuery = null;      //clear the typeahead field\n        //     this.update();\n        // }\n        //\n        // getOptions (text) {\n        //\n        //     this.displayOpts.fetching = true;\n        //     this.displayOpts.empty = false;\n        //\n        //     let params = {\n        //         q:text,\n        //         size:12\n        //     };\n        //     if(this.type)\n        //         params['for'] = this.type;\n        //\n        //     return this.termService.query(params).$promise\n        //     .then( response => {\n        //         let results = response.results;\n        //         this.displayOpts.empty = !results.length;\n        //         return results;\n        //     })\n        //     .catch( e => {\n        //         this.displayOpts.empty = true;\n        //         console.log(\"Error finding semantic terms: \" + e.message);\n        //     })\n        //     .finally( () => {\n        //         this.displayOpts.fetching = false;\n        //     });\n        // }\n        RecommendedTermFilter.prototype.hideSuggested = function () {\n            this.displayOpts.suggest = this.displayOpts.fetching =\n                this.displayOpts.empty = false;\n            this.termQuery = null;\n            this.suggested = [];\n            this.paging.start = this.paging.total = 0;\n        };\n        RecommendedTermFilter.prototype.select = function (item) {\n            item._selected = true; //update status to show it's already _selected\n            this.values.push(item); //append selection to list\n            this.update(); //update overall browse query with new selection\n        };\n        RecommendedTermFilter.prototype.getOptions = function () {\n            var _this = this;\n            var text = this.termQuery;\n            // console.log(\"Querying using '\" + text + \"'\");\n            //if empty value was provided, don't search.\n            if (!text || !text.length) {\n                this.suggested = [];\n                // this.suggestedTotal = this.suggestedCount = 0;\n                this.paging.start = this.paging.total = 0;\n                this.notify('gp:browse:suggestions:pagination', this.paging);\n                // this.displayOpts.suggest = false;\n                return;\n            }\n            //reset variables\n            this.suggested = [];\n            // this.suggestedTotal = this.suggestedCount = 0;\n            this.displayOpts.suggest = true;\n            this.displayOpts.fetching = true;\n            this.displayOpts.empty = false;\n            var params = {\n                q: text,\n                page: Math.floor(this.paging.start / this.paging.size),\n                size: this.paging.size\n            };\n            if (this.type)\n                params['for'] = this.type;\n            this.termService.query(params).$promise\n                .then(function (response) {\n                var results = response.results;\n                _this.displayOpts.empty = !results.length;\n                _this.suggested = results.map(function (result) {\n                    result._selected = _this.isSelected(result);\n                    return result;\n                });\n                _this.paging.total = response.totalResults;\n                _this.notify('gp:browse:suggestions:pagination', _this.paging);\n            })\n                .catch(function (e) {\n                _this.displayOpts.empty = true;\n                _this.suggested = [];\n                _this.paging.total = 0;\n                _this.notify('gp:browse:suggestions:pagination', _this.paging);\n                console.log(\"Error finding semantic terms: \" + e.message);\n            })\n                .finally(function () {\n                _this.displayOpts.fetching = false;\n                // this.displayOpts.suggest = true;\n            });\n        };\n        RecommendedTermFilter.prototype.hasSelections = function () {\n            return this.values.length;\n        };\n        RecommendedTermFilter.prototype.isSelected = function (item) {\n            return this.values.filter(function (v) { return v.uri === item.uri; }).length;\n        };\n        RecommendedTermFilter.prototype.removeValue = function (index) {\n            if (this.values.length >= index) {\n                var removed_1 = this.values.splice(index, 1)[0]; //remove from selected\n                this.update(); //update overall browse query\n                //update associated item in suggested list (if visible)\n                if (this.suggested.length) {\n                    var match = this.suggested.find(function (i) { return i.uri === removed_1.uri; });\n                    if (match)\n                        match._selected = false;\n                }\n            }\n        };\n        RecommendedTermFilter.prototype.clear = function () {\n            this.values = [];\n            this.update();\n        };\n        RecommendedTermFilter.prototype.update = function () {\n            var value = this.values.length ? this.values.map(function (v) { return v.uri; }) : null;\n            this.service.applyOption(PARAMETER, value, true);\n        };\n        /* -------- pagination methods ----------- */\n        RecommendedTermFilter.prototype.on = function (event, callback) {\n            this.eventHandlers = this.eventHandlers || {};\n            this.eventHandlers[event] = this.eventHandlers[event] || [];\n            this.eventHandlers[event].push(callback);\n        };\n        RecommendedTermFilter.prototype.notify = function (event, data) {\n            var _this = this;\n            if (!this.$timeout || !this.eventHandlers || !this.eventHandlers[event])\n                return;\n            this.$timeout(function () {\n                angular.forEach(_this.eventHandlers[event], function (handler) {\n                    try {\n                        handler(data);\n                    }\n                    catch (e) { }\n                });\n            }, 100);\n        };\n        RecommendedTermFilter.prototype.getPagination = function () {\n            return this.paging;\n        };\n        RecommendedTermFilter.prototype.start = function (index) {\n            this.paging.start = index;\n            this.getOptions();\n        };\n        RecommendedTermFilter.prototype.size = function (value) {\n            this.paging.size = value;\n            this.getOptions();\n        };\n        return RecommendedTermFilter;\n    }());\n    angular.module('gp-common').component('recommendedTermFilter', {\n        bindings: {\n            //type of object being searched (ie, Layer, Map)\n            type: '@',\n            //BrowseObjectService the filter will affect\n            service: \"<\"\n        },\n        controller: RecommendedTermFilter,\n        template: \"\\n            <div class=\\\"card c-filter__recommended-terms\\\">\\n\\n                <h5 class=\\\"card-title l-flex-container flex-justify-between flex-align-center\\\">\\n\\n                    Filter using Semantic Concepts\\n\\n                    <button type=\\\"button\\\" class=\\\"btn btn-sm btn-link\\\"\\n                        title=\\\"{{$ctrl.displayOpts.collapse?'Expand':'Collapse'}}\\\"\\n                        ng-click=\\\"$ctrl.displayOpts.collapse = !$ctrl.displayOpts.collapse\\\">\\n                        <span class=\\\"glyphicon\\\"\\n                            ng-class=\\\"{'glyphicon-chevron-up':!$ctrl.displayOpts.collapse,'glyphicon-chevron-down':$ctrl.displayOpts.collapse}\\\"></span>\\n                    </button>\\n                </h5>\\n\\n                <div class=\\\"c-facets\\\" ng-class=\\\"{'is-collapsed':$ctrl.displayOpts.collapse}\\\">\\n\\n                    <!--\\n                    <div class=\\\"c-facet__value\\\">\\n\\n                        <div class=\\\"input-group-slick\\\">\\n                            <input name=\\\"termQuery\\\" type=\\\"text\\\" class=\\\"form-control\\\"\\n                              ng-model=\\\"$ctrl.termQuery\\\"\\n                              typeahead-on-select=\\\"$ctrl.onSelection($item, $model, $label, $event)\\\"\\n                              uib-typeahead=\\\"opt as ' (' + opt.context + ') ' + opt.label for opt in $ctrl.getOptions($viewValue)\\\"\\n                              typeahead-loading=\\\"$ctrl.displayOpts.fetching\\\"\\n                              typeahead-no-results=\\\"$ctrl.displayOpts.empty\\\"\\n                              ng-model-options=\\\"{ debounce: 250 }\\\"\\n                              typeahead-min-length=\\\"2\\\"\\n                              typeahead-editable=\\\"false\\\"\\n                              placeholder=\\\"Find a concept\\\">\\n                            <span class=\\\"glyphicon glyphicon-hourglass spin\\\" ng-if=\\\"$ctrl.displayOpts.fetching\\\"></span>\\n                        </div>\\n\\n                        <div ng-show=\\\"$ctrl.displayOpts.empty\\\">No Results Found</div>\\n\\n                    </div>\\n                    -->\\n\\n                    <div ng-hide=\\\"$ctrl.displayOpts.collapse\\\">\\n\\n                        <div class=\\\"input-group-slick\\\">\\n                            <span class=\\\"glyphicon\\\"\\n                                ng-class=\\\"{'glyphicon-search':!$ctrl.displayOpts.fetching, 'glyphicon-hourglass spin':$ctrl.displayOpts.fetching}\\\"></span>\\n                            <input type=\\\"text\\\" class=\\\"form-control\\\"\\n                                ng-model=\\\"$ctrl.termQuery\\\"\\n                                ng-model-options=\\\"{ debounce: 250 }\\\"\\n                                ng-change=\\\"$ctrl.getOptions()\\\"\\n                                placeholder=\\\"Find concepts\\\">\\n                            <span class=\\\"glyphicon glyphicon-remove\\\" ng-if=\\\"$ctrl.displayOpts.suggest\\\"\\n                                ng-click=\\\"$ctrl.hideSuggested()\\\"></span>\\n                        </div>\\n\\n                        <gp-pagination service=\\\"$ctrl\\\" event-key=\\\"suggestions\\\" use-select=\\\"true\\\"\\n                            ng-if=\\\"$ctrl.displayOpts.suggest\\\">\\n                        </gp-pagination>\\n\\n                        <div class=\\\"list-group list-group-sm u-text--sm\\\"\\n                            ng-if=\\\"$ctrl.displayOpts.suggest && !$ctrl.displayOpts.fetching\\\">\\n\\n                            <a ng-repeat=\\\"item in $ctrl.suggested track by $index\\\"\\n                                class=\\\"list-group-item\\\"\\n                                ng-class=\\\"{disabled:item._selected}\\\"\\n                                ng-click=\\\"$ctrl.select(item)\\\">\\n                                <span class=\\\"u-break--all t-text--strong u-pd-bottom--sm\\\">{{item.prefLabel}}</span>\\n                                <br>\\n                                <span class=\\\"u-break--all u-text--sm t-text--italic\\\">{{item.uri}}</span>\\n                            </a>\\n\\n                            <div ng-if=\\\"$ctrl.displayOpts.empty\\\" class=\\\"list-group-item disabled u-pd--md\\\">\\n                                No concepts found\\n                            </div>\\n\\n                        </div>\\n\\n                    </div>\\n\\n\\n                    <!-- selected terms -->\\n                    <div ng-repeat=\\\"term in $ctrl.values\\\" class=\\\"c-facet__value active\\\"\\n                        title=\\\"Remove this term from the query\\\"\\n                        ng-click=\\\"$ctrl.removeValue($index)\\\">\\n\\n                        <div class=\\\"u-break--all t-text--strong u-pd-bottom--sm\\\">\\n                            <span class=\\\"glyphicon glyphicon-check\\\"></span>\\n                            {{term.prefLabel}}\\n                        </div>\\n                        <div class=\\\"u-break--all u-text--sm t-text--italic\\\">{{term.uri}}</div>\\n                    </div>\\n\\n                </div>\\n\\n            </div>\\n        \"\n    });\n})(angular);\n","(function (angular) {\n    'use strict';\n    angular.module('gp-common').component('similarityFilter', {\n        bindings: {\n            //type of object being searched (ie, Layer, Map)\n            type: '@',\n            //BrowseObjectService the filter will affect\n            service: \"<\",\n            //optional, id of current map (if one exists)\n            mapId: '@'\n        },\n        controller: function () {\n            this.$onInit = function () {\n                var _this = this;\n                this.collapse = true;\n                this.value = null;\n                this.useMap = false;\n                var evtName = this.service.events.SIMILARITY;\n                this.listener = this.service.on(evtName, function (event, layer) {\n                    _this.value = layer;\n                    _this.service.applyOption('similarTo', _this.value.id, true);\n                });\n                if (!this.type)\n                    this.type = \"item\";\n            };\n            this.$onDestroy = function () {\n                this.listener(); //dispose of listener\n                this.collapse = null;\n                this.value = null;\n                this.service = null;\n                this.mapId = null;\n            };\n            this.hasSelections = function () {\n                return !!this.value;\n            };\n            this.clearValue = function () {\n                if (this.useMap) {\n                    this.useMap = false;\n                    this.service.applyOption('similarTo', this.value.id, true);\n                }\n                else {\n                    this.value = null;\n                    this.service.applyOption('similarTo', null, true);\n                }\n            };\n            this.toggleCurrentMap = function (bool) {\n                if (this.useMap) {\n                    this.useMap = false;\n                    if (this.value) {\n                        this.service.applyOption('similarTo', this.value.id, true);\n                    }\n                    else {\n                        this.service.applyOption('similarTo', false, true);\n                    }\n                }\n                else {\n                    this.useMap = true;\n                    this.service.applyOption('similarTo', this.mapId, true);\n                }\n            };\n        },\n        template: \"\\n            <div class=\\\"card\\\" ng-if=\\\"$ctrl.value\\\">\\n\\n                <h5 class=\\\"card-title\\\">Find Similar</h5>\\n                <div class=\\\"card-content\\\">\\n\\n                    <p class=\\\"u-text--sm\\\">Searching for {{$ctrl.type}}s similar to the following: </p>\\n\\n                    <div class=\\\"c-facets\\\">\\n\\n                        <a class=\\\"c-facet__value\\\" ng-if=\\\"$ctrl.value\\\" ng-click=\\\"$ctrl.clearValue()\\\">\\n                            <span class=\\\"glyphicon glyphicon-remove-circle\\\"></span>\\n                            {{$ctrl.value.label}}\\n                        </a>\\n\\n                        <!--\\n                        <a ng-if=\\\"$ctrl.mapId\\\" class=\\\"c-facet__value\\\"\\n                            ng-click=\\\"$ctrl.toggleCurrentMap()\\\" ng-class=\\\"{active:$ctrl.useMap}\\\">\\n                            <span class=\\\"glyphicon glyphicon-check\\\" ng-show=\\\"$ctrl.useMap\\\"></span>\\n                            <span class=\\\"glyphicon glyphicon-unchecked\\\" ng-show=\\\"!$ctrl.useMap\\\"></span>\\n                            Find similar to my current map\\n                        </a>\\n                        -->\\n\\n                    </div>\\n\\n                    <br>\\n                    <p class=\\\"u-text--sm\\\">Note that query filters below are still being applied.</p>\\n\\n                </div>\\n            </div>\\n        \"\n    });\n})(angular);\n","(function (angular, Constants) {\n    'use strict';\n    /*\n        <themes-filter></themes-filter>\n     */\n    angular.module('gp-common').component('themeFilter', {\n        bindings: {\n            name: '@',\n            service: '<'\n        },\n        controller: function ($http) {\n            this.$onInit = function () {\n                this.collapse = true;\n                this.updateValues();\n            };\n            this.$onDestroy = function () {\n                this.values = null;\n                this.service = null;\n            };\n            this.hasSelections = function () {\n                return (this.service.getThemes() || []).length;\n            };\n            this.isSelected = function (value) {\n                var themes = this.service.getThemes() || [];\n                return ~themes.indexOf(value.id);\n            };\n            this.toggle = function (value) {\n                var themes = this.service.getThemes() || [];\n                var idx = themes.indexOf(value.id);\n                if (idx >= 0)\n                    themes.splice(idx, 1);\n                else\n                    themes.push(value.id);\n                this.service.setThemes(themes);\n            };\n            this.clear = function () {\n                var themes = this.service.getThemes() || [];\n                if (!themes || !themes.length)\n                    this.collapse = !this.collapse; //toggle collapsed state\n                else\n                    this.service.setThemes([]);\n            };\n            this.getCount = function (value) {\n                var facet = this.service.getFacet('themes');\n                if (!facet)\n                    return '';\n                var valObj = facet.buckets.find(function (v) { return v.label === value.id; });\n                if (!valObj)\n                    return '';\n                return valObj.count;\n            };\n            this.updateValues = function (query) {\n                var _this = this;\n                return $http.get(Constants.ualUrl + '/api/items', {\n                    params: {\n                        type: 'skos:Concept',\n                        'scheme.label': 'NGDA Portfolio Themes',\n                        fields: 'scheme',\n                        size: 9999,\n                        sort: 'label,asc',\n                        bust: new Date().getTime()\n                    }\n                }).then(function (response) {\n                    // let total = response.data.totalResults;\n                    _this.values = response.data.results.slice(0);\n                }, function (response) {\n                    console.log(\"(\" + response.status + \") \" + response.statusText);\n                }).catch(function (e) {\n                    console.log(\"Error fetching NGDA Themes: \" + e.message);\n                });\n            };\n        },\n        template: \"\\n            <div class=\\\"card c-browse-filter\\\">\\n                <h5 class=\\\"card-title l-flex-container flex-justify-between flex-align-center\\\">\\n                    Filter by NGDA Themes\\n                    <button type=\\\"button\\\" class=\\\"btn btn-sm btn-link\\\"\\n                        title=\\\"{{$ctrl.collapse?'Expand':'Collapse'}}\\\"\\n                        ng-click=\\\"$ctrl.collapse = !$ctrl.collapse\\\">\\n                        <span class=\\\"glyphicon\\\" ng-class=\\\"{'glyphicon-chevron-up':!$ctrl.collapse,'glyphicon-chevron-down':$ctrl.collapse}\\\"></span>\\n                    </button>\\n                </h5>\\n                <div class=\\\"card-content\\\">\\n                    <div class=\\\"c-facets\\\" ng-class=\\\"{'is-collapsed':$ctrl.collapse}\\\">\\n                        <a class=\\\"c-facet__value\\\" ng-click=\\\"$ctrl.clear()\\\"\\n                            ng-class=\\\"{active:!$ctrl.hasSelections()}\\\">\\n                            <span class=\\\"glyphicon\\\"\\n                                ng-class=\\\"{'glyphicon-check':!$ctrl.hasSelections(), 'glyphicon-unchecked t-fg--gray-lt':$ctrl.hasSelections()}\\\">\\n                            </span>\\n                            Any Theme\\n                        </a>\\n                        <a ng-repeat=\\\"theme in $ctrl.values track by $index\\\"\\n                            class=\\\"c-facet__value\\\" ng-click=\\\"$ctrl.toggle(theme)\\\"\\n                            ng-class=\\\"{active:$ctrl.isSelected(theme)}\\\">\\n                                <span class=\\\"badge pull-right\\\">{{$ctrl.getCount(theme)}}</span>\\n                                <span class=\\\"glyphicon\\\"\\n                                    ng-class=\\\"{'glyphicon-check':$ctrl.isSelected(theme),'glyphicon-unchecked t-fg--gray-lt':!$ctrl.isSelected(theme)}\\\"></span>\\n                                {{theme.label}}\\n                            </a>\\n                        </div>\\n                    </div>\\n                </div>\\n            </div>\\n        \"\n    });\n})(angular, GeoPlatform);\n","(function (angular, Constants) {\n    \"use strict\";\n    //fields list sent to MDR in order to have these properties for display in search results\n    var FIELDS = ['created', 'modified', 'publishers', 'themes', 'description', 'extent'];\n    //facets list sent to MDR in order to get aggregation numbers\n    var FACETS = ['types', 'themes', 'publishers', 'serviceTypes', 'schemes', 'visibility', 'createdBy'];\n    var SORT_OPTIONS = [\n        { value: \"label,asc\", label: \"Name (A-Z)\" },\n        { value: \"label,desc\", label: \"Name (Z-A)\" },\n        { value: \"type,asc\", label: \"Type (A-Z)\" },\n        { value: \"type,desc\", label: \"Type (Z-A)\" },\n        { value: \"modified,desc\", label: \"Most recently modified\" },\n        { value: \"modified,asc\", label: \"Least recently modified\" },\n        { value: \"_score,desc\", label: \"Relevance\" },\n    ];\n    //list of _options variables for mapping to parameters\n    var VAR_TYPES = 'types';\n    var VAR_THEMES = 'themes';\n    var VAR_PUBLISHERS = 'publishers';\n    var VAR_USED_BY = 'usedBy';\n    var VAR_USER = 'user';\n    var VAR_CREATED_BY = 'createdBy';\n    var VAR_SERVICE_TYPES = 'serviceTypes';\n    var VAR_SCHEMES = 'schemes';\n    var VAR_VISIBILITY = \"visibility\";\n    var VAR_QUERY = 'query';\n    var VAR_EXTENT = 'bbox';\n    var VAR_MODIFIED_BEFORE = 'modified.max';\n    var VAR_MODIFIED_AFTER = 'modified.min';\n    //parameter names for various query constraints used in requests to MDR for results\n    var PARAMETER_TYPE = 'type';\n    var PARAMETER_THEME = 'theme.id';\n    var PARAMETER_PUBLISHER = 'publisher.id';\n    var PARAMETER_USED_BY = 'usedBy.id';\n    var PARAMETER_CREATED_BY = 'createdBy';\n    var PARAMETER_CONTRIBUTED_BY = 'contributedBy';\n    var PARAMETER_CREATOR = 'creator.id';\n    var PARAMETER_SVC_TYPE = 'serviceType.id';\n    var PARAMETER_IN_SCHEME = 'scheme.id';\n    var PARAMETER_VISIBILITY = 'visibility';\n    var PARAMETER_QUERY = 'q';\n    var PARAMETER_EXTENT = 'extent';\n    var PARAMETER_MODIFIED_BEFORE = 'modified.max';\n    var PARAMETER_MODIFIED_AFTER = 'modified.min';\n    // const PARAMETER_CONTRIBUTOR     = 'contributor.id';\n    var PARAM_OPTIONS = [\n        { option: VAR_TYPES, parameter: PARAMETER_TYPE },\n        { option: VAR_THEMES, parameter: PARAMETER_THEME },\n        { option: VAR_PUBLISHERS, parameter: PARAMETER_PUBLISHER },\n        { option: VAR_USED_BY, parameter: PARAMETER_USED_BY },\n        { option: VAR_USER, parameter: PARAMETER_CREATOR },\n        { option: VAR_CREATED_BY, parameter: PARAMETER_CREATED_BY },\n        { option: VAR_SERVICE_TYPES, parameter: PARAMETER_SVC_TYPE },\n        { option: VAR_SCHEMES, parameter: PARAMETER_IN_SCHEME },\n        { option: VAR_VISIBILITY, parameter: PARAMETER_VISIBILITY },\n        { option: VAR_QUERY, parameter: PARAMETER_QUERY },\n        { option: VAR_EXTENT, parameter: PARAMETER_EXTENT },\n        { option: VAR_MODIFIED_BEFORE, parameter: PARAMETER_MODIFIED_BEFORE },\n        { option: VAR_MODIFIED_AFTER, parameter: PARAMETER_MODIFIED_AFTER }\n    ];\n    var PAGE_SIZE_BASE_10 = [10, 20, 50, 100];\n    var PAGE_SIZE_BASE_12 = [12, 24, 48, 96];\n    /**\n     *\n     *\n     */\n    function BrowseObjectsService($rootScope, $timeout, $resource, options) {\n        /* -------- private data ----------- */\n        var url = options && options.url ? options.url + \"/:id\" : Constants.ualUrl + '/api/items/:id';\n        var eventKey = 'gp:browse:' + (options && options.key ? options.key : 'objects') + \":\";\n        var svc = $resource(url, { id: '@id' }, {\n            query: {\n                isArray: false\n            }\n        });\n        var _pageSizeBase = PAGE_SIZE_BASE_10.slice(0);\n        if (options && options.pageSizeBase && options.pageSizeBase === 12)\n            _pageSizeBase = PAGE_SIZE_BASE_12.slice(0);\n        var _options = {\n            start: 0,\n            size: _pageSizeBase[0],\n            total: 0,\n            sort: (options && options.sort) ? options.sort : \"modified,desc\",\n            facets: {}\n        };\n        //list of field names to request in response\n        var _fields = options && options.fields ? options.fields : FIELDS.slice(0);\n        //list of facet names to request\n        var _requestFacets = options && options.facets ? options.facets : FACETS.slice(0);\n        var _facets = [];\n        var _selectedFacets = [];\n        var _results = [];\n        var _dirtyPromise = null;\n        var _isLoading = false;\n        var _selected = [];\n        var _onSelectFn = options && options.onSelect ? options.onSelect : null;\n        /**\n         *\n         */\n        function notify(eventName, arg) {\n            // console.log(\"Notifying of \" + eventName + \" with \" + arg);\n            $rootScope.$broadcast(eventName, arg);\n        }\n        /**\n         * when marked as dirty, debounce for rapid fire events like onKeyUp\n         */\n        function dirty(delay, resetStart) {\n            var doReset = typeof (resetStart) === 'undefined' || resetStart === true;\n            if (_dirtyPromise)\n                $timeout.cancel(_dirtyPromise);\n            _dirtyPromise = $timeout(function () {\n                _dirtyPromise = null;\n                _doUpdate(doReset);\n            }, delay || 100);\n        }\n        /**\n         *\n         */\n        function _doUpdate(resetStart) {\n            if (resetStart)\n                _options.start = 0;\n            _isLoading = true;\n            notify(eventKey + 'querying');\n            var params = {};\n            // -------- QUERY FILTERS --------\n            //create a temporary options object\n            var opts = angular.copy(_options);\n            //apply options as parameters\n            angular.forEach(PARAM_OPTIONS, function (po) {\n                var name = po.parameter;\n                var value = opts[po.option];\n                var isSet = value !== null && typeof (value) !== 'undefined';\n                var isArr = isSet && typeof (value.push) !== 'undefined';\n                if (isSet && (!isArr || value.length)) {\n                    params[name] = isArr ? value.join(',') : value;\n                }\n                else {\n                    delete params[name];\n                }\n                delete opts[po.option]; //remove from temp opts\n            });\n            //apply remaining options to query\n            // these are not keyed with specific parameters (ie, custom params)\n            angular.forEach(opts, function (value, name) {\n                if (value !== null && typeof (value) !== 'undefined') {\n                    var isArr = typeof (value.push) !== 'undefined';\n                    params[name] = isArr ? value.join(',') : value;\n                }\n                else {\n                    //make sure it doesn't get sent if no value provided\n                    delete params[name];\n                }\n            });\n            // -------- QUERY FILTERS --------\n            var arr = [];\n            for (var k in _options.facets) {\n                if (_options.facets.hasOwnProperty(k)) {\n                    //encode commas in facet name since it's used to separate multiple\n                    // facet values\n                    arr.push(k + \":\" + _options.facets[k].replace(/,/g, '%2C'));\n                }\n            }\n            _selectedFacets = arr;\n            var start = _options.start;\n            if (isNaN(start))\n                start = 0;\n            else\n                start = start * 1;\n            params.page = Math.floor(start / _options.size);\n            params.size = _options.size;\n            params.sort = _options.sort;\n            if (arr.length)\n                params.facets = arr.join(',');\n            //prevent CORS cache bug in Chrome\n            params.bust = new Date().getTime();\n            //request facets\n            params.includeFacet = _requestFacets.join(',');\n            //request fields\n            params.fields = _fields.join(',');\n            svc.query(params).$promise.\n                then(function (response) {\n                _results = response.results;\n                _facets = response.facets || [];\n                //auto select objects if user has marked it as selected previously\n                // this is needed to maintain selections across pagination pages\n                _selected.each(function (id) {\n                    var map = _results.find(function (map) { return map._id === id; });\n                    if (map)\n                        map.selected = true;\n                });\n                //will trigger update on pagination directive\n                _options.total = response.totalResults;\n                _isLoading = false;\n                notify(eventKey + 'results');\n                notify(eventKey + 'pagination');\n            })\n                .catch(function (response) {\n                _isLoading = false;\n                //fallback\n                var obj = { error: \"An Error Occurred\", message: \"No details provided\" };\n                //http response error\n                if (response && response.data)\n                    obj = response.data;\n                else if (response && response.message)\n                    obj = response;\n                //serialized json\n                if (typeof (obj) === 'string') {\n                    try {\n                        obj = JSON.parse(obj);\n                    }\n                    catch (e) {\n                        obj.message = \"Bad response from server\";\n                    }\n                }\n                var error = {\n                    label: obj.error || \"An Error Occurred\",\n                    message: obj.message || \"No details provided\"\n                };\n                notify(eventKey + 'error', error);\n            });\n        }\n        function setOption(name, value, fire) {\n            _options[name] = value;\n            if (typeof (fire) === 'undefined' || !!fire) {\n                var delay = 500;\n                if (value === null || value === undefined)\n                    delay = 0;\n                if (value && typeof (value.push) !== 'undefined' && value.length)\n                    delay = 0; //arrays\n                else if (value && value.length)\n                    delay = 0; //strings\n                dirty(delay);\n            }\n        }\n        /* ------------ public api ------------- */\n        return {\n            events: {\n                LOADING: eventKey + 'querying',\n                RESULTS: eventKey + 'results',\n                PAGINATION: eventKey + 'pagination',\n                SELECTED: eventKey + 'selected',\n                ERROR: eventKey + 'error',\n                SELECTED_ADDED: eventKey + 'selected:added',\n                SELECTED_REMOVED: eventKey + 'selected:removed',\n                SIMILARITY: eventKey + 'similarTo'\n            },\n            /**\n             * @return {bool}\n             */\n            getLoadingStatus: function () {\n                return _isLoading;\n            },\n            /**\n             * NOTE: Make sure event names are prefixed with\n             *  eventKey + ''\n             * @param {string} eventName\n             * @param {function} listener\n             */\n            on: function (eventName, listener) {\n                // if(eventName.indexOf(eventKey + \":\") !== 0)\n                //     eventName = eventKey + '' + eventName;\n                return $rootScope.$on(eventName, listener);\n            },\n            /**\n             * @param {string} eventName\n             * @param {*} args\n             */\n            trigger: function (eventName, args) { notify(eventName, args); },\n            /**\n             * @return {array[object]}\n             */\n            getResults: function () { return _results; },\n            /**\n             * @return {array[string]} list of facet names\n             */\n            getFacetNames: function () { return FACETS.slice(0); },\n            /**\n             * @return {object} in form of <facet>: [<values>]\n             */\n            getFacets: function () { return _facets; },\n            /**\n             * @param {string} name\n             * @return {object|null}\n             */\n            getFacet: function (name) {\n                if (_facets) {\n                    return _facets.find(function (facet) { return facet.name === name; });\n                }\n                return null;\n            },\n            addFacet: function (name) {\n                _requestFacets.push(name);\n            },\n            applyConstraints: function (obj) {\n                // _options[VAR_QUERY] = obj.query;\n                // _options[VAR_TYPES] = obj.types;\n                // _options[VAR_THEMES] = obj.themes;\n                // _options[VAR_PUBLISHERS] = obj.publishers;\n                // _options[VAR_USER] = obj.user;\n                // _options[VAR_CREATED_BY] = obj.createdBy;\n                // _options[VAR_SERVICE_TYPES] = obj.serviceTypes;\n                // _options[VAR_SCHEMES] = obj.schemes;\n                // _options[VAR_VISIBILITY] = obj.visibility;\n                // //do we need to set extent here too?\n                for (var p in obj) {\n                    if (obj.hasOwnProperty(p)) {\n                        _options[p] = obj[p];\n                    }\n                }\n                _doUpdate(true);\n            },\n            applyOption: function (key, value, fire) { setOption(key, value, fire); },\n            applyOptions: function (opts, fire) {\n                angular.forEach(opts, function (value, key) { setOption(key, value, false); });\n                if (fire)\n                    _doUpdate(true);\n            },\n            /**\n             * @param {string} text - free text query\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setQuery: function (text, fireUpdate) { setOption(VAR_QUERY, text, fireUpdate); },\n            /**\n             * @param {array[string]} types - name of class(es) to request\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setTypes: function (types, fireUpdate) { setOption(VAR_TYPES, types, fireUpdate); },\n            getTypes: function () { return _options[VAR_TYPES]; },\n            /**\n             * @param {string} userId - identifier of user\n             * @param {boolean} fireUpdate -\n             */\n            setUser: function (userId, fireUpdate) { setOption(VAR_USER, userId, fireUpdate); },\n            /**\n             * @param {array[string]} creators - ids of creators\n             * @param {boolean} fireUpdate -\n             */\n            setCreatedBy: function (creators, fireUpdate) { setOption(VAR_CREATED_BY, creators, fireUpdate); },\n            /**\n             * @param {array[string]} themes - name of class(es) to request\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setThemes: function (themes, fireUpdate) { setOption(VAR_THEMES, themes, fireUpdate); },\n            getThemes: function () { return _options[VAR_THEMES]; },\n            /**\n             * @param {array[string]} publishers - name of class(es) to request\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setAgencies: function (publishers, fireUpdate) { setOption(VAR_PUBLISHERS, publishers, fireUpdate); },\n            getAgencies: function () { return _options[VAR_PUBLISHERS]; },\n            /**\n             * @param {array[string]} ids - ids of agents using this item\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setUsedBy: function (ids, fireUpdate) { setOption(VAR_USED_BY, ids, fireUpdate); },\n            getUsedBy: function () { return _options[VAR_USED_BY]; },\n            /**\n             * @param {array[string]} svcTypes - ids\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setServiceTypes: function (svcTypes, fireUpdate) { setOption(VAR_SERVICE_TYPES, svcTypes, fireUpdate); },\n            getServiceTypes: function () { return _options[VAR_SERVICE_TYPES]; },\n            /**\n             * @param {array[string]} schemes - ids\n             * @param {bool} fireUpdate - trigger update (default is true)\n             */\n            setSchemes: function (schemes, fireUpdate) { setOption(VAR_SCHEMES, schemes, fireUpdate); },\n            /**\n             * @param {string} visibility - one of 'public' or 'private'\n             * @param {boolean} fireUpdate\n             */\n            setVisibility: function (visibility, fireUpdate) { setOption(VAR_VISIBILITY, visibility, fireUpdate); },\n            /**\n             * @param {Date} date - date to compare against\n             * @param {boolean} beforeOrAfter - flag specifying which boundary condition (true = before, false = after)\n             * @param {boolean} fireUpdate - flag specifying whether to trigger update automatically\n             */\n            setModified: function (date, beforeOrAfter, fireUpdate) {\n                //if no date was supplied, consider it \"unset\" for both properties\n                if (!date) {\n                    setOption(VAR_MODIFIED_BEFORE, null, false);\n                    setOption(VAR_MODIFIED_AFTER, null, true);\n                    return;\n                }\n                var dir = beforeOrAfter && (beforeOrAfter === true || beforeOrAfter === \"true\");\n                var prop = dir ? VAR_MODIFIED_BEFORE : VAR_MODIFIED_AFTER; //property being set\n                var oppProp = dir ? VAR_MODIFIED_AFTER : VAR_MODIFIED_BEFORE; //unset opposite property\n                var arg = (date && date.getTime) ? date.getTime() : date;\n                setOption(oppProp, null, false);\n                setOption(prop, arg, true);\n            },\n            getModified: function () {\n                return this._options[VAR_MODIFIED_BEFORE] || this._options[VAR_MODIFIED_AFTER];\n            },\n            /**\n             * @param {string} bboxStr - form of \"minx,miny,maxx,maxy\"\n             * @param {boolean} fireUpdate\n             */\n            setExtent: function (bboxStr) { setOption(VAR_EXTENT, bboxStr, true); },\n            /**\n             * @return {string} bbox string or null if not set\n             */\n            getExtent: function () { return _options[VAR_EXTENT]; },\n            /**\n             * @return {array} list of selected items from current search results\n             */\n            getSelected: function () { return _selected; },\n            /**\n             * @param {array} arr - list of items to select in current search results\n             */\n            setSelected: function (arr) {\n                _selected = arr;\n                notify(this.events.SELECTED, _selected);\n            },\n            /**\n             * @param {string} id - identifier of item in current search results to add to selected list\n             */\n            select: function (id) {\n                var finder = function (l) { return l.id === id; };\n                var existing = _selected.find(finder);\n                if (existing) {\n                    var idx = _selected.indexOf(existing);\n                    if (idx >= 0) {\n                        _selected.splice(idx, 1);\n                        notify(eventKey + 'selected:removed', existing);\n                    }\n                }\n                else {\n                    var obj = _results.find(finder);\n                    if (obj) {\n                        if (_onSelectFn) {\n                            _onSelectFn(id, function (err, item) {\n                                if (item) {\n                                    _selected.unshift(item);\n                                    notify(eventKey + 'selected:added', item);\n                                }\n                            });\n                        }\n                        else {\n                            _selected.unshift(obj);\n                            notify(eventKey + 'selected:added', obj);\n                        }\n                    }\n                }\n                notify(this.events.SELECTED, _selected);\n            },\n            /**\n             * @param {string} id - identifier of item to check\n             * @return {boolean} true if selected, false otherwise\n             */\n            isSelected: function (id) {\n                return _selected.find(function (obj) { return obj.id === id; });\n            },\n            /**\n             * select all items in current page of results\n             */\n            selectAll: function () {\n                var _this = this;\n                angular.forEach(_results, function (obj) {\n                    if (!_this.isSelected(obj.id))\n                        _selected.unshift(obj);\n                });\n                notify(this.events.SELECTED, _selected);\n            },\n            /**\n             * empty list of selected items\n             */\n            clearSelected: function () {\n                _selected = [];\n                notify(this.events.SELECTED, []);\n            },\n            /**\n             *\n             */\n            clear: function (refresh) {\n                for (var prop in _options) {\n                    if (!_options.hasOwnProperty(prop))\n                        continue;\n                    if ('start' === prop)\n                        _options[prop] = 0;\n                    else if ('size' === prop) { }\n                    else if ('sort' === prop)\n                        _options[prop] = 'modified,desc';\n                    else if ('facets' === prop)\n                        _options[prop] = {};\n                    else\n                        _options[prop] = null;\n                }\n                if (refresh || typeof (refresh) === 'undefined')\n                    _doUpdate(true);\n            },\n            /*\n             * @param {string} category - name of facet\n             * @param {string} value - value of facet\n             */\n            setFacet: function (category, value) {\n                var f = _options.facets[category];\n                if (!f)\n                    _options.facets[category] = value;\n                else {\n                    if (f === value) {\n                        //unset it\n                        delete _options.facets[category];\n                    }\n                    else {\n                        //set it\n                        _options.facets[category] = value;\n                    }\n                }\n                _doUpdate(true);\n            },\n            /**\n             * @param {array[string]} fields - list of field names to request for each search result\n             */\n            setFields: function (fields) {\n                if (fields && typeof (fields.push) !== 'undefined')\n                    _fields = fields;\n            },\n            /**\n             * @param {int} start - beginning index of results to request\n             * @param {bool} andUpdate - trigger update (default is true)\n             */\n            start: function (start, andUpdate) {\n                _options.start = start;\n                if (andUpdate && andUpdate === true)\n                    _doUpdate(false);\n            },\n            /**\n             * @param {int} size - page size to request\n             * @param {bool} andUpdate - trigger update (default is true)\n             */\n            size: function (size, andUpdate) {\n                _options.size = size;\n                //find out which page in the new scheme the current first-result of current page\n                // will show up in, and set start so that it shows up with the new page size\n                var page = Math.floor(_options.start * 1 / _options.size * 1);\n                _options.start = page * (_options.size * 1);\n                if (andUpdate && andUpdate === true)\n                    _doUpdate(false);\n            },\n            /**\n             * @param {int} size - number of items to return in each page of results\n             */\n            pageSize: function (size) {\n                this.size(size, true);\n            },\n            /**\n             * @param {string} sort - form of <field>,<dir>\n             */\n            sort: function (sort) {\n                _options.sort = sort;\n                _doUpdate(false);\n            },\n            /**\n             * return {object} containing start index, page size, and total results\n             */\n            getPagination: function () {\n                return {\n                    start: _options.start,\n                    size: _options.size,\n                    pageSize: _options.size,\n                    total: _options.total,\n                    sizeOptions: _pageSizeBase\n                };\n            },\n            /**\n             * @return {array} list of key-value pairs of sort options\n             */\n            getSortOptions: function () { return SORT_OPTIONS.slice(0); },\n            /**\n             * @return {string} sorting parameter (field,order)\n             */\n            getSortValue: function () { return _options.sort; },\n            /**\n             * @return {object} clone of the current set of query options\n             */\n            getQueryOptions: function () { return jQuery.extend({}, _options); },\n            /**\n             *\n             */\n            hasQueryOptions: function () {\n                var result = false;\n                for (var k in _options) {\n                    if (_options.hasOwnProperty(k)) {\n                        if ('start' === k || 'size' === k || 'total' === k ||\n                            'sort' === k || 'order' === k || 'within' === k ||\n                            'facets' === k)\n                            continue;\n                        if (_selectedFacets.length)\n                            result = true;\n                        if (typeof (_options[k]) !== 'undefined' && _options[k] !== null) {\n                            result = true;\n                        }\n                    }\n                }\n                return result;\n            },\n            /**\n             * Triggers a refresh of current search results\n             * @param {boolean} resetStart - reset 'start' to 0 flag\n             */\n            update: function (resetStart) {\n                dirty(0, resetStart);\n            },\n            reset: function () {\n                _options = {\n                    start: 0,\n                    size: _pageSizeBase[0],\n                    total: 0,\n                    sort: \"modified,desc\", order: \"asc\",\n                    facets: {}\n                };\n                _facets = [];\n                _selectedFacets = [];\n                _results = [];\n                _isLoading = false;\n                _selected = [];\n                if (_dirtyPromise)\n                    $timeout.cancel(_dirtyPromise);\n                _dirtyPromise = null;\n            },\n            destroy: function () {\n                if (_dirtyPromise)\n                    $timeout.cancel(_dirtyPromise);\n            }\n        };\n    }\n    /**\n     * Factory for creating instances of BrowseObjectsService\n     */\n    function BrowseServiceFactory($rootScope, $timeout, $resource) {\n        return function (options) {\n            var svc = BrowseObjectsService($rootScope, $timeout, $resource, options);\n            if (options && options.params)\n                svc.applyOptions(options.params);\n            return svc;\n        };\n    }\n    angular.module('gp-common')\n        .service(\"BrowseObjectsService\", ['$rootScope', '$timeout', '$resource', BrowseObjectsService])\n        .factory(\"BrowseServiceFactory\", ['$rootScope', '$timeout', '$resource', 'BrowseObjectsService', BrowseServiceFactory]);\n    /*\n        Example of how to use the factory to customize a service\n    \n        //layer-specific browse service\n        .service('BrowseLayerObjService', ['BrowseServiceFactory', function(BrowseServiceFactory) {\n            let service = BrowseServiceFactory({\n                key: 'layers',\n                url: Constants.ualUrl + '/api/layers'\n            });\n    \n            //add custom methods here\n    \n            return service;\n        }])\n    */\n})(angular, GeoPlatform);\n","(function (angular) {\n    'use strict';\n    /* *********************************************\n     * Requires socket.io be in the global namespace\n     * tested with version 2.x\n     * ********************************************* */\n    /*\n       Usage:\n\n       let service = ...\n\n       let svcId = service.getId();\n\n       //listen to events from the server\n       service.on('testing', (event) => {\n           if(event.clientId === svcId) return; //ignore our own events\n           ... do something ...\n       });\n       \n       //sends out a message to others\n       service.emit( service.events.CREATED, 'test');\n\n       //sends out a message to others\n       service.begin(service.events.EDITING, 'test');\n\n       //sends out a message to others\n       service.end(service.events.EDITING, 'test');\n\n       //stop listening and close the socket\n       service.close();\n\n     */\n    /**\n     *\n     */\n    var SocketService = /** @class */ (function () {\n        function SocketService(url, options) {\n            'ngInject';\n            var _this = this;\n            var opts = typeof (options) === 'object' ? options : {};\n            for (var key in opts)\n                this[key] = opts[key];\n            this.socket = null;\n            //list of ids of things being tracked, such as \n            // items edited, in order to send messages\n            // about the things lifecycle\n            this.tracking = {};\n            //events supported.\n            // Note that lifecycles can be added by using the \n            // begin() and end() methods on the service,\n            // which appends '_start' and '_end' respectively\n            this.events = {\n                CREATED: 'created',\n                UPDATED: 'updated',\n                DELETED: 'deleted',\n                EDITING: 'editing',\n                STATUS: 'status'\n            };\n            if (typeof (io) === 'undefined') {\n                console.log(\"Socket.IO not found in global namespace\");\n                return;\n            }\n            if (!url) {\n                console.log(\"No web socket URL configured for this app to communicate with\");\n                return;\n            }\n            //make connection\n            this.socket = io.connect(url);\n            //listen for the init event indicating connection has been made\n            // and to get the socket's id from the server\n            this.socket.on(\"init\", function (evt) {\n                _this.socketId = evt.id;\n            });\n            //if unable to connect\n            this.socket.on('error', function () {\n                console.log(\"Unable to connect to \" + url + \" with websockets\");\n            });\n        }\n        /**\n         *\n         */\n        SocketService.prototype.getId = function () { return this.socketId; };\n        /**\n         * @param {string} eventName\n         * @param {Function} callback\n         * @return {Function} to remove the listener\n         */\n        SocketService.prototype.on = function (eventName, callback) {\n            var _this = this;\n            if (!this.socket)\n                return function () { };\n            //add the listener to the socket\n            this.socket.on(eventName, callback);\n            //return an 'off' function to remove the listener\n            return function () { _this.socket.off(eventName, callback); };\n        };\n        /**\n         *\n         */\n        SocketService.prototype.emit = function (eventName, data, callback) {\n            if (!this.socket)\n                return;\n            this.socket.emit(eventName, data, callback);\n        };\n        /**\n         * Closes this service's socket\n         */\n        SocketService.prototype.close = function () {\n            var _this = this;\n            //if this app was tracking an obj, \n            // notify listeners that it is no longer\n            for (var event in this.tracking) {\n                if (this.tracking.hasOwnProperty(event)) {\n                    var tracks = this.tracking[event];\n                    if (tracks && tracks.length) {\n                        /* jshint ignore:start */\n                        angular.forEach(tracks, function (id) {\n                            _this.end(event, id);\n                        });\n                        /* jshint ignore:end */\n                    }\n                }\n            }\n            if (this.socket) {\n                this.socket.close();\n                this.socket = null;\n            }\n            return null;\n        };\n        /**\n         * @param {string} event - name of the event being started\n         * @param {string} objId - identifier of the item being tracked\n         */\n        SocketService.prototype.begin = function (event, objId) {\n            var _this = this;\n            this.tracking[event] = this.tracking[event] || [];\n            this.tracking[event].push(objId);\n            var room = objId + \"_\" + event.toLowerCase();\n            this.join(room, function () {\n                _this.socket.emit(event, room, _this.socketId, true);\n            });\n        };\n        /**\n         * @param {string} event - name of the event being ended\n         * @param {string} objId - identifier of the item being tracked\n         */\n        SocketService.prototype.end = function (event, objId) {\n            var _this = this;\n            this.tracking[event] = this.tracking[event] || [];\n            if (!this.tracking[event].length)\n                return; //empty, ignore request\n            var idx = this.tracking[event].indexOf(objId);\n            if (idx < 0)\n                //remove tracker\n                this.tracking[event].splice(idx, 1);\n            //send event to server about client stopping it's tracking\n            var room = objId + \"_\" + event.toLowerCase();\n            this.socket.emit(event, room, this.socketId, false, function () {\n                _this.leave(room);\n            });\n        };\n        /**\n         *\n         */\n        SocketService.prototype.join = function (objId, callback) {\n            this.emit('join', objId, callback);\n        };\n        /**\n         *\n         */\n        SocketService.prototype.leave = function (objId, callback) {\n            this.emit('leave', objId, callback);\n        };\n        return SocketService;\n    }());\n    /**\n     * Factory to get a Service used to listen for WebSocket messages from a server\n     *\n     * Usage:\n     *\n     * let wsUrl = ...\n     * let service = SocketServiceFactory(wsUrl);\n     *\n     */\n    angular.module('gp-common').factory('SocketServiceFactory', function ($rootScope, $window, UUID) {\n        var cache = {};\n        //disconnect whenever the app is closed\n        var onClose = function (e) {\n            for (var key in cache) {\n                if (cache.hasOwnProperty(key)) {\n                    cache[key].close();\n                    cache[key] = null;\n                }\n            }\n            cache = null;\n            return null;\n        };\n        //needed for reload/backbtn\n        if ($window.onbeforeunload === 'function') {\n            var existing_1 = $window.onbeforeunload;\n            $window.onbeforeunload = function (e) {\n                onClose(e);\n                return existing_1(e);\n            };\n        }\n        else {\n            $window.onbeforeunload = onClose;\n        }\n        $rootScope.$on('$destroy', onClose);\n        //-------------------\n        return function (url) {\n            // if(!url) return null;\n            // if(cache[url]) return cache[url];\n            var cacheRef = UUID();\n            var service = new SocketService(url, $rootScope, { cacheRef: cacheRef });\n            var closeDelegate = service.close;\n            service.close = function () {\n                var id = service.cacheRef;\n                closeDelegate.call(service); //have service disconnect and clean up itself\n                //then clean up cache reference\n                delete cache[id];\n            };\n            var onDelegate = service.on;\n            service.on = function (event, callback) {\n                if (typeof (callback) === 'function') {\n                    //have to use old-school refs instead of arrow functions\n                    // or else the arguments get scrambled\n                    var handle = function () {\n                        var args = arguments;\n                        $rootScope.$apply(function () {\n                            callback.apply(service.socket, args);\n                        });\n                    };\n                    return onDelegate.call(service, event, handle);\n                }\n                else {\n                    return onDelegate.call(service, event);\n                }\n            };\n            var emitDelegate = service.emit;\n            service.emit = function (event, data, callback) {\n                if (typeof (callback) === 'function') {\n                    //have to use old-school refs instead of arrow functions\n                    // or else the arguments get scrambled\n                    var handle = function () {\n                        var args = arguments;\n                        $rootScope.$apply(function () {\n                            callback.apply(service.socket, args);\n                        });\n                    };\n                    emitDelegate.call(service, event, data, handle);\n                }\n                else {\n                    emitDelegate.call(service, event, data);\n                }\n            };\n            // cache[url] = service;\n            cache[cacheRef] = service;\n            return service;\n        };\n    });\n})(angular);\n","(function (angular) {\n    'use strict';\n    angular.module(\"gp-common\").factory('UUID', function () {\n        function s4() {\n            return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);\n        }\n        /*\n        return function() {\n                return s4() + s4() + '-' + s4() + '-' + s4() + '-' +\n                    s4() + '-' + s4() + s4() + s4();\n            }\n         */\n        return function () {\n            // http://www.ietf.org/rfc/rfc4122.txt\n            var s = [];\n            var hexDigits = \"0123456789abcdef\";\n            for (var i = 0; i < 36; i++) {\n                s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);\n            }\n            s[14] = \"4\"; // bits 12-15 of the time_hi_and_version field to 0010\n            s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1); // bits 6-7 of the clock_seq_hi_and_reserved to 01\n            s[8] = s[13] = s[18] = s[23] = \"-\";\n            return s.join(\"\");\n        };\n    });\n})(angular);\n","(function () {\n    \"use strict\";\n    if (typeof (Array.prototype.find) === 'undefined') {\n        Array.prototype.find = function (callback) {\n            for (var i = 0; i < this.length; ++i) {\n                if (callback(this[i], i, this))\n                    return this[i];\n            }\n            return null;\n        };\n    }\n    if (typeof (Array.prototype.filter) === 'undefined') {\n        Array.prototype.filter = function (callback) {\n            var results = [];\n            for (var i = 0; i < this.length; ++i) {\n                if (callback(this[i], i, this))\n                    results.push(this[i]);\n            }\n            return results;\n        };\n    }\n    if (typeof (Array.prototype.each) === 'undefined') {\n        Array.prototype.each = function (callback) {\n            for (var i = 0; i < this.length; ++i) {\n                callback(this[i], i, this);\n            }\n        };\n    }\n    if (typeof (Array.prototype.indexOfObj) === 'undefined') {\n        Array.prototype.indexOfObj = function (obj, comparatorFn) {\n            var arr = this, len = arr.length;\n            if (typeof (comparatorFn) !== 'function')\n                comparatorFn = function (a, b) { return a === b; };\n            for (var i = 0; i < len; ++i) {\n                if (comparatorFn(obj, arr[i]))\n                    return i;\n            }\n            return -1;\n        };\n    }\n    if (typeof (String.prototype.startsWith) === 'undefined') {\n        String.prototype.startsWith = function (value) {\n            var str = this;\n            if (!str.length)\n                return false;\n            if (!value.length)\n                return false;\n            if (str.length < value.length)\n                return false;\n            return str.indexOf(value) === 0;\n        };\n    }\n    if (typeof (String.prototype.endsWith) === 'undefined') {\n        String.prototype.endsWith = function (value) {\n            var str = this;\n            if (!str.length)\n                return false;\n            if (!value.length)\n                return false;\n            if (str.length < value.length)\n                return false;\n            var substr = str.substring(str.length - value.length, str.length);\n            return substr == value;\n        };\n    }\n    if (typeof (Date.prototype.plus) === 'undefined') {\n        Date.prototype.plus = function (offset) {\n            var type = typeof (offset);\n            if (type === 'undefined')\n                return this;\n            var offsetMS = 0;\n            if (type === 'string') {\n                switch (offset) {\n                    case 'hour':\n                        offsetMS = 1000 * 60 * 60;\n                        break;\n                    case 'day':\n                        offsetMS = 1000 * 60 * 60 * 24;\n                        break;\n                    case 'week':\n                        offsetMS = 1000 * 60 * 60 * 24 * 7;\n                        break;\n                    case 'month':\n                        offsetMS = 1000 * 60 * 60 * 24 * 31;\n                        break;\n                    case 'year':\n                        offsetMS = 1000 * 60 * 60 * 24 * 365;\n                        break;\n                }\n            }\n            else if (type === 'number') {\n                offsetMS = offset;\n            }\n            else\n                return this;\n            var d = this;\n            return new Date(d.getTime() + offsetMS);\n        };\n    }\n    if (typeof (Date.prototype.random) === 'undefined') {\n        Date.prototype.random = function (threshold) {\n            var type = typeof (threshold);\n            if (type === 'undefined')\n                return this;\n            var offsetMS = 0;\n            if (type === 'string') {\n                switch (threshold) {\n                    case 'hour':\n                        offsetMS = 1000 * 60 * 60;\n                        break;\n                    case 'day':\n                        offsetMS = 1000 * 60 * 60 * 24;\n                        break;\n                    case 'week':\n                        offsetMS = 1000 * 60 * 60 * 24 * 7;\n                        break;\n                    case 'month':\n                        offsetMS = 1000 * 60 * 60 * 24 * 31;\n                        break;\n                    case 'year':\n                        offsetMS = 1000 * 60 * 60 * 24 * 365;\n                        break;\n                }\n            }\n            else if (type === 'number') {\n                offsetMS = threshold;\n            }\n            else\n                return this;\n            var d = this;\n            return new Date(d.getTime() + Math.floor(Math.random() * offsetMS));\n        };\n    }\n})();\n","/// <reference path=\"../types.ts\" />\n(function (angular) {\n    'use strict';\n    //flag on whether we're in dev env\n    // function isDEV() {\n    //     return \"localhost\" === window.location.hostname ||\n    //         ~window.location.hostname.indexOf(\"192.168\")||\n    //         ~window.location.hostname.indexOf(\"localhost\")||\n    //         ~window.location.hostname.indexOf(\"10.0\");\n    // }\n    /**\n     * Get token from query string\n     *\n     * Note:\n     *  Lifted outside of any Angular service to prevent cyclical service dependencies.\n     *\n     * @method getJWTFromUrl\n     * @returns {String} token - token in query string or undefined\n     */\n    function getJWTFromUrl() {\n        var queryString = window.location.hash ? window.location.hash : window.location.href;\n        var res = queryString.match(/access_token=([^\\&]*)/);\n        return res && res[1];\n    }\n    ;\n    /**\n     * GeoPlatform Common Module Authentication Support\n     *\n     * Contains re-usable services, directives, and other angular components\n     *\n     *\n     * NOTE: This module uses certain variables in $rootScope in order to\n     * perform actions like authentication.  The following variables should be\n     * set before using any service/directive in this file:\n     *\n     *   - idspUrl : the url to the identity service provider server\n     *   - idmUrl : the url to the identity management server\n     *   - portalUrl : the url to the main landing page of GeoPlatform (www.geoplatform.gov in production)\n     */\n    angular.module('gp-common')\n        .service('AuthenticationService', ['$q', '$http', '$location', '$rootScope', '$window', 'GPConfig',\n        function ($q, $http, $location, $rootScope, $window, Config) {\n            //extend Storage prototype\n            Storage.prototype.setObject = function (key, value) {\n                this.setItem(key, btoa(JSON.stringify(value)));\n            };\n            Storage.prototype.getObject = function (key) {\n                var value = atob(this.getItem(key));\n                return value && JSON.parse(value);\n            };\n            var User = /** @class */ (function () {\n                function User(opts) {\n                    this.id = opts.sub;\n                    this.username = opts.username;\n                    this.name = opts.name;\n                    this.email = opts.email;\n                    this.org = opts.orgs[0] && opts.orgs[0].name;\n                    this.groups = opts.groups;\n                    this.exp = opts.exp;\n                }\n                User.prototype.toJSON = function () {\n                    return JSON.parse(JSON.stringify(this));\n                };\n                ;\n                User.prototype.clone = function () {\n                    return Object.assign({}, this);\n                };\n                ;\n                User.prototype.compare = function (arg) {\n                    if (arg instanceof User) {\n                        return this.id === arg.id;\n                    }\n                    else if (typeof (arg) === 'object') {\n                        return typeof (arg.id) !== 'undefined' &&\n                            arg.id === this.id;\n                    }\n                    return false;\n                };\n                ;\n                User.prototype.isAuthorized = function (role) {\n                    var env = Config.env || Config.ENV || Config.NODE_ENV;\n                    if (env === 'dev' || env === 'development')\n                        return true;\n                    return this.groups &&\n                        !!this.groups\n                            .map(function (g) { return g.name; })\n                            .filter(function (n) { return n === role; })\n                            .length;\n                };\n                ;\n                return User;\n            }());\n            /**\n             * Authentication Service\n             */\n            var AuthService = /** @class */ (function () {\n                function AuthService() {\n                    this.init();\n                }\n                /**\n                 * Redirects or displays login window the page to the login site\n                 */\n                AuthService.prototype.login = function () {\n                    // Check implicit we need to actually redirect them\n                    if (Config.AUTH_TYPE === 'token') {\n                        window.location.href = Config.IDP_BASE_URL +\n                            '/auth/authorize?client_id=' + Config.APP_ID +\n                            '&response_type=' + Config.AUTH_TYPE +\n                            '&redirect_uri=' + encodeURIComponent(Config.CALLBACK || '/login');\n                        // Otherwise pop up the login modal\n                    }\n                    else {\n                        // Iframe login\n                        if (Config.ALLOWIFRAMELOGIN === true || Config.ALLOWIFRAMELOGIN === 'true') {\n                            $rootScope.$broadcast('auth:requireLogin');\n                            // Redirect login\n                        }\n                        else {\n                            window.location.href = Config.LOGIN_URL || \"/login\" +\n                                (\"?redirect_url=\" + encodeURIComponent(window.location.href));\n                        }\n                    }\n                };\n                ;\n                /**\n                 * Performs background logout and requests jwt revokation\n                 */\n                AuthService.prototype.logout = function () {\n                    var self = this;\n                    $http.get(Config.IDP_BASE_URL + '/auth/revoke')\n                        .then(function (response) {\n                        window.location.href = Config.LOGOUT_URL ?\n                            Config.LOGOUT_URL :\n                            window.location.host;\n                    })\n                        .catch(function (err) { return console.log(err); })\n                        .finally(function () { return self.removeAuth(); });\n                };\n                ;\n                /**\n                 * Optional force redirect for non-public services\n                 */\n                AuthService.prototype.forceLogin = function () {\n                    this.login();\n                };\n                ;\n                /**\n                 * Get protected user profile\n                 */\n                AuthService.prototype.getOauthProfile = function () {\n                    var Q = $q.defer();\n                    //check to make sure we can make called\n                    if (this.getJWT()) {\n                        $http.get(Config.IDP_BASE_URL + '/api/profile')\n                            .then(function (response) { return Q.resolve(response); })\n                            .catch(function (err) { return Q.reject(err); });\n                    }\n                    else {\n                        Q.reject(null);\n                    }\n                    return Q.promise;\n                };\n                ;\n                /**\n                 * Unpacks JWT to see if session is valid.\n                 *\n                 * Side Effects:\n                 *  - Will redirect user to login url if FORCE_LOGIN is set an no valid user is found\n                 *\n                 * @return {User} - the authenticated user or undefined\n                 */\n                AuthService.prototype.init = function () {\n                    var jwt = this.getJWT();\n                    if (jwt) {\n                        this.setAuth(jwt); // Save JWT in Auhorization Header\n                        // No valid userdata found\n                    }\n                    else {\n                        // Redirect if settings set\n                        if (Config.FORCE_LOGIN === true)\n                            this.forceLogin();\n                    }\n                    //clean hosturl on redirect from oauth\n                    if (getJWTFromUrl()) {\n                        if (window.history && window.history.replaceState) {\n                            window.history.replaceState({}, 'Remove token from URL', $window.location.href.replace(/[\\?\\&\\%3F]access_token=[^\\&]*\\&token_type=Bearer/, ''));\n                        }\n                        else {\n                            $window.location.search.replace(/[\\?\\&]access_token=[^\\&]*\\&token_type=Bearer/, '');\n                        }\n                    }\n                    // return the user\n                    return this.getUserFromJWT(jwt);\n                };\n                ;\n                /**\n                 * Get User object from the JWT.\n                 *\n                 * If no JWT is provided it will be looked for at the normal JWT\n                 * locations (localStorage or URL queryString).\n                 *\n                 * @param {JWT} [jwt] - the JWT to extract user from.\n                 */\n                AuthService.prototype.getUserFromJWT = function (jwt) {\n                    var user = this.parseJwt(jwt);\n                    return user ?\n                        new User(Object.assign({}, user, { id: user.sub })) :\n                        null;\n                };\n                /**\n                 * If the callback parameter is specified, this method\n                 * will return undefined. Otherwise, it returns the user (or null).\n                 *\n                 * Side Effects:\n                 *  - Will redirect users if no valid JWT was found\n                 *\n                 * @param callback optional function to invoke with the user\n                 * @return object representing current user\n                 */\n                AuthService.prototype.getUser = function (callback) {\n                    var jwt = this.getJWT();\n                    // If callback provided we can treat async and call server\n                    if (callback && typeof (callback) === 'function') {\n                        this.check()\n                            .then(function (user) { return callback(user); });\n                        // If no callback we have to provide a sync response (no network)\n                    }\n                    else {\n                        // We allow front end to get user data if grant type and expired\n                        // because they will recieve a new token automatically when\n                        // making a call to the client(application)\n                        return this.isImplicitJWT(jwt) && this.isExpired(jwt) ?\n                            null :\n                            this.getUserFromJWT(jwt);\n                    }\n                };\n                //$q version of getUser\n                AuthService.prototype.getUserQ = function () {\n                    return this.check();\n                };\n                ;\n                /**\n                 * Check function being used by some front end apps already.\n                 * (wrapper for getUser)\n                 *\n                 * @method check\n                 * @returns {User} - ng-common user object or null\n                 */\n                AuthService.prototype.check = function () {\n                    var _this = this;\n                    var jwt = this.getJWT();\n                    if (!jwt)\n                        return $q.when(null);\n                    if (!this.isImplicitJWT(jwt)) {\n                        return this.isExpired(jwt) ?\n                            this.checkWithClient(jwt)\n                                .then(function (jwt) { return _this.getUserFromJWT(jwt); }) : // Check with server\n                            $q.when(this.getUserFromJWT(jwt));\n                    }\n                    else {\n                        return this.isExpired(jwt) ?\n                            $q.reject(null) :\n                            $q.when(this.getUserFromJWT(jwt));\n                    }\n                };\n                /**\n                 * Makes a call to a service hosting node-gpoauth to allow for a\n                 * token refresh on an expired token, or a token that has been\n                 * invalidated to be revoked.\n                 *\n                 * Note: Client as in hosting application:\n                 *    https://www.digitalocean.com/community/tutorials/an-introduction-to-oauth-2\n                 *\n                 * @method checkWithClient\n                 * @param {jwt} - encoded accessToken/JWT\n                 *\n                 * @return {Promise<jwt>} - promise resolving with a JWT\n                 */\n                AuthService.prototype.checkWithClient = function (originalJWT) {\n                    var _this = this;\n                    return $http.get('/checktoken')\n                        .then(function (resp) {\n                        var header = resp.headers('Authorization');\n                        var newJWT = header && header.replace('Bearer ', '');\n                        if (newJWT)\n                            _this.setAuth(newJWT);\n                        return newJWT ? newJWT : originalJWT;\n                    });\n                };\n                //=====================================================\n                /**\n                 * Extract token from current URL\n                 *\n                 * @method getJWTFromUrl\n                 *\n                 * @return {String | undefined} - JWT Token (raw string)\n                 */\n                AuthService.prototype.getJWTFromUrl = function () {\n                    var queryString = ($window && $window.location && $window.location.hash) ? $window.location.hash : $location.url();\n                    var res = queryString.match(/access_token=([^\\&]*)/);\n                    return res && res[1];\n                };\n                ;\n                /**\n                 * Load the JWT stored in local storage.\n                 *\n                 * @method getJWTfromLocalStorage\n                 *\n                 * @return {JWT | undefined} An object wih the following format:\n                 */\n                AuthService.prototype.getJWTfromLocalStorage = function () {\n                    return window.localStorage.gpoauthJWT;\n                };\n                ;\n                /**\n                 * Attempt and pull JWT from the following locations (in order):\n                 *  - URL query parameter 'access_token' (returned from IDP)\n                 *  - Browser local storage (saved from previous request)\n                 *\n                 * NOTE:\n                 *  This call will redirect user to login if the Config.FORCE_LOGIN\n                 *  option is set to true.\n                 *\n                 * @method getJWT\n                 *\n                 * @return {JWT | undefined}\n                 */\n                AuthService.prototype.getJWT = function () {\n                    var jwt = this.getJWTFromUrl() || this.getJWTfromLocalStorage();\n                    // Only deny implicit tokens that have expired\n                    if (!jwt || (jwt && this.isExpired(jwt) && this.isImplicitJWT(jwt))) {\n                        this.removeAuth();\n                        if (Config.FORCE_LOGIN === true)\n                            this.forceLogin();\n                        return null;\n                    }\n                    else {\n                        return jwt;\n                    }\n                };\n                ;\n                /**\n                 * Remove the JWT saved in local storge.\n                 *\n                 * @method clearLocalStorageJWT\n                 *\n                 * @return  {undefined}\n                 */\n                AuthService.prototype.clearLocalStorageJWT = function () {\n                    delete window.localStorage.gpoauthJWT;\n                };\n                ;\n                /**\n                 * Is a token expired.\n                 *\n                 * @method isExpired\n                 * @param {JWT} jwt - A JWT\n                 *\n                 * @return {boolean}\n                 */\n                AuthService.prototype.isExpired = function (jwt) {\n                    var parsedJWT = this.parseJwt(jwt);\n                    if (parsedJWT) {\n                        var now = (new Date()).getTime() / 1000;\n                        return now > parsedJWT.exp;\n                    }\n                    return true;\n                };\n                ;\n                /**\n                 * Is the JWT an implicit JWT?\n                 * @param jwt\n                 */\n                AuthService.prototype.isImplicitJWT = function (jwt) {\n                    var parsedJWT = this.parseJwt(jwt);\n                    return parsedJWT && parsedJWT.implicit;\n                };\n                /**\n                 * Unsafe (signature not checked) unpacking of JWT.\n                 *\n                 * @param {string} token - Access Token (JWT)\n                 *\n                 * @return {Object} the parsed payload in the JWT\n                 */\n                AuthService.prototype.parseJwt = function (token) {\n                    var parsed;\n                    if (token) {\n                        try {\n                            var base64Url = token.split('.')[1];\n                            var base64 = base64Url.replace('-', '+').replace('_', '/');\n                            parsed = JSON.parse(atob(base64));\n                        }\n                        catch (e) { }\n                    }\n                    return parsed;\n                };\n                ;\n                /**\n                 * Simple front end validion to verify JWT is complete and not\n                 * expired.\n                 *\n                 * Note:\n                 *  Signature validation is the only truly save method. This is done\n                 *  automatically in the node-gpoauth module.\n                 */\n                AuthService.prototype.validateJwt = function (token) {\n                    var parsed = this.parseJwt(token);\n                    var valid = (parsed && parsed.exp && parsed.exp * 1000 > Date.now()) ? true : false;\n                    return valid;\n                };\n                ;\n                /**\n                 * Save JWT to localStorage and in the request headers for accessing\n                 * protected resources.\n                 *\n                 * @param {JWT} jwt\n                 */\n                AuthService.prototype.setAuth = function (jwt) {\n                    window.localStorage.gpoauthJWT = jwt;\n                    $http.defaults.headers.common.Authorization = 'Bearer ' + jwt;\n                    // $http.defaults.useXDomain = true;\n                };\n                ;\n                /**\n                 * Purge the JWT from localStorage and authorization headers.\n                 */\n                AuthService.prototype.removeAuth = function () {\n                    delete window.localStorage.gpoauthJWT;\n                    delete $http.defaults.headers.common.Authorization;\n                    $rootScope.$broadcast(\"userSignOut\");\n                    // $http.defaults.useXDomain = false;\n                };\n                ;\n                return AuthService;\n            }());\n            return new AuthService();\n        }\n    ])\n        .factory('ng-common-AuthenticationInterceptor', function ($injector, $window) {\n        // Interceptor\n        return {\n            response: function (resp) {\n                var jwt = getJWTFromUrl();\n                var authHeader = resp.headers('Authorization');\n                if (jwt) {\n                    var AuthenticationService = $injector.get('AuthenticationService');\n                    AuthenticationService.setAuth(jwt);\n                }\n                else if (authHeader) {\n                    var AuthenticationService = $injector.get('AuthenticationService');\n                    var token = authHeader.replace('Bearer', '').trim();\n                    AuthenticationService.setAuth(token);\n                }\n                return resp;\n            }\n        };\n    })\n        .config(function myAppConfig($httpProvider) {\n        $httpProvider.interceptors.push('ng-common-AuthenticationInterceptor');\n    })\n        .directive('gpLoginModal', ['$rootScope', 'AuthenticationService', 'GPConfig',\n        function ($rootScope, AuthenticationService, Config) {\n            return {\n                scope: {\n                    minimal: '@'\n                },\n                replace: true,\n                template: [\n                    '<div class=\"gpLoginCover\" ng-if=\"requireLogin\">' +\n                        '   <div class=\"gpLoginWindow\">' +\n                        '     <iframe src=\"/login\"></iframe>' +\n                        '   </div>' +\n                        '</div>'\n                ].join(' '),\n                controller: function ($scope, $element) {\n                    $scope.requireLogin = false;\n                    function startAuthIntervalCheck(delay) {\n                        // Setup check for localstorage set and close iframe when set\n                        var timeout = setInterval(function () {\n                            AuthenticationService.check()\n                                .then(function (user) {\n                                if (user) {\n                                    // close iframe\n                                    $scope.requireLogin = false;\n                                    $rootScope.$broadcast(\"userAuthenticated\", user);\n                                    clearTimeout(timeout); // All Done here\n                                    AuthenticationService.init();\n                                }\n                            });\n                        }, delay);\n                    }\n                    // Catch the request to display login modal\n                    $scope.$on('auth:requireLogin', function () {\n                        $scope.requireLogin = true;\n                        startAuthIntervalCheck(500);\n                    });\n                }\n            };\n        }\n    ])\n        .directive('gpLoginButton', ['$rootScope', '$timeout', 'AuthenticationService', 'GPConfig',\n        function ($rootScope, $timeout, AuthenticationService, Config) {\n            return {\n                scope: {\n                    minimal: '@'\n                },\n                replace: true,\n                template: [\n                    '<div class=\"btn-account btn-group\">' +\n                        //not logged in\n                        '  <a class=\"btn btn-link\" ng-click=\"login()\" ng-if=\"!user\">Sign In</a>' +\n                        //logged in\n                        '  <button type=\"button\" class=\"btn btn-link dropdown-toggle\" data-toggle=\"dropdown\" ' +\n                        '   aria-expanded=\"false\" ng-if=\"user\">' +\n                        '     <span class=\"glyphicon glyphicon-user\"></span> ' +\n                        '     <span class=\"hidden-xs\">{{::user.name}}</span> ' +\n                        '     <span class=\"caret\"></span>' +\n                        '  </button>' +\n                        '  <ul class=\"dropdown-menu dropdown-menu-right\" role=\"menu\" ng-if=\"user\">' +\n                        '    <li class=\"account-details\">' +\n                        '      <div class=\"media\">' +\n                        '        <div class=\"media-left\">' +\n                        '          <div class=\"media-object\">' +\n                        '            <span class=\"glyphicon glyphicon-user glyphicon-xlg\"></span>' +\n                        '          </div>' +\n                        '        </div>' +\n                        '        <div class=\"media-body\">' +\n                        '          <div class=\"media-heading\">{{::user.name}}</div>' +\n                        '          <div><em>{{::user.username}}</em></div>' +\n                        '          <div>{{::user.email}}</div>' +\n                        '          <div>{{::user.org}}</div>' +\n                        '        </div>' +\n                        '      </div>' +\n                        '    </li>' +\n                        '    <li class=\"divider\"></li>' +\n                        '    <li><a href=\"{{::idpUrl}}/modifyuser.html\">Edit Info</a></li>' +\n                        '    <li><a href=\"{{::idpUrl}}/changepassword.html\">Change Password</a></li>' +\n                        '    <li><a href ng-click=\"logout()\">Sign Out</a></li>' +\n                        '  </ul>' +\n                        '</div>'\n                ].join(' '),\n                controller: function ($scope, $element) {\n                    if ($scope.minimal === 'true')\n                        $scope.minimal = true;\n                    if ($scope.minimal !== true)\n                        $scope.minimal = false;\n                    $scope.idpUrl = Config.idmUrl;\n                    // console.log(\"IDM Base Url: \" + Config.idmUrl);\n                    AuthenticationService.getUser(function (user) {\n                        $timeout(function () {\n                            $scope.user = user;\n                        }, 100);\n                    });\n                    $scope.login = function () {\n                        $scope.user = AuthenticationService.login();\n                    };\n                    $scope.logout = function () {\n                        $scope.user = AuthenticationService.logout();\n                    };\n                    $rootScope.$on('userAuthenticated', function (event, user) {\n                        $scope.user = user;\n                    });\n                }\n            };\n        }\n    ])\n        .directive('gpAccountDetails', ['$timeout', 'AuthenticationService', 'GPConfig',\n        function ($timeout, AuthenticationService, Config) {\n            return {\n                scope: {},\n                replace: true,\n                template: [\n                    '<div>' +\n                        '  <div class=\"media\">',\n                    '    <div class=\"media-left\">',\n                    '        <div class=\"media-object\">',\n                    '            <span class=\"glyphicon glyphicon-user glyphicon-xlg\"></span>',\n                    '        </div>',\n                    '    </div>',\n                    '    <div class=\"media-body\" ng-if=\"user\">',\n                    '       <div class=\"media-heading\">{{::user.name}}</div>' +\n                        '       <div><small><em>{{::user.username}}</em></small></div>' +\n                        '       <div><small>{{::user.email}}</small></div>' +\n                        '       <div><small>{{::user.org}}</small></div>' +\n                        '    </div>',\n                    '    <div class=\"media-body\" ng-if=\"!user\">',\n                    '       <div class=\"media-heading\">Please Sign In</div>' +\n                        '       <div><small>Sign in to your GeoPlatform account or register a new account.</small></div>' +\n                        '    </div>',\n                    '  </div>',\n                    '  <hr/>',\n                    '  <div ng-if=\"user\">',\n                    '    <button type=\"button\" class=\"btn btn-sm btn-accent pull-right\" ng-click=\"logout()\">Sign Out</button>' +\n                        '    <a class=\"btn btn-sm btn-default\" href=\"{{::idpUrl}}/modifyuser.html\">Edit Details</a>' +\n                        '  </div>',\n                    '  <div ng-if=\"!user\">',\n                    '    <button type=\"button\" class=\"btn btn-sm btn-accent pull-right\" ng-click=\"login()\">Sign In</button>' +\n                        '    <a class=\"btn btn-sm btn-default\" href=\"{{::idpUrl}}/registeruser.html\">Register</a>' +\n                        '  </div>',\n                    '</div>'\n                ].join(' '),\n                controller: function ($scope, $element) {\n                    $scope.idpUrl = Config.idmUrl;\n                    AuthenticationService.getUser(function (user /* TODO: lift User */) {\n                        $timeout(function () {\n                            $scope.user = user;\n                        }, 100);\n                    });\n                    $scope.login = function () {\n                        $scope.user = AuthenticationService.login();\n                    };\n                    $scope.logout = function () {\n                        $scope.user = AuthenticationService.logout();\n                    };\n                }\n            };\n        }\n    ]);\n})(angular);\n"]}