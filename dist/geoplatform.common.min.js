"use strict";var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){t.module("gp-common",[]).constant("GPConfig",function(){function e(e){throw"ng.common: Required field in GeoPlatform is missing: "+e+"\nPlease see https://github.com/GeoPlatform/ng-common/tree/develop for configuration details"}function t(e){return JSON.parse(e)}GeoPlatform.env||GeoPlatform.ENV||GeoPlatform.NODE_ENV||e('"env", "ENV", or "NODE_ENV"'),GeoPlatform.IDP_BASE_URL||e('"IDP_BASE_URL"'),GeoPlatform.AUTH_TYPE&&-1===["token","grant"].indexOf(GeoPlatform.AUTH_TYPE)&&function(e,t){throw"ng.common: A field you provided has an invalid value: "+e+"\nExpected value was: "+t+"Please see https://github.com/GeoPlatform/ng-common/tree/develop for configuration details"}(GeoPlatform.AUTH_TYPE,"token | grant"),"token"===GeoPlatform.AUTH_TYPE&&(GeoPlatform.APP_ID||e("APP_ID"));var n=!!window.MSInputMethodContext&&!!document.documentMode;return GeoPlatform.ALLOWIFRAMELOGIN=!n&&t(GeoPlatform.ALLOWIFRAMELOGIN||!1),GeoPlatform.FORCE_LOGIN=t(GeoPlatform.FORCE_LOGIN||!1),GeoPlatform}())}(jQuery,angular),function(e,t,n){t.module("gp-common-kg",[]).constant("KGFields",["purposes","functions","primaryTopics","secondaryTopics","primarySubjects","secondarySubjects","communities","audiences","places","categories"]).service("KGHelper",["KGFields","RecommenderServiceFactory",function(e,n){return{calculate:function(n){if(!n)return 0;var i=0;return t.forEach(e,function(e){n[e]&&n[e].length&&(i+=7+Math.floor((n[e].length-1)/2))}),i},getService:function(e){return n(e)}}}]).service("RecommenderService",["$resource",function(e){var t=n.ualUrl+"/api/recommender";return e(t,{},{query:{url:t+"/suggest",isArray:!1},queryTypes:{url:t+"/types",isArray:!1},querySources:{url:t+"/sources",isArray:!1}})}]).factory("RecommenderServiceFactory",["$resource",function(e){return function(t){var i=n.ualUrl+"/api/recommender";return e(i,{for:t},{query:{url:i+"/suggest",isArray:!1},queryTypes:{url:i+"/types",isArray:!1},querySources:{url:i+"/sources",isArray:!1}})}}]).component("kgCompletionDisplay",{bindings:{ngModel:"<"},controller:["$rootScope","KGHelper",function(e,t){this.$onInit=function(){var n=this;this.update(),this.listener=e.$on("gp:kg:updated",function(e,i){i&&i.id===n.id&&(n.ngModel.classifiers||(n.ngModel.classifiers=i.classifiers),n.value=t.calculate(n.ngModel.classifiers))})},this.$onChanges=function(){this.update()},this.$onDestroy=function(){this.listener(),this.listener=null},this.update=function(){var e=this;if(this.ngModel.$promise&&!this.ngModel.$resolved)return void this.ngModel.$promise.then(function(t){e.update()});this.id=this.ngModel?this.ngModel.id:null,this.value=t.calculate(this.ngModel.classifiers)}}],template:'\n            <span>{{$ctrl.value||0}}%</span>\n            <span class="glyphicon glyphicon-dashboard"></span>\n        '})}(jQuery,angular,GeoPlatform),function(e,t){"function"==typeof define&&define.amd?define([],function(){if(!GeoPlatform)throw new Error("AuthenticatedComponent - 'GeoPlatform' global not defined!");return GeoPlatform.AuthenticatedComponent=e.AuthenticatedComponent=t()}):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=e.AuthenticatedComponent=t():GeoPlatform.AuthenticatedComponent=t()}(window,function(){return function(){function e(e,t){var n=this;this.authState={user:null,authorized:!1},this.authService=t,this.authListener=e.$on("userAuthenticated",function(e,t){n.onAuthEvent(e,t)})}return e.prototype.$onInit=function(){var e=this;this.authService.getUser(function(t){e.onAuthEvent(null,t)})},e.prototype.$onDestroy=function(){this.authListener(),this.authListener=null,this.authService=null,this.authState=null},e.prototype.onAuthEvent=function(e,t){this.authState.user=t,this.authState.authorized=t&&t.isAuthorized("gp_editor")},e.prototype.isAuthenticated=function(){return!!this.authState.user},e.prototype.canUserEdit=function(e){return!!this.authState.user&&(e?this.isAuthorOf(e)||this.authState.authorized:this.authState.authorized)},e.prototype.isAuthorOf=function(e){return!!this.authState.user&&(!!e&&(e.createdBy&&e.createdBy===this.authState.user.username))},e}()}),function(e,t){t.module("gp-common").filter("fixLabel",function(){return function(e){if(!e||"string"!=typeof e||!e.length)return"Untitled";var t=e.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/_/g," ").trim();return t.charAt(0).toUpperCase()+t.slice(1)}}).filter("pluralize",function(){return function(e){return e&&e.length?e.endsWith("ss")?e+"es":e.endsWith("s")?e:e+"s":""}}).filter("capitalize",function(){return function(e){return e[0].toUpperCase()+e.substring(1)}}).filter("facets",function(){return function(e,t){return t?e&&e.length?e.filter(function(e){return e.toLowerCase().startsWith(t+":")}).map(function(e){return e.substring(e.indexOf(":")+1,e.length)}):[]:e}}).filter("joinBy",function(){return function(e,t,n){return e&&void 0!==e.push&&e.length?e.join(t||", "):n||""}}).filter("defaultValue",function(){return function(e,t){return void 0!==e&&e.length?e:t}}).filter("count",function(){return function(e){if(void 0!==e){if("function"==typeof e.push)return e.length;if("object"===(void 0===e?"undefined":_typeof(e))&&void 0!==Object.keys)return Object.keys(e)}return 0}}).filter("gpObjTypeMapper",function(){return function(e){if(!e||"string"!=typeof e||0===e.length)return e;var t=e,n=e.indexOf(":");return~n&&(t=e.substring(n+1)),"VCard"===t?"Contact":t}}).filter("gpReliabilityGrade",function(){return function(e){var t=e;return"object"===(void 0===t?"undefined":_typeof(t))&&(t=t.statistics?t.statistics.reliability||null:t.reliability?t.reliability:null),isNaN(t)?"X":(t*=1,null===t||void 0===t?"X":t>90?"A":t>80?"B":t>70?"C":t>60?"D":"F")}})}(jQuery,angular),function(e){e.module("gp-common").directive("cardDetailsCarouselActivator",function(){return{compile:function(e){e.append('\n            <div class="gp-ui-card__details-activator--left" title="Show previous details"\n                ng-class="{disabled:!hasPrevious()}" ng-click="previousDetails()">\n                <span class="glyphicon glyphicon-chevron-left"></span>\n            </div>\n            <div class="gp-ui-card__details-activator--right" title="Show next details"\n                ng-class="{disabled:!hasNext()}" ng-click="nextDetails()">\n                <span class="glyphicon glyphicon-chevron-right"></span>\n            </div>\n        ')},controller:["$scope","$element",function(t,n){t.hasPrevious=function(){return n.find(".gp-ui-card__details.active").prevAll(".gp-ui-card__details").length},t.hasNext=function(){return n.find(".gp-ui-card__details.active").nextAll(".gp-ui-card__details").length},t.previousDetails=function(){if(t.hasPrevious()){var i=n.find(".gp-ui-card__details.active");i.removeClass("active"),i=i.prevAll(".gp-ui-card__details"),i.length&&e.element(i[0]).addClass("active")}},t.nextDetails=function(){if(t.hasNext()){var i=n.find(".gp-ui-card__details.active");i.removeClass("active"),i=i.nextAll(".gp-ui-card__details"),i.length&&e.element(i[0]).addClass("active")}}}]}})}(angular),function(e,t){function n(e){var t=!1;if(e instanceof Object){var n=parseInt(e.r,10),i=parseInt(e.g,10),s=parseInt(e.b,10);(n>255||n<0||!n&&0!==n)&&(t=!0),(i>255||i<0||!i&&0!==i)&&(t=!0),(s>255||s<0||!s&&0!==s)&&(t=!0)}else{var o=parseInt(e,10);(o>255||o<0||!o&&0!==o)&&(t=!0)}return t}function i(e){var t=e.toString(16),i=null;return isNaN(e)||n(e)||(i=1==t.length?"0"+t:t),i}function s(e){var t=null,n=i(parseInt(e.r,10)),s=i(parseInt(e.g,10)),o=i(parseInt(e.b,10));return n&&s&&o&&(t="#"+n+s+o),t}function o(e){return/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e)||null}function r(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,n,i){return t+t+n+n+i+i});var n=o(e);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null}t.module("gp-common").component("gpColorPicker",{bindings:{ngModel:"=",onChange:"&"},controller:["$timeout","$q",function(e,t){this.changeRGB=function(){this.rgbError=n(this.rgb),this.ngModel=s(this.rgb);var t=this;e(function(){t.onChange({value:t.ngModel})})},this.changeHex=function(){o(this.ngModel)?this.hexError=!1:this.hexError="Invalid hex color value",this.rgb=r(this.ngModel);var t=this;e(function(){t.onChange({value:t.ngModel})})},this.$onInit=function(){this.rgb=r(this.ngModel)}}],template:'\n            <div class="gp-colorpicker">\n                <div class="form-group hex-form-group" ng-class="{\'has-error\':$ctrl.hexError}">\n                    <input type="text" class="form-control"\n                        ng-model="$ctrl.ngModel" ng-keyup="$ctrl.changeHex()">\n                </div>\n                <div class="gp-colorpicker__wrapper">\n                    <div colorpicker colorpicker-inline="true" colorpicker-parent="true" \n                        ng-model="$ctrl.ngModel" ng-change="$ctrl.changeHex()"></div>\n                </div>\n                <div class="form-group rgb-form-group" ng-class="{\'has-error\':$ctrl.rgbError}">\n                    <input type="text" class="form-control"\n                        placeholder="R" ng-model="$ctrl.rgb.r" ng-keyup="$ctrl.changeRGB()" title="R">\n                    <input type="text" class="form-control"\n                        placeholder="G" ng-model="$ctrl.rgb.g" ng-keyup="$ctrl.changeRGB()" title="G">\n                    <input type="text" class="form-control"\n                        placeholder="B" ng-model="$ctrl.rgb.b" ng-keyup="$ctrl.changeRGB()" title="B">\n                </div>\n            </div>\n        '})}(jQuery,angular),function(e,t){t.module("gp-common").directive("gpDatePicker",["$timeout",function(e){return{scope:{label:"@",format:"@",date:"=",onChange:"&?"},template:['<div class="input-group-slick">','    <input type="text" class="form-control" placeholder="{{::label}}"','        datepicker-popup="{{format}}" ng-model="date" is-open="opened" />','    <span class="glyphicon glyphicon-calendar" ng-click="toggle($event)"></span>',"</div>",'<p class="help-block"><small><em>Ex: "2015-01-31" or "Jan 31 2015"</em></small></p>'].join(" "),controller:["$scope","$element","$attrs",function(t,n,i){t.toggle=function(e){e.preventDefault(),e.stopPropagation(),this.opened=!this.opened},t.format||(t.format="MMM dd yyyy");var s=null;t.debounce=function(){s&&e.cancel(s),s=e(function(){s=null,t.onChange&&t.onChange()},200)},t.$watch("date",function(){t.debounce()});var o=t.$on("$destroy",function(){o(),s&&e.cancel(s),s=null,t.opened=!1,t.onChange=null,t.format=null,t.debounce=null})}]}}])}(jQuery,angular),function(e,t){t.module("gp-common").directive("gpGeolocation",["$window",function(e){return{scope:{label:"=?"},restrict:"EA",template:['<a class="btn btn-primary" ng-click="geolocate()" ng-if="available">','  <span class="glyphicon glyphicon-screenshot" ng-if="!loading"></span>','  <span class="glyphicon glyphicon-hourglass glyphicon-spin" ng-if="loading"></span>',"  {{btnLabel}}","</a>",'<div ng-if="error">{{error}}</div>'].join(" "),controller:["$scope",function(t){t.btnLabel=t.label||"Locate",t.loading=!1,t.available=e.navigator&&e.navigator.geolocation,t.available||(t.error="Your browser does not support determining location"),t.geolocate=function(){t.loading=!0,e.navigator.geolocation.getCurrentPosition(function(e){t.$apply(function(){t.loading=!1}),t.$emit("map:geolocation",e.coords.latitude,e.coords.longitude)},function(e){switch(e.code){case 1:t.error="Permission was denied while attempting to determine location";break;case 2:t.error="Unable to determine your location";break;case 3:t.error="Unable to determine location in a reasonable amount of time"}})}}]}}])}(jQuery,angular),function(e,t){t.module("gp-common").directive("gpHeader",["GPConfig","AuthenticationService",function(e,t){return{scope:{brand:"@",showHomeLink:"@"},restrict:"AE",transclude:!0,replace:!0,template:["<header>",'  <div class="container-fluid">','    <div class="row">','      <div class="col-md-12">','        <ul role="menu" class="header__menu" gp-header-menu>','          <li ng-if="showHomeLink">','            <a href="#/goHome">','                <span class="glyphicon glyphicon-home"></span> ','                <span class="hidden-xs hidden-sm">Home</span>',"            </a>","          </li>",'          <div class="transcluded"></div>',"          <li><span gp-login-button></span></li>","        </ul>",'        <h4 class="brand">','          <a href="{{portalUrl}}" title="Go to the GeoPlatform Home Page">','            <span class="icon-gp"></span>','            <span class="hidden-xs">GeoPlatform</span>',"          </a>","          {{brand}}","        </h4>","      </div>","    </div>","  </div>","  <gp-login-modal></gp-login-modal>","</header>"].join(" "),link:function(n,i,s,o,r){n.showHomeLink="true"===n.showHomeLink||!1,n.portalUrl=e.portalUrl,t.getUserQ().then(function(e){n.user=e}),i.find(".transcluded").replaceWith(r())}}}]).directive("gpHeaderMenu",["$location",function(e){function t(t){var i=e.path();"/"!==i&&"/#"!==i&&"/#/"!==i||(i=n),"/"===i[0]&&(i=i.substring(1));var s=t;s.find("li.active").removeClass("active");var o=s.find('li > a[href="#/'+i+'"]');if(o.length){var r=o.closest(".dropdown-menu");r.length?r.closest("li").addClass("active"):o.parent().addClass("active")}s.find("li > a").each(function(e,t){var n=$(t),s=n.attr("href");s&&(s=s.replace("#/",""),0===i.indexOf(s)&&n.parent().addClass("active"))})}var n="goHome";return{scope:{homeHref:"@"},restrict:"A",controller:["$rootScope","$scope","$element",function(e,t,i){t.homeHref&&(n=t.homeHref)}],link:function(e,n){t(n),e.$root.$on("$locationChangeSuccess",function(){t(n)})}}}]).directive("gpFlexHeader",["GPConfig","AuthenticationService",function(e,t){return{scope:{brand:"@",showHomeLink:"@"},restrict:"AE",transclude:!0,replace:!0,template:'\n                <header>\n                    <h4 class="brand">\n                        <a href="{{portalUrl}}" title="Go to the GeoPlatform Home Page">\n                            <span class="icon-gp"></span>\n                            <span class="hidden-xs">GeoPlatform</span>\n                        </a>\n                        {{brand}}\n                    </h4>\n                    <ul role="menu" class="header__menu" gp-header-menu>\n                        <li ng-if="showHomeLink">\n                            <a href="/">\n                                <span class="glyphicon glyphicon-home"></span> \n                                <span class="hidden-xs hidden-sm">Home</span>\n                            </a>\n                        </li>\n                        <div class="transcluded"></div>\n                        <li><span gp-login-button></span></li>\n                    </ul>\n                </header>\n            ',link:function(n,i,s,o,r){n.showHomeLink="true"===n.showHomeLink||!1,n.portalUrl=e.portalUrl,t.getUserQ().then(function(e){n.user=e}),i.find(".transcluded").replaceWith(r())}}}])}(jQuery,angular),function(e){e.module("gp-common").directive("iframeOnload",function(){return{scope:{callback:"&iframeOnload"},link:function(e,t,n){t.on("load",function(n){return t.off("load"),e.callback(n)})}}})}(angular),function(e,t){e.module("gp-common").directive("onImgFail",function(){return{restrict:"A",link:function(e,t,n){var i=jQuery(t);i.on("error",function(){i.off("error"),i.attr("src",n.onImgFail)})}}}).directive("mapThumbnail",[function(){return{restrict:"A",scope:{mapThumbnail:"="},link:function(e,n,i){function s(e){if(e.thumbnail)if(e.thumbnail.contentData){var t="background-size:contain;background-repeat:no-repeat;background-image: url(data:"+(e.thumbnail.mediaType||"image/png")+";base64,"+e.thumbnail.contentData+");";n.attr("class").indexOf("embed-responsive-item")<0&&(t+="width:"+(e.thumbnail.width||"32")+"px;height:"+(e.thumbnail.height||"32")+"px;"),n.attr("style",t)}else e.thumbnail.url?n.attr("src",e.thumbnail.url):n.attr("src",null);else n.attr("src",null)}function o(e){var n=e.thumbnail;return n&&n.length?0!==n.indexOf("http")&&(n="/"!==n[0]?t.ualUrl+"/"+n:t.ualUrl+n):n=t.ualUrl+"/api/maps/"+e.id+"/thumbnail",n}var r=e.mapThumbnail;r.$promise&&!r.$resolved?r.$promise.then(function(e){"string"==typeof e.thumbnail?n.attr("src",o(e)):s(e)}).catch(function(e){n.attr("src",null)}):"string"==typeof r.thumbnail?n.attr("src",o(r)):s(r)}}}]).directive("itemThumbnail",["$q",function(e){return{restrict:"E",replace:!0,scope:{item:"=",fallback:"@",link:"@"},template:'\n                <a ng-show="hasThumbnail" class="media embed-responsive embed-responsive-16by9">\n                    <img class="embed-responsive-item" on-img-error="{{fallback||\'/img/img-404.jpg\'}}">\n                </a>\n            ',controller:["$scope",function(e){e.elName="div",e.isLink=!!e.link,e.isLink&&(e.elName="a")}],link:function(n,i,s){var o=n.item;(o.$promise||e.resolve(o)).then(function(e){var s=n.fallback;if(e.type&&"Map"===e.type)s=t.ualUrl+"/api/maps/"+e.id+"/thumbnail";else if(e.assetType&&"Map"===e.assetType)s=t.ualUrl+"/api/maps/"+e.assetId+"/thumbnail";else if(e.thumbnail&&e.thumbnail.url)s=e.thumbnail.url;else if(e.thumbnail&&e.thumbnail.contentData){var o="background-size:contain;background-repeat:no-repeat;background-image: url(data:"+(e.thumbnail.mediaType||"image/png")+";base64,"+e.thumbnail.contentData+");";i.attr("class").indexOf("embed-responsive-item")<0&&(o+="width:"+(e.thumbnail.width||"32")+"px;height:"+(e.thumbnail.height||"32")+"px;"),i.find("img").attr("style",o)}n.hasThumbnail=!!s,i.find("img").attr("src",s),n.isLink&&i.attr("href",n.link).attr("target","_blank")}).catch(function(e){i.find("img").attr("src",n.fallback)})}}}])}(angular,GeoPlatform),function(e){e.module("gp-common").service("NotificationService",["$rootScope",function(e){var t=function(){this.items=[]};return t.prototype={getItems:function(){return this.items},addItem:function(t){return this.items.push(t),e.$broadcast("gp:notifications:new",t),function(e){this.removeItem(e)}.bind(this,t)},removeItem:function(e){var t=this.items.indexOf(e);return t>=0?this.items.splice(t,1):null},error:function(e,t,n){return this.addItem({type:"error",label:e,message:t,canDismiss:n})},success:function(e,t,n){return this.addItem({type:"success",label:e,message:t,canDismiss:n})},info:function(e,t,n){return this.addItem({type:"info",label:e,message:t,canDismiss:n})}},new t}]).directive("gpNotifications",["$timeout","NotificationService",function(e,t){return{scope:{expiration:"@"},template:['<div class="notifications ng-hide" ng-show="items.length">','  <div class="notification" ng-repeat="item in items"',"    ng-class=\"{'notification--success':item.type==='success', 'notification--error':item.type==='error', 'notification--info':item.type==='info'}\">",'    <h5 class="notification__title">','        <span class="pull-right glyphicon" ',"            ng-class=\"{'glyphicon-ok-sign':item.type==='success','glyphicon-exclamation-sign':item.type==='error','glyphicon-info-sign':item.type==='info'}\">","        </span>","        {{item.label}}","    </h5>",'    <p class="notification__content" ng-bind-html="item.message"></p>','    <div class="notification__actions" ng-if="item.canDismiss">','        <button type="button" class="btn btn-link" ng-click="dismiss(item)">dismiss</button>',"    </div>","  </div>","</div>"].join(" "),link:function(n,i,s){function o(){n.items=t.getItems(),n.timer&&(e.cancel(n.timer),n.timer=null),n.timer=e(function(){n.timer=null,n.removeOldest()},n.expiration)}n.expiration=1*(n.expiration||2e3),n.items=[],o(),n.removeOldest=function(){var e=n.items.find(function(e){return e.canDismiss});e&&t.removeItem(e)},n.dismiss=function(e){t.removeItem(e)},n.$watchCollection(function(){return t.getItems()},o)}}}])}(angular),function(e,t){var n=function(){function e(){"ngInject"}return e.prototype.$onInit=function(){var e=this;if(this.service){this.options=this.service.getPagination(),this.pageSizeDropdown=!0,this.useSelect=void 0!==this.useSelect&&(!0===this.useSelect||"true"===this.useSelect||1===this.useSelect),this.useSelect&&(this.pageSizeDropdown=!1,this.pageSize=this.options.size,this.pageSizeOptions=(this.options.sizeOptions||[5,10,20,50]).map(function(e){return{label:e+" per page",value:e}}));var t="gp:browse:";t=this.eventKey?"gp:browse:"+this.eventKey+":":"gp:browse:objects:",this.listener=this.service.on(t+"pagination",function(){e.options=e.service.getPagination()})}},e.prototype.$onDestroy=function(){this.listener&&this.listener(),this.service=null},e.prototype.previous=function(){this.service&&this.hasPrevious()&&this.service.start(Math.max(0,1*this.options.start-1*this.options.size),!0)},e.prototype.next=function(){this.service&&this.hasNext()&&this.service.start(Math.min(this.options.total,1*this.options.start+1*this.options.size),!0)},e.prototype.first=function(){this.service&&this.hasPrevious()&&this.service.start(0,!0)},e.prototype.last=function(){if(this.service&&this.hasNext()){var e=Math.floor(this.options.total/this.options.size);this.setPage(e)}},e.prototype.setPage=function(e){if(this.service){var t=1*e;this.service.start(t*(1*this.options.size),!0)}},e.prototype.setPageSize=function(e){this.service&&this.service.size(1*e,!0)},e.prototype.hasPrevious=function(){return this.options&&this.options.start>0},e.prototype.hasNext=function(){return this.options&&this.options.start+this.options.size<this.options.total},e}();t.module("gp-common").component("gpPagination",{bindings:{service:"=",eventKey:"@",useSelect:"@"},controller:n,template:'\n            <div class="c-pagination">\n                <div class="c-pagination__total">{{$ctrl.options.total||0}} results</div>\n                <div class="c-pagination__page-size" ng-if="$ctrl.pageSizeDropdown">\n                    <span uib-dropdown>\n                        <a href="" uib-dropdown-toggle title="Change the number of results returned">\n                            {{$ctrl.options.size}} per page <span class="caret"></span>\n                        </a>\n                        <ul class="dropdown-menu" role="menu">\n                            <li ng-repeat="size in $ctrl.options.sizeOptions track by $index">\n                                <a ng-click="$ctrl.setPageSize(size)">{{size}} per page</a>\n                            </li>\n                        </ul>\n                    </span>\n                </div>\n                <div class="c-pagination__page-size" ng-if="!$ctrl.pageSizeDropdown">\n                    <select class="form-control" \n                        ng-model="$ctrl.pageSize" ng-change="$ctrl.setPageSize($ctrl.pageSize)"\n                        ng-options="opt.value as opt.label for opt in $ctrl.pageSizeOptions">\n                    </select>\n                </div>\n                <div class="c-pagination__pages">\n                    <div class="c-pagination__button" \n                        ng-class="{\'is-disabled\':!$ctrl.hasPrevious()}"\n                        ng-click="$ctrl.first()">\n                        <span class="glyphicon glyphicon-fast-backward"></span>\n                    </div>\n                    <div class="c-pagination__button" \n                        ng-class="{\'is-disabled\':!$ctrl.hasPrevious()}"\n                        ng-click="$ctrl.previous()">\n                        <span class="glyphicon glyphicon-backward"></span>\n                    </div>\n                    <div class="c-pagination__page">\n                        {{$ctrl.options.start+1}} - {{$ctrl.options.start+$ctrl.options.size}}\n                    </div>\n                    <div class="c-pagination__button" \n                        ng-class="{\'is-disabled\':!$ctrl.hasNext()}"\n                        ng-click="$ctrl.next()">\n                        <span class="glyphicon glyphicon-forward"></span>\n                    </div>\n                    <div class="c-pagination__button" \n                        ng-class="{\'is-disabled\':!$ctrl.hasNext()}"\n                        ng-click="$ctrl.last()">\n                        <span class="glyphicon glyphicon-fast-forward"></span>\n                    </div>\n                </div>\n            </div>\n        '})}(jQuery,angular),function(e){e.module("gp-common").component("gpProgressCircle",{bindings:{ngModel:"<"},controller:function(){this.$onInit=function(){this.dashArray=2*Math.PI*45,this.ngModel||(this.ngModel=0),this.update()},this.$onChanges=function(e){e.ngModel&&this.update()},this.update=function(){var e=2*Math.PI*45*(1-this.ngModel/100);this.value=e}},template:'\n            <svg class="c-progress--circle" viewBox="0 0 100 100">\n                <circle class="c-progress__meter" cx="50" cy="50" r="45" stroke-width="10" />\n                <circle class="c-progress__value" cx="50" cy="50" r="45" stroke-width="10" \n                    stroke-dasharray="{{$ctrl.dashArray}}" stroke-dashoffset="{{$ctrl.value}}"/>\n                <text class="c-progress__label" x="50" y="-40" text-anchor="middle">{{$ctrl.ngModel}}%</text>\n            </svg>\n        '})}(angular),function(e,t){t.module("gp-common").provider("responsiveHelper",["$windowProvider",function(e){function t(e){this.window=e}var n=e.$get();t.prototype={getWidth:function(){return n.innerWidth||n.outerWidth},isXS:function(){return this.getWidth()<768},isSM:function(){var e=this.getWidth();return e>=768&&e<992},isMD:function(){var e=this.getWidth();return e>=992&&e<1200},isLG:function(){return this.getWidth()>=1200}};var i=new t(n);this.$get=function(){return i}}]).directive("gpResponsive",["$window","responsiveHelper",function(e,n){return{restrict:"A",link:function(i,s,o){function r(e,t){t.isXS()?e.addClass("gp-responsive-xs"):e.removeClass("gp-responsive-xs"),t.isSM()?e.addClass("gp-responsive-sm"):e.removeClass("gp-responsive-sm"),t.isMD()?e.addClass("gp-responsive-md"):e.removeClass("gp-responsive-md"),t.isLG()?e.addClass("gp-responsive-lg"):e.removeClass("gp-responsive-lg")}r(s,n);var l=function(){r(s,n)},a=t.element(e);a.on("resize",l);i.$on("$destroy",function(){a.off("resize",l)})}}}]).directive("gpResize",["$window","$timeout",function(n,i){return function(s,o,r){var l=function(){var t=e("header")[0].offsetHeight,n=t+2,i={top:n+"px"};o.css(i),s.$apply()},a=t.element(n);a.on("resize",l),i(l,200),s.$on("$destroy",function(){a.off("resize",l)})}}])}(jQuery,angular),function(e,t){function n(e,t,n,i,s){function o(){var n=t.find(".form-control");e.isDirty=n.hasClass("ng-dirty"),n.hasClass("ng-invalid")?n.hasClass("ng-empty")?e.error="This field requires a value":e.error="Invalid value provided":e.error=null}function r(e){i.$setViewValue(e),i.$render()}e.type||(e.type="text"),"true"===e.required?e.required=!0:e.required=!1,e.elId="input_"+Math.ceil(9999*Math.random()),e.size=e.size||"medium",e.type=e.type||"text",t.find(".form-control").on("change",function(){o(e.innerValue)}),i.$render=function(){var t=i.$viewValue;e.innerValue=t,e.displayValue=t||e.placeholder||"No value provided",o()},e.isReadOnly=function(){var e=_typeof(this.readOnly);return"undefined"!==e&&("string"===e?"true"===this.readOnly.toLowerCase():"number"===e?1===this.readOnly:"boolean"===e&&this.readOnly)},e.edit=function(){e.isReadOnly()||(e.editing=!0,s(function(){t.find(".form-control").focus().select()},200))},e.done=function(){e.editing=!1,e.error=null},e.save=function(){r(e.innerValue),e.done()},e.cancel=function(){e.innerValue=i.$viewValue,e.done()},e.onKeyPress=function(t,n){if(void 0!==n&&0!==n||void 0===t.which||(n=t.which),"number"===e.type){if(8===n||46===n||n>=44&&n<=57)return;return t.preventDefault(),!1}},e.onKeyUp=function(t,n){if(void 0!==n&&0!==n||void 0===t.which||(n=t.which),13!==n||e.error)if(27===n)e.cancel();else{if(8!==n&&46!==n&&190!==n&&(n<48||n>90)&&(n<106||n>111)&&n<186)return;o()}else e.done()},e.$destroy=function(){t.off("change")}}t.module("gp-common").directive("gpSlickFormInput",["$timeout",function(e){return{restrict:"AE",require:"ngModel",scope:{label:"@",placeholder:"@",help:"=",type:"@",pattern:"@",required:"@",readOnly:"@",size:"@",icon:"@"},template:i,link:function(t,i,s,o){n(t,i,s,o,e)}}}]).directive("gpSlickFormTextarea",["$timeout",function(e){return{restrict:"AE",require:"ngModel",scope:{label:"@",placeholder:"@",help:"@",readOnly:"@",size:"@",icon:"@"},template:s,link:function(t,i,s,o){n(t,i,s,o,e)}}}]).directive("gpSlickFormDate",["$timeout","$filter",function(e,n){return{restrict:"AE",require:"ngModel",scope:{label:"@",format:"@",placeholder:"@",required:"@",readOnly:"@",size:"@",icon:"@"},template:o,controller:["$scope","$element",function(e,t){(!e.format||e.format.length<3)&&(e.format="mediumDate"),e.inline=t.hasClass("inline")}],link:function(e,i,s,o){function r(t){var n=i.find(".form-control");n.hasClass("ng-invalid")?n.hasClass("ng-empty")?e.error="This field requires a value":e.error="Invalid value provided":e.error=null}function l(e){o.$setViewValue(e),o.$render()}"true"===e.required?e.required=!0:e.required=!1,e.elId="input_"+Math.ceil(9999*Math.random()),e.size=e.size||"medium",e.type=e.type||"text",o.$render=function(){var t=o.$viewValue;e.innerValue=t,e.displayValue=t?n("date")(o.$modelValue,e.format):e.placeholder||"No value provided",r(t)},e.isReadOnly=function(){var e=_typeof(this.readOnly);return"undefined"!==e&&("string"===e?"true"===this.readOnly.toLowerCase():"number"===e?1===this.readOnly:"boolean"===e&&this.readOnly)},e.edit=function(){e.isReadOnly()||(e.editing=!0)},e.done=function(){e.opened=!1,e.editing=!1,e.error=null},e.save=function(){l(e.innerValue),e.done()},e.cancel=function(){e.innerValue=t.copy(o.$modelValue),e.done()},e.open=function(){void 0===e.uibopts&&(e.uibopts={}),e.uibopts.opened=!0},e.onKeyUp=function(t){13===t?e.done():27===t&&e.cancel()},e.onChange=function(t){isNaN(o.$modelValue)&&e.required?e.error="This field requires a value":e.error=null}}}}]).directive("gpSlickFormSelect",["$timeout",function(e){return{restrict:"AE",require:"ngModel",scope:{label:"@",codeList:"=",help:"=",required:"@",readOnly:"@",size:"@",icon:"@"},template:r,link:function(t,n,i,s){function o(){return a&&a.length||(a=n.find(".form-control")),a}function r(){var e=o();t.isDirty=e.hasClass("ng-dirty"),e.hasClass("ng-invalid")?e.hasClass("ng-empty")?t.error="This field requires a value":t.error="Invalid value provided":t.error=null}function l(e){s.$setViewValue(e),s.$render()}t.type||(t.type="text"),"true"===t.required?t.required=!0:t.required=!1,t.elId="input_"+Math.ceil(9999*Math.random()),t.size=t.size||"medium",t.type=t.type||"text";var a=null;t.codeList?t.selectOptions=t.codeList.map(function(e){return"object"===(void 0===e?"undefined":_typeof(e))&&e.value?e.label?e:{value:e.value,label:e.value}:{value:e,label:e}}):t.selectOptions=[],s.$render=function(){var e=s.$viewValue;if(t.innerValue=e,t.displayValue=t.placeholder||"No value provided",e){var n=t.selectOptions.find(function(t){return t.value==e});t.displayValue=n.label}r()},t.onChange=function(n){t.innerValue=n,e(function(){r()},200)},t.onTypeaheadSelection=function(n,i,s,o){t.innerValue=n?n.value:null,e(function(){r()},200)},t.isReadOnly=function(){var e=_typeof(this.readOnly);return"undefined"!==e&&("string"===e?"true"===this.readOnly.toLowerCase():"number"===e?1===this.readOnly:"boolean"===e&&this.readOnly)},t.edit=function(){t.isReadOnly()||(t.editing=!0,e(function(){a.focus().select()},200))},t.done=function(){t.editing=!1,t.error=null},t.save=function(){l(t.innerValue),t.done()},t.cancel=function(){t.innerValue=s.$viewValue,t.done()},t.onKeyUp=function(e){13!==e||t.error?27===e&&t.cancel():t.save()},t.onTypeaheadKeyUp=function(e){r()},t.$destroy=function(){}}}}])
;var i=['<div class="form-group form-group-slick">','   <label for="{{::elId}}" class="control-label">{{::label}}</label>','   <div class="input__display" ',"       ng-class=\"{'is-read-only':isReadOnly(), 'has-error':!!error,'text-lg':size==='large'}\" ",'       ng-show="!editing" ng-click="edit()" ',"       title=\"{{!!error?error:(!isReadOnly()?'Click to edit':'')}}\">","      {{displayValue}}","   </div>",'   <div ng-show="editing">',"      <div class=\"input-group\" ng-class=\"{'input-group-lg':size==='large'}\">","           <div class=\"input-group-slick\" ng-class=\"{'input-group-slick--lg':size==='large'}\">",'               <span ng-if="icon" class="{{::icon}}"></span>','               <input id="{{::elId}}" type="{{::type}}" class="form-control" ','                   pattern="{{pattern}}" ','                   ng-model="innerValue" ','                   ng-required="{{required}}" ','                   ng-keypress="onKeyPress($event, $event.keyCode)" ','                   ng-keyup="onKeyUp($event, $event.keyCode)" >','               <span class="indicators">','                   <span class="is-valid glyphicon glyphicon-ok-sign"></span>','                  <span class="is-invalid glyphicon glyphicon-exclamation-sign"></span>',"              </span>","           </div>",'          <span class="input-group-btn">','               <button type="button" class="btn btn-default" ',"                   ng-class=\"{'btn-lg':size==='large'}\"",'                   ng-click="cancel()" title="Cancel changes">','                   <span class="glyphicon glyphicon-ban-circle"></span>',"              </button>",'               <button type="button" class="btn btn-default" ',"                   ng-class=\"{disabled:!!error||!isDirty,'btn-lg':size==='large'}\"",'                   ng-disabled="{{!!error}}" ','                   ng-click="save()" title="Save changes">','                  <span class="glyphicon glyphicon-ok"></span>',"               </button>","           </span>","       </div>",'       <div ng-if="error && error.length"><small class="help-block text-danger">{{error}}</small></div>','       <div ng-if="help && help.length"><small class="help-block">{{help}}</small></div>',"   </div>","</div>"].join(" "),s=['<div class="form-group form-group-slick">','   <label for="{{::elId}}" class="control-label">{{::label}}</label>','   <div class="input__display" ',"       ng-class=\"{'is-read-only':isReadOnly(), 'has-error':!!error,'text-lg':size==='large'}\" ",'       ng-show="!editing" ng-click="edit()" ',"       title=\"{{!!error?error:(!isReadOnly()?'Click to edit':'')}}\">","      {{displayValue}}","   </div>",'   <div ng-show="editing">',"      <div class=\"input-group\" ng-class=\"{'input-group-lg':size==='large'}\">","           <div class=\"input-group-slick\" ng-class=\"{'input-group-slick--lg':size==='large'}\">",'               <span ng-if="icon" class="{{::icon}}"></span>','               <textarea rows="3" id="{{::elId}}" class="form-control" ','                   ng-required="{{required}}" ng-model="innerValue"','                   ng-keypress="onKeyPress($event, $event.keyCode)" ','                   ng-keyup="onKeyUp($event, $event.keyCode)"></textarea>','               <span class="indicators">','                   <span class="is-valid glyphicon glyphicon-ok-sign"></span>','                  <span class="is-invalid glyphicon glyphicon-exclamation-sign"></span>',"              </span>","           </div>",'          <span class="input-group-btn">','               <button type="button" class="btn btn-default" ',"                   ng-class=\"{'btn-lg':size==='large'}\"",'                   ng-click="cancel()" title="Cancel changes">','                   <span class="glyphicon glyphicon-ban-circle"></span>',"              </button>",'               <button type="button" class="btn btn-default" ',"                   ng-class=\"{disabled:!!error||!isDirty,'btn-lg':size==='large'}\"",'                   ng-disabled="{{!!error}}" ','                   ng-click="save()" title="Save changes">','                  <span class="glyphicon glyphicon-ok"></span>',"               </button>","           </span>","       </div>",'       <div ng-if="error && error.length"><small class="help-block text-danger">{{error}}</small></div>','       <div ng-if="help && help.length"><small class="help-block">{{help}}</small></div>',"   </div>","</div>"].join(" "),o=['<div class="form-group form-group-slick">','   <label for="{{::elId}}" class="control-label">{{::label}}</label>','   <div class="input__display" ',"       ng-class=\"{'is-read-only':isReadOnly(), 'has-error':!!error}\" ",'       ng-show="!editing" ng-click="edit()" ',"       title=\"{{!!error?error:(!isReadOnly()?'Click to edit':'')}}\">","      {{displayValue}}","   </div>",'   <div ng-show="editing">','       <div uib-datepicker ng-required="{{required}}" ng-model="innerValue" datepicker-options="{showWeeks:false}"></div>','       <div ng-if="error && error.length"><small class="help-block text-danger">{{error}}</small></div>','       <div ng-if="help && help.length"><small class="help-block">{{help}}</small></div>','       <button type="button" class="btn btn-default" ',"           ng-class=\"{'btn-lg':size==='large'}\"",'           ng-click="cancel()" title="Cancel changes">','           <span class="glyphicon glyphicon-ban-circle"></span>',"      </button>",'      <button type="button" class="btn btn-default" ',"           ng-class=\"{disabled:!!error,'btn-lg':size==='large'}\"",'          ng-disabled="{{!!error}}" ','           ng-click="save()" title="Save changes">','           <span class="glyphicon glyphicon-ok"></span>',"      </button>","   </div>","</div>"].join(" "),r=['<div class="form-group form-group-slick">','   <label for="{{::elId}}" class="control-label">{{::label}}</label>','   <div class="input__display" ',"       ng-class=\"{'is-read-only':isReadOnly(), 'has-error':!!error}\" ",'       ng-show="!editing" ng-click="edit()" ',"       title=\"{{!!error?error:(!isReadOnly()?'Click to edit':'')}}\">","      {{displayValue}}","   </div>",'   <div ng-show="editing">',"      <div class=\"input-group\" ng-class=\"{'input-group-lg':size==='large'}\">","           <div class=\"input-group-slick\" ng-class=\"{'input-group-slick--lg':size==='large'}\">",'               <span ng-if="icon" class="{{::icon}}"></span>','               <select class="form-control input__field" ','                   ng-if="codeList.length<=12" ','                   ng-model="innerValue" ','                   ng-options="opt.value as opt.label for opt in selectOptions" ','                   ng-required="{{required}}" ','                   ng-change="onChange(innerValue)" ','                   ng-keyUp="onKeyUp($event.keyCode)" >','                   <option value="">Select One</option>',"               </select>",'               <input type="text" class="form-control input__field" ng-if="codeList.length>12" ','                   ng-model="innerValue" ','                   ng-required="{{required}}" ','                   ng-keyUp="onTypeaheadKeyUp($event.keyCode)" ','                   typeahead-on-select="onTypeaheadSelection($item, $model, $label, $event)" ','                   uib-typeahead="opt.value as opt.label for opt in selectOptions | filter:{value:$viewValue} | limitTo:12" ','                   typeahead-min-length="0" ','                   typeahead-editable="false">','               <span class="indicators">','                   <span class="is-valid glyphicon glyphicon-ok-sign"></span>','                  <span class="is-invalid glyphicon glyphicon-exclamation-sign"></span>',"              </span>","           </div>",'          <span class="input-group-btn">','               <button type="button" class="btn btn-default" ',"                   ng-class=\"{'btn-lg':size==='large'}\"",'                   ng-click="cancel()" title="Cancel changes">','                   <span class="glyphicon glyphicon-ban-circle"></span>',"              </button>",'               <button type="button" class="btn btn-default" ',"                   ng-class=\"{disabled:!!error||!isDirty,'btn-lg':size==='large'}\"",'                   ng-disabled="{{!!error}}" ','                   ng-click="save()" title="Save changes">','                  <span class="glyphicon glyphicon-ok"></span>',"               </button>","           </span>","       </div>",'       <div ng-if="error && error.length"><small class="help-block text-danger">{{error}}</small></div>','       <div ng-if="help && help.length"><small class="help-block">{{help}}</small></div>',"   </div>","</div>"].join(" ")}(jQuery,angular),function(e){e.module("gp-common").directive("gpTweetButton",["$timeout",function(e){function t(e,t,n){var i;return function(){var s=this,o=arguments,r=function(){i=null,n||e.apply(s,o)},l=n&&!i;clearTimeout(i),i=setTimeout(r,t),l&&e.apply(s,o)}}return{link:function(n,i,s){if("undefined"==typeof twttr)return void(i.className+=" disabled");var o=t(function(){s.url&&e(function(){i[0].innerHTML="",twttr.widgets.createShareButton(s.url,i[0],function(){},{count:s.count,text:s.text,via:s.via,size:s.size,hashtags:s.hashtags,dnt:s.dnt})})},75);s.$observe("url",o),s.$observe("text",o)}}}])}(angular),function(e){e.module("gp-common").directive("sortOrder",function(){return{replace:!0,require:"ngModel",template:["<div>",'<a class="btn btn-default" title="Click to sort in ascending order" href ng-if="value===\'dsc\'" ng-click="toggle()">','    <span class="glyphicon glyphicon-sort-by-attributes-alt"></span>',"</a>",'<a class="btn btn-default" title="Click to sort in descending order" href ng-if="value===\'asc\'" ng-click="toggle()">','    <span class="glyphicon glyphicon-sort-by-attributes"></span>',"</a>","</div>"].join(" "),link:function(e,t,n,i){i.$viewChangeListeners.push(function(){e.$eval(n.ngChange)}),i.$render=function(){e.value=i.$modelValue},e.toggle=function(){e.value="asc"===e.value?"dsc":"asc",i.$setViewValue(e.value)}}}})}(angular),function(e){e.module("gp-common").directive("stringArrayInput",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){function s(e){var t=null;return e&&e.length&&(t=e.split(",").map(function(e){return e.trim()})),t}function o(e){var t=null;return e&&void 0!==e.push&&(t=e.join(", ")),t}i.$parsers.push(s),i.$formatters.push(o)}}})}(angular),function(e,t){var n=function(){function e(e,t,n,i){"ngInject";this.$rootScope=e,this.$element=t,this.fields=n.slice(0),this.helper=i}return e.$inject=["$rootScope","$element","KGFields","KGHelper"],e.prototype.$onInit=function(){this.displayOptions={},this.completion=0,this.service=this.helper.getService(this.ngModel.type),this.descriptions={purpose:"The intended use or reason for the Object (i.e., layer, map, gallery) e.g., environmental impact of an oil spill.",function:"The business actions, activities, or tasks this Object is intended to support (i.e., the role it plays in supporting an activity).  e.g., environmental impact assessment.",audience:"The group of people for which this Object was intended to be used. e.g., general public, disaster recovery personnel, Congress.",community:'The GeoPlatform community this Object was produced for. e.g., "Ecosystems and Biodiversity" community',place:"The central locale or common names for the place where the Subjects of the Object occur. e.g.,  USA/Gulf Coast",category:"The type or category of the Object.  e.g., topographic map, elevation layer",primarySubject:"The selected things, events, or concepts forming part of or represented by the Object. e.g., Deep Water Horizon oil rig, oil slick extent, oil slick movement over time, predicted oil slick movement, impacted sites, impact severity.",secondarySubject:"Second-order subjects derived by machine processing/ analysis of the target Object",primaryTopic:"The central branch of knowledge or theme pertaining to the thing, concept, situation, issue, or event of interest. e.g., environmental impact of oil spill.",secondaryTopic:"Second-order topics derived by machine processing/ analysis of the target Object"},this.ngModel.classifiers||(this.ngModel.classifiers={}),this.calculatePercentage()},e.prototype.$onDestroy=function(){this.$rootScope=null,this.ngModel=null,this.helper=null,this.fields=null,this.service=null},e.prototype.onChange=function(e,t){this.ngModel.classifiers[e]=t,this.calculatePercentage()},e.prototype.onValueClick=function(e,t){this.onActivate&&this.onActivate({classifier:e,value:t})},e.prototype.calculatePercentage=function(){this.completion=this.helper.calculate(this.ngModel.classifiers)},e}();e.module("gp-common-kg").component("kgEditor",{require:{ngModelCtrl:"ngModel"},bindings:{ngModel:"=",onActivate:"&"},controller:n,template:'\n            <div class="c-kg-editor">\n                <div class="c-kg-editor__header l-flex-container flex-justify-between flex-align-center">\n                    <div class="flex-1">\n                        <h4>Knowledge Graph</h4>\n                        <div class="u-text--sm">\n                            Knowledge graphs (KGs) are formed from classifiers for several dimensions of GeoPlatform items \n                            (layers, maps, galleries, etc), including <em>Purpose</em>, <em>Scope</em>, \n                            <em>Fitness for Use</em>, and <em>Social Context</em>. \n                            <br>\n                            <br>\n                            Knowledge graphs are used to answer questions about items, such as:\n                            <ul>\n                            <li>Why was the item created?</li>\n                            <li>Why is it useful for others?</li>\n                            <li>Why is it appropriate to be used?</li>\n                            </ul>\n                        </div>\n                    </div>\n                    <gp-progress-circle ng-model="$ctrl.completion" class="u-mg-left--xlg u-mg-right--xlg"></gp-progress-circle>\n                </div>\n\n                <div class="c-kg-editor__content">\n\n                    <div class="c-kg-editor__section">\n                        <h4 class="t-fg--accent">Purpose</h4>\n\n                        <kg-section \n                            service="$ctrl.service"\n                            ng-model="$ctrl.ngModel.classifiers.purposes"\n                            on-change="$ctrl.onChange(\'purposes\', values)"\n                            on-activate="$ctrl.onValueClick(\'purposes\', value)"\n                            type="Purpose"\n                            label="Purpose" \n                            description="{{$ctrl.descriptions.purpose}}">\n                        </kg-section>\n                    </div>\n\n\n                    <div class="c-kg-editor__section">\n                        <h4 class="t-fg--accent">Scope</h4>\n\n                        <kg-section \n                            service="$ctrl.service"\n                            ng-model="$ctrl.ngModel.classifiers.primaryTopics"\n                            on-change="$ctrl.onChange(\'primaryTopics\', values)"\n                            on-activate="$ctrl.onValueClick(\'primaryTopics\', value)"\n                            type="Topic" \n                            label="Primary Topics" \n                            description="{{$ctrl.descriptions.primaryTopic}}">\n                        </kg-section>\n                        <kg-section \n                            service="$ctrl.service"\n                            ng-model="$ctrl.ngModel.classifiers.secondaryTopics"\n                            on-change="$ctrl.onChange(\'secondaryTopics\', values)"\n                            on-activate="$ctrl.onValueClick(\'secondaryTopics\', value)"\n                            type="Topic" \n                            label="Secondary Topics" \n                            description="{{$ctrl.descriptions.secondaryTopic}}">\n                        </kg-section>\n                        <kg-section \n                            service="$ctrl.service"\n                            ng-model="$ctrl.ngModel.classifiers.primarySubjects"\n                            on-change="$ctrl.onChange(\'primarySubjects\', values)"\n                            on-activate="$ctrl.onValueClick(\'primarySubjects\', value)"\n                            type="Subject" \n                            label="Primary Subjects" \n                            description="{{$ctrl.descriptions.primarySubject}}">\n                        </kg-section>\n                        <kg-section \n                            service="$ctrl.service"\n                            ng-model="$ctrl.ngModel.classifiers.secondarySubjects"\n                            on-change="$ctrl.onChange(\'secondarySubjects\', values)"\n                            on-activate="$ctrl.onValueClick(\'secondarySubjects\', value)"\n                            type="Subject" \n                            label="Secondary Subjects" \n                            description="{{$ctrl.descriptions.secondarySubject}}">\n                        </kg-section>\n                        <kg-section \n                            service="$ctrl.service"\n                            ng-model="$ctrl.ngModel.classifiers.categories"\n                            on-change="$ctrl.onChange(\'categories\', values)"\n                            on-activate="$ctrl.onValueClick(\'categories\', value)"\n                            type="Category" \n                            label="Categories" \n                            description="{{$ctrl.descriptions.category}}">\n                        </kg-section>\n                        <kg-section \n                            service="$ctrl.service"\n                            ng-model="$ctrl.ngModel.classifiers.communities"\n                            on-change="$ctrl.onChange(\'communities\', values)"\n                            on-activate="$ctrl.onValueClick(\'communities\', value)"\n                            type="Community" \n                            label="Communities" \n                            description="{{$ctrl.descriptions.community}}">\n                        </kg-section>\n                        <kg-section \n                            service="$ctrl.service"\n                            ng-model="$ctrl.ngModel.classifiers.places"\n                            on-change="$ctrl.onChange(\'places\', values)"\n                            on-activate="$ctrl.onValueClick(\'places\', value)"\n                            type="Place" \n                            label="Places" \n                            description="{{$ctrl.descriptions.place}}">\n                        </kg-section> \n                    </div> \n\n                    <div class="c-kg-editor__section">\n                        <h4 class="t-fg--accent">Fitness for Use</h4>\n\n                        <kg-section \n                            service="$ctrl.service"\n                            ng-model="$ctrl.ngModel.classifiers.functions"\n                            on-change="$ctrl.onChange(\'functions\', values)"\n                            on-activate="$ctrl.onValueClick(\'functions\', value)"\n                            type="Function" \n                            label="Function" \n                            description="{{$ctrl.descriptions.function}}">\n                        </kg-section>\n                    </div>\n\n                    <div class="c-kg-editor__section">\n                        <h4 class="t-fg--accent">Social Context</h4>\n\n                        <kg-section \n                            service="$ctrl.service"\n                            ng-model="$ctrl.ngModel.classifiers.audiences"\n                            on-change="$ctrl.onChange(\'audiences\', values)"\n                            on-activate="$ctrl.onValueClick(\'audiences\', value)"\n                            type="Audience" \n                            label="Audiences" \n                            description="{{$ctrl.descriptions.audience}}">\n                        </kg-section>\n                    </div>\n\n                </div>\n            </div>\n        '})}(angular,GeoPlatform),function(e,t){var n=function(){function t(e,t){"ngInject";this.$timeout=e}return t.$inject=["$timeout","RecommenderService"],t.prototype.$onInit=function(){this.noResults=!1,this.query="",this.displayOptions={fetching:!1,showSuggested:!1},this.paging={start:0,size:5,sizeOptions:[5,10,20]},this.updateCache(),this.description||(this.description="<em>No description provided</em>")},t.prototype.$onChanges=function(){this.updateCache()},t.prototype.$onDestroy=function(){this.eventHandlers=null,this.clearOptions(),this.selected=null,this.service=null,this.$timeout=null},t.prototype.activate=function(e){this.onActivate&&this.onActivate({value:e})},t.prototype.on=function(e,t){this.eventHandlers=this.eventHandlers||{},this.eventHandlers[e]=this.eventHandlers[e]||[],this.eventHandlers[e].push(t)},t.prototype.notify=function(t,n){this.eventHandlers&&this.eventHandlers[t]&&e.forEach(this.eventHandlers[t],function(e){try{e(n)}catch(e){}})},t.prototype.fetchOptions=function(e){var t=this;this.$timeout(function(){t.query=e},10),this.displayOptions.fetching=!0;var n={type:this.type,q:e,page:Math.floor(this.paging.start/this.paging.size),size:this.paging.size};return this.service.query(n).$promise.then(function(e){return t.paging.total=e.totalResults,t.notify("gp:browse:suggestions:pagination",t.paging),t.suggested=e.results.map(function(e){return e._selected=t.isSelected(e),e}),t.displayOptions.showSuggested=!0,t.suggested}).catch(function(e){return t.paging.total=0,t.notify("gp:browse:suggestions:pagination",t.paging),t.suggested=[],t.suggested}).finally(function(){return t.displayOptions.fetching=!1})},t.prototype.clearQuery=function(){this.query="",this.fetchOptions(this.query)},t.prototype.clearOptions=function(){this.query="",this.suggested=null,this.paging.start=0,this.paging.total=0,this.displayOptions.showSuggested=!1},t.prototype.remove=function(e){var t=this.ngModel[e].uri;if(this.ngModel.splice(e,1),this.suggested&&this.suggested.length){var n=this.suggested.find(function(e){return e.uri===t});n&&(n._selected=!1)}this.updateCache(),this.onChange&&this.onChange({values:this.ngModel})},t.prototype.isSelected=function(e){return e._selected||~this.selected.indexOf(e.uri)},t.prototype.selectValue=function(e){e._selected||(e._selected=!0,this.ngModel=this.ngModel||[],this.ngModel.push(e),this.updateCache(),this.onChange&&this.onChange({values:this.ngModel}))},t.prototype.updateCache=function(){this.selected=(this.ngModel||[]).map(function(e){return e.uri})},t.prototype.onDropdownToggled=function(e){e||this.clearOptions()},t.prototype.getPagination=function(){return this.paging},t.prototype.start=function(e){this.paging.start=e,this.fetchOptions(this.query)},t.prototype.size=function(e){this.paging.size=e,this.fetchOptions(this.query)},t}();e.module("gp-common-kg").component("kgSection",{bindings:{ngModel:"<",service:"<",label:"@",description:"@",type:"@",onChange:"&?",onActivate:"&?"},controller:n,template:'\n            <h5>{{$ctrl.label}}</h5>\n            <p class="u-text--sm" ng-bind-html="$ctrl.description"></p>\n\n            <div class="list-group list-group-sm">\n                <div ng-repeat="item in $ctrl.ngModel track by $index" class="list-group-item">\n                    <button type="button" class="btn btn-link" ng-click="$ctrl.remove($index)">\n                        <span class="glyphicon glyphicon-remove-circle t-fg--danger"></span> \n                    </button>\n                    <div class="flex-1 u-pd--md">\n                        <div class="u-pd-bottom--sm t-text--strong">\n                            <a ng-click="$ctrl.activate(item)" ng-if="$ctrl.onActivate"\n                                 class="u-break--all">{{item.label}}</a>\n                            <span ng-if="!$ctrl.onActivate">{{item.label}}</span>\n                        </div>\n                        <div class="u-text--sm t-text--italic">\n                            <a href="{{item.uri}}" target="_blank" class="u-break--all"\n                                title="Open source info in new window">{{item.uri}}</a>\n                        </div>\n                        <div class="description" ng-if="item.description" ng-bind-html="item.description"></div>\n                    </div>\n                </div>\n            </div>\n\n            <div class="t-fg--gray-md" ng-if="!$ctrl.ngModel.length"><em>No values specified</em></div>            \n\n            <hr>\n\n            <div uib-dropdown is-open="$ctrl.displayOptions.showSuggested" \n                auto-close="outsideClick" on-toggle="$ctrl.onDropdownToggled(open)">\n\n                <div class="l-flex-container flex-justify-between flex-align-center">\n                    <div class="input-group-slick flex-1">\n                        <span class="glyphicon"\n                            ng-class="{\'glyphicon-search\':!$ctrl.displayOptions.fetching, \'glyphicon-hourglass spin\':$ctrl.displayOptions.fetching}"></span>\n                        <input type="text" class="form-control" \n                            ng-model="$ctrl.query" \n                            ng-model-options="{ debounce: 250 }"\n                            ng-change="$ctrl.fetchOptions($ctrl.query)"\n                            placeholder="Find values to add...">\n                    </div>\n                </div>\n                \n                <div class="dropdown-menu" uib-dropdown-menu>\n                    \n                    <div class="form-group l-flex-container flex-justify-between flex-align-center">\n                        <div class="input-group-slick flex-1">\n                            <span class="glyphicon"\n                                ng-class="{\'glyphicon-search\':!$ctrl.displayOptions.fetching, \'glyphicon-hourglass spin\':$ctrl.displayOptions.fetching}"></span>\n                            <input type="text" class="form-control" \n                                ng-model="$ctrl.query" \n                                ng-model-options="{ debounce: 250 }"\n                                ng-change="$ctrl.fetchOptions($ctrl.query)"\n                                placeholder="Find values to add...">\n                            <span class="glyphicon glyphicon-remove"\n                                ng-if="$ctrl.query.length"\n                                ng-click="$event.stopPropagation();$ctrl.clearQuery()"></span>\n                        </div>\n                        <button type="button" class="btn btn-info u-mg-left--xlg animated-show"\n                            ng-click="$ctrl.clearOptions();">\n                            Done\n                        </button>\n                    </div>\n                    \n                    <gp-pagination service="$ctrl" event-key="suggestions" use-select="true"></gp-pagination>\n\n                    <div class="list-group list-group-sm u-text--sm">\n                        <div ng-repeat="item in $ctrl.suggested track by $index" class="list-group-item">\n                            <button type="button" class="btn btn-link" ng-click="$ctrl.selectValue(item)"\n                                ng-class="{disabled:item._selected}">\n                                <span class="glyphicon glyphicon-ok t-fg--gray-md" ng-show="item._selected"></span> \n                                <span class="glyphicon glyphicon-plus-sign t-fg--success" ng-show="!item._selected"></span> \n                            </button>\n                            <div class="flex-1 u-pd--md">\n                                <div class="u-break--all t-text--strong u-pd-bottom--sm">{{item.prefLabel}}</div>\n                                <a href="{{item.uri}}" target="_blank" \n                                    class="u-break--all u-text--sm t-text--italic"\n                                    title="Open source info in new window">\n                                    {{item.uri}}\n                                </a>\n                                <div class="description">{{item.description||"No description provided"}}</div>\n                            </div>\n                        </div>\n                        <div ng-if="!$ctrl.suggested.length" class="list-group-item disabled u-pd--md">\n                            No results match your query\n                        </div>\n                    </div>\n                </div>\n            </div>\n        '})}(angular,GeoPlatform),function(e,t){e.module("gp-common").component("communityFilter",{bindings:{name:"@",service:"<"},controller:["$http",function(e){this.$onInit=function(){this.collapse=!0,this.updateValues()},this.$onDestroy=function(){this.values=null},this.hasSelections=function(){return(this.service.getUsedBy()||[]).length},this.isSelected=function(e){return~(this.service.getUsedBy()||[]).indexOf(e.id)},this.toggle=function(e){var t=this.service.getUsedBy()||[],n=t.indexOf(e.id);n>=0?t.splice(n,1):t.push(e.id),this.service.setUsedBy(t)},this.clear=function(){var e=this.service.getUsedBy()||[];e&&e.length?this.service.setUsedBy([]):this.collapse=!this.collapse},this.getCount=function(e){var t=this.service.getFacet("usedBy.id");if(!t)return"";var n=t.buckets.find(function(t){return t.label===e.id});return n?n.count:""},this.updateValues=function(n){var i=this;return e.get(t.ualUrl+"/api/communities",{params:{sort:"label,asc",q:n,size:20,bust:(new Date).getTime()}}).then(function(e){var t=e.data.totalResults,n=e.data.results.slice(0);i.additionalValueCount=t-n.length;var s=i.service.getUsedBy();if(s&&s.length&&i.values&&i.values.length){var o=i.values.filter(function(e){return~s.indexOf(e.id)&&!n.filter(function(t){return t.id===e.id}).length});n=o.concat(n)}i.values=n}).catch(function(e){console.log("("+e.status+") "+e.statusText)})}}],
template:'\n            <div class="card c-query-filter">\n                <h5 class="card-title">\n                    <button type="button" class="btn btn-sm btn-link"\n                        title="{{$ctrl.collapse?\'Expand\':\'Collapse\'}}"\n                        ng-click="$ctrl.collapse = !$ctrl.collapse">\n                        <span class="glyphicon" ng-class="{\'glyphicon-minus\':!$ctrl.collapse,\'glyphicon-plus\':$ctrl.collapse}"></span>\n                    </button>\n                    <span class="flex-1">Filter by Communities</span>\n                </h5>\n                <div class="card-content">\n                    <div class="c-facets" ng-class="{\'is-collapsed\':$ctrl.collapse}">\n\n                        <div class="c-facet__value">\n                            <div class="input-group-slick">\n                                <input name="scheme-typeahead" type="text" class="form-control"\n                                    ng-model="$ctrl.typeaheadValue"\n                                    ng-change="$ctrl.updateValues($ctrl.typeaheadValue)"\n                                    ng-model-options="{debounce:200}"\n                                    placeholder="Search by name">\n                                <span class="glyphicon glyphicon-remove"\n                                    title="Clear query"\n                                    ng-if="$ctrl.typeaheadValue.length"\n                                    ng-click="$ctrl.updateValues($ctrl.typeaheadValue=null)">\n                                </span>\n                            </div>\n                        </div>\n\n                        <a class="c-facet__value" ng-click="$ctrl.clear()"\n                            ng-class="{active:!$ctrl.hasSelections()}">\n                            <span class="glyphicon"\n                                ng-class="{\'glyphicon-check\':!$ctrl.hasSelections(), \'glyphicon-unchecked t-fg--gray-lt\':$ctrl.hasSelections()}">\n                            </span>\n                            Any Community\n                        </a>\n                        <a  ng-repeat="value in $ctrl.values track by $index"\n                            class="c-facet__value"\n                            ng-click="$ctrl.toggle(value)"\n                            ng-class="{active:$ctrl.isSelected(value)}">\n\n                            <span class="badge pull-right">{{$ctrl.getCount(value)}}</span>\n                            <span class="glyphicon"\n                                ng-class="{\'glyphicon-check\':$ctrl.isSelected(value),\'glyphicon-unchecked t-fg--gray-lt\':!$ctrl.isSelected(value)}"></span>\n                            {{value.label}}\n                        </a>\n                        <div class="c-facet__value t-fg--gray-md"\n                            ng-if="$ctrl.additionalValueCount">\n                            <em>plus {{$ctrl.additionalValueCount}} more options</em>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        '})}(angular,GeoPlatform);var __extends=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();!function(e){var t=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.$inject=["$rootScope","AuthenticationService"],t.prototype.$onInit=function(){e.prototype.$onInit.call(this),this.value=null,this.collapse=!0,this.limitToUser=!1,this.modelOptions={updateOn:"default blur",debounce:{default:250,blur:0}}},t.prototype.$onDestroy=function(){e.prototype.$onDestroy.call(this),this.value=null,this.collapse=null,this.limitToUser=null,this.username=null},t.prototype.onAuthEvent=function(t,n){e.prototype.onAuthEvent.call(this,t,n),!n&&this.limitToUser&&(this.limitToUser=null,this.filter())},t.prototype.filter=function(){var e=this.limitToUser?this.authState.user.username:this.value;void 0!==e&&null!==e&&0===e.trim().length&&(e=null),this.service.setCreatedBy(e,!0)},t.prototype.toggleLimitToUser=function(){this.limitToUser=!this.limitToUser,this.filter()},t.prototype.clear=function(){this.value=null,this.filter()},t}(GeoPlatform.AuthenticatedComponent);e.module("gp-common").component("createdByFilter",{bindings:{service:"<"},controller:t,template:'\n            <div class="card c-query-filter">\n                <h5 class="card-title">\n                    <button type="button" class="btn btn-sm btn-link"\n                        title="{{$ctrl.collapse?\'Expand\':\'Collapse\'}}"\n                        ng-click="$ctrl.collapse = !$ctrl.collapse">\n                        <span class="glyphicon" ng-class="{\'glyphicon-minus\':!$ctrl.collapse,\'glyphicon-plus\':$ctrl.collapse}"></span>\n                    </button>\n                    <span class="flex-1">Filter by Author</span>\n                </h5>\n                <div class="card-content">\n\n                    <div class="c-facets" ng-hide="$ctrl.collapse">\n\n                        <div class="input-group-slick">\n                            <span class="glyphicon glyphicon-user"></span>\n                            <input type="text" class="form-control" placeholder="Specify author username"\n                                ng-disabled="$ctrl.limitToUser"\n                                ng-model="$ctrl.value"\n                                ng-model-options="$ctrl.modelOptions"\n                                ng-change="$ctrl.filter()">\n                            <span class="glyphicon glyphicon-remove" title="Clear author"\n                                ng-if="$ctrl.value.length&&!$ctrl.limitToUser" ng-click="$ctrl.clear()"></span>\n                        </div>\n\n                        <label class="control-label u-text--sm text-muted u-pd-top--sm" ng-if="$ctrl.isAuthenticated()">\n                            <input type="checkbox" ng-model="$ctrl.limitToUser" ng-change="$ctrl.filter()">\n                            Only show my items\n                        </label>\n\n                    </div>\n                </div>\n            </div>\n        '})}(angular),function(e,t){e.module("gp-common").component("publisherFilter",{bindings:{name:"@",service:"<"},controller:["$http",function(e){this.$onInit=function(){this.collapse=!0,this.updateValues()},this.$onDestroy=function(){this.values=null},this.hasSelections=function(){return(this.service.getAgencies()||[]).length},this.isSelected=function(e){return~(this.service.getAgencies()||[]).indexOf(e.id)},this.toggle=function(e){var t=this.service.getAgencies()||[],n=t.indexOf(e.id);n>=0?t.splice(n,1):t.push(e.id),this.service.setAgencies(t)},this.clear=function(){var e=this.service.getAgencies()||[];e&&e.length?this.service.setAgencies([]):this.collapse=!this.collapse},this.getCount=function(e){var t=this.service.getFacet("publishers");if(!t)return"";var n=t.buckets.find(function(t){return t.label===e.id});return n?n.count:""},this.updateValues=function(n){var i=this;return e.get(t.ualUrl+"/api/items",{params:{type:"org:Organization",sort:"label,asc",q:n,size:20,bust:(new Date).getTime()}}).then(function(e){var t=e.data.totalResults,n=e.data.results.slice(0);i.additionalValueCount=t-n.length;var s=i.service.getAgencies();if(s&&s.length&&i.values&&i.values.length){var o=i.values.filter(function(e){return~s.indexOf(e.id)&&!n.filter(function(t){return t.id===e.id}).length});n=o.concat(n)}i.values=n},function(e){console.log("("+e.status+") "+e.statusText)})}}],template:'\n            <div class="card c-query-filter">\n                <h5 class="card-title">\n                    <button type="button" class="btn btn-sm btn-link"\n                        title="{{$ctrl.collapse?\'Expand\':\'Collapse\'}}"\n                        ng-click="$ctrl.collapse = !$ctrl.collapse">\n                        <span class="glyphicon" ng-class="{\'glyphicon-minus\':!$ctrl.collapse,\'glyphicon-plus\':$ctrl.collapse}"></span>\n                    </button>\n                    <span class="flex-1">Filter by Publishers</span>\n                </h5>\n                <div class="card-content">\n                    <div class="c-facets" ng-class="{\'is-collapsed\':$ctrl.collapse}">\n\n                        <div class="c-facet__value">\n                            <div class="input-group-slick">\n                                <input name="scheme-typeahead" type="text" class="form-control"\n                                    ng-model="$ctrl.typeaheadValue"\n                                    ng-change="$ctrl.updateValues($ctrl.typeaheadValue)"\n                                    ng-model-options="{debounce:200}"\n                                    placeholder="Search by name">\n                                <span class="glyphicon glyphicon-remove"\n                                    title="Clear query"\n                                    ng-if="$ctrl.typeaheadValue.length"\n                                    ng-click="$ctrl.updateValues($ctrl.typeaheadValue=null)">\n                                </span>\n                            </div>\n                        </div>\n\n                        <a class="c-facet__value" ng-click="$ctrl.clear()"\n                            ng-class="{active:!$ctrl.hasSelections()}">\n                            <span class="glyphicon"\n                                ng-class="{\'glyphicon-check\':!$ctrl.hasSelections(), \'glyphicon-unchecked t-fg--gray-lt\':$ctrl.hasSelections()}">\n                            </span>\n                            Any Publisher\n                        </a>\n                        <a  ng-repeat="value in $ctrl.values track by $index"\n                            class="c-facet__value"\n                            ng-click="$ctrl.toggle(value)"\n                            ng-class="{active:$ctrl.isSelected(value)}">\n\n                            <span class="badge pull-right">{{$ctrl.getCount(value)}}</span>\n                            <span class="glyphicon"\n                                ng-class="{\'glyphicon-check\':$ctrl.isSelected(value),\'glyphicon-unchecked t-fg--gray-lt\':!$ctrl.isSelected(value)}"></span>\n                            {{value.label}}\n                        </a>\n                        <div class="c-facet__value t-fg--gray-md"\n                            ng-if="$ctrl.additionalValueCount">\n                            <em>plus {{$ctrl.additionalValueCount}} more options</em>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        '})}(angular,GeoPlatform),function(e){var t=function(){function t(e,t){"ngInject";this.termService=t,this.$timeout=e}return t.$inject=["$timeout","RecommenderService"],t.prototype.$onInit=function(){this.displayOpts={fetching:!1,empty:!1,collapse:!1,suggest:!1},this.values=[],this.suggested=[],this.termQuery=null,this.paging={start:0,size:5,sizeOptions:[5,10,20]}},t.prototype.$onDestroy=function(){this.$timeout=null,this.displayOpts=null,this.values=null,this.suggested=null,this.service=null,this.termService=null,this.termQuery=null,this.paging=null,this.eventHandlers=null},t.prototype.hideSuggested=function(){this.displayOpts.suggest=this.displayOpts.fetching=this.displayOpts.empty=!1,this.termQuery=null,this.suggested=[],this.paging.start=this.paging.total=0},t.prototype.select=function(e){e._selected=!0,this.values.push(e),this.update()},t.prototype.getOptions=function(){var e=this,t=this.termQuery;if(!t||!t.length)return this.suggested=[],this.paging.start=this.paging.total=0,void this.notify("gp:browse:suggestions:pagination",this.paging);this.suggested=[],this.displayOpts.suggest=!0,this.displayOpts.fetching=!0,this.displayOpts.empty=!1;var n={q:t,page:Math.floor(this.paging.start/this.paging.size),size:this.paging.size};this.type&&(n.for=this.type),this.termService.query(n).$promise.then(function(t){var n=t.results;e.displayOpts.empty=!n.length,e.suggested=n.map(function(t){return t._selected=e.isSelected(t),t}),e.paging.total=t.totalResults,e.notify("gp:browse:suggestions:pagination",e.paging)}).catch(function(t){e.displayOpts.empty=!0,e.suggested=[],e.paging.total=0,e.notify("gp:browse:suggestions:pagination",e.paging),console.log("Error finding semantic terms: "+t.message)}).finally(function(){e.displayOpts.fetching=!1})},t.prototype.hasSelections=function(){return this.values.length},t.prototype.isSelected=function(e){return this.values.filter(function(t){return t.uri===e.uri}).length},t.prototype.removeValue=function(e){if(this.values.length>=e){var t=this.values.splice(e,1)[0];if(this.update(),this.suggested.length){var n=this.suggested.find(function(e){return e.uri===t.uri});n&&(n._selected=!1)}}},t.prototype.clear=function(){this.values=[],this.update()},t.prototype.update=function(){var e=this.values.length?this.values.map(function(e){return e.uri}):null;this.service.applyOption("concepts",e,!0)},t.prototype.on=function(e,t){this.eventHandlers=this.eventHandlers||{},this.eventHandlers[e]=this.eventHandlers[e]||[],this.eventHandlers[e].push(t)},t.prototype.notify=function(t,n){var i=this;this.$timeout&&this.eventHandlers&&this.eventHandlers[t]&&this.$timeout(function(){e.forEach(i.eventHandlers[t],function(e){try{e(n)}catch(e){}})},100)},t.prototype.getPagination=function(){return this.paging},t.prototype.start=function(e){this.paging.start=e,this.getOptions()},t.prototype.size=function(e){this.paging.size=e,this.getOptions()},t}();e.module("gp-common").component("recommendedTermFilter",{bindings:{type:"@",service:"<"},controller:t,template:'\n            <div class="card c-query-filter c-filter__recommended-terms">\n\n                <h5 class="card-title">\n                    <button type="button" class="btn btn-sm btn-link"\n                        title="{{$ctrl.displayOpts.collapse?\'Expand\':\'Collapse\'}}"\n                        ng-click="$ctrl.displayOpts.collapse = !$ctrl.displayOpts.collapse">\n                        <span class="glyphicon"\n                            ng-class="{\'glyphicon-minus\':!$ctrl.displayOpts.collapse,\'glyphicon-plus\':$ctrl.displayOpts.collapse}"></span>\n                    </button>\n                    <span>Filter using Semantic Concepts</span>\n                </h5>\n\n                <div class="c-facets" ng-class="{\'is-collapsed\':$ctrl.displayOpts.collapse}">\n\n                    \x3c!--\n                    <div class="c-facet__value">\n\n                        <div class="input-group-slick">\n                            <input name="termQuery" type="text" class="form-control"\n                              ng-model="$ctrl.termQuery"\n                              typeahead-on-select="$ctrl.onSelection($item, $model, $label, $event)"\n                              uib-typeahead="opt as \' (\' + opt.context + \') \' + opt.label for opt in $ctrl.getOptions($viewValue)"\n                              typeahead-loading="$ctrl.displayOpts.fetching"\n                              typeahead-no-results="$ctrl.displayOpts.empty"\n                              ng-model-options="{ debounce: 250 }"\n                              typeahead-min-length="2"\n                              typeahead-editable="false"\n                              placeholder="Find a concept">\n                            <span class="glyphicon glyphicon-hourglass spin" ng-if="$ctrl.displayOpts.fetching"></span>\n                        </div>\n\n                        <div ng-show="$ctrl.displayOpts.empty">No Results Found</div>\n\n                    </div>\n                    --\x3e\n\n                    <div ng-hide="$ctrl.displayOpts.collapse">\n\n                        <div class="input-group-slick">\n                            <span class="glyphicon"\n                                ng-class="{\'glyphicon-search\':!$ctrl.displayOpts.fetching, \'glyphicon-hourglass spin\':$ctrl.displayOpts.fetching}"></span>\n                            <input type="text" class="form-control"\n                                ng-model="$ctrl.termQuery"\n                                ng-model-options="{ debounce: 250 }"\n                                ng-change="$ctrl.getOptions()"\n                                placeholder="Find concepts">\n                            <span class="glyphicon glyphicon-remove" ng-if="$ctrl.displayOpts.suggest"\n                                ng-click="$ctrl.hideSuggested()"></span>\n                        </div>\n\n                        <gp-pagination service="$ctrl" event-key="suggestions" use-select="true"\n                            ng-if="$ctrl.displayOpts.suggest">\n                        </gp-pagination>\n\n                        <div class="list-group list-group-sm u-text--sm"\n                            ng-if="$ctrl.displayOpts.suggest && !$ctrl.displayOpts.fetching">\n\n                            <a ng-repeat="item in $ctrl.suggested track by $index"\n                                class="list-group-item"\n                                ng-class="{disabled:item._selected}"\n                                ng-click="$ctrl.select(item)">\n                                <span class="u-break--all t-text--strong u-pd-bottom--sm">{{item.prefLabel}}</span>\n                                <br>\n                                <span class="u-break--all u-text--sm t-text--italic">{{item.uri}}</span>\n                            </a>\n\n                            <div ng-if="$ctrl.displayOpts.empty" class="list-group-item disabled u-pd--md">\n                                No concepts found\n                            </div>\n\n                        </div>\n\n                    </div>\n\n\n                    \x3c!-- selected terms --\x3e\n                    <div ng-repeat="term in $ctrl.values" class="c-facet__value active"\n                        title="Remove this term from the query"\n                        ng-click="$ctrl.removeValue($index)">\n\n                        <div class="u-break--all t-text--strong u-pd-bottom--sm">\n                            <span class="glyphicon glyphicon-check"></span>\n                            {{term.prefLabel}}\n                        </div>\n                        <div class="u-break--all u-text--sm t-text--italic">{{term.uri}}</div>\n                    </div>\n\n                </div>\n\n            </div>\n        '})}(angular),function(e){e.module("gp-common").component("similarityFilter",{bindings:{type:"@",service:"<",mapId:"@"},controller:function(){this.$onInit=function(){var e=this;this.collapse=!0,this.value=null,this.useMap=!1;var t=this.service.events.SIMILARITY;this.listener=this.service.on(t,function(t,n){e.value=n,e.service.applyOption("similarTo",e.value.id,!0)}),this.type||(this.type="item")},this.$onDestroy=function(){this.listener(),this.collapse=null,this.value=null,this.service=null,this.mapId=null},this.hasSelections=function(){return!!this.value},this.clearValue=function(){this.useMap?(this.useMap=!1,this.service.applyOption("similarTo",this.value.id,!0)):(this.value=null,this.service.applyOption("similarTo",null,!0))},this.toggleCurrentMap=function(e){this.useMap?(this.useMap=!1,this.value?this.service.applyOption("similarTo",this.value.id,!0):this.service.applyOption("similarTo",!1,!0)):(this.useMap=!0,this.service.applyOption("similarTo",this.mapId,!0))}},template:'\n            <div class="card c-query-filter" ng-if="$ctrl.value">\n\n                <h5 class="card-title">Find Similar</h5>\n                <div class="card-content">\n\n                    <p class="u-text--sm">Searching for {{$ctrl.type}}s similar to the following: </p>\n\n                    <div class="c-facets">\n\n                        <a class="c-facet__value" ng-if="$ctrl.value" ng-click="$ctrl.clearValue()">\n                            <span class="glyphicon glyphicon-remove-circle"></span>\n                            {{$ctrl.value.label}}\n                        </a>\n\n                        \x3c!--\n                        <a ng-if="$ctrl.mapId" class="c-facet__value"\n                            ng-click="$ctrl.toggleCurrentMap()" ng-class="{active:$ctrl.useMap}">\n                            <span class="glyphicon glyphicon-check" ng-show="$ctrl.useMap"></span>\n                            <span class="glyphicon glyphicon-unchecked" ng-show="!$ctrl.useMap"></span>\n                            Find similar to my current map\n                        </a>\n                        --\x3e\n\n                    </div>\n\n                    <br>\n                    <p class="u-text--sm">Note that query filters below are still being applied.</p>\n\n                </div>\n            </div>\n        '})}(angular),function(e,t){e.module("gp-common").component("themeFilter",{bindings:{name:"@",service:"<"},controller:["$http",function(e){this.$onInit=function(){this.collapse=!0,this.updateValues()},this.$onDestroy=function(){this.values=null,this.service=null},this.hasSelections=function(){return(this.service.getThemes()||[]).length},this.isSelected=function(e){return~(this.service.getThemes()||[]).indexOf(e.id)},this.toggle=function(e){var t=this.service.getThemes()||[],n=t.indexOf(e.id);n>=0?t.splice(n,1):t.push(e.id),this.service.setThemes(t)},this.clear=function(){var e=this.service.getThemes()||[];e&&e.length?this.service.setThemes([]):this.collapse=!this.collapse},this.getCount=function(e){var t=this.service.getFacet("themes");if(!t)return"";var n=t.buckets.find(function(t){return t.label===e.id});return n?n.count:""},this.updateValues=function(n){var i=this;return e.get(t.ualUrl+"/api/items",{params:{type:"skos:Concept","scheme.label":"NGDA Portfolio Themes",fields:"scheme",size:9999,sort:"label,asc",bust:(new Date).getTime()}}).then(function(e){i.values=e.data.results.slice(0)},function(e){console.log("("+e.status+") "+e.statusText)}).catch(function(e){console.log("Error fetching NGDA Themes: "+e.message)})}}],template:'\n            <div class="card c-query-filter c-browse-filter">\n                <h5 class="card-title">\n                    <button type="button" class="btn btn-sm btn-link"\n                        title="{{$ctrl.collapse?\'Expand\':\'Collapse\'}}"\n                        ng-click="$ctrl.collapse = !$ctrl.collapse">\n                        <span class="glyphicon" ng-class="{\'glyphicon-minus\':!$ctrl.collapse,\'glyphicon-plus\':$ctrl.collapse}"></span>\n                    </button>\n                    <span>Filter by NGDA Themes</span>\n                </h5>\n                <div class="card-content">\n                    <div class="c-facets" ng-class="{\'is-collapsed\':$ctrl.collapse}">\n                        <a class="c-facet__value" ng-click="$ctrl.clear()"\n                            ng-class="{active:!$ctrl.hasSelections()}">\n                            <span class="glyphicon"\n                                ng-class="{\'glyphicon-check\':!$ctrl.hasSelections(), \'glyphicon-unchecked t-fg--gray-lt\':$ctrl.hasSelections()}">\n                            </span>\n                            Any Theme\n                        </a>\n                        <a ng-repeat="theme in $ctrl.values track by $index"\n                            class="c-facet__value" ng-click="$ctrl.toggle(theme)"\n                            ng-class="{active:$ctrl.isSelected(theme)}">\n                                <span class="badge pull-right">{{$ctrl.getCount(theme)}}</span>\n                                <span class="glyphicon"\n                                    ng-class="{\'glyphicon-check\':$ctrl.isSelected(theme),\'glyphicon-unchecked t-fg--gray-lt\':!$ctrl.isSelected(theme)}"></span>\n                                {{theme.label}}\n                            </a>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        '})}(angular,GeoPlatform),function(e,t){function n(n,i,w,_){function x(e,t){n.$broadcast(e,t)}function C(e,t){var n=void 0===t||!0===t;G&&i.cancel(G),G=i(function(){G=null,T(n)},e||100)}function T(t){t&&(M.start=0),R=!0,x(E+"querying");var n={},i=e.copy(M);e.forEach(k,function(e){var t=e.parameter,s=i[e.option],o=null!==s&&void 0!==s,r=o&&void 0!==s.push;!o||r&&!s.length?delete n[t]:n[t]=r?s.join(","):s,delete i[e.option]}),e.forEach(i,function(e,t){if(null!==e&&void 0!==e){var i=void 0!==e.push;n[t]=i?e.join(","):e}else delete n[t]});var s=[];for(var o in M.facets)M.facets.hasOwnProperty(o)&&s.push(o+":"+M.facets[o].replace(/,/g,"%2C"));j=s;var r=M.start;isNaN(r)?r=0:r*=1,n.page=Math.floor(r/M.size),n.size=M.size,n.sort=M.sort,s.length&&(n.facets=s.join(",")),n.bust=(new Date).getTime(),n.includeFacet=U.join(","),n.fields=z.join(","),L.query(n).$promise.then(function(e){V=e.results,D=e.facets||[],q.each(function(e){var t=V.find(function(t){return t._id===e});t&&(t.selected=!0)}),M.total=e.totalResults,R=!1,x(E+"results"),x(E+"pagination")}).catch(function(e){R=!1;var t={error:"An Error Occurred",message:"No details provided"};if(e&&e.data?t=e.data:e&&e.message&&(t=e),"string"==typeof t)try{t=JSON.parse(t)}catch(e){t.message="Bad response from server"}var n={label:t.error||"An Error Occurred",message:t.message||"No details provided"};x(E+"error",n)})}function A(e,t,n){if(M[e]=t,void 0===n||n){var i=500;null!==t&&void 0!==t||(i=0),t&&void 0!==t.push&&t.length?i=0:t&&t.length&&(i=0),C(i)}}var I=_&&_.url?_.url+"/:id":t.ualUrl+"/api/items/:id",E="gp:browse:"+(_&&_.key?_.key:"objects")+":",L=w(I,{id:"@id"},{query:{isArray:!1}}),P=S.slice(0);_&&_.pageSizeBase&&12===_.pageSizeBase&&(P=O.slice(0));var M={start:0,size:P[0],total:0,sort:_&&_.sort?_.sort:"modified,desc",facets:{}},z=_&&_.fields?_.fields:s.slice(0),U=_&&_.facets?_.facets:o.slice(0),D=[],j=[],V=[],G=null,R=!1,q=[],N=_&&_.onSelect?_.onSelect:null;return{events:{LOADING:E+"querying",RESULTS:E+"results",PAGINATION:E+"pagination",SELECTED:E+"selected",ERROR:E+"error",SELECTED_ADDED:E+"selected:added",SELECTED_REMOVED:E+"selected:removed",SIMILARITY:E+"similarTo"},getLoadingStatus:function(){return R},on:function(e,t){return n.$on(e,t)},trigger:function(e,t){x(e,t)},getResults:function(){return V},getFacetNames:function(){return o.slice(0)},getFacets:function(){return D},getFacet:function(e){return D?D.find(function(t){return t.name===e}):null},addFacet:function(e){U.push(e)},applyConstraints:function(e){for(var t in e)e.hasOwnProperty(t)&&(M[t]=e[t]);T(!0)},applyOption:function(e,t,n){A(e,t,n)},applyOptions:function(t,n){e.forEach(t,function(e,t){A(t,e,!1)}),n&&T(!0)},setQuery:function(e,t){A(v,e,t)},getQuery:function(){return M[v]},setTypes:function(e,t){A(l,e,t)},getTypes:function(){return M[l]},setUser:function(e,t){A(p,e,t)},getUser:function(){return M[p]},setCreatedBy:function(e,t){A(d,e,t)},getCreatedBy:function(){return M[d]},setThemes:function(e,t){A(a,e,t)},getThemes:function(){return M[a]},setAgencies:function(e,t){A(c,e,t)},getAgencies:function(){return M[c]},setUsedBy:function(e,t){A(u,e,t)},getUsedBy:function(){return M[u]},setServiceTypes:function(e,t){A(g,e,t)},getServiceTypes:function(){return M[g]},setResourceTypes:function(e,t){A($,e,t)},getResourceTypes:function(){return M[$]},setSchemes:function(e,t){A(h,e,t)},getSchemes:function(){return M[h]},setVisibility:function(e,t){A(f,e,t)},getVisibility:function(){return M[f]},setModified:function(e,t,n){if(!e)return A(y,null,!1),void A(b,null,!0);var i=t&&(!0===t||"true"===t),s=i?y:b,o=i?b:y,r=e&&e.getTime?e.getTime():e;A(o,null,!1),A(s,r,!0)},getModified:function(){return this._options[y]||this._options[b]},setExtent:function(e){A(m,e,!0)},getExtent:function(){return M[m]},getSelected:function(){return q},setSelected:function(e){q=e,x(this.events.SELECTED,q)},select:function(e){var t=function(t){return t.id===e},n=q.find(t);if(n){var i=q.indexOf(n);i>=0&&(q.splice(i,1),x(E+"selected:removed",n))}else{var s=V.find(t);s&&(N?N(e,function(e,t){t&&(q.unshift(t),x(E+"selected:added",t))}):(q.unshift(s),x(E+"selected:added",s)))}x(this.events.SELECTED,q)},isSelected:function(e){return q.find(function(t){return t.id===e})},selectAll:function(){var t=this;e.forEach(V,function(e){t.isSelected(e.id)||q.unshift(e)}),x(this.events.SELECTED,q)},clearSelected:function(){q=[],x(this.events.SELECTED,[])},clear:function(e){for(var t in M)M.hasOwnProperty(t)&&("start"===t?M[t]=0:"size"===t||(M[t]="sort"===t?"modified,desc":"facets"===t?{}:null));(e||void 0===e)&&T(!0)},setFacet:function(e,t){var n=M.facets[e];n&&n===t?delete M.facets[e]:M.facets[e]=t,T(!0)},setFields:function(e){e&&void 0!==e.push&&(z=e)},start:function(e,t){M.start=e,t&&!0===t&&T(!1)},size:function(e,t){M.size=e;var n=Math.floor(1*M.start/M.size*1);M.start=n*(1*M.size),t&&!0===t&&T(!1)},pageSize:function(e){this.size(e,!0)},sort:function(e){M.sort=e,T(!1)},getPagination:function(){return{start:M.start,size:M.size,pageSize:M.size,total:M.total,sizeOptions:P}},getSortOptions:function(){return r.slice(0)},getSortValue:function(){return M.sort},getQueryOptions:function(){return jQuery.extend({},M)},hasQueryOptions:function(){var e=!1;for(var t in M)if(M.hasOwnProperty(t)){if("start"===t||"size"===t||"total"===t||"sort"===t||"order"===t||"within"===t||"facets"===t)continue;j.length&&(e=!0),void 0!==M[t]&&null!==M[t]&&(e=!0)}return e},update:function(e){C(0,e)},reset:function(){M={start:0,size:P[0],total:0,sort:"modified,desc",order:"asc",facets:{}},D=[],j=[],V=[],R=!1,q=[],G&&i.cancel(G),G=null},destroy:function(){G&&i.cancel(G)}}}function i(e,t,i){return function(s){var o=n(e,t,i,s);return s&&s.params&&o.applyOptions(s.params),o}}var s=["created","modified","publishers","themes","description","extent"],o=["types","themes","publishers","serviceTypes","schemes","visibility","createdBy"],r=[{value:"label,asc",label:"Name (A-Z)"},{value:"label,desc",label:"Name (Z-A)"},{value:"type,asc",label:"Type (A-Z)"},{value:"type,desc",label:"Type (Z-A)"},{value:"modified,desc",label:"Most recently modified"},{value:"modified,asc",label:"Least recently modified"},{value:"_score,desc",label:"Relevance"}],l="types",a="themes",c="publishers",u="usedBy",p="user",d="createdBy",g="serviceTypes",h="schemes",f="visibility",v="query",m="bbox",y="modified.max",b="modified.min",$="resourceTypes",k=[{option:l,parameter:"type"},{option:a,parameter:"theme.id"},{option:c,parameter:"publisher.id"},{option:u,parameter:"usedBy.id"},{option:p,parameter:"creator.id"},{option:d,parameter:"createdBy"},{option:g,parameter:"serviceType.id"},{option:h,parameter:"scheme.id"},{option:f,parameter:"visibility"},{option:v,parameter:"q"},{option:m,parameter:"extent"},{option:y,parameter:"modified.max"},{option:b,parameter:"modified.min"},{option:$,parameter:"resourceType"}],S=[10,20,50,100],O=[12,24,48,96];e.module("gp-common").service("BrowseObjectsService",["$rootScope","$timeout","$resource",n]).factory("BrowseServiceFactory",["$rootScope","$timeout","$resource","BrowseObjectsService",i])}(angular,GeoPlatform),function(e){var t=function(){function t(e,t){"ngInject";var n=this,i="object"===(void 0===t?"undefined":_typeof(t))?t:{};for(var s in i)this[s]=i[s];return this.socket=null,this.tracking={},this.events={CREATED:"created",UPDATED:"updated",DELETED:"deleted",EDITING:"editing",STATUS:"status"},"undefined"==typeof io?void console.log("Socket.IO not found in global namespace"):e?(this.socket=io.connect(e),this.socket.on("init",function(e){n.socketId=e.id}),void this.socket.on("error",function(){console.log("Unable to connect to "+e+" with websockets")})):void console.log("No web socket URL configured for this app to communicate with")}return t.$inject=["url","options"],t.prototype.getId=function(){return this.socketId},t.prototype.on=function(e,t){var n=this;return this.socket?(this.socket.on(e,t),function(){n.socket.off(e,t)}):function(){}},
t.prototype.emit=function(e,t,n){this.socket&&this.socket.emit(e,t,n)},t.prototype.close=function(){var t=this;for(var n in this.tracking)if(this.tracking.hasOwnProperty(n)){var i=this.tracking[n];i&&i.length&&e.forEach(i,function(e){t.end(n,e)})}return this.socket&&(this.socket.close(),this.socket=null),null},t.prototype.begin=function(e,t){var n=this;this.tracking[e]=this.tracking[e]||[],this.tracking[e].push(t);var i=t+"_"+e.toLowerCase();this.join(i,function(){n.socket.emit(e,i,n.socketId,!0)})},t.prototype.end=function(e,t){var n=this;if(this.tracking[e]=this.tracking[e]||[],this.tracking[e].length){var i=this.tracking[e].indexOf(t);i<0&&this.tracking[e].splice(i,1);var s=t+"_"+e.toLowerCase();this.socket.emit(e,s,this.socketId,!1,function(){n.leave(s)})}},t.prototype.join=function(e,t){this.emit("join",e,t)},t.prototype.leave=function(e,t){this.emit("leave",e,t)},t}();e.module("gp-common").factory("SocketServiceFactory",["$rootScope","$window","UUID",function(e,n,i){var s={},o=function(e){for(var t in s)s.hasOwnProperty(t)&&(s[t].close(),s[t]=null);return s=null,null};if("function"===n.onbeforeunload){var r=n.onbeforeunload;n.onbeforeunload=function(e){return o(),r(e)}}else n.onbeforeunload=o;return e.$on("$destroy",o),function(n){var o=i(),r=new t(n,e,{cacheRef:o}),l=r.close;r.close=function(){var e=r.cacheRef;l.call(r),delete s[e]};var a=r.on;r.on=function(t,n){if("function"==typeof n){var i=function(){var t=arguments;e.$apply(function(){n.apply(r.socket,t)})};return a.call(r,t,i)}return a.call(r,t)};var c=r.emit;return r.emit=function(t,n,i){if("function"==typeof i){var s=function(){var t=arguments;e.$apply(function(){i.apply(r.socket,t)})};c.call(r,t,n,s)}else c.call(r,t,n)},s[o]=r,r}}])}(angular),function(e){e.module("gp-common").factory("UUID",function(){return function(){for(var e=[],t="0123456789abcdef",n=0;n<36;n++)e[n]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}})}(angular),function(){void 0===Array.prototype.find&&(Array.prototype.find=function(e){for(var t=0;t<this.length;++t)if(e(this[t],t,this))return this[t];return null}),void 0===Array.prototype.filter&&(Array.prototype.filter=function(e){for(var t=[],n=0;n<this.length;++n)e(this[n],n,this)&&t.push(this[n]);return t}),void 0===Array.prototype.each&&(Array.prototype.each=function(e){for(var t=0;t<this.length;++t)e(this[t],t,this)}),void 0===Array.prototype.indexOfObj&&(Array.prototype.indexOfObj=function(e,t){var n=this,i=n.length;"function"!=typeof t&&(t=function(e,t){return e===t});for(var s=0;s<i;++s)if(t(e,n[s]))return s;return-1}),void 0===String.prototype.startsWith&&(String.prototype.startsWith=function(e){var t=this;return!!t.length&&(!!e.length&&(!(t.length<e.length)&&0===t.indexOf(e)))}),void 0===String.prototype.endsWith&&(String.prototype.endsWith=function(e){var t=this;return!!t.length&&(!!e.length&&(!(t.length<e.length)&&t.substring(t.length-e.length,t.length)==e))}),void 0===Date.prototype.plus&&(Date.prototype.plus=function(e){var t=void 0===e?"undefined":_typeof(e);if("undefined"===t)return this;var n=0;if("string"===t)switch(e){case"hour":n=36e5;break;case"day":n=864e5;break;case"week":n=6048e5;break;case"month":n=26784e5;break;case"year":n=31536e6}else{if("number"!==t)return this;n=e}var i=this;return new Date(i.getTime()+n)}),void 0===Date.prototype.random&&(Date.prototype.random=function(e){var t=void 0===e?"undefined":_typeof(e);if("undefined"===t)return this;var n=0;if("string"===t)switch(e){case"hour":n=36e5;break;case"day":n=864e5;break;case"week":n=6048e5;break;case"month":n=26784e5;break;case"year":n=31536e6}else{if("number"!==t)return this;n=e}var i=this;return new Date(i.getTime()+Math.floor(Math.random()*n))})}(),function(e){function t(){var e=window.location.hash?window.location.hash:window.location.href,t=e.match(/access_token=([^\&]*)/);return t&&t[1]}e.module("gp-common").service("AuthenticationService",["$q","$http","$location","$rootScope","$window","GPConfig",function(e,n,i,s,o,r){Storage.prototype.saveToLocalStorage=function(e,t){this.setItem(e,btoa(t))},Storage.prototype.getFromLocalStorage=function(e){var t=this.getItem(e);try{return t?atob(t):void 0}catch(e){return}};var l=function(){function e(e){this.id=e.sub,this.username=e.username,this.name=e.name,this.email=e.email,this.org=e.orgs[0]&&e.orgs[0].name,this.groups=e.groups,this.roles=e.roles,this.exp=e.exp}return e.prototype.toJSON=function(){return JSON.parse(JSON.stringify(_extends({},this)))},e.prototype.clone=function(){return _extends({},this)},e.prototype.compare=function(t){return t instanceof e?this.id===t.id:"object"===(void 0===t?"undefined":_typeof(t))&&(void 0!==t.id&&t.id===this.id)},e.prototype.isAuthorized=function(e){var t=r.env||r.ENV||r.NODE_ENV;return("dev"===t||"development"===t)&&void 0!==r.ALLOW_DEV_EDITS||this.groups&&!!this.groups.map(function(e){return e.name}).filter(function(t){return t===e}).length},e}();return new(function(){function a(){var e=this;addEventListener("message",function(t){"iframe:userAuthenticated"===t.data&&e.init(),"userSignOut"===t.data&&e.removeAuth()}),e.init()||"grant"!==r.AUTH_TYPE||e.ssoCheck()}return a.prototype.ssoCheck=function(){var e=this;addEventListener("message",function(t){"iframe:ssoFailed"===t.data&&(n.remove(),r.FORCE_LOGIN&&e.forceLogin()),"iframe:userAuthenticated"===t.data&&n.remove()});var t="/login?sso=true&cachebuster="+(new Date).getTime(),n=this.createIframe(t)},a.prototype.init=function(){var e=this.getJWT();return e&&this.setAuth(e),t()&&(window.history&&window.history.replaceState?window.history.replaceState({},"Remove token from URL",o.location.href.replace(/[\?\&]access_token=.*\&token_type=Bearer/,"")):o.location.search.replace(/[\?\&]access_token=.*\&token_type=Bearer/,"")),this.getUserFromJWT(e)},a.prototype.createIframe=function(e){var t=document.createElement("iframe");return t.style.display="none",t.src=e,document.body.appendChild(t),t},a.prototype.login=function(){"token"===r.AUTH_TYPE?window.location.href=r.IDP_BASE_URL+"/auth/authorize?client_id="+r.APP_ID+"&response_type="+r.AUTH_TYPE+"&redirect_uri="+encodeURIComponent(r.CALLBACK||"/login"):r.ALLOWIFRAMELOGIN?s.$broadcast("auth:requireLogin"):window.location.href=r.LOGIN_URL||"/login?redirect_url="+encodeURIComponent(window.location.href)},a.prototype.logout=function(){var e=this,t=this.getJWT();return e.removeAuth(),n({method:"GET",url:"/revoke?sso=true",headers:{Authorization:"Bearer "+t}}).then(function(){r.LOGOUT_URL&&(window.location.href=r.LOGOUT_URL),r.FORCE_LOGIN&&e.forceLogin()}).catch(function(e){return console.log("Error logging out: ",e)})},a.prototype.forceLogin=function(){this.login()},a.prototype.getOauthProfile=function(){var t=e.defer();return this.getJWT()?n.get(r.IDP_BASE_URL+"/api/profile").then(function(e){return t.resolve(e.data)}).catch(function(e){return t.reject(e)}):t.reject(null),t.promise},a.prototype.getUserFromJWT=function(e){var t=this.parseJwt(e);return t?new l(_extends({},t,{id:t.sub})):null},a.prototype.getUser=function(e){var t=this.getJWT();if(!e||"function"!=typeof e)return this.isImplicitJWT(t)&&this.isExpired(t)?null:this.getUserFromJWT(t);this.check().then(function(t){return e(t)})},a.prototype.getUserQ=function(){var t=this,n=e.defer();return this.check().then(function(e){e?n.resolve(e):(r.ALLOWIFRAMELOGIN&&r.FORCE_LOGIN&&s.$on("userAuthenticated",function(e,t){n.resolve(t)}),r.ALLOWIFRAMELOGIN&&!r.FORCE_LOGIN&&n.resolve(null),!r.ALLOWIFRAMELOGIN&&r.FORCE_LOGIN&&(addEventListener("message",function(e){"iframe:ssoFailed"===e.data&&n.resolve(t.getUser())}),n.resolve(null)),r.ALLOWIFRAMELOGIN||r.FORCE_LOGIN||n.resolve(null))}).catch(function(e){return console.log(e)}),n.promise},a.prototype.check=function(){var t=this,n=this.getJWT();return n?this.isImplicitJWT(n)?this.isExpired(n)?e.reject(null):e.when(this.getUserFromJWT(n)):this.isExpired(n)?this.checkWithClient(n).then(function(e){return t.getUserFromJWT(e)}):e.when(this.getUserFromJWT(n)):e.when(null)},a.prototype.checkWithClient=function(t){var i=this;return"token"===r.AUTH_TYPE?e.when(null):n.get("/checktoken").then(function(e){var n=e.headers("Authorization"),s=n&&n.replace("Bearer ","");return s&&i.setAuth(s),s||t})},a.prototype.getJWTFromUrl=function(){var e=o&&o.location&&o.location.hash?o.location.hash:i.url(),t=e.match(/access_token=([^\&]*)/);return t&&t[1]},a.prototype.getJWTfromLocalStorage=function(){return window.localStorage.getFromLocalStorage("gpoauthJWT")},a.prototype.getJWT=function(){var e=this.getJWTFromUrl()||this.getJWTfromLocalStorage();return!e||e&&this.isImplicitJWT(e)&&this.isExpired(e)?null:e},a.prototype.clearLocalStorageJWT=function(){delete window.localStorage.gpoauthJWT},a.prototype.isExpired=function(e){var t=this.parseJwt(e);if(t){return(new Date).getTime()/1e3>t.exp}return!0},a.prototype.isImplicitJWT=function(e){var t=this.parseJwt(e);return t&&t.implicit},a.prototype.parseJwt=function(e){var t;if(e)try{var n=e.split(".")[1],i=n.replace("-","+").replace("_","/");t=JSON.parse(atob(i))}catch(e){}return t},a.prototype.validateJwt=function(e){var t=this.parseJwt(e);return!!(t&&t.exp&&1e3*t.exp>Date.now())},a.prototype.setAuth=function(e){window.localStorage.saveToLocalStorage("gpoauthJWT",e),n.defaults.headers.common.Authorization="Bearer "+e,s.$broadcast("userAuthenticated",this.getUserFromJWT(e))},a.prototype.removeAuth=function(){delete window.localStorage.gpoauthJWT,delete n.defaults.headers.common.Authorization,s.$broadcast("userAuthenticated",null),s.$broadcast("userSignOut")},a}())}]).factory("ng-common-AuthenticationInterceptor",["$injector","$window",function(e,n){return{response:function(n){var i=e.get("AuthenticationService"),s=t(),o=n.headers("Authorization");if(s)i.setAuth(s);else if(o){var r=o.replace("Bearer","").trim();i.setAuth(r)}return n}}}]).config(["$httpProvider",function(e){e.interceptors.push("ng-common-AuthenticationInterceptor")}]).directive("gpLoginModal",["$rootScope","AuthenticationService","GPConfig",function(e,t,n){return{scope:{minimal:"@"},replace:!0,template:'<div class="gpLoginCover" ng-show="requireLogin">\n\n              <button class="btn btn-cancel gpLoginCancelIframe pull-right"\n                ng-show="!FORCE_LOGIN"\n                ng-click="cancel()">\n                Cancel\n                <span class="glyphicon glyphicon-remove-sign"></span>\n              </button>\n\n              \x3c!-- In order to keep the trigger in scope we use ng-show above and ng-if here --\x3e\n              <div class="gpLoginWindow" ng-if="requireLogin">\n                <iframe src="/login?redirect_url='+encodeURIComponent(window.location.origin+"/auth/loading?cachebuster="+(new Date).getTime())+"&cachebuster="+(new Date).getTime()+'"></iframe>\n              </div>\n\n            </div>',controller:["$scope","$element","$timeout",function(e,t,i){e.requireLogin=!1,e.FORCE_LOGIN=n.FORCE_LOGIN,e.$on("auth:requireLogin",function(){i(function(){e.requireLogin=!0})}),e.$on("userAuthenticated",function(){i(function(){e.requireLogin=!1})}),e.cancel=function(){console.log("CALLED"),e.requireLogin=!1}}]}}]).directive("gpLoginButton",["$rootScope","$timeout","AuthenticationService","GPConfig",function(e,t,n,i){return{scope:{minimal:"@"},replace:!0,template:['<div class="btn-account btn-group">  <a class="btn btn-link" ng-click="login()" ng-if="!user">Sign In</a>  <button type="button" class="btn btn-link dropdown-toggle" data-toggle="dropdown"    aria-expanded="false" ng-if="user">     <span class="glyphicon glyphicon-user"></span>      <span class="hidden-xs">{{::user.name}}</span>      <span class="caret"></span>  </button>  <ul class="dropdown-menu dropdown-menu-right" role="menu" ng-if="user">    <li class="account-details">      <div class="media">        <div class="media-left">          <div class="media-object">            <span class="glyphicon glyphicon-user glyphicon-xlg"></span>          </div>        </div>        <div class="media-body">          <div class="media-heading">{{::user.name}}</div>          <div><em>{{::user.username}}</em></div>          <div>{{::user.email}}</div>          <div>{{::user.org}}</div>        </div>      </div>    </li>    <li class="divider"></li>    <li><a target="_blank" href="{{::IDP_BASE_URL}}/profile">Edit Info</a></li>    <li><a target="_blank" href="{{::IDP_BASE_URL}}/updatepw">Change Password</a></li>    <li><a href ng-click="logout()">Sign Out</a></li>  </ul></div>'].join(" "),controller:["$scope","$rootScope","$element",function(e,s,o){e.IDP_BASE_URL=i.IDP_BASE_URL,"true"===e.minimal&&(e.minimal=!0),!0!==e.minimal&&(e.minimal=!1),e.user=n.getUser(),s.$on("userAuthenticated",function(n,i){t(function(){e.user=i})}),s.$on("userSignOut",function(n){t(function(){e.user=null})}),e.login=function(){n.login()},e.logout=function(){n.logout()}}]}}]).directive("gpAccountDetails",["$timeout","AuthenticationService","GPConfig",function(e,t,n){return{scope:{},replace:!0,template:['<div>  <div class="media">','    <div class="media-left">','        <div class="media-object">','            <span class="glyphicon glyphicon-user glyphicon-xlg"></span>',"        </div>","    </div>",'    <div class="media-body" ng-if="user">','       <div class="media-heading">{{::user.name}}</div>       <div><small><em>{{::user.username}}</em></small></div>       <div><small>{{::user.email}}</small></div>       <div><small>{{::user.org}}</small></div>    </div>','    <div class="media-body" ng-if="!user">','       <div class="media-heading">Please Sign In</div>       <div><small>Sign in to your GeoPlatform account or register a new account.</small></div>    </div>',"  </div>","  <hr/>",'  <div ng-if="user">','    <button type="button" class="btn btn-sm btn-accent pull-right" ng-click="logout()">Sign Out</button>    <a class="btn btn-sm btn-default" target="_blank" href="{{::IDP_BASE_URL}}/profile">Edit Details</a>  </div>','  <div ng-if="!user">','    <button type="button" class="btn btn-sm btn-accent pull-right" ng-click="login()">Sign In</button>    <a class="btn btn-sm btn-default" target="_blank" href="{{::IDP_BASE_URL}}/register">Register</a>  </div>',"</div>"].join(" "),controller:["$scope","$rootScope","$element","$timeout",function(e,i,s,o){e.IDP_BASE_URL=n.IDP_BASE_URL,e.user=t.getUser(),i.$on("userAuthenticated",function(t,n){o(function(){e.user=n})}),i.$on("userSignOut",function(t){o(function(){e.user=null})}),e.login=function(){t.login()},e.logout=function(){t.logout()}}]}}])}(angular);
//# sourceMappingURL=geoplatform.common.min.js.map
