"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}();!function(e,n){n.module("gp-common",[]).constant("idspBaseUrl",GeoPlatform.idspUrl).constant("idmBaseUrl",GeoPlatform.idmUrl).value("GPConfig",GeoPlatform)}(jQuery,angular),function(e){e.module("gp-common").directive("cardDetailsCarouselActivator",function(){return{compile:function(e){e.append('\n            <div class="gp-ui-card__details-activator--left" title="Show previous details"\n                ng-class="{disabled:!hasPrevious()}" ng-click="previousDetails()">\n                <span class="glyphicon glyphicon-chevron-left"></span>\n            </div>\n            <div class="gp-ui-card__details-activator--right" title="Show next details"\n                ng-class="{disabled:!hasNext()}" ng-click="nextDetails()">\n                <span class="glyphicon glyphicon-chevron-right"></span>\n            </div>\n        ')},controller:["$scope","$element",function(n,t){n.hasPrevious=function(){return t.find(".gp-ui-card__details.active").prevAll(".gp-ui-card__details").length},n.hasNext=function(){return t.find(".gp-ui-card__details.active").nextAll(".gp-ui-card__details").length},n.previousDetails=function(){if(n.hasPrevious()){var i=t.find(".gp-ui-card__details.active");i.removeClass("active"),i=i.prevAll(".gp-ui-card__details"),i.length&&e.element(i[0]).addClass("active")}},n.nextDetails=function(){if(n.hasNext()){var i=t.find(".gp-ui-card__details.active");i.removeClass("active"),i=i.nextAll(".gp-ui-card__details"),i.length&&e.element(i[0]).addClass("active")}}}]}})}(angular),function(e,n){function t(e){var n=!1;if(e instanceof Object){var t=parseInt(e.r,10),i=parseInt(e.g,10),o=parseInt(e.b,10);(t>255||t<0||!t&&0!==t)&&(n=!0),(i>255||i<0||!i&&0!==i)&&(n=!0),(o>255||o<0||!o&&0!==o)&&(n=!0)}else{var r=parseInt(e,10);(r>255||r<0||!r&&0!==r)&&(n=!0)}return n}function i(e){var n=e.toString(16),i=null;return isNaN(e)||t(e)||(i=1==n.length?"0"+n:n),i}function o(e){var n=null,t=i(parseInt(e.r,10)),o=i(parseInt(e.g,10)),r=i(parseInt(e.b,10));return t&&o&&r&&(n="#"+t+o+r),n}function r(e){return/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e)||null}function s(e){var n=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(n,function(e,n,t,i){return n+n+t+t+i+i});var t=r(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}n.module("gp-common").component("gpColorPicker",{bindings:{ngModel:"=",onChange:"&"},controller:["$timeout","$q",function(e,n){this.changeRGB=function(){this.rgbError=t(this.rgb),this.ngModel=o(this.rgb);var n=this;e(function(){n.onChange({value:n.ngModel})})},this.changeHex=function(){r(this.ngModel)?this.hexError=!1:this.hexError="Invalid hex color value",this.rgb=s(this.ngModel);var n=this;e(function(){n.onChange({value:n.ngModel})})},this.$onInit=function(){this.rgb=s(this.ngModel)}}],template:'\n            <div class="gp-colorpicker">\n                <div class="form-group hex-form-group" ng-class="{\'has-error\':$ctrl.hexError}">\n                    <input type="text" class="form-control"\n                        ng-model="$ctrl.ngModel" ng-keyup="$ctrl.changeHex()">\n                </div>\n                <div class="gp-colorpicker__wrapper">\n                    <div colorpicker colorpicker-inline="true" colorpicker-parent="true" \n                        ng-model="$ctrl.ngModel" ng-change="$ctrl.changeHex()"></div>\n                </div>\n                <div class="form-group rgb-form-group" ng-class="{\'has-error\':$ctrl.rgbError}">\n                    <input type="text" class="form-control"\n                        placeholder="R" ng-model="$ctrl.rgb.r" ng-keyup="$ctrl.changeRGB()" title="R">\n                    <input type="text" class="form-control"\n                        placeholder="G" ng-model="$ctrl.rgb.g" ng-keyup="$ctrl.changeRGB()" title="G">\n                    <input type="text" class="form-control"\n                        placeholder="B" ng-model="$ctrl.rgb.b" ng-keyup="$ctrl.changeRGB()" title="B">\n                </div>\n            </div>\n        '})}(jQuery,angular),function(e,n){n.module("gp-common").directive("gpDatePicker",["$timeout",function(e){return{scope:{label:"@",format:"@",date:"=",onChange:"&?"},template:['<div class="input-group-slick">','    <input type="text" class="form-control" placeholder="{{::label}}"','        datepicker-popup="{{format}}" ng-model="date" is-open="opened" />','    <span class="glyphicon glyphicon-calendar" ng-click="toggle($event)"></span>',"</div>",'<p class="help-block"><small><em>Ex: "2015-01-31" or "Jan 31 2015"</em></small></p>'].join(" "),controller:["$scope","$element","$attrs",function(n,t,i){n.toggle=function(e){e.preventDefault(),e.stopPropagation(),this.opened=!this.opened},n.format||(n.format="MMM dd yyyy");var o=null;n.debounce=function(){o&&e.cancel(o),o=e(function(){o=null,n.onChange&&n.onChange()},200)},n.$watch("date",function(){n.debounce()});var r=n.$on("$destroy",function(){r(),o&&e.cancel(o),o=null,n.opened=!1,n.onChange=null,n.format=null,n.debounce=null})}]}}])}(jQuery,angular),function(e,n){n.module("gp-common").directive("gpGeolocation",["$window",function(e){return{scope:{label:"=?"},restrict:"EA",template:['<a class="btn btn-primary" ng-click="geolocate()" ng-if="available">','  <span class="glyphicon glyphicon-screenshot" ng-if="!loading"></span>','  <span class="glyphicon glyphicon-hourglass glyphicon-spin" ng-if="loading"></span>',"  {{btnLabel}}","</a>",'<div ng-if="error">{{error}}</div>'].join(" "),controller:["$scope",function(n){n.btnLabel=n.label||"Locate",n.loading=!1,n.available=e.navigator&&e.navigator.geolocation,n.available||(n.error="Your browser does not support determining location"),n.geolocate=function(){n.loading=!0,e.navigator.geolocation.getCurrentPosition(function(e){n.$apply(function(){n.loading=!1}),n.$emit("map:geolocation",e.coords.latitude,e.coords.longitude)},function(e){switch(e.code){case 1:n.error="Permission was denied while attempting to determine location";break;case 2:n.error="Unable to determine your location";break;case 3:n.error="Unable to determine location in a reasonable amount of time"}})}}]}}])}(jQuery,angular),function(e,n){n.module("gp-common").directive("gpHeader",["GPConfig","AuthenticationService",function(e,n){return{scope:{brand:"@",showHomeLink:"@"},restrict:"AE",transclude:!0,replace:!0,template:["<header>",'  <div class="container-fluid">','    <div class="row">','      <div class="col-md-12">','        <ul role="menu" class="header__menu" gp-header-menu>','          <li ng-if="showHomeLink">','            <a href="#/goHome">','                <span class="glyphicon glyphicon-home"></span> ','                <span class="hidden-xs hidden-sm">Home</span>',"            </a>","          </li>",'          <div class="transcluded"></div>',"          <li><span gp-login-button></span></li>","        </ul>",'        <h4 class="brand">','          <a href="{{portalUrl}}" title="Go to the GeoPlatform Home Page">','            <span class="icon-gp"></span>','            <span class="hidden-xs">GeoPlatform</span>',"          </a>","          {{brand}}","        </h4>","      </div>","    </div>","  </div>","</header>"].join(" "),link:function(t,i,o,r,s){t.showHomeLink="true"===t.showHomeLink||!1,t.portalUrl=e.portalUrl,n.getUserQ().then(function(e){t.user=e}),i.find(".transcluded").replaceWith(s())}}}]).directive("gpHeaderMenu",["$location",function(e){function n(n){var i=e.path();"/"!==i&&"/#"!==i&&"/#/"!==i||(i=t),"/"===i[0]&&(i=i.substring(1));var o=n;o.find("li.active").removeClass("active");var r=o.find('li > a[href="#/'+i+'"]');if(r.length){var s=r.closest(".dropdown-menu");s.length?s.closest("li").addClass("active"):r.parent().addClass("active")}o.find("li > a").each(function(e,n){var t=$(n),o=t.attr("href");o&&(o=o.replace("#/",""),0===i.indexOf(o)&&t.parent().addClass("active"))})}var t="goHome";return{scope:{homeHref:"@"},restrict:"A",controller:["$rootScope","$scope","$element",function(e,n,i){n.homeHref&&(t=n.homeHref)}],link:function(e,t){n(t),e.$root.$on("$locationChangeSuccess",function(){n(t)})}}}]).directive("gpFlexHeader",["GPConfig","AuthenticationService",function(e,n){return{scope:{brand:"@",showHomeLink:"@"},restrict:"AE",transclude:!0,replace:!0,template:'\n                <header>\n                    <h4 class="brand">\n                        <a href="{{portalUrl}}" title="Go to the GeoPlatform Home Page">\n                            <span class="icon-gp"></span>\n                            <span class="hidden-xs">GeoPlatform</span>\n                        </a>\n                        {{brand}}\n                    </h4>\n                    <ul role="menu" class="header__menu" gp-header-menu>\n                        <li ng-if="showHomeLink">\n                            <a href="/">\n                                <span class="glyphicon glyphicon-home"></span> \n                                <span class="hidden-xs hidden-sm">Home</span>\n                            </a>\n                        </li>\n                        <div class="transcluded"></div>\n                        <li><span gp-login-button></span></li>\n                    </ul>\n                </header>\n            ',link:function(t,i,o,r,s){t.showHomeLink="true"===t.showHomeLink||!1,t.portalUrl=e.portalUrl,n.getUserQ().then(function(e){t.user=e}),i.find(".transcluded").replaceWith(s())}}}])}(jQuery,angular),function(e){e.module("gp-common").directive("iframeOnload",function(){return{scope:{callback:"&iframeOnload"},link:function(e,n,t){n.on("load",function(t){return n.off("load"),e.callback(t)})}}})}(angular),function(e,n){e.module("gp-common").directive("onImgFail",function(){return{restrict:"A",link:function(e,n,t){var i=jQuery(n);i.on("error",function(){i.off("error"),i.attr("src",t.onImgFail)})}}}).directive("mapThumbnail",[function(){return{restrict:"A",scope:{mapThumbnail:"="},link:function(e,t,i){function o(e){if(e.thumbnail)if(e.thumbnail.contentData){var n="background-size:contain;background-repeat:no-repeat;background-image: url(data:"+(e.thumbnail.mediaType||"image/png")+";base64,"+e.thumbnail.contentData+");";t.attr("class").indexOf("embed-responsive-item")<0&&(n+="width:"+(e.thumbnail.width||"32")+"px;height:"+(e.thumbnail.height||"32")+"px;"),t.attr("style",n)}else e.thumbnail.url?t.attr("src",e.thumbnail.url):t.attr("src",null);else t.attr("src",null)}function r(e){var t=e.thumbnail;return t&&t.length?0!==t.indexOf("http")&&(t="/"!==t[0]?n.ualUrl+"/"+t:n.ualUrl+t):t=n.ualUrl+"/api/maps/"+e.id+"/thumbnail",t}var s=e.mapThumbnail;s.$promise&&!s.$resolved?s.$promise.then(function(e){"string"==typeof e.thumbnail?t.attr("src",r(e)):o(e)}).catch(function(e){t.attr("src",null)}):"string"==typeof s.thumbnail?t.attr("src",r(s)):o(s)}}}]).directive("itemThumbnail",["$q",function(e){return{restrict:"E",replace:!0,scope:{item:"=",fallback:"@",link:"@"},template:'\n                <a ng-show="hasThumbnail" class="media embed-responsive embed-responsive-16by9">\n                    <img class="embed-responsive-item" on-img-error="{{fallback||\'/img/img-404.jpg\'}}">\n                </a>\n            ',controller:["$scope",function(e){e.elName="div",e.isLink=!!e.link,e.isLink&&(e.elName="a")}],link:function(t,i,o){var r=t.item;(r.$promise||e.resolve(r)).then(function(e){var o=t.fallback;if(e.type&&"Map"===e.type)o=n.ualUrl+"/api/maps/"+e.id+"/thumbnail";else if(e.assetType&&"Map"===e.assetType)o=n.ualUrl+"/api/maps/"+e.assetId+"/thumbnail";else if(e.thumbnail&&e.thumbnail.url)o=e.thumbnail.url;else if(e.thumbnail&&e.thumbnail.contentData){var r="background-size:contain;background-repeat:no-repeat;background-image: url(data:"+(e.thumbnail.mediaType||"image/png")+";base64,"+e.thumbnail.contentData+");";i.attr("class").indexOf("embed-responsive-item")<0&&(r+="width:"+(e.thumbnail.width||"32")+"px;height:"+(e.thumbnail.height||"32")+"px;"),i.find("img").attr("style",r)}t.hasThumbnail=!!o,i.find("img").attr("src",o),t.isLink&&i.attr("href",t.link).attr("target","_blank")}).catch(function(e){i.find("img").attr("src",t.fallback)})}}}])}(angular,GeoPlatform),function(e){e.module("gp-common").service("NotificationService",["$rootScope",function(e){var n=function(){this.items=[]};return n.prototype={getItems:function(){return this.items},addItem:function(n){return this.items.push(n),e.$broadcast("gp:notifications:new",n),function(e){this.removeItem(e)}.bind(this,n)},removeItem:function(e){var n=this.items.indexOf(e);return n>=0?this.items.splice(n,1):null},error:function(e,n,t){return this.addItem({type:"error",label:e,message:n,canDismiss:t})},success:function(e,n,t){return this.addItem({type:"success",label:e,message:n,canDismiss:t})},info:function(e,n,t){return this.addItem({type:"info",label:e,message:n,canDismiss:t})}},new n}]).directive("gpNotifications",["$timeout","NotificationService",function(e,n){return{scope:{expiration:"@"},template:['<div class="notifications ng-hide" ng-show="items.length">','  <div class="notification" ng-repeat="item in items"',"    ng-class=\"{'notification--success':item.type==='success', 'notification--error':item.type==='error', 'notification--info':item.type==='info'}\">",'    <h5 class="notification__title">','        <span class="pull-right glyphicon" ',"            ng-class=\"{'glyphicon-ok-sign':item.type==='success','glyphicon-exclamation-sign':item.type==='error','glyphicon-info-sign':item.type==='info'}\">","        </span>","        {{item.label}}","    </h5>",'    <p class="notification__content" ng-bind-html="item.message"></p>','    <div class="notification__actions" ng-if="item.canDismiss">','        <button type="button" class="btn btn-link" ng-click="dismiss(item)">dismiss</button>',"    </div>","  </div>","</div>"].join(" "),link:function(t,i,o){function r(){t.items=n.getItems(),t.timer&&(e.cancel(t.timer),t.timer=null),t.timer=e(function(){t.timer=null,t.removeOldest()},t.expiration)}t.expiration=1*(t.expiration||2e3),t.items=[],r(),t.removeOldest=function(){var e=t.items.find(function(e){return e.canDismiss});e&&n.removeItem(e)},t.dismiss=function(e){n.removeItem(e)},t.$watchCollection(function(){return n.getItems()},r)}}}])}(angular),function(e,n){var t=function(){function e(){"ngInject";_classCallCheck(this,e)}return _createClass(e,[{key:"$onInit",value:function(){var e=this;if(this.service){this.options=this.service.getPagination(),this.pageSizeDropdown=!0,this.useSelect=void 0!==this.useSelect&&(!0===this.useSelect||"true"===this.useSelect||1===this.useSelect),this.useSelect&&(this.pageSizeDropdown=!1,this.pageSize=this.options.size,this.pageSizeOptions=(this.options.sizeOptions||[5,10,20,50]).map(function(e){return{label:e+" per page",value:e}}));var n="gp:browse:";n=this.eventKey?"gp:browse:"+this.eventKey+":":"gp:browse:objects:",this.listener=this.service.on(n+"pagination",function(){e.options=e.service.getPagination()})}}},{key:"$onDestroy",value:function(){this.listener&&this.listener(),this.service=null}},{key:"previous",value:function(){this.service&&this.hasPrevious()&&this.service.start(Math.max(0,1*this.options.start-1*this.options.size),!0)}},{key:"next",value:function(){this.service&&this.hasNext()&&this.service.start(Math.min(this.options.total,1*this.options.start+1*this.options.size),!0)}},{key:"first",value:function(){this.service&&this.hasPrevious()&&this.service.start(0,!0)}},{key:"last",value:function(){if(this.service&&this.hasNext()){var e=Math.floor(this.options.total/this.options.size);this.setPage(e)}}},{key:"setPage",value:function(e){if(this.service){var n=1*e;this.service.start(n*(1*this.options.size),!0)}}},{key:"setPageSize",value:function(e){this.service&&this.service.size(1*e,!0)}},{key:"hasPrevious",value:function(){return this.options&&this.options.start>0}},{key:"hasNext",value:function(){return this.options&&this.options.start+this.options.size<this.options.total}}]),e}();n.module("gp-common").component("gpPagination",{bindings:{service:"=",eventKey:"@",useSelect:"@"},controller:t,template:'\n            <div class="c-pagination">\n                <div class="c-pagination__total">{{$ctrl.options.total||0}} results</div>\n                <div class="c-pagination__page-size" ng-if="$ctrl.pageSizeDropdown">\n                    <span uib-dropdown>\n                        <a href="" uib-dropdown-toggle title="Change the number of results returned">\n                            {{$ctrl.options.size}} per page <span class="caret"></span>\n                        </a>\n                        <ul class="dropdown-menu" role="menu">\n                            <li ng-repeat="size in $ctrl.options.sizeOptions track by $index">\n                                <a ng-click="$ctrl.setPageSize(size)">{{size}} per page</a>\n                            </li>\n                        </ul>\n                    </span>\n                </div>\n                <div class="c-pagination__page-size" ng-if="!$ctrl.pageSizeDropdown">\n                    <select class="form-control" \n                        ng-model="$ctrl.pageSize" ng-change="$ctrl.setPageSize($ctrl.pageSize)"\n                        ng-options="opt.value as opt.label for opt in $ctrl.pageSizeOptions">\n                    </select>\n                </div>\n                <div class="c-pagination__pages">\n                    <div class="c-pagination__button" \n                        ng-class="{\'is-disabled\':!$ctrl.hasPrevious()}"\n                        ng-click="$ctrl.first()">\n                        <span class="glyphicon glyphicon-fast-backward"></span>\n                    </div>\n                    <div class="c-pagination__button" \n                        ng-class="{\'is-disabled\':!$ctrl.hasPrevious()}"\n                        ng-click="$ctrl.previous()">\n                        <span class="glyphicon glyphicon-backward"></span>\n                    </div>\n                    <div class="c-pagination__page">\n                        {{$ctrl.options.start+1}} - {{$ctrl.options.start+$ctrl.options.size}}\n                    </div>\n                    <div class="c-pagination__button" \n                        ng-class="{\'is-disabled\':!$ctrl.hasNext()}"\n                        ng-click="$ctrl.next()">\n                        <span class="glyphicon glyphicon-forward"></span>\n                    </div>\n                    <div class="c-pagination__button" \n                        ng-class="{\'is-disabled\':!$ctrl.hasNext()}"\n                        ng-click="$ctrl.last()">\n                        <span class="glyphicon glyphicon-fast-forward"></span>\n                    </div>\n                </div>\n            </div>\n        '})}(jQuery,angular),function(e){e.module("gp-common").component("gpProgressCircle",{bindings:{ngModel:"<"},controller:function(){this.$onInit=function(){this.dashArray=2*Math.PI*45,this.ngModel||(this.ngModel=0),this.update()},this.$onChanges=function(e){e.ngModel&&this.update()},this.update=function(){var e=2*Math.PI*45*(1-this.ngModel/100);this.value=e}},template:'\n            <svg class="c-progress--circle" viewBox="0 0 100 100">\n                <circle class="c-progress__meter" cx="50" cy="50" r="45" stroke-width="10" />\n                <circle class="c-progress__value" cx="50" cy="50" r="45" stroke-width="10" \n                    stroke-dasharray="{{$ctrl.dashArray}}" stroke-dashoffset="{{$ctrl.value}}"/>\n                <text class="c-progress__label" x="50" y="-40" text-anchor="middle">{{$ctrl.ngModel}}%</text>\n            </svg>\n        '})}(angular),function(e,n){n.module("gp-common").provider("responsiveHelper",["$windowProvider",function(e){function n(e){this.window=e}var t=e.$get();n.prototype={getWidth:function(){return t.innerWidth||t.outerWidth},isXS:function(){return this.getWidth()<768},isSM:function(){var e=this.getWidth();return e>=768&&e<992},isMD:function(){var e=this.getWidth();return e>=992&&e<1200},isLG:function(){return this.getWidth()>=1200}};var i=new n(t);this.$get=function(){return i}}]).directive("gpResponsive",["$window","responsiveHelper",function(e,t){return{restrict:"A",link:function(i,o,r){function s(e,n){n.isXS()?e.addClass("gp-responsive-xs"):e.removeClass("gp-responsive-xs"),n.isSM()?e.addClass("gp-responsive-sm"):e.removeClass("gp-responsive-sm"),n.isMD()?e.addClass("gp-responsive-md"):e.removeClass("gp-responsive-md"),n.isLG()?e.addClass("gp-responsive-lg"):e.removeClass("gp-responsive-lg")}s(o,t);var a=function(){s(o,t)},l=n.element(e);l.on("resize",a);i.$on("$destroy",function(){l.off("resize",a)})}}}]).directive("gpResize",["$window","$timeout",function(t,i){return function(o,r,s){var a=function(){var n=e("header")[0].offsetHeight,t=n+2,i={top:t+"px"};r.css(i),o.$apply()},l=n.element(t);l.on("resize",a),i(a,200),o.$on("$destroy",function(){l.off("resize",a)})}}])}(jQuery,angular),function(e,n){function t(e,n,t,i,o){function r(){var t=n.find(".form-control");e.isDirty=t.hasClass("ng-dirty"),t.hasClass("ng-invalid")?t.hasClass("ng-empty")?e.error="This field requires a value":e.error="Invalid value provided":e.error=null}function s(e){i.$setViewValue(e),i.$render()}e.type||(e.type="text"),"true"===e.required?e.required=!0:e.required=!1,e.elId="input_"+Math.ceil(9999*Math.random()),e.size=e.size||"medium",e.type=e.type||"text",n.find(".form-control").on("change",function(){r(e.innerValue)}),i.$render=function(){var n=i.$viewValue;e.innerValue=n,e.displayValue=n||e.placeholder||"No value provided",r()},e.isReadOnly=function(){var e=_typeof(this.readOnly);return"undefined"!==e&&("string"===e?"true"===this.readOnly.toLowerCase():"number"===e?1===this.readOnly:"boolean"===e&&this.readOnly)},e.edit=function(){e.isReadOnly()||(e.editing=!0,o(function(){n.find(".form-control").focus().select()},200))},e.done=function(){e.editing=!1,e.error=null},e.save=function(){s(e.innerValue),e.done()},e.cancel=function(){e.innerValue=i.$viewValue,e.done()},e.onKeyPress=function(n,t){if(void 0!==t&&0!==t||void 0===n.which||(t=n.which),"number"===e.type){if(8===t||46===t||t>=44&&t<=57)return;return n.preventDefault(),!1}},e.onKeyUp=function(n,t){if(void 0!==t&&0!==t||void 0===n.which||(t=n.which),13!==t||e.error)if(27===t)e.cancel();else{if(8!==t&&46!==t&&190!==t&&(t<48||t>90)&&(t<106||t>111)&&t<186)return;r()}else e.done()},e.$destroy=function(){n.off("change")}}n.module("gp-common").directive("gpSlickFormInput",["$timeout",function(e){return{restrict:"AE",require:"ngModel",scope:{label:"@",placeholder:"@",help:"=",type:"@",pattern:"@",required:"@",readOnly:"@",size:"@",icon:"@"},template:i,link:function(n,i,o,r){t(n,i,o,r,e)}}}]).directive("gpSlickFormTextarea",["$timeout",function(e){return{restrict:"AE",require:"ngModel",scope:{label:"@",placeholder:"@",help:"@",readOnly:"@",size:"@",icon:"@"},template:o,link:function(n,i,o,r){t(n,i,o,r,e)}}}]).directive("gpSlickFormDate",["$timeout","$filter",function(e,t){return{restrict:"AE",require:"ngModel",scope:{label:"@",format:"@",placeholder:"@",required:"@",readOnly:"@",size:"@",icon:"@"},template:r,controller:["$scope","$element",function(e,n){(!e.format||e.format.length<3)&&(e.format="mediumDate"),e.inline=n.hasClass("inline")}],link:function(e,i,o,r){function s(n){var t=i.find(".form-control");t.hasClass("ng-invalid")?t.hasClass("ng-empty")?e.error="This field requires a value":e.error="Invalid value provided":e.error=null}function a(e){r.$setViewValue(e),r.$render()}"true"===e.required?e.required=!0:e.required=!1,e.elId="input_"+Math.ceil(9999*Math.random()),e.size=e.size||"medium",e.type=e.type||"text",r.$render=function(){var n=r.$viewValue;e.innerValue=n,e.displayValue=n?t("date")(r.$modelValue,e.format):e.placeholder||"No value provided",s(n)},e.isReadOnly=function(){var e=_typeof(this.readOnly);return"undefined"!==e&&("string"===e?"true"===this.readOnly.toLowerCase():"number"===e?1===this.readOnly:"boolean"===e&&this.readOnly)},e.edit=function(){e.isReadOnly()||(e.editing=!0)},e.done=function(){e.opened=!1,e.editing=!1,e.error=null},e.save=function(){a(e.innerValue),e.done()},e.cancel=function(){e.innerValue=n.copy(r.$modelValue),e.done()},e.open=function(){void 0===e.uibopts&&(e.uibopts={}),e.uibopts.opened=!0},e.onKeyUp=function(n){13===n?e.done():27===n&&e.cancel()},e.onChange=function(n){isNaN(r.$modelValue)&&e.required?e.error="This field requires a value":e.error=null}}}}]).directive("gpSlickFormSelect",["$timeout",function(e){return{restrict:"AE",require:"ngModel",scope:{label:"@",codeList:"=",help:"=",required:"@",readOnly:"@",size:"@",icon:"@"},template:s,link:function(n,t,i,o){function r(){return l&&l.length||(l=t.find(".form-control")),l}function s(){var e=r();n.isDirty=e.hasClass("ng-dirty"),e.hasClass("ng-invalid")?e.hasClass("ng-empty")?n.error="This field requires a value":n.error="Invalid value provided":n.error=null}function a(e){o.$setViewValue(e),o.$render()}n.type||(n.type="text"),"true"===n.required?n.required=!0:n.required=!1,n.elId="input_"+Math.ceil(9999*Math.random()),n.size=n.size||"medium",n.type=n.type||"text";var l=null;n.codeList?n.selectOptions=n.codeList.map(function(e){return"object"===(void 0===e?"undefined":_typeof(e))&&e.value?e.label?e:{value:e.value,label:e.value}:{value:e,label:e}}):n.selectOptions=[],o.$render=function(){var e=o.$viewValue;if(n.innerValue=e,n.displayValue=n.placeholder||"No value provided",e){var t=n.selectOptions.find(function(n){return n.value==e});n.displayValue=t.label}s()},n.onChange=function(t){n.innerValue=t,e(function(){s()},200)},n.onTypeaheadSelection=function(t,i,o,r){n.innerValue=t?t.value:null,e(function(){s()},200)},n.isReadOnly=function(){var e=_typeof(this.readOnly);return"undefined"!==e&&("string"===e?"true"===this.readOnly.toLowerCase():"number"===e?1===this.readOnly:"boolean"===e&&this.readOnly)},n.edit=function(){n.isReadOnly()||(n.editing=!0,e(function(){l.focus().select()},200))},n.done=function(){n.editing=!1,n.error=null},n.save=function(){a(n.innerValue),n.done()},n.cancel=function(){n.innerValue=o.$viewValue,n.done()},n.onKeyUp=function(e){13!==e||n.error?27===e&&n.cancel():n.save()},n.onTypeaheadKeyUp=function(e){s()},n.$destroy=function(){}}}}])
;var i=['<div class="form-group form-group-slick">','   <label for="{{::elId}}" class="control-label">{{::label}}</label>','   <div class="input__display" ',"       ng-class=\"{'is-read-only':isReadOnly(), 'has-error':!!error,'text-lg':size==='large'}\" ",'       ng-show="!editing" ng-click="edit()" ',"       title=\"{{!!error?error:(!isReadOnly()?'Click to edit':'')}}\">","      {{displayValue}}","   </div>",'   <div ng-show="editing">',"      <div class=\"input-group\" ng-class=\"{'input-group-lg':size==='large'}\">","           <div class=\"input-group-slick\" ng-class=\"{'input-group-slick--lg':size==='large'}\">",'               <span ng-if="icon" class="{{::icon}}"></span>','               <input id="{{::elId}}" type="{{::type}}" class="form-control" ','                   pattern="{{pattern}}" ','                   ng-model="innerValue" ','                   ng-required="{{required}}" ','                   ng-keypress="onKeyPress($event, $event.keyCode)" ','                   ng-keyup="onKeyUp($event, $event.keyCode)" >','               <span class="indicators">','                   <span class="is-valid glyphicon glyphicon-ok-sign"></span>','                  <span class="is-invalid glyphicon glyphicon-exclamation-sign"></span>',"              </span>","           </div>",'          <span class="input-group-btn">','               <button type="button" class="btn btn-default" ',"                   ng-class=\"{'btn-lg':size==='large'}\"",'                   ng-click="cancel()" title="Cancel changes">','                   <span class="glyphicon glyphicon-ban-circle"></span>',"              </button>",'               <button type="button" class="btn btn-default" ',"                   ng-class=\"{disabled:!!error||!isDirty,'btn-lg':size==='large'}\"",'                   ng-disabled="{{!!error}}" ','                   ng-click="save()" title="Save changes">','                  <span class="glyphicon glyphicon-ok"></span>',"               </button>","           </span>","       </div>",'       <div ng-if="error && error.length"><small class="help-block text-danger">{{error}}</small></div>','       <div ng-if="help && help.length"><small class="help-block">{{help}}</small></div>',"   </div>","</div>"].join(" "),o=['<div class="form-group form-group-slick">','   <label for="{{::elId}}" class="control-label">{{::label}}</label>','   <div class="input__display" ',"       ng-class=\"{'is-read-only':isReadOnly(), 'has-error':!!error,'text-lg':size==='large'}\" ",'       ng-show="!editing" ng-click="edit()" ',"       title=\"{{!!error?error:(!isReadOnly()?'Click to edit':'')}}\">","      {{displayValue}}","   </div>",'   <div ng-show="editing">',"      <div class=\"input-group\" ng-class=\"{'input-group-lg':size==='large'}\">","           <div class=\"input-group-slick\" ng-class=\"{'input-group-slick--lg':size==='large'}\">",'               <span ng-if="icon" class="{{::icon}}"></span>','               <textarea rows="3" id="{{::elId}}" class="form-control" ','                   ng-required="{{required}}" ng-model="innerValue"','                   ng-keypress="onKeyPress($event, $event.keyCode)" ','                   ng-keyup="onKeyUp($event, $event.keyCode)"></textarea>','               <span class="indicators">','                   <span class="is-valid glyphicon glyphicon-ok-sign"></span>','                  <span class="is-invalid glyphicon glyphicon-exclamation-sign"></span>',"              </span>","           </div>",'          <span class="input-group-btn">','               <button type="button" class="btn btn-default" ',"                   ng-class=\"{'btn-lg':size==='large'}\"",'                   ng-click="cancel()" title="Cancel changes">','                   <span class="glyphicon glyphicon-ban-circle"></span>',"              </button>",'               <button type="button" class="btn btn-default" ',"                   ng-class=\"{disabled:!!error||!isDirty,'btn-lg':size==='large'}\"",'                   ng-disabled="{{!!error}}" ','                   ng-click="save()" title="Save changes">','                  <span class="glyphicon glyphicon-ok"></span>',"               </button>","           </span>","       </div>",'       <div ng-if="error && error.length"><small class="help-block text-danger">{{error}}</small></div>','       <div ng-if="help && help.length"><small class="help-block">{{help}}</small></div>',"   </div>","</div>"].join(" "),r=['<div class="form-group form-group-slick">','   <label for="{{::elId}}" class="control-label">{{::label}}</label>','   <div class="input__display" ',"       ng-class=\"{'is-read-only':isReadOnly(), 'has-error':!!error}\" ",'       ng-show="!editing" ng-click="edit()" ',"       title=\"{{!!error?error:(!isReadOnly()?'Click to edit':'')}}\">","      {{displayValue}}","   </div>",'   <div ng-show="editing">','       <div uib-datepicker ng-required="{{required}}" ng-model="innerValue" datepicker-options="{showWeeks:false}"></div>','       <div ng-if="error && error.length"><small class="help-block text-danger">{{error}}</small></div>','       <div ng-if="help && help.length"><small class="help-block">{{help}}</small></div>','       <button type="button" class="btn btn-default" ',"           ng-class=\"{'btn-lg':size==='large'}\"",'           ng-click="cancel()" title="Cancel changes">','           <span class="glyphicon glyphicon-ban-circle"></span>',"      </button>",'      <button type="button" class="btn btn-default" ',"           ng-class=\"{disabled:!!error,'btn-lg':size==='large'}\"",'          ng-disabled="{{!!error}}" ','           ng-click="save()" title="Save changes">','           <span class="glyphicon glyphicon-ok"></span>',"      </button>","   </div>","</div>"].join(" "),s=['<div class="form-group form-group-slick">','   <label for="{{::elId}}" class="control-label">{{::label}}</label>','   <div class="input__display" ',"       ng-class=\"{'is-read-only':isReadOnly(), 'has-error':!!error}\" ",'       ng-show="!editing" ng-click="edit()" ',"       title=\"{{!!error?error:(!isReadOnly()?'Click to edit':'')}}\">","      {{displayValue}}","   </div>",'   <div ng-show="editing">',"      <div class=\"input-group\" ng-class=\"{'input-group-lg':size==='large'}\">","           <div class=\"input-group-slick\" ng-class=\"{'input-group-slick--lg':size==='large'}\">",'               <span ng-if="icon" class="{{::icon}}"></span>','               <select class="form-control input__field" ','                   ng-if="codeList.length<=12" ','                   ng-model="innerValue" ','                   ng-options="opt.value as opt.label for opt in selectOptions" ','                   ng-required="{{required}}" ','                   ng-change="onChange(innerValue)" ','                   ng-keyUp="onKeyUp($event.keyCode)" >','                   <option value="">Select One</option>',"               </select>",'               <input type="text" class="form-control input__field" ng-if="codeList.length>12" ','                   ng-model="innerValue" ','                   ng-required="{{required}}" ','                   ng-keyUp="onTypeaheadKeyUp($event.keyCode)" ','                   typeahead-on-select="onTypeaheadSelection($item, $model, $label, $event)" ','                   uib-typeahead="opt.value as opt.label for opt in selectOptions | filter:{value:$viewValue} | limitTo:12" ','                   typeahead-min-length="0" ','                   typeahead-editable="false">','               <span class="indicators">','                   <span class="is-valid glyphicon glyphicon-ok-sign"></span>','                  <span class="is-invalid glyphicon glyphicon-exclamation-sign"></span>',"              </span>","           </div>",'          <span class="input-group-btn">','               <button type="button" class="btn btn-default" ',"                   ng-class=\"{'btn-lg':size==='large'}\"",'                   ng-click="cancel()" title="Cancel changes">','                   <span class="glyphicon glyphicon-ban-circle"></span>',"              </button>",'               <button type="button" class="btn btn-default" ',"                   ng-class=\"{disabled:!!error||!isDirty,'btn-lg':size==='large'}\"",'                   ng-disabled="{{!!error}}" ','                   ng-click="save()" title="Save changes">','                  <span class="glyphicon glyphicon-ok"></span>',"               </button>","           </span>","       </div>",'       <div ng-if="error && error.length"><small class="help-block text-danger">{{error}}</small></div>','       <div ng-if="help && help.length"><small class="help-block">{{help}}</small></div>',"   </div>","</div>"].join(" ")}(jQuery,angular),function(e){e.module("gp-common").directive("gpTweetButton",["$timeout",function(e){function n(e,n,t){var i;return function(){var o=this,r=arguments,s=function(){i=null,t||e.apply(o,r)},a=t&&!i;clearTimeout(i),i=setTimeout(s,n),a&&e.apply(o,r)}}return{link:function(t,i,o){if("undefined"==typeof twttr)return void(i.className+=" disabled");var r=n(function(){o.url&&e(function(){i[0].innerHTML="",twttr.widgets.createShareButton(o.url,i[0],function(){},{count:o.count,text:o.text,via:o.via,size:o.size,hashtags:o.hashtags,dnt:o.dnt})})},75);o.$observe("url",r),o.$observe("text",r)}}}])}(angular),function(e){e.module("gp-common").directive("sortOrder",function(){return{replace:!0,require:"ngModel",template:["<div>",'<a class="btn btn-default" title="Click to sort in ascending order" href ng-if="value===\'dsc\'" ng-click="toggle()">','    <span class="glyphicon glyphicon-sort-by-attributes-alt"></span>',"</a>",'<a class="btn btn-default" title="Click to sort in descending order" href ng-if="value===\'asc\'" ng-click="toggle()">','    <span class="glyphicon glyphicon-sort-by-attributes"></span>',"</a>","</div>"].join(" "),link:function(e,n,t,i){i.$viewChangeListeners.push(function(){e.$eval(t.ngChange)}),i.$render=function(){e.value=i.$modelValue},e.toggle=function(){e.value="asc"===e.value?"dsc":"asc",i.$setViewValue(e.value)}}}})}(angular),function(e){e.module("gp-common").directive("stringArrayInput",function(){return{restrict:"A",require:"ngModel",link:function(e,n,t,i){function o(e){var n=null;return e&&e.length&&(n=e.split(",").map(function(e){return e.trim()})),n}function r(e){var n=null;return e&&void 0!==e.push&&(n=e.join(", ")),n}i.$parsers.push(o),i.$formatters.push(r)}}})}(angular),function(e,n){n.module("gp-common").filter("fixLabel",function(){return function(e){return e=e||"",e.replace(/_/g," ")}}).filter("pluralize",function(){return function(e){return e&&e.length?e.endsWith("ss")?e+"es":e.endsWith("s")?e:e+"s":""}}).filter("capitalize",function(){return function(e){return e[0].toUpperCase()+e.substring(1)}}).filter("facets",function(){return function(e,n){return n?e&&e.length?e.filter(function(e){return e.toLowerCase().startsWith(n+":")}).map(function(e){return e.substring(e.indexOf(":")+1,e.length)}):[]:e}}).filter("joinBy",function(){return function(e,n,t){return e&&void 0!==e.push&&e.length?e.join(n||", "):t||""}}).filter("defaultValue",function(){return function(e,n){return void 0!==e&&e.length?e:n}}).filter("count",function(){return function(e){if(void 0!==e){if("function"==typeof e.push)return e.length;if("object"===(void 0===e?"undefined":_typeof(e))&&void 0!==Object.keys)return Object.keys(e)}return 0}}).filter("gpObjTypeMapper",function(){return function(e){if(!e||"string"!=typeof e||0===e.length)return e;var n=e,t=e.indexOf(":");return~t&&(n=e.substring(t+1)),"VCard"===n?"Contact":n}}).filter("gpReliabilityGrade",function(){return function(e){var n=e;return"object"===(void 0===n?"undefined":_typeof(n))&&(n=n.statistics?n.statistics.reliability||null:n.reliability?n.reliability:null),isNaN(n)?"X":(n*=1,null===n||void 0===n?"X":n>90?"A":n>80?"B":n>70?"C":n>60?"D":"F")}})}(jQuery,angular),function(e,n){function t(t,i,w,S){function I(e,n){t.$broadcast(e,n)}function _(e,n){var t=void 0===n||!0===n;M&&i.cancel(M),M=i(function(){M=null,x(t)},e||100)}function x(n){n&&(A.start=0),L=!0,I(z+"querying");var t={},i=e.copy(A);e.forEach(b,function(e){var n=e.parameter,o=i[e.option],r=null!==o&&void 0!==o,s=r&&void 0!==o.push;!r||s&&!o.length?delete t[n]:t[n]=s?o.join(","):o,delete i[e.option]}),e.forEach(i,function(e,n){if(null!==e&&void 0!==e){var i=void 0!==e.push;t[n]=i?e.join(","):e}else delete t[n]});var o=[];for(var r in A.facets)A.facets.hasOwnProperty(r)&&o.push(r+":"+A.facets[r].replace(/,/g,"%2C"));N=o;var s=A.start;isNaN(s)?s=0:s*=1,t.page=Math.floor(s/A.size),t.size=A.size,t.sort=A.sort,o.length&&(t.facets=o.join(",")),t.bust=(new Date).getTime(),t.includeFacet=U.join(","),t.fields=D.join(","),T.query(t).$promise.then(function(e){j=e.results,P=e.facets||[],V.each(function(e){var n=j.find(function(n){return n._id===e});n&&(n.selected=!0)}),A.total=e.totalResults,L=!1,I(z+"results"),I(z+"pagination")}).catch(function(e){L=!1;var n={error:"An Error Occurred",message:"No details provided"};if(e&&e.data?n=e.data:e&&e.message&&(n=e),"string"==typeof n)try{n=JSON.parse(n)}catch(e){n.message="Bad response from server"}var t={label:n.error||"An Error Occurred",message:n.message||"No details provided"};I(z+"error",t)})}function C(e,n,t){if(A[e]=n,void 0===t||t){var i=500;null!==n&&void 0!==n||(i=0),n&&void 0!==n.push&&n.length?i=0:n&&n.length&&(i=0),_(i)}}var O=S&&S.url?S.url+"/:id":n.ualUrl+"/api/items/:id",z="gp:browse:"+(S&&S.key?S.key:"objects")+":",T=w(O,{id:"@id"},{query:{isArray:!1}}),E=k.slice(0);S&&S.pageSizeBase&&12===S.pageSizeBase&&(E=$.slice(0));var A={start:0,size:E[0],total:0,sort:S&&S.sort?S.sort:"modified,desc",facets:{}},D=S&&S.fields?S.fields:o.slice(0),U=S&&S.facets?S.facets:r.slice(0),P=[],N=[],j=[],M=null,L=!1,V=[],q=S&&S.onSelect?S.onSelect:null;return{events:{LOADING:z+"querying",RESULTS:z+"results",PAGINATION:z+"pagination",SELECTED:z+"selected",ERROR:z+"error",SELECTED_ADDED:z+"selected:added",SELECTED_REMOVED:z+"selected:removed"},getLoadingStatus:function(){return L},on:function(e,n){return t.$on(e,n)},trigger:function(e,n){I(e,n)},getResults:function(){return j},getFacetNames:function(){return r.slice(0)},getFacets:function(){return P},getFacet:function(e){return P?P.find(function(n){return n.name===e}):null},addFacet:function(e){U.push(e)},applyConstraints:function(e){for(var n in e)e.hasOwnProperty(n)&&(A[n]=e[n]);x(!0)},applyOption:function(e,n,t){C(e,n,t)},applyOptions:function(n,t){e.forEach(n,function(e,n){C(n,e,!1)}),t&&x(!0)},setQuery:function(e,n){C(h,e,n)},setTypes:function(e,n){C(a,e,n)},getTypes:function(){return A[a]},setUser:function(e,n){C(u,e,n)},setCreatedBy:function(e,n){C(d,e,n)},setThemes:function(e,n){C(l,e,n)},getThemes:function(){return A[l]},setAgencies:function(e,n){C(c,e,n)},getAgencies:function(){return A[c]},setServiceTypes:function(e,n){C(p,e,n)},getServiceTypes:function(){return A[p]},setSchemes:function(e,n){C(f,e,n)},setVisibility:function(e,n){C(g,e,n)},setModified:function(e,n,t){if(!e)return C(m,null,!1),void C(y,null,!0);var i=n&&(!0===n||"true"===n),o=i?m:y,r=i?y:m,s=e&&e.getTime?e.getTime():e;C(r,null,!1),C(o,s,!0)},getModified:function(){return this._options[m]||this._options[y]},setExtent:function(e){C(v,e,!0)},getExtent:function(){return A[v]},getSelected:function(){return V},setSelected:function(e){V=e,I(this.events.SELECTED,V)},select:function(e){var n=function(n){return n.id===e},t=V.find(n);if(t){var i=V.indexOf(t);i>=0&&(V.splice(i,1),I(z+"selected:removed",t))}else{var o=j.find(n);o&&(q?q(e,function(e,n){n&&(V.unshift(n),I(z+"selected:added",n))}):(V.unshift(o),I(z+"selected:added",o)))}I(this.events.SELECTED,V)},isSelected:function(e){return V.find(function(n){return n.id===e})},selectAll:function(){var n=this;e.forEach(j,function(e){n.isSelected(e.id)||V.unshift(e)}),I(this.events.SELECTED,V)},clearSelected:function(){V=[],I(this.events.SELECTED,[])},clear:function(e){for(var n in A)A.hasOwnProperty(n)&&("start"===n?A[n]=0:"size"===n||(A[n]="sort"===n?"modified,desc":"facets"===n?{}:null));(e||void 0===e)&&x(!0)},setFacet:function(e,n){var t=A.facets[e];t&&t===n?delete A.facets[e]:A.facets[e]=n,x(!0)},setFields:function(e){e&&void 0!==e.push&&(D=e)},start:function(e,n){A.start=e,n&&!0===n&&x(!1)},size:function(e,n){A.size=e;var t=Math.floor(1*A.start/A.size*1);A.start=t*(1*A.size),n&&!0===n&&x(!1)},pageSize:function(e){this.size(e,!0)},sort:function(e){A.sort=e,x(!1)},getPagination:function(){return{start:A.start,size:A.size,pageSize:A.size,total:A.total,sizeOptions:E}},getSortOptions:function(){return s.slice(0)},getSortValue:function(){return A.sort},getQueryOptions:function(){return jQuery.extend({},A)},hasQueryOptions:function(){var e=!1;for(var n in A)if(A.hasOwnProperty(n)){if("start"===n||"size"===n||"total"===n||"sort"===n||"order"===n||"within"===n||"facets"===n)continue;N.length&&(e=!0),void 0!==A[n]&&null!==A[n]&&(e=!0)}return e},update:function(e){_(0,e)},reset:function(){A={start:0,size:E[0],total:0,sort:"modified,desc",order:"asc",facets:{}},P=[],N=[],j=[],L=!1,V=[],M&&i.cancel(M),M=null},destroy:function(){M&&i.cancel(M)}}}function i(e,n,i){return function(o){var r=t(e,n,i,o);return o&&o.params&&r.applyOptions(o.params),r}}var o=["created","modified","publishers","themes","description","extent"],r=["types","themes","publishers","serviceTypes","schemes","visibility","createdBy"],s=[{value:"label,asc",label:"Name (A-Z)"},{value:"label,desc",label:"Name (Z-A)"},{value:"type,asc",label:"Type (A-Z)"},{value:"type,desc",label:"Type (Z-A)"},{value:"modified,desc",label:"Most recently modified"},{value:"modified,asc",label:"Least recently modified"}],a="types",l="themes",c="publishers",u="user",d="createdBy",p="serviceTypes",f="schemes",g="visibility",h="query",v="extent",m="modified.max",y="modified.min",b=[{option:a,parameter:"type"},{option:l,parameter:"theme.id"},{option:c,parameter:"publisher.id"},{option:u,parameter:"creator.id"},{option:d,parameter:"createdBy"},{option:p,parameter:"serviceType.id"},{option:f,parameter:"scheme.id"},{option:g,parameter:"visibility"},{option:h,parameter:"q"},{option:v,parameter:"bbox"},{option:m,parameter:"modified.max"},{option:y,parameter:"modified.min"}],k=[10,20,50,100],$=[12,24,48,96];e.module("gp-common").service("BrowseObjectsService",["$rootScope","$timeout","$resource",t]).factory("BrowseServiceFactory",["$rootScope","$timeout","$resource","BrowseObjectsService",i])}(angular,GeoPlatform),function(e){var n=function(){function n(e,t){"ngInject";var i=this;_classCallCheck(this,n);var o="object"===(void 0===t?"undefined":_typeof(t))?t:{};for(var r in o)this[r]=o[r];return this.socket=null,this.tracking={},this.events={CREATED:"created",UPDATED:"updated",DELETED:"deleted",EDITING:"editing",STATUS:"status"},"undefined"==typeof io?void console.log("Socket.IO not found in global namespace"):e?(this.socket=io.connect(e),this.socket.on("init",function(e){i.socketId=e.id}),void this.socket.on("error",function(){console.log("Unable to connect to "+e+" with websockets")})):void console.log("No web socket URL configured for this app to communicate with")}return n.$inject=["url","options"],_createClass(n,[{key:"getId",value:function(){return this.socketId}},{key:"on",value:function(e,n){var t=this;return this.socket?(this.socket.on(e,n),function(){t.socket.off(e,n)}):function(){}}},{key:"emit",value:function(e,n,t){this.socket&&this.socket.emit(e,n,t)}},{key:"close",value:function(){var n=this;for(var t in this.tracking)if(this.tracking.hasOwnProperty(t)){var i=this.tracking[t];i&&i.length&&e.forEach(i,function(e){n.end(t,e)})}return this.socket&&(this.socket.close(),this.socket=null),null}},{key:"begin",value:function(e,n){var t=this;this.tracking[e]=this.tracking[e]||[],this.tracking[e].push(n);var i=n+"_"+e.toLowerCase();this.join(i,function(){t.socket.emit(e,i,t.socketId,!0)})}},{key:"end",value:function(e,n){var t=this;if(this.tracking[e]=this.tracking[e]||[],this.tracking[e].length){var i=this.tracking[e].indexOf(n);i<0&&this.tracking[e].splice(i,1);var o=n+"_"+e.toLowerCase();this.socket.emit(e,o,this.socketId,!1,function(){t.leave(o)})}}},{key:"join",value:function(e,n){this.emit("join",e,n)}},{key:"leave",value:function(e,n){this.emit("leave",e,n)}}]),n}();e.module("gp-common").factory("SocketServiceFactory",["$rootScope","$window","UUID",function(e,t,i){var o={},r=function(e){for(var n in o)o.hasOwnProperty(n)&&(o[n].close(),o[n]=null);return o=null,null};if("function"===t.onbeforeunload){var s=t.onbeforeunload;t.onbeforeunload=function(e){return r(),s(e)}}else t.onbeforeunload=r;return e.$on("$destroy",r),function(t){var r=i(),s=new n(t,e,{cacheRef:r}),a=s.close;s.close=function(){var e=s.cacheRef;a.call(s),delete o[e]};var l=s.on;s.on=function(n,t){if("function"==typeof t){var i=function(){var n=arguments;e.$apply(function(){t.apply(s.socket,n)})};return l.call(s,n,i)}return l.call(s,n)};var c=s.emit;return s.emit=function(n,t,i){if("function"==typeof i){var o=function(){var n=arguments;e.$apply(function(){i.apply(s.socket,n)})};c.call(s,n,t,o)}else c.call(s,n,t)},o[r]=s,s}}])}(angular),function(e){e.module("gp-common").factory("UUID",function(){return function(){for(var e=[],n="0123456789abcdef",t=0;t<36;t++)e[t]=n.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=n.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}})}(angular),function(e){function n(){return"localhost"===window.location.hostname||~window.location.hostname.indexOf("192.168")||~window.location.hostname.indexOf("10.0")}e.module("gp-common").service("AuthenticationService",["$q","$http","GPConfig",function(e,t,i){function o(e){for(var n in e)this[n]=e[n];!this.id&&this.username&&(this.id=this.username),this.toJSON=function(){return{id:this.id,username:this.username,name:this.name,email:this.email,org:this.org,roles:this.roles}},this.clone=function(){return new o(this.toJSON())},this.compare=function(e){return e instanceof o?this.id===e.id:"object"===(void 0===e?"undefined":_typeof(e))&&(void 0!==e.id&&e.id===this.id)},this.isAuthorized=function(e){var n=i.env||i.ENV||i.NODE_ENV;return"dev"===n||"development"===n||this.roles&&~this.roles.indexOf(e)}}function r(e){if(!e||!e.length)return null;var n={},t=decodeURIComponent(e),i=t.split("+");return i=i.map(function(e){var t=e.split(":");n[t[0]]=t.slice(1).join(":")}),n.groups=n.groups?n.groups.split(","):[],n}function s(){var e=document.cookie.replace(/(?:(?:^|.*;\s*)AUTHENTICATEDGEOSAML\s*\=\s*([^;]*).*$)|^.*$/,"$1"),n=r(e);return n?n.groups:[]}var a=new o({id:"tester",username:"tester",email:"tester@geoplatform.us",name:"John Test",org:"Other"}),l=null;n()&&(l=GeoPlatform&&GeoPlatform.TEST_NO_AUTH?null:a.clone());var c={NONE:0,INITIALIZING:-1,INITIALIZED:1};return new function(){var r=this;this.status=c.NONE,this.getUserQ=function(){var n=e.defer();return this.getUser(function(e){n.resolve(e)}),n.promise},this.getUser=function(e){return e&&"function"==typeof e?void(r.status===c.INITIALIZED?e(l):r.status!==c.INITIALIZING?r.check().then(function(n){r.status=c.INITIALIZED,e(n)},function(){r.status=c.INITIALIZED,e(null)}):setTimeout(function(){r.getUser(e)},500)):l},this.login=function(){if(n()&&(!GeoPlatform||!GeoPlatform.TEST_NO_AUTH))return l=a.clone();var e=window.location.href;window.location=i.idspUrl+"/module.php/core/as_login.php?AuthId=geosaml&ReturnTo="+encodeURIComponent(e)},this.logout=function(){if(n())return l=null;var e=window.location.href;window.location=i.idspUrl+"/module.php/core/as_logout.php?AuthId=geosaml&ReturnTo="+encodeURIComponent(e)},this.check=function(){var a=e.defer();return n()?(setTimeout(function(){a.resolve(l)},1e3),a.promise):(r.status=c.INITIALIZING,t.get(i.idspUrl+"/authenticategeosaml.php?as=geosaml").then(function(e){var n=e.data?e.data:e;if("string"==typeof n)try{n=JSON.parse(n)}catch(e){return void a.reject(e)}l=n.Success?new o({id:n.name[0],username:n.name[0],email:n.mail[0],name:n.first_name[0]+" "+n.last_name[0],org:n.organization[0],roles:s()}):null,a.resolve(l)},function(e,n,t){a.reject(e)}).catch(function(e){a.reject(e.message)}),a.promise)},this.check().then(function(e){r.status=c.INITIALIZED},function(e){r.status=c.INITIALIZED}).catch(function(e){})}}]).directive("gpLoginButton",["$timeout","AuthenticationService","GPConfig",function(e,n,t){return{scope:{minimal:"@"},replace:!0,template:['<div class="btn-account btn-group">  <a class="btn btn-link" ng-click="login()" ng-if="!user">Sign In</a>  <button type="button" class="btn btn-link dropdown-toggle" data-toggle="dropdown"    aria-expanded="false" ng-if="user">     <span class="glyphicon glyphicon-user"></span>      <span class="hidden-xs">{{::user.name}}</span>      <span class="caret"></span>  </button>  <ul class="dropdown-menu dropdown-menu-right" role="menu" ng-if="user">    <li class="account-details">      <div class="media">        <div class="media-left">          <div class="media-object">            <span class="glyphicon glyphicon-user glyphicon-xlg"></span>          </div>        </div>        <div class="media-body">          <div class="media-heading">{{::user.name}}</div>          <div><em>{{::user.username}}</em></div>          <div>{{::user.email}}</div>          <div>{{::user.org}}</div>        </div>      </div>    </li>    <li class="divider"></li>    <li><a href="{{::idpUrl}}/modifyuser.html">Edit Info</a></li>    <li><a href="{{::idpUrl}}/changepassword.html">Change Password</a></li>    <li><a href ng-click="logout()">Sign Out</a></li>  </ul></div>'].join(" "),controller:["$scope","$element",function(i,o){"true"===i.minimal&&(i.minimal=!0),!0!==i.minimal&&(i.minimal=!1),i.idpUrl=t.idmUrl,n.getUser(function(n){e(function(){i.user=n},100)}),i.login=function(){i.user=n.login()},i.logout=function(){i.user=n.logout()};var r=i.$watch(function(){return n.getUser()},function(e){i.user=e});i.$on("$destroy",function(){r()})}]}}]).directive("gpAccountDetails",["$timeout","AuthenticationService","GPConfig",function(e,n,t){return{scope:{},replace:!0,template:['<div>  <div class="media">','    <div class="media-left">','        <div class="media-object">','            <span class="glyphicon glyphicon-user glyphicon-xlg"></span>',"        </div>","    </div>",'    <div class="media-body" ng-if="user">','       <div class="media-heading">{{::user.name}}</div>       <div><small><em>{{::user.username}}</em></small></div>       <div><small>{{::user.email}}</small></div>       <div><small>{{::user.org}}</small></div>    </div>','    <div class="media-body" ng-if="!user">','       <div class="media-heading">Please Sign In</div>       <div><small>Sign in to your GeoPlatform account or register a new account.</small></div>    </div>',"  </div>","  <hr/>",'  <div ng-if="user">','    <button type="button" class="btn btn-sm btn-accent pull-right" ng-click="logout()">Sign Out</button>    <a class="btn btn-sm btn-default" href="{{::idpUrl}}/modifyuser.html">Edit Details</a>  </div>','  <div ng-if="!user">','    <button type="button" class="btn btn-sm btn-accent pull-right" ng-click="login()">Sign In</button>    <a class="btn btn-sm btn-default" href="{{::idpUrl}}/registeruser.html">Register</a>  </div>',"</div>"].join(" "),controller:["$scope","$element",function(i,o){i.idpUrl=t.idmUrl,n.getUser(function(n){e(function(){i.user=n},100)}),i.login=function(){i.user=n.login()},i.logout=function(){i.user=n.logout()};var r=i.$watch(function(){return n.getUser()},function(e){i.user=e});i.$on("$destroy",function(){r()})}]}}])}(angular),function(){void 0===Array.prototype.find&&(Array.prototype.find=function(e){for(var n=0;n<this.length;++n)if(e(this[n],n,this))return this[n];return null}),void 0===Array.prototype.filter&&(Array.prototype.filter=function(e){for(var n=[],t=0;t<this.length;++t)e(this[t],t,this)&&n.push(this[t]);return n}),void 0===Array.prototype.each&&(Array.prototype.each=function(e){for(var n=0;n<this.length;++n)e(this[n],n,this)}),void 0===Array.prototype.indexOfObj&&(Array.prototype.indexOfObj=function(e,n){var t=this,i=t.length;"function"!=typeof n&&(n=function(e,n){return e===n});for(var o=0;o<i;++o)if(n(e,t[o]))return o;return-1}),void 0===String.prototype.startsWith&&(String.prototype.startsWith=function(e){var n=this;return!!n.length&&(!!e.length&&(!(n.length<e.length)&&0===n.indexOf(e)))}),void 0===String.prototype.endsWith&&(String.prototype.endsWith=function(e){var n=this;return!!n.length&&(!!e.length&&(!(n.length<e.length)&&n.substring(n.length-e.length,n.length)==e))}),void 0===Date.prototype.plus&&(Date.prototype.plus=function(e){var n=void 0===e?"undefined":_typeof(e);if("undefined"===n)return this;var t=0;if("string"===n)switch(e){case"hour":t=36e5;break;case"day":t=864e5;break;case"week":t=6048e5;break;case"month":t=26784e5;break;case"year":t=31536e6}else{if("number"!==n)return this;t=e}var i=this;return new Date(i.getTime()+t)}),void 0===Date.prototype.random&&(Date.prototype.random=function(e){var n=void 0===e?"undefined":_typeof(e);if("undefined"===n)return this;var t=0;if("string"===n)switch(e){case"hour":t=36e5;break;case"day":t=864e5;break;case"week":t=6048e5;break;case"month":t=26784e5;break;case"year":t=31536e6}else{if("number"!==n)return this;t=e}var i=this;return new Date(i.getTime()+Math.floor(Math.random()*t))})}();
//# sourceMappingURL=geoplatform.common.min.js.map
