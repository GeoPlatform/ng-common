!function(e,t){"use strict";t.module("gp-common",[]).constant("idspBaseUrl",GeoPlatform.idspUrl).constant("idmBaseUrl",GeoPlatform.idmUrl).value("GPConfig",GeoPlatform)}(jQuery,angular),function(e){"use strict";function t(){return"localhost"===window.location.hostname||~window.location.hostname.indexOf("192.168")||~window.location.hostname.indexOf("10.0")}e.module("gp-common").service("AuthenticationService",["$q","$http","GPConfig",function(e,n,i){function o(e){for(var t in e)this[t]=e[t];!this.id&&this.username&&(this.id=this.username),this.toJSON=function(){return{id:this.id,username:this.username,name:this.name,email:this.email,org:this.org}},this.clone=function(){return new o(this.toJSON())},this.compare=function(e){return e instanceof o?this.id===e.id:"object"==typeof e?"undefined"!=typeof e.id&&e.id===this.id:!1}}var a=new o({id:"tester",username:"tester",email:"tester@geoplatform.us",name:"John Test",org:"Other"}),s=null;t()&&(s=a.clone());var r={NONE:0,INITIALIZING:-1,INITIALIZED:1},l=function(){var l=this;this.status=r.NONE,this.getUserQ=function(){var t=e.defer();return this.getUser(function(e){t.resolve(e)}),t.promise},this.getUser=function(e){return e&&"function"==typeof e?void(l.status===r.INITIALIZED?e(s):l.status!==r.INITIALIZING?l.check().then(function(t){l.status=r.INITIALIZED,e(t)},function(){l.status=r.INITIALIZED,e(null)}):setTimeout(function(){l.getUser(e)},500)):s},this.login=function(){if(t())return s=a.clone();var e=window.location.href;window.location=i.idspUrl+"/module.php/core/as_login.php?AuthId=geosaml&ReturnTo="+encodeURIComponent(e)},this.logout=function(){if(t())return s=null;var e=window.location.href;window.location=i.idspUrl+"/module.php/core/as_logout.php?AuthId=geosaml&ReturnTo="+encodeURIComponent(e)},this.check=function(){var a=e.defer();return t()?(setTimeout(function(){a.resolve(s)},1e3),a.promise):(l.status=r.INITIALIZING,n.get(i.idspUrl+"/authenticategeosaml.php?as=geosaml").success(function(e){s=e.Success?new o({id:e.name[0],username:e.name[0],email:e.mail[0],name:e.first_name[0]+" "+e.last_name[0],org:e.organization[0]}):null,a.resolve(s)}).error(function(e,t,n){console.log("Authentication call failed"),a.reject(e)}),a.promise)},this.check().then(function(e){l.status=r.INITIALIZED},function(e){l.status=r.INITIALIZED})};return new l}]).directive("gpLoginButton",["$timeout","AuthenticationService","GPConfig",function(e,t,n){return{scope:{minimal:"@"},template:['<div class="btn-account btn-group" ng-if="!user" >    <a class="hidden-xs btn btn-link" ng-click="login()">        <span class="glyphicon glyphicon-user"></span>        Sign In    </a>    <button type="button" class="visible-xs btn btn-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false">        <span class="glyphicon glyphicon-user"></span>        <span class="caret"></span>    </button>    <ul class="dropdown-menu dropdown-menu-right" role="menu">        <li><a ng-click="login()">Sign In</a></li>    </ul></div><div class="btn-account btn-group" ng-if="user" >  <button type="button" class="btn btn-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false">     <span class="glyphicon glyphicon-user"></span>      <span class="hidden-xs">{{::user.name}}</span>      <span class="caret"></span>  </button>  <ul class="dropdown-menu dropdown-menu-right" role="menu">    <li class="account-details">      <div class="media">        <div class="media-left">          <div class="media-object">            <span class="glyphicon glyphicon-user glyphicon-xlg"></span>          </div>        </div>        <div class="media-body">          <div class="media-heading">{{::user.name}}</div>          <div><em>{{::user.username}}</em></div>          <div>{{::user.email}}</div>          <div>{{::user.org}}</div>        </div>      </div>    </li>    <li class="divider"></li>    <li><a href="{{::idpUrl}}/modifyuser.html">Edit Info</a></li>    <li><a href="{{::idpUrl}}/changepassword.html">Change Password</a></li>    <li><a href ng-click="logout()">Sign Out</a></li>  </ul></div>'].join(" "),controller:["$scope","$element",function(i,o){"true"===i.minimal&&(i.minimal=!0),i.minimal!==!0&&(i.minimal=!1),i.idpUrl=n.idmUrl,t.getUser(function(t){e(function(){i.user=t},100)}),i.login=function(){i.user=t.login()},i.logout=function(){i.user=t.logout()};var a=i.$watch(function(){return t.getUser()},function(e){i.user=e});i.$on("$destroy",function(){a()})}]}}]).directive("gpAccountDetails",["$timeout","AuthenticationService","GPConfig",function(e,t,n){return{scope:{},replace:!0,template:['<div>  <div class="media">','    <div class="media-left">','        <div class="media-object">','            <span class="glyphicon glyphicon-user glyphicon-xlg"></span>',"        </div>","    </div>",'    <div class="media-body" ng-if="user">','       <div class="media-heading">{{::user.name}}</div>       <div><small><em>{{::user.username}}</em></small></div>       <div><small>{{::user.email}}</small></div>       <div><small>{{::user.org}}</small></div>    </div>','    <div class="media-body" ng-if="!user">','       <div class="media-heading">Please Sign In</div>       <div><small>Sign in to your GeoPlatform account or register a new account.</small></div>    </div>',"  </div>","  <hr/>",'  <div ng-if="user">','    <button type="button" class="btn btn-sm btn-accent pull-right" ng-click="logout()">Sign Out</button>    <a class="btn btn-sm btn-default" href="{{::idpUrl}}/modifyuser.html">Edit Details</a>  </div>','  <div ng-if="!user">','    <button type="button" class="btn btn-sm btn-accent pull-right" ng-click="login()">Sign In</button>    <a class="btn btn-sm btn-default" href="{{::idpUrl}}/registeruser.html">Register</a>  </div>',"</div>"].join(" "),controller:["$scope","$element",function(i,o){i.idpUrl=n.idmUrl,t.getUser(function(t){e(function(){i.user=t},100)}),i.login=function(){i.user=t.login()},i.logout=function(){i.user=t.logout()};var a=i.$watch(function(){return t.getUser()},function(e){i.user=e});i.$on("$destroy",function(){a()})}]}}])}(angular),function(){"use strict";"undefined"==typeof Array.prototype.find&&(Array.prototype.find=function(e){for(var t=0;t<this.length;++t)if(e(this[t],t,this))return this[t];return null}),"undefined"==typeof Array.prototype.filter&&(Array.prototype.filter=function(e){for(var t=[],n=0;n<this.length;++n)e(this[n],n,this)&&t.push(this[n]);return t}),"undefined"==typeof Array.prototype.each&&(Array.prototype.each=function(e){for(var t=0;t<this.length;++t)e(this[t],t,this)}),"undefined"==typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){var t=this;return t.length&&e.length?t.length<e.length?!1:0===t.indexOf(e):!1}),"undefined"==typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){var t=this;if(!t.length)return!1;if(!e.length)return!1;if(t.length<e.length)return!1;var n=t.substring(t.length-e.length,t.length);return n==e}),"undefined"==typeof Date.prototype.plus&&(Date.prototype.plus=function(e){var t=typeof e;if("undefined"===t)return this;var n=0;if("string"===t)switch(e){case"hour":n=36e5;break;case"day":n=864e5;break;case"week":n=6048e5;break;case"month":n=26784e5;break;case"year":n=31536e6}else{if("number"!==t)return this;n=e}var i=this;return new Date(i.getTime()+n)}),"undefined"==typeof Date.prototype.random&&(Date.prototype.random=function(e){var t=typeof e;if("undefined"===t)return this;var n=0;if("string"===t)switch(e){case"hour":n=36e5;break;case"day":n=864e5;break;case"week":n=6048e5;break;case"month":n=26784e5;break;case"year":n=31536e6}else{if("number"!==t)return this;n=e}var i=this;return new Date(i.getTime()+Math.floor(Math.random()*n))})}(),function(e,t){"use strict";t.module("gp-common").directive("gpDatePicker",["$timeout",function(e){return{scope:{label:"@",format:"@",date:"=",onChange:"&?"},template:['<div class="input-group-slick">','    <input type="text" class="form-control" placeholder="{{::label}}"','        datepicker-popup="{{format}}" ng-model="date" is-open="opened" />','    <span class="glyphicon glyphicon-calendar" ng-click="toggle($event)"></span>',"</div>",'<p class="help-block"><small><em>Ex: "2015-01-31" or "Jan 31 2015"</em></small></p>'].join(" "),controller:["$scope","$element","$attrs",function(t,n,i){t.toggle=function(e){e.preventDefault(),e.stopPropagation(),this.opened=!this.opened},t.format||(t.format="MMM dd yyyy");var o=null;t.debounce=function(){o&&e.cancel(o),o=e(function(){o=null,t.onChange&&t.onChange()},200)},t.$watch("date",function(){t.debounce()});var a=t.$on("$destroy",function(){a(),o&&e.cancel(o),o=null,t.opened=!1,t.onChange=null,t.format=null,t.debounce=null})}]}}])}(jQuery,angular),function(e,t){"use strict";t.module("gp-common").directive("gpGeolocation",["$window",function(e){var t="Locate";return{scope:{label:"=?"},restrict:"EA",template:['<a class="btn btn-primary" ng-click="geolocate()" ng-if="available">','  <span class="glyphicon glyphicon-screenshot" ng-if="!loading"></span>','  <span class="glyphicon glyphicon-hourglass glyphicon-spin" ng-if="loading"></span>',"  {{btnLabel}}","</a>",'<div ng-if="error">{{error}}</div>'].join(" "),controller:["$scope",function(n){n.btnLabel=n.label||t,n.loading=!1,n.available=e.navigator&&e.navigator.geolocation,n.available||(n.error="Your browser does not support determining location"),n.geolocate=function(){n.loading=!0,e.navigator.geolocation.getCurrentPosition(function(e){n.$apply(function(){n.loading=!1}),n.$emit("map:geolocation",e.coords.latitude,e.coords.longitude)},function(e){switch(e.code){case 1:n.error="Permission was denied while attempting to determine location";break;case 2:n.error="Unable to determine your location";break;case 3:n.error="Unable to determine location in a reasonable amount of time"}})}}]}}])}(jQuery,angular),function(e,t){"use strict";t.module("gp-common").directive("gpHeader",["GPConfig","AuthenticationService",function(e,t){return{scope:{brand:"@",showHomeLink:"@"},restrict:"AE",transclude:!0,replace:!0,template:["<header>",'  <div class="container-fluid">','    <div class="row">','      <div class="col-md-12">','        <ul role="menu" class="header__menu" gp-header-menu>','          <li ng-if="showHomeLink">','            <a href="#/goHome">','                <span class="glyphicon glyphicon-home"></span> ','                <span class="hidden-xs hidden-sm">Home</span>',"            </a>","          </li>",'          <div class="transcluded"></div>',"          <li><span gp-login-button></span></li>","        </ul>",'        <h4 class="brand">','          <a href="{{portalUrl}}" title="Go to the GeoPlatform Home Page">','            <span class="icon-gp"></span>','            <span class="hidden-xs">GeoPlatform</span>',"          </a>","          {{brand}}","        </h4>","      </div>","    </div>","  </div>","</header>"].join(" "),link:function(n,i,o,a,s){n.showHomeLink="true"===n.showHomeLink||!1,n.portalUrl=e.portalUrl,t.getUserQ().then(function(e){n.user=e}),i.find(".transcluded").replaceWith(s())}}}]).directive("gpHeaderMenu",["$location",function(e){function t(t){var i=e.path();"/"!==i&&"/#"!==i&&"/#/"!==i||(i=n),"/"===i[0]&&(i=i.substring(1));var o=t;o.find("li.active").removeClass("active"),o.find('li > a[href="#/'+i+'"]').parent().addClass("active"),o.find("li > a").each(function(e,t){var n=$(t),o=n.attr("href");o&&(o=o.replace("#/",""),0===i.indexOf(o)&&n.parent().addClass("active"))})}var n="#/goHome";return{scope:{homeHref:"@"},restrict:"A",controller:["$rootScope","$scope","$element",function(e,t,i){t.homeHref&&(n=t.homeHref)}],link:function(e,n){t(n),e.$root.$on("$locationChangeSuccess",function(){t(n)})}}}])}(jQuery,angular),function(e){"use strict";e.module("gp-common").directive("iframeOnload",function(){return{scope:{callback:"&iframeOnload"},link:function(e,t,n){t.on("load",function(n){return t.off("load"),e.callback(n)})}}})}(angular),function(e){"use strict";e.module("gp-common").directive("onImgFail",function(){return{scope:{onImgFail:"@"},link:function(e,t){var n=jQuery(t);n.on("error",function(){n.attr("src",e.onImgFail)})}}})}(angular),function(e){"use strict";e.module("gp-common").service("NotificationService",["$rootScope",function(e){var t=function(){this.items=[]};return t.prototype={getItems:function(){return this.items},addItem:function(t){this.items.push(t),e.$broadcast("gp:notifications:new",t);var n=function(e){this.removeItem(e)};return n.bind(this,t)},removeItem:function(e){var t=this.items.indexOf(e);return t>=0?this.items.splice(t,1):null},error:function(e,t,n){return this.addItem({type:"error",label:e,message:t,canDismiss:n})},success:function(e,t,n){return this.addItem({type:"success",label:e,message:t,canDismiss:n})},info:function(e,t,n){return this.addItem({type:"info",label:e,message:t,canDismiss:n})}},new t}]).directive("gpNotifications",["$timeout","NotificationService",function(e,t){return{scope:{expiration:"@"},template:['<div class="notifications ng-hide" ng-show="items.length">','  <div class="notification" ng-repeat="item in items"',"    ng-class=\"{'notification--success':item.type==='success', 'notification--error':item.type==='error', 'notification--info':item.type==='info'}\">",'    <h5 class="notification__title">','        <span class="pull-right glyphicon" ',"            ng-class=\"{'glyphicon-ok-sign':item.type==='success','glyphicon-exclamation-sign':item.type==='error','glyphicon-info-sign':item.type==='info'}\">","        </span>","        {{item.label}}","    </h5>",'    <p class="notification__content" ng-bind-html="item.message"></p>','    <div class="notification__actions" ng-if="item.canDismiss">','        <button type="button" class="btn btn-link" ng-click="dismiss(item)">dismiss</button>',"    </div>","  </div>","</div>"].join(" "),link:function(n,i,o){function a(){n.items=t.getItems(),n.timer&&(e.cancel(n.timer),n.timer=null),n.timer=e(function(){n.timer=null,n.removeOldest()},n.expiration)}n.expiration=1*(n.expiration||2e3),n.items=[],a(),n.removeOldest=function(){var e=n.items.find(function(e){return e.canDismiss});e&&t.removeItem(e)},n.dismiss=function(e){t.removeItem(e)},n.$watchCollection(function(){return t.getItems()},a)}}}])}(angular),function(e,t){"use strict";t.module("gp-common").directive("gpPagination",function(){function e(e,t){function n(){var t=1*e.start,n=1*e.pageSize,i=[],o=5;o%2!==0?Math.ceil(o/2):o/2;if(e.total>0){var a=Math.ceil(e.total/n),s=Math.floor(t/n),r=0;r=s>Math.floor(o/2)?s-Math.floor(o/2):0;for(var l=Math.min(r+o,a);r>0&&o>l-r;)r-=1;for(var c=r;l>c;++c){var u=c*n+1,d=Math.min(u+n-1,e.total);i.push({label:c+1+"",tooltip:"Results "+u+"-"+d}),c==s&&(i[i.length-1].active=!0)}}e.pages=i}e.previous=function(){e.start=Math.max(0,1*e.start-1*e.pageSize),e.$emit("pagination:change",e.start,e.pageSize)},e.next=function(){e.start=Math.min(e.total,1*e.start+1*e.pageSize),e.$emit("pagination:change",e.start,e.pageSize)},e.setPage=function(t){var n=1*t;e.start=(n-1)*(1*e.pageSize),e.$emit("pagination:change",e.start,e.pageSize)},e.setPageSize=function(t){e.pageSize=1*t;var n=Math.floor(e.start/e.pageSize)+1;e.setPage(n)},e.hasPrevious=function(){return e.start>0},e.hasNext=function(){return e.start+e.pageSize<e.total},n(),e.$watch("start",n),e.$watch("pageSize",n),e.$watch("total",n)}return e.$inject=["$scope","$element"],{scope:{start:"=",pageSize:"=",total:"="},replace:!0,template:["<div>",'  <div class="visible-xs row">','    <div class="col-xs-6">{{total}} results</div>','    <div class="col-xs-6">','      <select class="form-control" ng-model="pageSize">','        <option value="5">5 per page</option>','        <option value="10">10 per page</option>','        <option value="25">25 per page</option>','        <option value="50">50 per page</option>',"      </select>","    </div>","  </div>",'  <ul class="pagination">','    <li class="info hidden-xs">',"      <a>{{total}} results</a>","    </li>",'    <li class="pagination-control hidden-xs" ng-if="total>0">',"      <span uib-dropdown>",'        <a href="" uib-dropdown-toggle title="Change the number of results returned">','          {{pageSize}} per page <span class="caret"></span>',"        </a>",'        <ul class="dropdown-menu" role="menu">','          <li><a href="" ng-click="setPageSize(5)">5 per page</a></li>','          <li><a href="" ng-click="setPageSize(10)">10 per page</a></li>','          <li><a href="" ng-click="setPageSize(25)">25 per page</a></li>','          <li><a href="" ng-click="setPageSize(50)">50 per page</a></li>',"        </ul>","      </span>","    </li>",'    <li class="separator hidden-xs"></li>','    <li ng-if="hasPrevious()">','      <a ng-click="previous()">','        <span class="glyphicon glyphicon-backward"></span>',"      </a>","    </li>",'    <li ng-repeat="page in pages" ng-class="{active:page.active,disabled:page.disabled}">','      <a ng-click="setPage(page.label)" title="{{::page.tooltip}}">{{::page.label}}</a>',"    </li>",'    <li ng-if="hasNext()">','      <a ng-click="next()">','        <span class="glyphicon glyphicon-forward"></span>',"      </a>","    </li>","  </ul>","</div>"].join(" "),controller:e}})}(jQuery,angular),function(e,t){"use strict";t.module("gp-common").provider("responsiveHelper",["$windowProvider",function(e){function t(e){this.window=e}var n=e.$get();t.prototype={getWidth:function(){return n.innerWidth||n.outerWidth},isXS:function(){var e=this.getWidth();return 768>e},isSM:function(){var e=this.getWidth();return e>=768&&992>e},isMD:function(){var e=this.getWidth();return e>=992&&1200>e},isLG:function(){var e=this.getWidth();return e>=1200}};var i=new t(n);this.$get=function(){return i}}]).directive("gpResponsive",["$window","responsiveHelper",function(e,n){return{restrict:"A",link:function(i,o,a){function s(e,t){t.isXS()?e.addClass("gp-responsive-xs"):e.removeClass("gp-responsive-xs"),t.isSM()?e.addClass("gp-responsive-sm"):e.removeClass("gp-responsive-sm"),t.isMD()?e.addClass("gp-responsive-md"):e.removeClass("gp-responsive-md"),t.isLG()?e.addClass("gp-responsive-lg"):e.removeClass("gp-responsive-lg")}s(o,n);var r=function(){s(o,n)},l=t.element(e);l.on("resize",r);i.$on("$destroy",function(){l.off("resize",r)})}}}]).directive("gpResize",["$window","$timeout",function(n,i){return function(o,a,s){var r=function(){var t=e("header")[0].offsetHeight,n=t+2,i={top:n+"px"};a.css(i),o.$apply()},l=t.element(n);l.on("resize",r),i(r,200),o.$on("$destroy",function(){l.off("resize",r)})}}])}(jQuery,angular),function(e){"use strict";e.module("gp-common").directive("gpTweetButton",["$timeout",function(e){function t(e,t,n){var i;return function(){var o=this,a=arguments,s=function(){i=null,n||e.apply(o,a)},r=n&&!i;clearTimeout(i),i=setTimeout(s,t),r&&e.apply(o,a)}}return{link:function(n,i,o){if("undefined"==typeof twttr)return void(i.className+=" disabled");var a=t(function(){o.url&&e(function(){i[0].innerHTML="",twttr.widgets.createShareButton(o.url,i[0],function(){},{count:o.count,text:o.text,via:o.via,size:o.size,hashtags:o.hashtags,dnt:o.dnt})})},75);o.$observe("url",a),o.$observe("text",a)}}}])}(angular),function(e){"use strict";e.module("gp-common").directive("sortOrder",function(){return{replace:!0,require:"ngModel",template:["<div>",'<a class="btn btn-default" title="Click to sort in ascending order" href ng-if="value===\'dsc\'" ng-click="toggle()">','    <span class="glyphicon glyphicon-sort-by-attributes-alt"></span>',"</a>",'<a class="btn btn-default" title="Click to sort in descending order" href ng-if="value===\'asc\'" ng-click="toggle()">','    <span class="glyphicon glyphicon-sort-by-attributes"></span>',"</a>","</div>"].join(" "),link:function(e,t,n,i){i.$viewChangeListeners.push(function(){e.$eval(n.ngChange)}),i.$render=function(){e.value=i.$modelValue},e.toggle=function(){e.value="asc"===e.value?"dsc":"asc",i.$setViewValue(e.value)}}}})}(angular),function(e,t){"use strict";t.module("gp-common").filter("fixLabel",function(){return function(e){return e=e||"",e.replace(/_/g," ")}}).filter("pluralize",function(){return function(e){return e&&e.length?e.endsWith("ss")?e+"es":e.endsWith("s")?e:e+"s":""}}).filter("facets",function(){return function(e,t){return t?e&&e.length?e.filter(function(e){return e.toLowerCase().startsWith(t+":")}).map(function(e){return e.substring(e.indexOf(":")+1,e.length)}):[]:e}}).filter("joinBy",function(){return function(e,t,n){return e.length?e.join(t||", "):n||""}})}(jQuery,angular);
//# sourceMappingURL=geoplatform.common.min.js.map
