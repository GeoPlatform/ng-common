import { ItemTypes } from '@geoplatform/client';
import { ItemHelper } from './item-helper';
var Visibilities = {
    PUBLIC: 'public',
    PRIVATE: 'private'
};
var Statuses = {
    SUBMITTED: 'submitted'
};
function createItem(type, opts) {
    return Object.assign({
        type: type,
        uri: null,
        label: "New Item",
        description: "This item needs a description",
        resourceTypes: [],
        createdBy: null,
        lastModifiedBy: null
    }, opts || {});
}
function createAsset(type, opts) {
    var options = Object.assign({
        keywords: [],
        alternateTitles: [],
        purpose: null,
        themes: [],
        contacts: [],
        publishers: [],
        contributors: [],
        distributions: [],
        classifiers: {},
        landingPage: null,
        status: Statuses.SUBMITTED,
        visibility: Visibilities.PUBLIC,
        identifiers: [],
        extent: { minx: -179, miny: -89, maxx: 179, maxy: 89 },
        temporal: { startDate: null, endDate: null },
        statistics: { numViews: 0, numLikes: 0 },
        usedBy: [],
        related: [],
        rights: []
    }, opts || {});
    var item = createItem(type, options);
    return item;
}
function createMap() {
    var obj = createAsset(ItemTypes.MAP, {
        layers: [],
        baseLayer: null,
        annotations: {},
        thumbnail: {
            label: null,
            url: null,
            contentData: null,
            width: 0,
            height: 0
        }
    });
    return obj;
}
function createLayer(service) {
    var services = service ? [service] : [];
    var obj = createAsset(ItemTypes.LAYER, {
        subLayers: [],
        parentLayer: null,
        services: services,
        layerName: null,
        layerType: null,
        legend: null
    });
    return obj;
}
function createService() {
    var obj = createAsset(ItemTypes.SERVICE, {
        datasets: [],
        serviceType: null,
        href: null
    });
    return obj;
}
function createDataset() {
    var obj = createAsset(ItemTypes.DATASET, { services: [] });
    return obj;
}
function createGallery() {
    var obj = createAsset(ItemTypes.GALLERY, { items: [] });
    return obj;
}
function createCommunity() {
    var obj = createAsset(ItemTypes.COMMUNITY);
    return obj;
}
function createConcept() {
    var obj = createItem(ItemTypes.CONCEPT, { scheme: null });
    return obj;
}
function createConceptScheme() {
    var obj = createItem(ItemTypes.CONCEPT_SCHEME);
    return obj;
}
function createOrg() {
    var obj = createItem(ItemTypes.ORGANIZATION, { subOrgOf: null });
    return obj;
}
function createContact() {
    var obj = createItem(ItemTypes.CONTACT, {
        fullName: null,
        email: null,
        tel: null,
        fax: null,
        address: {
            street1: null,
            street2: null,
            city: null,
            state: null,
            zip: null
        }
    });
    return obj;
}
function defaultArrayValue(item, property) {
    if (!item || !property)
        return;
    if (item[property] === null || item[property] === undefined ||
        typeof (item[property]) === 'undefined')
        item[property] = [];
}
function defaultToNullValue(item, property) {
    if (!item || !property)
        return;
    if (typeof (item[property]) === 'undefined')
        item[property] = null;
}
var ItemFactory = /** @class */ (function () {
    function ItemFactory() {
    }
    ItemFactory.create = function (type) {
        switch (type) {
            case ItemTypes.MAP: return createMap();
            case ItemTypes.LAYER: return createLayer();
            case ItemTypes.SERVICE: return createService();
            case ItemTypes.DATASET: return createDataset();
            case ItemTypes.GALLERY: return createGallery();
            case ItemTypes.COMMUNITY: return createCommunity();
            case ItemTypes.CONCEPT: return createConcept();
            case ItemTypes.CONCEPT_SCHEME: return createConceptScheme();
            case ItemTypes.ORGANIZATION: return createOrg();
            case ItemTypes.CONTACT: return createContact();
            default: return null;
        }
    };
    ItemFactory.fix = function (item) {
        defaultArrayValue(item, 'resourceTypes');
        if (ItemHelper.isAsset(item)) {
            defaultArrayValue(item, 'keywords');
            defaultArrayValue(item, 'alternateTitles');
            defaultArrayValue(item, 'themes');
            defaultArrayValue(item, 'contacts');
            defaultArrayValue(item, 'publishers');
            defaultArrayValue(item, 'contributors');
            defaultArrayValue(item, 'distributions');
            defaultArrayValue(item, 'identifiers');
            defaultArrayValue(item, 'usedBy');
            defaultArrayValue(item, 'related');
            defaultArrayValue(item, 'accessRights');
            defaultToNullValue(item, 'purpose');
            defaultToNullValue(item, 'landingPage');
            defaultToNullValue(item, 'status');
            defaultToNullValue(item, 'visibility');
            if (!item.temporal) {
                item.temporal = { startDate: null, endDate: null };
            }
            if (!item.extent) {
                item.extent = { minx: -179, miny: -89, maxx: 179, maxy: 89 };
            }
        }
    };
    return ItemFactory;
}());
export { ItemFactory };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaXRlbS1mYWN0b3J5LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdlb3BsYXRmb3JtL2NvbW1vbi8iLCJzb3VyY2VzIjpbIml0ZW0tZmFjdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxPQUFPLEVBSUgsU0FBUyxFQUNaLE1BQU0scUJBQXFCLENBQUM7QUFFN0IsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUczQyxJQUFNLFlBQVksR0FBUztJQUN2QixNQUFNLEVBQUcsUUFBUTtJQUNqQixPQUFPLEVBQUcsU0FBUztDQUN0QixDQUFDO0FBRUYsSUFBTSxRQUFRLEdBQVM7SUFDbkIsU0FBUyxFQUFHLFdBQVc7Q0FDMUIsQ0FBQztBQUlGLFNBQVMsVUFBVSxDQUFDLElBQUksRUFBRSxJQUEwQjtJQUNoRCxPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQUM7UUFDakIsSUFBSSxFQUFZLElBQUk7UUFDcEIsR0FBRyxFQUFhLElBQUk7UUFDcEIsS0FBSyxFQUFXLFVBQVU7UUFDMUIsV0FBVyxFQUFLLCtCQUErQjtRQUMvQyxhQUFhLEVBQUcsRUFBRTtRQUNsQixTQUFTLEVBQU8sSUFBSTtRQUNwQixjQUFjLEVBQUUsSUFBSTtLQUN2QixFQUFFLElBQUksSUFBRSxFQUFFLENBQUMsQ0FBQztBQUNqQixDQUFDO0FBRUQsU0FBUyxXQUFXLENBQUMsSUFBSSxFQUFFLElBQTBCO0lBQ2pELElBQUksT0FBTyxHQUEyQixNQUFNLENBQUMsTUFBTSxDQUFDO1FBQ2hELFFBQVEsRUFBVSxFQUFFO1FBQ3BCLGVBQWUsRUFBRyxFQUFFO1FBQ3BCLE9BQU8sRUFBVyxJQUFJO1FBQ3RCLE1BQU0sRUFBWSxFQUFFO1FBQ3BCLFFBQVEsRUFBVSxFQUFFO1FBQ3BCLFVBQVUsRUFBUSxFQUFFO1FBQ3BCLFlBQVksRUFBTSxFQUFFO1FBQ3BCLGFBQWEsRUFBSyxFQUFFO1FBQ3BCLFdBQVcsRUFBTyxFQUFFO1FBQ3BCLFdBQVcsRUFBTyxJQUFJO1FBQ3RCLE1B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QUFFLElBQUksRUFBRSxFQUFFLEVBQUUsQ0FBQzthQUNoRTtTQUNKO0lBQ0wsQ0FBQztJQUVMLGtCQUFDO0FBQUQsQ0FBQyxBQWpERCxJQWlEQyIsInNvdXJjZXNDb250ZW50IjpbIlxuXG5pbXBvcnQge1xuICAgIEl0ZW0sIEFzc2V0LFxuICAgIE1hcCwgTGF5ZXIsIFNlcnZpY2UsIERhdGFzZXQsIEdhbGxlcnksIENvbW11bml0eSwgQ29uY2VwdCxcbiAgICBDb25jZXB0U2NoZW1lLCBPcmdhbml6YXRpb24sIENvbnRhY3QsXG4gICAgSXRlbVR5cGVzXG59IGZyb20gJ0BnZW9wbGF0Zm9ybS9jbGllbnQnO1xuXG5pbXBvcnQgeyBJdGVtSGVscGVyIH0gZnJvbSAnLi9pdGVtLWhlbHBlcic7XG5cblxuY29uc3QgVmlzaWJpbGl0aWVzIDogYW55ID0ge1xuICAgIFBVQkxJQyA6ICdwdWJsaWMnLFxuICAgIFBSSVZBVEUgOiAncHJpdmF0ZSdcbn07XG5cbmNvbnN0IFN0YXR1c2VzIDogYW55ID0ge1xuICAgIFNVQk1JVFRFRCA6ICdzdWJtaXR0ZWQnXG59O1xuXG5cblxuZnVuY3Rpb24gY3JlYXRlSXRlbSh0eXBlLCBvcHRzID86IHtba2V5OnN0cmluZ106YW55fSkgOiBhbnkge1xuICAgIHJldHVybiBPYmplY3QuYXNzaWduKHtcbiAgICAgICAgdHlwZTogICAgICAgICAgIHR5cGUsXG4gICAgICAgIHVyaTogICAgICAgICAgICBudWxsLFxuICAgICAgICBsYWJlbDogICAgICAgICAgXCJOZXcgSXRlbVwiLFxuICAgICAgICBkZXNjcmlwdGlvbjogICAgXCJUaGlzIGl0ZW0gbmVlZHMgYSBkZXNjcmlwdGlvblwiLFxuICAgICAgICByZXNvdXJjZVR5cGVzOiAgW10sXG4gICAgICAgIGNyZWF0ZWRCeTogICAgICBudWxsLFxuICAgICAgICBsYXN0TW9kaWZpZWRCeTogbnVsbFxuICAgIH0sIG9wdHN8fHt9KTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlQXNzZXQodHlwZSwgb3B0cyA/OiB7W2tleTpzdHJpbmddOmFueX0pIDogYW55IHtcbiAgICBsZXQgb3B0aW9ucyA6IHtba2V5OnN0cmluZ106c3RyaW5nfSA9IE9iamVjdC5hc3NpZ24oe1xuICAgICAgICBrZXl3b3JkcyAgICAgICAgOiBbXSxcbiAgICAgICAgYWx0ZXJuYXRlVGl0bGVzIDogW10sXG4gICAgICAgIHB1cnBvc2UgICAgICAgICA6IG51bGwsXG4gICAgICAgIHRoZW1lcyAgICAgICAgICA6IFtdLFxuICAgICAgICBjb250YWN0cyAgICAgICAgOiBbXSxcbiAgICAgICAgcHVibGlzaGVycyAgICAgIDogW10sXG4gICAgICAgIGNvbnRyaWJ1dG9ycyAgICA6IFtdLFxuICAgICAgICBkaXN0cmlidXRpb25zICAgOiBbXSxcbiAgICAgICAgY2xhc3NpZmllcnMgICAgIDoge30sXG4gICAgICAgIGxhbmRpbmdQYWdlICAgICA6IG51bGwsXG4gICAgICAgIHN0YXR1cyAgICAgICAgICA6IFN0YXR1c2VzLlNVQk1JVFRFRCxcbiAgICAgICAgdmlzaWJpbGl0eSAgICAgIDogVmlzaWJpbGl0aWVzLlBVQkxJQyxcbiAgICAgICAgaWRlbnRpZmllcnMgICAgIDogW10gYXMgc3RyaW5nW10sXG4gICAgICAgIGV4dGVudCAgICAgICAgICA6IHsgbWlueDogLTE3OSwgbWlueTogLTg5LCBtYXh4OiAxNzksIG1heHk6IDg5IH0sXG4gICAgICAgIHRlbXBvcmFsICAgICAgICA6IHsgc3RhcnREYXRlOiBudWxsLCBlbmREYXRlOiBudWxsIH0sXG4gICAgICAgIHN0YXRpc3RpY3MgICAgICA6IHsgbnVtVmlld3M6IDAsIG51bUxpa2VzOiAwIH0sXG4gICAgICAgIHVzZWRCeSAgICAgICAgICA6IFtdLFxuICAgICAgICByZWxhdGVkICAgICAgICAgOiBbXSxcbiAgICAgICAgcmlnaHRzICAgICAgICAgIDogW11cbiAgICB9LCBvcHRzfHx7fSk7XG4gICAgbGV0IGl0ZW0gPSBjcmVhdGVJdGVtKHR5cGUsIG9wdGlvbnMpO1xuICAgIHJldHVybiBpdGVtIGFzIEFzc2V0O1xufVxuXG5cblxuZnVuY3Rpb24gY3JlYXRlTWFwKCkgOiBNYXAge1xuICAgIGxldCBvYmogPSBjcmVhdGVBc3NldChJdGVtVHlwZXMuTUFQLCB7XG4gICAgICAgIGxheWVycyAgICAgIDogW10sXG4gICAgICAgIGJhc2VMYXllciAgIDogbnVsbCxcbiAgICAgICAgYW5ub3RhdGlvbnMgOiB7fSxcbiAgICAgICAgdGh1bWJuYWlsICAgOiB7XG4gICAgICAgICAgICBsYWJlbCAgICAgICA6IG51bGwsXG4gICAgICAgICAgICB1cmwgICAgICAgICA6IG51bGwsXG4gICAgICAgICAgICBjb250ZW50RGF0YSA6IG51bGwsXG4gICAgICAgICAgICB3aWR0aCAgICAgICA6IDAsXG4gICAgICAgICAgICBoZWlnaHQgICAgICA6IDBcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBvYmogYXMgTWFwO1xufVxuXG5cbmZ1bmN0aW9uIGNyZWF0ZUxheWVyKCBzZXJ2aWNlID86IFNlcnZpY2UgKSA6IE1hcCB7XG4gICAgbGV0IHNlcnZpY2VzID0gc2VydmljZSA/IFtzZXJ2aWNlXSA6IFtdO1xuICAgIGxldCBvYmogPSBjcmVhdGVBc3NldChJdGVtVHlwZXMuTEFZRVIsIHtcbiAgICAgICAgc3ViTGF5ZXJzICAgOiBbXSxcbiAgICAgICAgcGFyZW50TGF5ZXIgOiBudWxsLFxuICAgICAgICBzZXJ2aWNlcyAgICA6IHNlcnZpY2VzLFxuICAgICAgICBsYXllck5hbWUgICA6IG51bGwsXG4gICAgICAgIGxheWVyVHlwZSAgIDogbnVsbCxcbiAgICAgICAgbGVnZW5kICAgICAgOiBudWxsXG4gICAgfSk7XG4gICAgcmV0dXJuIG9iaiBhcyBNYXA7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVNlcnZpY2UoKSA6IFNlcnZpY2Uge1xuICAgIGxldCBvYmogPSBjcmVhdGVBc3NldChJdGVtVHlwZXMuU0VSVklDRSwge1xuICAgICAgICBkYXRhc2V0cyAgICA6IFtdLFxuICAgICAgICBzZXJ2aWNlVHlwZSA6IG51bGwsXG4gICAgICAgIGhyZWYgICAgICAgIDogbnVsbFxuICAgIH0pO1xuICAgIHJldHVybiBvYmogYXMgU2VydmljZTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlRGF0YXNldCgpIDogRGF0YXNldCB7XG4gICAgbGV0IG9iaiA9IGNyZWF0ZUFzc2V0KEl0ZW1UeXBlcy5EQVRBU0VULCB7IHNlcnZpY2VzIDogW10gfSk7XG4gICAgcmV0dXJuIG9iaiBhcyBEYXRhc2V0O1xufVxuXG5mdW5jdGlvbiBjcmVhdGVHYWxsZXJ5KCkgOiBHYWxsZXJ5IHtcbiAgICBsZXQgb2JqID0gY3JlYXRlQXNzZXQoSXRlbVR5cGVzLkdBTExFUlksIHsgaXRlbXMgOiBbXSB9KTtcbiAgICByZXR1cm4gb2JqIGFzIEdhbGxlcnk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUNvbW11bml0eSgpIDogQ29tbXVuaXR5IHtcbiAgICBsZXQgb2JqID0gY3JlYXRlQXNzZXQoSXRlbVR5cGVzLkNPTU1VTklUWSk7XG4gICAgcmV0dXJuIG9iaiBhcyBDb21tdW5pdHk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUNvbmNlcHQoKSA6IENvbmNlcHQge1xuICAgIGxldCBvYmogPSBjcmVhdGVJdGVtKEl0ZW1UeXBlcy5DT05DRVBULCB7IHNjaGVtZSA6IG51bGwgfSk7XG4gICAgcmV0dXJuIG9iaiBhcyBDb25jZXB0O1xufVxuXG5mdW5jdGlvbiBjcmVhdGVDb25jZXB0U2NoZW1lKCkgOiBDb25jZXB0U2NoZW1lIHtcbiAgICBsZXQgb2JqID0gY3JlYXRlSXRlbShJdGVtVHlwZXMuQ09OQ0VQVF9TQ0hFTUUpO1xuICAgIHJldHVybiBvYmogYXMgQ29uY2VwdFNjaGVtZTtcbn1cblxuXG5mdW5jdGlvbiBjcmVhdGVPcmcoKSA6IE9yZ2FuaXphdGlvbiB7XG4gICAgbGV0IG9iaiA9IGNyZWF0ZUl0ZW0oSXRlbVR5cGVzLk9SR0FOSVpBVElPTiwgeyBzdWJPcmdPZiA6IG51bGwgfSk7XG4gICAgcmV0dXJuIG9iaiBhcyBPcmdhbml6YXRpb247XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUNvbnRhY3QoKSA6IENvbnRhY3Qge1xuICAgIGxldCBvYmogPSBjcmVhdGVJdGVtKEl0ZW1UeXBlcy5DT05UQUNULCB7XG4gICAgICAgIGZ1bGxOYW1lIDogbnVsbCxcbiAgICAgICAgZW1haWwgICAgOiBudWxsLFxuICAgICAgICB0ZWwgICAgICA6IG51bGwsXG4gICAgICAgIGZheCAgICAgIDogbnVsbCxcbiAgICAgICAgYWRkcmVzcyAgOiB7XG4gICAgICAgICAgICBzdHJlZXQxOiBudWxsLFxuICAgICAgICAgICAgc3RyZWV0MjogbnVsbCxcbiAgICAgICAgICAgIGNpdHk6ICAgIG51bGwsXG4gICAgICAgICAgICBzdGF0ZTogICBudWxsLFxuICAgICAgICAgICAgemlwOiAgICAgbnVsbFxuICAgICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIG9iaiBhcyBDb250YWN0O1xufVxuXG5cblxuXG5cblxuZnVuY3Rpb24gZGVmYXVsdEFycmF5VmFsdWUoaXRlbSwgcHJvcGVydHkpIHtcbiAgICBpZighaXRlbSB8fCAhcHJvcGVydHkpIHJldHVybjtcbiAgICBpZiggaXRlbVtwcm9wZXJ0eV0gPT09IG51bGwgfHwgaXRlbVtwcm9wZXJ0eV0gPT09IHVuZGVmaW5lZCB8fFxuICAgICAgICB0eXBlb2YoaXRlbVtwcm9wZXJ0eV0pID09PSAndW5kZWZpbmVkJyApXG4gICAgICAgIGl0ZW1bcHJvcGVydHldID0gW107XG59XG5cbmZ1bmN0aW9uIGRlZmF1bHRUb051bGxWYWx1ZShpdGVtLCBwcm9wZXJ0eSkge1xuICAgIGlmKCFpdGVtIHx8ICFwcm9wZXJ0eSkgcmV0dXJuO1xuICAgIGlmKCB0eXBlb2YoaXRlbVtwcm9wZXJ0eV0pID09PSAndW5kZWZpbmVkJyApXG4gICAgICAgIGl0ZW1bcHJvcGVydHldID0gbnVsbDtcbn1cblxuXG5cbmV4cG9ydCBjbGFzcyBJdGVtRmFjdG9yeSB7XG5cbiAgICBzdGF0aWMgY3JlYXRlKHR5cGUpIHtcbiAgICAgICAgc3dpdGNoKHR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgSXRlbVR5cGVzLk1BUCA6IHJldHVybiBjcmVhdGVNYXAoKTtcbiAgICAgICAgICAgIGNhc2UgSXRlbVR5cGVzLkxBWUVSIDogcmV0dXJuIGNyZWF0ZUxheWVyKCk7XG4gICAgICAgICAgICBjYXNlIEl0ZW1UeXBlcy5TRVJWSUNFIDogcmV0dXJuIGNyZWF0ZVNlcnZpY2UoKTtcbiAgICAgICAgICAgIGNhc2UgSXRlbVR5cGVzLkRBVEFTRVQgOiByZXR1cm4gY3JlYXRlRGF0YXNldCgpO1xuICAgICAgICAgICAgY2FzZSBJdGVtVHlwZXMuR0FMTEVSWSA6IHJldHVybiBjcmVhdGVHYWxsZXJ5KCk7XG4gICAgICAgICAgICBjYXNlIEl0ZW1UeXBlcy5DT01NVU5JVFk6IHJldHVybiBjcmVhdGVDb21tdW5pdHkoKTtcbiAgICAgICAgICAgIGNhc2UgSXRlbVR5cGVzLkNPTkNFUFQgOiByZXR1cm4gY3JlYXRlQ29uY2VwdCgpO1xuICAgICAgICAgICAgY2FzZSBJdGVtVHlwZXMuQ09OQ0VQVF9TQ0hFTUU6IHJldHVybiBjcmVhdGVDb25jZXB0U2NoZW1lKCk7XG4gICAgICAgICAgICBjYXNlIEl0ZW1UeXBlcy5PUkdBTklaQVRJT046IHJldHVybiBjcmVhdGVPcmcoKTtcbiAgICAgICAgICAgIGNhc2UgSXRlbVR5cGVzLkNPTlRBQ1Q6IHJldHVybiBjcmVhdGVDb250YWN0KCk7XG4gICAgICAgICAgICBkZWZhdWx0OiByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHN0YXRpYyBmaXgoaXRlbSkge1xuXG4gICAgICAgIGRlZmF1bHRBcnJheVZhbHVlKGl0ZW0sICdyZXNvdXJjZVR5cGVzJyk7XG5cbiAgICAgICAgaWYoSXRlbUhlbHBlci5pc0Fzc2V0KGl0ZW0pKSB7XG4gICAgICAgICAgICBkZWZhdWx0QXJyYXlWYWx1ZShpdGVtLCAna2V5d29yZHMnKTtcbiAgICAgICAgICAgIGRlZmF1bHRBcnJheVZhbHVlKGl0ZW0sICdhbHRlcm5hdGVUaXRsZXMnKTtcbiAgICAgICAgICAgIGRlZmF1bHRBcnJheVZhbHVlKGl0ZW0sICd0aGVtZXMnKTtcbiAgICAgICAgICAgIGRlZmF1bHRBcnJheVZhbHVlKGl0ZW0sICdjb250YWN0cycpO1xuICAgICAgICAgICAgZGVmYXVsdEFycmF5VmFsdWUoaXRlbSwgJ3B1Ymxpc2hlcnMnKTtcbiAgICAgICAgICAgIGRlZmF1bHRBcnJheVZhbHVlKGl0ZW0sICdjb250cmlidXRvcnMnKTtcbiAgICAgICAgICAgIGRlZmF1bHRBcnJheVZhbHVlKGl0ZW0sICdkaXN0cmlidXRpb25zJyk7XG4gICAgICAgICAgICBkZWZhdWx0QXJyYXlWYWx1ZShpdGVtLCAnaWRlbnRpZmllcnMnKTtcbiAgICAgICAgICAgIGRlZmF1bHRBcnJheVZhbHVlKGl0ZW0sICd1c2VkQnknKTtcbiAgICAgICAgICAgIGRlZmF1bHRBcnJheVZhbHVlKGl0ZW0sICdyZWxhdGVkJyk7XG4gICAgICAgICAgICBkZWZhdWx0QXJyYXlWYWx1ZShpdGVtLCAnYWNjZXNzUmlnaHRzJyk7XG5cbiAgICAgICAgICAgIGRlZmF1bHRUb051bGxWYWx1ZShpdGVtLCAncHVycG9zZScpO1xuICAgICAgICAgICAgZGVmYXVsdFRvTnVsbFZhbHVlKGl0ZW0sICdsYW5kaW5nUGFnZScpO1xuICAgICAgICAgICAgZGVmYXVsdFRvTnVsbFZhbHVlKGl0ZW0sICdzdGF0dXMnKTtcbiAgICAgICAgICAgIGRlZmF1bHRUb051bGxWYWx1ZShpdGVtLCAndmlzaWJpbGl0eScpO1xuXG4gICAgICAgICAgICBpZighaXRlbS50ZW1wb3JhbCkge1xuICAgICAgICAgICAgICAgIGl0ZW0udGVtcG9yYWwgPSB7c3RhcnREYXRlOiBudWxsLCBlbmREYXRlOiBudWxsfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKCFpdGVtLmV4dGVudCkge1xuICAgICAgICAgICAgICAgIGl0ZW0uZXh0ZW50ID0geyBtaW54OiAtMTc5LCBtaW55OiAtODksIG1heHg6IDE3OSwgbWF4eTogODkgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxufVxuIl19