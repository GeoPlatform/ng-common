import { ngGpoauthFactory } from '@geoplatform/oauth-ng/angular';
;
var AUTH_KEYS = [
    'AUTH_TYPE', 'IDP_BASE_URL', 'APP_BASE_URL', 'ALLOW_SSO_LOGIN',
    'APP_ID', 'ALLOW_IFRAME_LOGIN', 'FORCE_LOGIN', 'CALLBACK',
    'LOGIN_URL', 'LOGOUT_URL', 'ALLOW_DEV_EDITS'
];
var authService = null;
export function authServiceFactory(environment) {
    // if(!environment.production) {
    //     //while in development mode, don't create an
    //     //instance of the gpoauth.AuthService because
    //     //it will endlessly keep reloading the page
    //     //trying to validate tokens
    //     return null;
    // }
    //once service has been built, keep using it
    if (authService)
        return authService;
    //
    //but the first time it's requested, it has to be built using env settings
    var authSettings = {};
    var gpGlobal = window.GeoPlatform;
    if (gpGlobal && gpGlobal.config && gpGlobal.config.auth) {
        //auth library settings made available through WP via 'GeoPlatform' global
        //https://geoplatform.atlassian.net/browse/DT-2307
        authSettings = gpGlobal.config.auth;
    }
    else {
        authSettings.APP_BASE_URL = environment.wpUrl || '';
        AUTH_KEYS.forEach(function (key) {
            var v = environment[key];
            if (typeof (v) !== 'undefined') {
                if (~key.indexOf('ALLOW') || ~key.indexOf('FORCE')) {
                    v = (v === true || v === 'true');
                }
                authSettings[key] = v;
            }
        });
    }
    // console.log("Configuring OAuth using: ");
    // console.log(authSettings);
    authService = ngGpoauthFactory(authSettings);
    return authService;
}
;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aC5mYWN0b3J5LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdlb3BsYXRmb3JtL2NvbW1vbi8iLCJzb3VyY2VzIjpbImF1dGgvYXV0aC5mYWN0b3J5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxnQkFBZ0IsRUFBZSxNQUFNLCtCQUErQixDQUFDO0FBZTdFLENBQUM7QUFDRixJQUFNLFNBQVMsR0FBRztJQUNkLFdBQVcsRUFBRSxjQUFjLEVBQUUsY0FBYyxFQUFFLGlCQUFpQjtJQUM5RCxRQUFRLEVBQUUsb0JBQW9CLEVBQUUsYUFBYSxFQUFFLFVBQVU7SUFDekQsV0FBVyxFQUFFLFlBQVksRUFBRSxpQkFBaUI7Q0FDL0MsQ0FBQztBQUtGLElBQUksV0FBVyxHQUFpQixJQUFJLENBQUM7QUFHckMsTUFBTSxVQUFVLGtCQUFrQixDQUFFLFdBQWlCO0lBRWpELGdDQUFnQztJQUNoQyxtREFBbUQ7SUFDbkQsb0RBQW9EO0lBQ3BELGtEQUFrRDtJQUNsRCxrQ0FBa0M7SUFDbEMsbUJBQW1CO0lBQ25CLElBQUk7SUFFSiw0Q0FBNEM7SUFDNUMsSUFBRyxXQUFXO1FBQUUsT0FBTyxXQUFXLENBQUM7SUFFbkMsRUFBRTtJQUNGLDBFQUEwRTtJQUMxRSxJQUFJLFlBQVksR0FBZ0IsRUFBRSxDQUFDO0lBRW5DLElBQUksUUFBUSxHQUFTLE1BQU8sQ0FBQyxXQUFXLENBQUM7SUFDekMsSUFBRyxRQUFRLElBQUksUUFBUSxDQUFDLE1BQU0sSUFBSSxRQUFRLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRTtRQUNwRCwwRUFBMEU7UUFDMUUsa0RBQWtEO1FBQ2xELFlBQVksR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQztLQUN2QztTQUFNO1FBQ0gsWUFBWSxDQUFDLFlBQVksR0FBRyxXQUFXLENBQUMsS0FBSyxJQUFJLEVBQUUsQ0FBQztRQUNwRCxTQUFTLENBQUMsT0FBTyxDQUFFLFVBQUEsR0FBRztZQUNsQixJQUFJLENBQUMsR0FBRyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDekIsSUFBRyxPQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssV0FBVyxFQUFFO2dCQUMxQixJQUFHLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUU7b0JBQy9DLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxLQUFLLE1BQU0sQ0FBQyxDQUFDO2lCQUNwQztnQkFDRCxZQUFZLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2FBQ3pCO1FBQ0wsQ0FBQyxDQUFDLENBQUM7S0FDTjtJQUVELDRDQUE0QztJQUM1Qyw2QkFBNkI7SUFFN0IsV0FBVyxHQUFHLGdCQUFnQixDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQzdDLE9BQU8sV0FBVyxDQUFDO0FBQ3ZCLENBQUM7QUFBQSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbmdHcG9hdXRoRmFjdG9yeSwgQXV0aFNlcnZpY2UgfSBmcm9tICdAZ2VvcGxhdGZvcm0vb2F1dGgtbmcvYW5ndWxhcic7XG5cbi8vc2hvdWxkIGJlIGV4cG9ydGVkIGJ5IGdwLW5nb2F1dGggYnV0IGlzbid0IHNvIHdlIGFyZSBkZWNsYXJpbmcgaXQgaGVyZS4uLlxuaW50ZXJmYWNlIEF1dGhDb25maWcge1xuICAgIEFVVEhfVFlQRT86ICdncmFudCcgfCAndG9rZW4nXG4gICAgSURQX0JBU0VfVVJMPzogc3RyaW5nXG4gICAgQVBQX0JBU0VfVVJMPzogc3RyaW5nXG4gICAgQUxMT1dfU1NPX0xPR0lOPzogYm9vbGVhblxuICAgIEFQUF9JRD86IGJvb2xlYW5cbiAgICBBTExPV19JRlJBTUVfTE9HSU4/OiBib29sZWFuXG4gICAgRk9SQ0VfTE9HSU4/OiBib29sZWFuXG4gICAgQ0FMTEJBQ0s/OiBzdHJpbmdcbiAgICBMT0dJTl9VUkw/OiBzdHJpbmdcbiAgICBMT0dPVVRfVVJMPzogc3RyaW5nXG4gICAgQUxMT1dfREVWX0VESVRTPzogYm9vbGVhblxufTtcbmNvbnN0IEFVVEhfS0VZUyA9IFtcbiAgICAnQVVUSF9UWVBFJywgJ0lEUF9CQVNFX1VSTCcsICdBUFBfQkFTRV9VUkwnLCAnQUxMT1dfU1NPX0xPR0lOJyxcbiAgICAnQVBQX0lEJywgJ0FMTE9XX0lGUkFNRV9MT0dJTicsICdGT1JDRV9MT0dJTicsICdDQUxMQkFDSycsXG4gICAgJ0xPR0lOX1VSTCcsICdMT0dPVVRfVVJMJywgJ0FMTE9XX0RFVl9FRElUUydcbl07XG5cblxuXG5cbnZhciBhdXRoU2VydmljZSA6IEF1dGhTZXJ2aWNlID0gbnVsbDtcblxuXG5leHBvcnQgZnVuY3Rpb24gYXV0aFNlcnZpY2VGYWN0b3J5KCBlbnZpcm9ubWVudCA6IGFueSApIHtcblxuICAgIC8vIGlmKCFlbnZpcm9ubWVudC5wcm9kdWN0aW9uKSB7XG4gICAgLy8gICAgIC8vd2hpbGUgaW4gZGV2ZWxvcG1lbnQgbW9kZSwgZG9uJ3QgY3JlYXRlIGFuXG4gICAgLy8gICAgIC8vaW5zdGFuY2Ugb2YgdGhlIGdwb2F1dGguQXV0aFNlcnZpY2UgYmVjYXVzZVxuICAgIC8vICAgICAvL2l0IHdpbGwgZW5kbGVzc2x5IGtlZXAgcmVsb2FkaW5nIHRoZSBwYWdlXG4gICAgLy8gICAgIC8vdHJ5aW5nIHRvIHZhbGlkYXRlIHRva2Vuc1xuICAgIC8vICAgICByZXR1cm4gbnVsbDtcbiAgICAvLyB9XG5cbiAgICAvL29uY2Ugc2VydmljZSBoYXMgYmVlbiBidWlsdCwga2VlcCB1c2luZyBpdFxuICAgIGlmKGF1dGhTZXJ2aWNlKSByZXR1cm4gYXV0aFNlcnZpY2U7XG5cbiAgICAvL1xuICAgIC8vYnV0IHRoZSBmaXJzdCB0aW1lIGl0J3MgcmVxdWVzdGVkLCBpdCBoYXMgdG8gYmUgYnVpbHQgdXNpbmcgZW52IHNldHRpbmdzXG4gICAgbGV0IGF1dGhTZXR0aW5ncyA6IEF1dGhDb25maWcgPSB7fTtcblxuICAgIGxldCBncEdsb2JhbCA9ICg8YW55PndpbmRvdykuR2VvUGxhdGZvcm07XG4gICAgaWYoZ3BHbG9iYWwgJiYgZ3BHbG9iYWwuY29uZmlnICYmIGdwR2xvYmFsLmNvbmZpZy5hdXRoKSB7XG4gICAgICAgIC8vYXV0aCBsaWJyYXJ5IHNldHRpbmdzIG1hZGUgYXZhaWxhYmxlIHRocm91Z2ggV1AgdmlhICdHZW9QbGF0Zm9ybScgZ2xvYmFsXG4gICAgICAgIC8vaHR0cHM6Ly9nZW9wbGF0Zm9ybS5hdGxhc3NpYW4ubmV0L2Jyb3dzZS9EVC0yMzA3XG4gICAgICAgIGF1dGhTZXR0aW5ncyA9IGdwR2xvYmFsLmNvbmZpZy5hdXRoO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGF1dGhTZXR0aW5ncy5BUFBfQkFTRV9VUkwgPSBlbnZpcm9ubWVudC53cFVybCB8fCAnJztcbiAgICAgICAgQVVUSF9LRVlTLmZvckVhY2goIGtleSA9PiB7XG4gICAgICAgICAgICBsZXQgdiA9IGVudmlyb25tZW50W2tleV07XG4gICAgICAgICAgICBpZih0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgaWYofmtleS5pbmRleE9mKCdBTExPVycpIHx8IH5rZXkuaW5kZXhPZignRk9SQ0UnKSkge1xuICAgICAgICAgICAgICAgICAgICB2ID0gKHYgPT09IHRydWUgfHwgdiA9PT0gJ3RydWUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYXV0aFNldHRpbmdzW2tleV0gPSB2O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBjb25zb2xlLmxvZyhcIkNvbmZpZ3VyaW5nIE9BdXRoIHVzaW5nOiBcIik7XG4gICAgLy8gY29uc29sZS5sb2coYXV0aFNldHRpbmdzKTtcblxuICAgIGF1dGhTZXJ2aWNlID0gbmdHcG9hdXRoRmFjdG9yeShhdXRoU2V0dGluZ3MpO1xuICAgIHJldHVybiBhdXRoU2VydmljZTtcbn07XG4iXX0=