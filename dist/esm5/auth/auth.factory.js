import { ngGpoauthFactory } from '@geoplatform/oauth-ng/angular';
;
var AUTH_KEYS = [
    'AUTH_TYPE', 'IDP_BASE_URL', 'APP_BASE_URL', 'ALLOW_SSO_LOGIN',
    'APP_ID', 'ALLOW_IFRAME_LOGIN', 'FORCE_LOGIN', 'CALLBACK',
    'LOGIN_URL', 'LOGOUT_URL', 'ALLOW_DEV_EDITS'
];
var authService = null;
export function authServiceFactory(environment) {
    //once service has been built, keep using it
    if (authService)
        return authService;
    //
    //but the first time it's requested, it has to be built using env settings
    var authSettings = {};
    var gpGlobal = window.GeoPlatform;
    if (gpGlobal && gpGlobal.config && gpGlobal.config.auth) {
        //auth library settings made available through WP via 'GeoPlatform' global
        //https://geoplatform.atlassian.net/browse/DT-2307
        authSettings = gpGlobal.config.auth;
    }
    else {
        authSettings.APP_BASE_URL = environment.wpUrl || '';
        AUTH_KEYS.forEach(function (key) {
            var v = environment[key];
            if (typeof (v) !== 'undefined') {
                if (~key.indexOf('ALLOW') || ~key.indexOf('FORCE')) {
                    v = (v === true || v === 'true');
                }
                authSettings[key] = v;
            }
        });
    }
    // console.log("Configuring OAuth using: ");
    // console.log(authSettings);
    authService = ngGpoauthFactory(authSettings);
    return authService;
}
;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aC5mYWN0b3J5LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdlb3BsYXRmb3JtL2NvbW1vbi8iLCJzb3VyY2VzIjpbImF1dGgvYXV0aC5mYWN0b3J5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxnQkFBZ0IsRUFBZSxNQUFNLCtCQUErQixDQUFDO0FBZTdFLENBQUM7QUFDRixJQUFNLFNBQVMsR0FBRztJQUNkLFdBQVcsRUFBRSxjQUFjLEVBQUUsY0FBYyxFQUFFLGlCQUFpQjtJQUM5RCxRQUFRLEVBQUUsb0JBQW9CLEVBQUUsYUFBYSxFQUFFLFVBQVU7SUFDekQsV0FBVyxFQUFFLFlBQVksRUFBRSxpQkFBaUI7Q0FDL0MsQ0FBQztBQUtGLElBQUksV0FBVyxHQUFpQixJQUFJLENBQUM7QUFHckMsTUFBTSxVQUFVLGtCQUFrQixDQUFFLFdBQWlCO0lBRWpELDRDQUE0QztJQUM1QyxJQUFHLFdBQVc7UUFBRSxPQUFPLFdBQVcsQ0FBQztJQUVuQyxFQUFFO0lBQ0YsMEVBQTBFO0lBQzFFLElBQUksWUFBWSxHQUFnQixFQUFFLENBQUM7SUFFbkMsSUFBSSxRQUFRLEdBQVMsTUFBTyxDQUFDLFdBQVcsQ0FBQztJQUN6QyxJQUFHLFFBQVEsSUFBSSxRQUFRLENBQUMsTUFBTSxJQUFJLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFO1FBQ3BELDBFQUEwRTtRQUMxRSxrREFBa0Q7UUFDbEQsWUFBWSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDO0tBQ3ZDO1NBQU07UUFDSCxZQUFZLENBQUMsWUFBWSxHQUFHLFdBQVcsQ0FBQyxLQUFLLElBQUksRUFBRSxDQUFDO1FBQ3BELFNBQVMsQ0FBQyxPQUFPLENBQUUsVUFBQSxHQUFHO1lBQ2xCLElBQUksQ0FBQyxHQUFHLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN6QixJQUFHLE9BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSyxXQUFXLEVBQUU7Z0JBQzFCLElBQUcsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRTtvQkFDL0MsQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLEtBQUssTUFBTSxDQUFDLENBQUM7aUJBQ3BDO2dCQUNELFlBQVksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7YUFDekI7UUFDTCxDQUFDLENBQUMsQ0FBQztLQUNOO0lBRUQsNENBQTRDO0lBQzVDLDZCQUE2QjtJQUU3QixXQUFXLEdBQUcsZ0JBQWdCLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDN0MsT0FBTyxXQUFXLENBQUM7QUFDdkIsQ0FBQztBQUFBLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBuZ0dwb2F1dGhGYWN0b3J5LCBBdXRoU2VydmljZSB9IGZyb20gJ0BnZW9wbGF0Zm9ybS9vYXV0aC1uZy9hbmd1bGFyJztcblxuLy9zaG91bGQgYmUgZXhwb3J0ZWQgYnkgZ3AtbmdvYXV0aCBidXQgaXNuJ3Qgc28gd2UgYXJlIGRlY2xhcmluZyBpdCBoZXJlLi4uXG5pbnRlcmZhY2UgQXV0aENvbmZpZyB7XG4gICAgQVVUSF9UWVBFPzogJ2dyYW50JyB8ICd0b2tlbidcbiAgICBJRFBfQkFTRV9VUkw/OiBzdHJpbmdcbiAgICBBUFBfQkFTRV9VUkw/OiBzdHJpbmdcbiAgICBBTExPV19TU09fTE9HSU4/OiBib29sZWFuXG4gICAgQVBQX0lEPzogYm9vbGVhblxuICAgIEFMTE9XX0lGUkFNRV9MT0dJTj86IGJvb2xlYW5cbiAgICBGT1JDRV9MT0dJTj86IGJvb2xlYW5cbiAgICBDQUxMQkFDSz86IHN0cmluZ1xuICAgIExPR0lOX1VSTD86IHN0cmluZ1xuICAgIExPR09VVF9VUkw/OiBzdHJpbmdcbiAgICBBTExPV19ERVZfRURJVFM/OiBib29sZWFuXG59O1xuY29uc3QgQVVUSF9LRVlTID0gW1xuICAgICdBVVRIX1RZUEUnLCAnSURQX0JBU0VfVVJMJywgJ0FQUF9CQVNFX1VSTCcsICdBTExPV19TU09fTE9HSU4nLFxuICAgICdBUFBfSUQnLCAnQUxMT1dfSUZSQU1FX0xPR0lOJywgJ0ZPUkNFX0xPR0lOJywgJ0NBTExCQUNLJyxcbiAgICAnTE9HSU5fVVJMJywgJ0xPR09VVF9VUkwnLCAnQUxMT1dfREVWX0VESVRTJ1xuXTtcblxuXG5cblxudmFyIGF1dGhTZXJ2aWNlIDogQXV0aFNlcnZpY2UgPSBudWxsO1xuXG5cbmV4cG9ydCBmdW5jdGlvbiBhdXRoU2VydmljZUZhY3RvcnkoIGVudmlyb25tZW50IDogYW55ICkge1xuXG4gICAgLy9vbmNlIHNlcnZpY2UgaGFzIGJlZW4gYnVpbHQsIGtlZXAgdXNpbmcgaXRcbiAgICBpZihhdXRoU2VydmljZSkgcmV0dXJuIGF1dGhTZXJ2aWNlO1xuXG4gICAgLy9cbiAgICAvL2J1dCB0aGUgZmlyc3QgdGltZSBpdCdzIHJlcXVlc3RlZCwgaXQgaGFzIHRvIGJlIGJ1aWx0IHVzaW5nIGVudiBzZXR0aW5nc1xuICAgIGxldCBhdXRoU2V0dGluZ3MgOiBBdXRoQ29uZmlnID0ge307XG5cbiAgICBsZXQgZ3BHbG9iYWwgPSAoPGFueT53aW5kb3cpLkdlb1BsYXRmb3JtO1xuICAgIGlmKGdwR2xvYmFsICYmIGdwR2xvYmFsLmNvbmZpZyAmJiBncEdsb2JhbC5jb25maWcuYXV0aCkge1xuICAgICAgICAvL2F1dGggbGlicmFyeSBzZXR0aW5ncyBtYWRlIGF2YWlsYWJsZSB0aHJvdWdoIFdQIHZpYSAnR2VvUGxhdGZvcm0nIGdsb2JhbFxuICAgICAgICAvL2h0dHBzOi8vZ2VvcGxhdGZvcm0uYXRsYXNzaWFuLm5ldC9icm93c2UvRFQtMjMwN1xuICAgICAgICBhdXRoU2V0dGluZ3MgPSBncEdsb2JhbC5jb25maWcuYXV0aDtcbiAgICB9IGVsc2Uge1xuICAgICAgICBhdXRoU2V0dGluZ3MuQVBQX0JBU0VfVVJMID0gZW52aXJvbm1lbnQud3BVcmwgfHwgJyc7XG4gICAgICAgIEFVVEhfS0VZUy5mb3JFYWNoKCBrZXkgPT4ge1xuICAgICAgICAgICAgbGV0IHYgPSBlbnZpcm9ubWVudFtrZXldO1xuICAgICAgICAgICAgaWYodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIGlmKH5rZXkuaW5kZXhPZignQUxMT1cnKSB8fCB+a2V5LmluZGV4T2YoJ0ZPUkNFJykpIHtcbiAgICAgICAgICAgICAgICAgICAgdiA9ICh2ID09PSB0cnVlIHx8IHYgPT09ICd0cnVlJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGF1dGhTZXR0aW5nc1trZXldID0gdjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gY29uc29sZS5sb2coXCJDb25maWd1cmluZyBPQXV0aCB1c2luZzogXCIpO1xuICAgIC8vIGNvbnNvbGUubG9nKGF1dGhTZXR0aW5ncyk7XG5cbiAgICBhdXRoU2VydmljZSA9IG5nR3BvYXV0aEZhY3RvcnkoYXV0aFNldHRpbmdzKTtcbiAgICByZXR1cm4gYXV0aFNlcnZpY2U7XG59O1xuIl19