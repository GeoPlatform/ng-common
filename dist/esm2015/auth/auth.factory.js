import { ngGpoauthFactory } from '@geoplatform/oauth-ng/angular';
;
const AUTH_KEYS = [
    'AUTH_TYPE', 'IDP_BASE_URL', 'APP_BASE_URL', 'ALLOW_SSO_LOGIN',
    'APP_ID', 'ALLOW_IFRAME_LOGIN', 'FORCE_LOGIN', 'CALLBACK',
    'LOGIN_URL', 'LOGOUT_URL', 'ALLOW_DEV_EDITS'
];
var authService = null;
export function authServiceFactory(environment) {
    // if(!environment.production) {
    //     //while in development mode, don't create an
    //     //instance of the gpoauth.AuthService because
    //     //it will endlessly keep reloading the page
    //     //trying to validate tokens
    //     return null;
    // }
    //once service has been built, keep using it
    if (authService)
        return authService;
    //
    //but the first time it's requested, it has to be built using env settings
    let authSettings = {};
    let gpGlobal = window.GeoPlatform;
    if (gpGlobal && gpGlobal.config && gpGlobal.config.auth) {
        //auth library settings made available through WP via 'GeoPlatform' global
        //https://geoplatform.atlassian.net/browse/DT-2307
        authSettings = gpGlobal.config.auth;
    }
    else {
        authSettings.APP_BASE_URL = environment.wpUrl || '';
        AUTH_KEYS.forEach(key => {
            let v = environment[key];
            if (typeof (v) !== 'undefined') {
                if (~key.indexOf('ALLOW') || ~key.indexOf('FORCE')) {
                    v = (v === true || v === 'true');
                }
                authSettings[key] = v;
            }
        });
    }
    // console.log("Configuring OAuth using: ");
    // console.log(authSettings);
    authService = ngGpoauthFactory(authSettings);
    return authService;
}
;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aC5mYWN0b3J5LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdlb3BsYXRmb3JtL2NvbW1vbi8iLCJzb3VyY2VzIjpbImF1dGgvYXV0aC5mYWN0b3J5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxnQkFBZ0IsRUFBZSxNQUFNLCtCQUErQixDQUFDO0FBZTdFLENBQUM7QUFDRixNQUFNLFNBQVMsR0FBRztJQUNkLFdBQVcsRUFBRSxjQUFjLEVBQUUsY0FBYyxFQUFFLGlCQUFpQjtJQUM5RCxRQUFRLEVBQUUsb0JBQW9CLEVBQUUsYUFBYSxFQUFFLFVBQVU7SUFDekQsV0FBVyxFQUFFLFlBQVksRUFBRSxpQkFBaUI7Q0FDL0MsQ0FBQztBQUtGLElBQUksV0FBVyxHQUFpQixJQUFJLENBQUM7QUFHckMsTUFBTSxVQUFVLGtCQUFrQixDQUFFLFdBQWlCO0lBRWpELGdDQUFnQztJQUNoQyxtREFBbUQ7SUFDbkQsb0RBQW9EO0lBQ3BELGtEQUFrRDtJQUNsRCxrQ0FBa0M7SUFDbEMsbUJBQW1CO0lBQ25CLElBQUk7SUFFSiw0Q0FBNEM7SUFDNUMsSUFBRyxXQUFXO1FBQUUsT0FBTyxXQUFXLENBQUM7SUFFbkMsRUFBRTtJQUNGLDBFQUEwRTtJQUMxRSxJQUFJLFlBQVksR0FBZ0IsRUFBRSxDQUFDO0lBRW5DLElBQUksUUFBUSxHQUFTLE1BQU8sQ0FBQyxXQUFXLENBQUM7SUFDekMsSUFBRyxRQUFRLElBQUksUUFBUSxDQUFDLE1BQU0sSUFBSSxRQUFRLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRTtRQUNwRCwwRUFBMEU7UUFDMUUsa0RBQWtEO1FBQ2xELFlBQVksR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQztLQUN2QztTQUFNO1FBQ0gsWUFBWSxDQUFDLFlBQVksR0FBRyxXQUFXLENBQUMsS0FBSyxJQUFJLEVBQUUsQ0FBQztRQUNwRCxTQUFTLENBQUMsT0FBTyxDQUFFLEdBQUcsQ0FBQyxFQUFFO1lBQ3JCLElBQUksQ0FBQyxHQUFHLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN6QixJQUFHLE9BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSyxXQUFXLEVBQUU7Z0JBQzFCLElBQUcsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRTtvQkFDL0MsQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLEtBQUssTUFBTSxDQUFDLENBQUM7aUJBQ3BDO2dCQUNELFlBQVksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7YUFDekI7UUFDTCxDQUFDLENBQUMsQ0FBQztLQUNOO0lBRUQsNENBQTRDO0lBQzVDLDZCQUE2QjtJQUU3QixXQUFXLEdBQUcsZ0JBQWdCLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDN0MsT0FBTyxXQUFXLENBQUM7QUFDdkIsQ0FBQztBQUFBLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBuZ0dwb2F1dGhGYWN0b3J5LCBBdXRoU2VydmljZSB9IGZyb20gJ0BnZW9wbGF0Zm9ybS9vYXV0aC1uZy9hbmd1bGFyJztcblxuLy9zaG91bGQgYmUgZXhwb3J0ZWQgYnkgZ3AtbmdvYXV0aCBidXQgaXNuJ3Qgc28gd2UgYXJlIGRlY2xhcmluZyBpdCBoZXJlLi4uXG5pbnRlcmZhY2UgQXV0aENvbmZpZyB7XG4gICAgQVVUSF9UWVBFPzogJ2dyYW50JyB8ICd0b2tlbidcbiAgICBJRFBfQkFTRV9VUkw/OiBzdHJpbmdcbiAgICBBUFBfQkFTRV9VUkw/OiBzdHJpbmdcbiAgICBBTExPV19TU09fTE9HSU4/OiBib29sZWFuXG4gICAgQVBQX0lEPzogYm9vbGVhblxuICAgIEFMTE9XX0lGUkFNRV9MT0dJTj86IGJvb2xlYW5cbiAgICBGT1JDRV9MT0dJTj86IGJvb2xlYW5cbiAgICBDQUxMQkFDSz86IHN0cmluZ1xuICAgIExPR0lOX1VSTD86IHN0cmluZ1xuICAgIExPR09VVF9VUkw/OiBzdHJpbmdcbiAgICBBTExPV19ERVZfRURJVFM/OiBib29sZWFuXG59O1xuY29uc3QgQVVUSF9LRVlTID0gW1xuICAgICdBVVRIX1RZUEUnLCAnSURQX0JBU0VfVVJMJywgJ0FQUF9CQVNFX1VSTCcsICdBTExPV19TU09fTE9HSU4nLFxuICAgICdBUFBfSUQnLCAnQUxMT1dfSUZSQU1FX0xPR0lOJywgJ0ZPUkNFX0xPR0lOJywgJ0NBTExCQUNLJyxcbiAgICAnTE9HSU5fVVJMJywgJ0xPR09VVF9VUkwnLCAnQUxMT1dfREVWX0VESVRTJ1xuXTtcblxuXG5cblxudmFyIGF1dGhTZXJ2aWNlIDogQXV0aFNlcnZpY2UgPSBudWxsO1xuXG5cbmV4cG9ydCBmdW5jdGlvbiBhdXRoU2VydmljZUZhY3RvcnkoIGVudmlyb25tZW50IDogYW55ICkge1xuXG4gICAgLy8gaWYoIWVudmlyb25tZW50LnByb2R1Y3Rpb24pIHtcbiAgICAvLyAgICAgLy93aGlsZSBpbiBkZXZlbG9wbWVudCBtb2RlLCBkb24ndCBjcmVhdGUgYW5cbiAgICAvLyAgICAgLy9pbnN0YW5jZSBvZiB0aGUgZ3BvYXV0aC5BdXRoU2VydmljZSBiZWNhdXNlXG4gICAgLy8gICAgIC8vaXQgd2lsbCBlbmRsZXNzbHkga2VlcCByZWxvYWRpbmcgdGhlIHBhZ2VcbiAgICAvLyAgICAgLy90cnlpbmcgdG8gdmFsaWRhdGUgdG9rZW5zXG4gICAgLy8gICAgIHJldHVybiBudWxsO1xuICAgIC8vIH1cblxuICAgIC8vb25jZSBzZXJ2aWNlIGhhcyBiZWVuIGJ1aWx0LCBrZWVwIHVzaW5nIGl0XG4gICAgaWYoYXV0aFNlcnZpY2UpIHJldHVybiBhdXRoU2VydmljZTtcblxuICAgIC8vXG4gICAgLy9idXQgdGhlIGZpcnN0IHRpbWUgaXQncyByZXF1ZXN0ZWQsIGl0IGhhcyB0byBiZSBidWlsdCB1c2luZyBlbnYgc2V0dGluZ3NcbiAgICBsZXQgYXV0aFNldHRpbmdzIDogQXV0aENvbmZpZyA9IHt9O1xuXG4gICAgbGV0IGdwR2xvYmFsID0gKDxhbnk+d2luZG93KS5HZW9QbGF0Zm9ybTtcbiAgICBpZihncEdsb2JhbCAmJiBncEdsb2JhbC5jb25maWcgJiYgZ3BHbG9iYWwuY29uZmlnLmF1dGgpIHtcbiAgICAgICAgLy9hdXRoIGxpYnJhcnkgc2V0dGluZ3MgbWFkZSBhdmFpbGFibGUgdGhyb3VnaCBXUCB2aWEgJ0dlb1BsYXRmb3JtJyBnbG9iYWxcbiAgICAgICAgLy9odHRwczovL2dlb3BsYXRmb3JtLmF0bGFzc2lhbi5uZXQvYnJvd3NlL0RULTIzMDdcbiAgICAgICAgYXV0aFNldHRpbmdzID0gZ3BHbG9iYWwuY29uZmlnLmF1dGg7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgYXV0aFNldHRpbmdzLkFQUF9CQVNFX1VSTCA9IGVudmlyb25tZW50LndwVXJsIHx8ICcnO1xuICAgICAgICBBVVRIX0tFWVMuZm9yRWFjaCgga2V5ID0+IHtcbiAgICAgICAgICAgIGxldCB2ID0gZW52aXJvbm1lbnRba2V5XTtcbiAgICAgICAgICAgIGlmKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBpZih+a2V5LmluZGV4T2YoJ0FMTE9XJykgfHwgfmtleS5pbmRleE9mKCdGT1JDRScpKSB7XG4gICAgICAgICAgICAgICAgICAgIHYgPSAodiA9PT0gdHJ1ZSB8fCB2ID09PSAndHJ1ZScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhdXRoU2V0dGluZ3Nba2V5XSA9IHY7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIGNvbnNvbGUubG9nKFwiQ29uZmlndXJpbmcgT0F1dGggdXNpbmc6IFwiKTtcbiAgICAvLyBjb25zb2xlLmxvZyhhdXRoU2V0dGluZ3MpO1xuXG4gICAgYXV0aFNlcnZpY2UgPSBuZ0dwb2F1dGhGYWN0b3J5KGF1dGhTZXR0aW5ncyk7XG4gICAgcmV0dXJuIGF1dGhTZXJ2aWNlO1xufTtcbiJdfQ==