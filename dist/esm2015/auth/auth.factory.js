import { ngGpoauthFactory } from '@geoplatform/oauth-ng/angular';
import { logger } from "../logger";
;
const AUTH_KEYS = [
    'AUTH_TYPE', 'IDP_BASE_URL', 'APP_BASE_URL', 'ALLOW_SSO_LOGIN',
    'APP_ID', 'ALLOW_IFRAME_LOGIN', 'FORCE_LOGIN', 'CALLBACK',
    'LOGIN_URL', 'LOGOUT_URL', 'ALLOW_DEV_EDITS'
];
var authService = null;
export function authServiceFactory(environment) {
    //once service has been built, keep using it
    if (authService)
        return authService;
    //
    //but the first time it's requested, it has to be built using env settings
    let authSettings = {};
    let gpGlobal = window.GeoPlatform;
    if (gpGlobal && gpGlobal.config && gpGlobal.config.auth) {
        //auth library settings made available through WP via 'GeoPlatform' global
        //https://geoplatform.atlassian.net/browse/DT-2307
        authSettings = gpGlobal.config.auth;
    }
    else {
        authSettings.APP_BASE_URL = environment.wpUrl || '';
        AUTH_KEYS.forEach(key => {
            let v = environment[key];
            if (typeof (v) !== 'undefined') {
                if (~key.indexOf('ALLOW') || ~key.indexOf('FORCE')) {
                    v = (v === true || v === 'true');
                }
                authSettings[key] = v;
            }
        });
    }
    logger.info("Configuring OAuth using: ");
    logger.info(authSettings);
    authService = ngGpoauthFactory(authSettings);
    return authService;
}
;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aC5mYWN0b3J5LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdlb3BsYXRmb3JtL2NvbW1vbi8iLCJzb3VyY2VzIjpbImF1dGgvYXV0aC5mYWN0b3J5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxnQkFBZ0IsRUFBZSxNQUFNLCtCQUErQixDQUFDO0FBRTlFLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFnQmxDLENBQUM7QUFDRixNQUFNLFNBQVMsR0FBRztJQUNkLFdBQVcsRUFBRSxjQUFjLEVBQUUsY0FBYyxFQUFFLGlCQUFpQjtJQUM5RCxRQUFRLEVBQUUsb0JBQW9CLEVBQUUsYUFBYSxFQUFFLFVBQVU7SUFDekQsV0FBVyxFQUFFLFlBQVksRUFBRSxpQkFBaUI7Q0FDL0MsQ0FBQztBQUtGLElBQUksV0FBVyxHQUFpQixJQUFJLENBQUM7QUFHckMsTUFBTSxVQUFVLGtCQUFrQixDQUFFLFdBQWlCO0lBRWpELDRDQUE0QztJQUM1QyxJQUFHLFdBQVc7UUFBRSxPQUFPLFdBQVcsQ0FBQztJQUVuQyxFQUFFO0lBQ0YsMEVBQTBFO0lBQzFFLElBQUksWUFBWSxHQUFnQixFQUFFLENBQUM7SUFFbkMsSUFBSSxRQUFRLEdBQVMsTUFBTyxDQUFDLFdBQVcsQ0FBQztJQUN6QyxJQUFHLFFBQVEsSUFBSSxRQUFRLENBQUMsTUFBTSxJQUFJLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFO1FBQ3BELDBFQUEwRTtRQUMxRSxrREFBa0Q7UUFDbEQsWUFBWSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDO0tBQ3ZDO1NBQU07UUFDSCxZQUFZLENBQUMsWUFBWSxHQUFHLFdBQVcsQ0FBQyxLQUFLLElBQUksRUFBRSxDQUFDO1FBQ3BELFNBQVMsQ0FBQyxPQUFPLENBQUUsR0FBRyxDQUFDLEVBQUU7WUFDckIsSUFBSSxDQUFDLEdBQUcsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3pCLElBQUcsT0FBTSxDQUFDLENBQUMsQ0FBQyxLQUFLLFdBQVcsRUFBRTtnQkFDMUIsSUFBRyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFO29CQUMvQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsS0FBSyxNQUFNLENBQUMsQ0FBQztpQkFDcEM7Z0JBQ0QsWUFBWSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQzthQUN6QjtRQUNMLENBQUMsQ0FBQyxDQUFDO0tBQ047SUFFRCxNQUFNLENBQUMsSUFBSSxDQUFDLDJCQUEyQixDQUFDLENBQUM7SUFDekMsTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUUxQixXQUFXLEdBQUcsZ0JBQWdCLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDN0MsT0FBTyxXQUFXLENBQUM7QUFDdkIsQ0FBQztBQUFBLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBuZ0dwb2F1dGhGYWN0b3J5LCBBdXRoU2VydmljZSB9IGZyb20gJ0BnZW9wbGF0Zm9ybS9vYXV0aC1uZy9hbmd1bGFyJztcblxuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSBcIi4uL2xvZ2dlclwiO1xuXG5cbi8vc2hvdWxkIGJlIGV4cG9ydGVkIGJ5IGdwLW5nb2F1dGggYnV0IGlzbid0IHNvIHdlIGFyZSBkZWNsYXJpbmcgaXQgaGVyZS4uLlxuaW50ZXJmYWNlIEF1dGhDb25maWcge1xuICAgIEFVVEhfVFlQRT86ICdncmFudCcgfCAndG9rZW4nXG4gICAgSURQX0JBU0VfVVJMPzogc3RyaW5nXG4gICAgQVBQX0JBU0VfVVJMPzogc3RyaW5nXG4gICAgQUxMT1dfU1NPX0xPR0lOPzogYm9vbGVhblxuICAgIEFQUF9JRD86IGJvb2xlYW5cbiAgICBBTExPV19JRlJBTUVfTE9HSU4/OiBib29sZWFuXG4gICAgRk9SQ0VfTE9HSU4/OiBib29sZWFuXG4gICAgQ0FMTEJBQ0s/OiBzdHJpbmdcbiAgICBMT0dJTl9VUkw/OiBzdHJpbmdcbiAgICBMT0dPVVRfVVJMPzogc3RyaW5nXG4gICAgQUxMT1dfREVWX0VESVRTPzogYm9vbGVhblxufTtcbmNvbnN0IEFVVEhfS0VZUyA9IFtcbiAgICAnQVVUSF9UWVBFJywgJ0lEUF9CQVNFX1VSTCcsICdBUFBfQkFTRV9VUkwnLCAnQUxMT1dfU1NPX0xPR0lOJyxcbiAgICAnQVBQX0lEJywgJ0FMTE9XX0lGUkFNRV9MT0dJTicsICdGT1JDRV9MT0dJTicsICdDQUxMQkFDSycsXG4gICAgJ0xPR0lOX1VSTCcsICdMT0dPVVRfVVJMJywgJ0FMTE9XX0RFVl9FRElUUydcbl07XG5cblxuXG5cbnZhciBhdXRoU2VydmljZSA6IEF1dGhTZXJ2aWNlID0gbnVsbDtcblxuXG5leHBvcnQgZnVuY3Rpb24gYXV0aFNlcnZpY2VGYWN0b3J5KCBlbnZpcm9ubWVudCA6IGFueSApIHtcblxuICAgIC8vb25jZSBzZXJ2aWNlIGhhcyBiZWVuIGJ1aWx0LCBrZWVwIHVzaW5nIGl0XG4gICAgaWYoYXV0aFNlcnZpY2UpIHJldHVybiBhdXRoU2VydmljZTtcblxuICAgIC8vXG4gICAgLy9idXQgdGhlIGZpcnN0IHRpbWUgaXQncyByZXF1ZXN0ZWQsIGl0IGhhcyB0byBiZSBidWlsdCB1c2luZyBlbnYgc2V0dGluZ3NcbiAgICBsZXQgYXV0aFNldHRpbmdzIDogQXV0aENvbmZpZyA9IHt9O1xuXG4gICAgbGV0IGdwR2xvYmFsID0gKDxhbnk+d2luZG93KS5HZW9QbGF0Zm9ybTtcbiAgICBpZihncEdsb2JhbCAmJiBncEdsb2JhbC5jb25maWcgJiYgZ3BHbG9iYWwuY29uZmlnLmF1dGgpIHtcbiAgICAgICAgLy9hdXRoIGxpYnJhcnkgc2V0dGluZ3MgbWFkZSBhdmFpbGFibGUgdGhyb3VnaCBXUCB2aWEgJ0dlb1BsYXRmb3JtJyBnbG9iYWxcbiAgICAgICAgLy9odHRwczovL2dlb3BsYXRmb3JtLmF0bGFzc2lhbi5uZXQvYnJvd3NlL0RULTIzMDdcbiAgICAgICAgYXV0aFNldHRpbmdzID0gZ3BHbG9iYWwuY29uZmlnLmF1dGg7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgYXV0aFNldHRpbmdzLkFQUF9CQVNFX1VSTCA9IGVudmlyb25tZW50LndwVXJsIHx8ICcnO1xuICAgICAgICBBVVRIX0tFWVMuZm9yRWFjaCgga2V5ID0+IHtcbiAgICAgICAgICAgIGxldCB2ID0gZW52aXJvbm1lbnRba2V5XTtcbiAgICAgICAgICAgIGlmKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBpZih+a2V5LmluZGV4T2YoJ0FMTE9XJykgfHwgfmtleS5pbmRleE9mKCdGT1JDRScpKSB7XG4gICAgICAgICAgICAgICAgICAgIHYgPSAodiA9PT0gdHJ1ZSB8fCB2ID09PSAndHJ1ZScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhdXRoU2V0dGluZ3Nba2V5XSA9IHY7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGxvZ2dlci5pbmZvKFwiQ29uZmlndXJpbmcgT0F1dGggdXNpbmc6IFwiKTtcbiAgICBsb2dnZXIuaW5mbyhhdXRoU2V0dGluZ3MpO1xuXG4gICAgYXV0aFNlcnZpY2UgPSBuZ0dwb2F1dGhGYWN0b3J5KGF1dGhTZXR0aW5ncyk7XG4gICAgcmV0dXJuIGF1dGhTZXJ2aWNlO1xufTtcbiJdfQ==