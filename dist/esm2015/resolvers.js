import * as tslib_1 from "tslib";
import { Injectable, Inject } from '@angular/core';
import { Router, ActivatedRouteSnapshot, RouterStateSnapshot, Resolve } from '@angular/router';
import { of, empty } from 'rxjs';
import { ItemService, TrackingService, TrackingTypes, TrackingEventFactory } from '@geoplatform/client';
import { ItemFactory } from './item-factory';
import { GeoPlatformError } from './error';
let ItemResolver = class ItemResolver {
    constructor(service, trackingService) {
        this.service = service;
        this.trackingService = trackingService;
    }
    resolve(route, state) {
        let id = route.paramMap.get('id');
        let opts = {};
        let version = route.paramMap.get("version");
        if (version)
            opts.version = version;
        return this.service.get(id, opts)
            .then(item => {
            if (this.trackingService) {
                let event = TrackingEventFactory(TrackingTypes.VIEWED, item);
                this.trackingService.logEvent(event);
            }
            return item;
        })
            .catch((e) => of(e));
    }
};
ItemResolver.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Inject, args: [ItemService,] }] },
    { type: undefined, decorators: [{ type: Inject, args: [TrackingService,] }] }
];
ItemResolver = tslib_1.__decorate([
    Injectable( /*{ providedIn: 'root' }*/),
    tslib_1.__param(0, Inject(ItemService)),
    tslib_1.__param(1, Inject(TrackingService))
], ItemResolver);
export { ItemResolver };
let VersionResolver = class VersionResolver {
    constructor() { }
    resolve(route, state) {
        let version = route.paramMap.get("version");
        return Promise.resolve(version || null);
    }
};
VersionResolver = tslib_1.__decorate([
    Injectable( /*{ providedIn: 'root' }*/)
], VersionResolver);
export { VersionResolver };
let NewItemResolver = class NewItemResolver {
    constructor(router) {
        this.router = router;
    }
    resolve(route, state) {
        let type = route.params.type;
        let item = ItemFactory.create(type);
        if (!item) {
            let gpe = new GeoPlatformError(`Type ${type} is unsupported`, "Unsupported Type", 400);
            // this.errorService.setError(gpe);
            this.router.navigateByUrl('error', { skipLocationChange: false });
            return empty();
        }
        else {
            return of(item);
        }
    }
};
NewItemResolver.ctorParameters = () => [
    { type: Router }
];
NewItemResolver = tslib_1.__decorate([
    Injectable()
], NewItemResolver);
export { NewItemResolver };
let ErrorResolver = class ErrorResolver {
    constructor(router) {
        this.router = router;
    }
    resolve(route, state) {
        let type = route.params.type;
        let msg = "An error has occurred";
        if ("unsupported" === type)
            msg = `Type ${type} is not supported`;
        else if ("404" === type)
            msg = "Item not found";
        let error = new Error(msg);
        // error.error = "Unsupported Type";
        return of(error);
    }
};
ErrorResolver.ctorParameters = () => [
    { type: Router }
];
ErrorResolver = tslib_1.__decorate([
    Injectable()
], ErrorResolver);
export { ErrorResolver };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVzb2x2ZXJzLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdlb3BsYXRmb3JtL2NvbW1vbi8iLCJzb3VyY2VzIjpbInJlc29sdmVycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbkQsT0FBTyxFQUNILE1BQU0sRUFBRSxzQkFBc0IsRUFBRSxtQkFBbUIsRUFBRSxPQUFPLEVBQy9ELE1BQU0saUJBQWlCLENBQUM7QUFDekIsT0FBTyxFQUFjLEVBQUUsRUFBRSxLQUFLLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDN0MsT0FBTyxFQUNHLFdBQVcsRUFDakIsZUFBZSxFQUFFLGFBQWEsRUFBRSxvQkFBb0IsRUFDdkQsTUFBTSxxQkFBcUIsQ0FBQztBQUM3QixPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQVksZ0JBQWdCLENBQUM7QUFDbkQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQWdCLFNBQVMsQ0FBQztBQUdyRCxJQUFhLFlBQVksR0FBekIsTUFBYSxZQUFZO0lBRXJCLFlBQ2lDLE9BQXFCLEVBQ2pCLGVBQWlDO1FBRHJDLFlBQU8sR0FBUCxPQUFPLENBQWM7UUFDakIsb0JBQWUsR0FBZixlQUFlLENBQWtCO0lBRXRFLENBQUM7SUFFRCxPQUFPLENBQ0gsS0FBNkIsRUFDN0IsS0FBMEI7UUFHMUIsSUFBSSxFQUFFLEdBQUcsS0FBSyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbEMsSUFBSSxJQUFJLEdBQVMsRUFBRSxDQUFDO1FBQ3BCLElBQUksT0FBTyxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQzVDLElBQUcsT0FBTztZQUFFLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1FBQ25DLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLElBQUks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Q0FBQyxLQUFLLENBQUMsQ0FBQztJQUNyQixDQUFDO0NBQ0osQ0FBQTs7WUFaK0IsTUFBTTs7QUFEekIsYUFBYTtJQUR6QixVQUFVLEVBQUU7R0FDQSxhQUFhLENBYXpCO1NBYlksYUFBYSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIEluamVjdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgICBSb3V0ZXIsIEFjdGl2YXRlZFJvdXRlU25hcHNob3QsIFJvdXRlclN0YXRlU25hcHNob3QsIFJlc29sdmVcbn0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mLCBlbXB0eSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtcbiAgICBJdGVtLCBJdGVtU2VydmljZSxcbiAgICBUcmFja2luZ1NlcnZpY2UsIFRyYWNraW5nVHlwZXMsIFRyYWNraW5nRXZlbnRGYWN0b3J5XG59IGZyb20gJ0BnZW9wbGF0Zm9ybS9jbGllbnQnO1xuaW1wb3J0IHsgSXRlbUZhY3RvcnkgfSAgICAgICBmcm9tICcuL2l0ZW0tZmFjdG9yeSc7XG5pbXBvcnQgeyBHZW9QbGF0Zm9ybUVycm9yIH0gICAgICAgICAgIGZyb20gJy4vZXJyb3InO1xuXG5ASW5qZWN0YWJsZSgvKnsgcHJvdmlkZWRJbjogJ3Jvb3QnIH0qLylcbmV4cG9ydCBjbGFzcyBJdGVtUmVzb2x2ZXIgaW1wbGVtZW50cyBSZXNvbHZlPEl0ZW0+IHtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBASW5qZWN0KEl0ZW1TZXJ2aWNlKSBwcml2YXRlIHNlcnZpY2UgOiBJdGVtU2VydmljZSxcbiAgICAgICAgQEluamVjdChUcmFja2luZ1NlcnZpY2UpIHByaXZhdGUgdHJhY2tpbmdTZXJ2aWNlIDogVHJhY2tpbmdTZXJ2aWNlXG4gICAgKSB7XG4gICAgfVxuXG4gICAgcmVzb2x2ZShcbiAgICAgICAgcm91dGU6IEFjdGl2YXRlZFJvdXRlU25hcHNob3QsXG4gICAgICAgIHN0YXRlOiBSb3V0ZXJTdGF0ZVNuYXBzaG90XG4gICAgKTogT2JzZXJ2YWJsZTxhbnk+fFByb21pc2U8YW55Pnxhbnkge1xuXG4gICAgICAgIGxldCBpZCA9IHJvdXRlLnBhcmFtTWFwLmdldCgnaWQnKTtcbiAgICAgICAgbGV0IG9wdHMgOiBhbnkgPSB7fTtcbiAgICAgICAgbGV0IHZlcnNpb24gPSByb3V0ZS5wYXJhbU1hcC5nZXQoXCJ2ZXJzaW9uXCIpO1xuICAgICAgICBpZih2ZXJzaW9uKSBvcHRzLnZlcnNpb24gPSB2ZXJzaW9uO1xuICAgICAgICByZXR1cm4gdGhpcy5zZXJ2aWNlLmdldChpZCwgb3B0cylcbiAgICAgICAgLnRoZW4oIGl0ZW0gPT4ge1xuICAgICAgICAgICAgaWYodGhpcy50cmFja2luZ1NlcnZpY2UpIHtcbiAgICAgICAgICAgICAgICBsZXQgZXZlbnQgPSBUcmFja2luZ0V2ZW50RmFjdG9yeShUcmFja2luZ1R5cGVzLlZJRVdFRCwgaXRlbSk7XG4gICAgICAgICAgICAgICAgdGhpcy50cmFja2luZ1NlcnZpY2UubG9nRXZlbnQoZXZlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCggKGUgOiBFcnJvcikgPT4gb2YoIGUgKSApO1xuICAgIH1cbn1cblxuXG5ASW5qZWN0YWJsZSgvKnsgcHJvdmlkZWRJbjogJ3Jvb3QnIH0qLylcbmV4cG9ydCBjbGFzcyBWZXJzaW9uUmVzb2x2ZXIgaW1wbGVtZW50cyBSZXNvbHZlPHN0cmluZz4ge1xuXG4gICAgY29uc3RydWN0b3IoKSB7IH1cblxuICAgIHJlc29sdmUoXG4gICAgICAgIHJvdXRlOiBBY3RpdmF0ZWRSb3V0ZVNuYXBzaG90LFxuICAgICAgICBzdGF0ZTogUm91dGVyU3RhdGVTbmFwc2hvdFxuICAgICk6IE9ic2VydmFibGU8YW55PnxQcm9taXNlPGFueT58YW55IHtcbiAgICAgICAgbGV0IHZlcnNpb24gPSByb3V0ZS5wYXJhbU1hcC5nZXQoXCJ2ZXJzaW9uXCIpO1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHZlcnNpb258fG51bGwpO1xuICAgIH1cbn1cblxuXG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBOZXdJdGVtUmVzb2x2ZXIgaW1wbGVtZW50cyBSZXNvbHZlPEl0ZW0+IHtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIHJvdXRlcjogUm91dGVyLFxuICAgICAgICAvLyBwcml2YXRlIGVycm9yU2VydmljZTogRXJyb3JTZXJ2aWNlXG4gICAgKSB7XG5cbiAgICB9XG5cbiAgICByZXNvbHZlKCByb3V0ZTogQWN0aXZhdGVkUm91dGVTbmFwc2hvdCwgc3RhdGU6IFJvdXRlclN0YXRlU25hcHNob3QgKTogT2JzZXJ2YWJsZTxJdGVtPiB7XG4gICAgICAgIGxldCB0eXBlID0gcm91dGUucGFyYW1zLnR5cGU7XG4gICAgICAgIGxldCBpdGVtID0gSXRlbUZhY3RvcnkuY3JlYXRlKHR5cGUpO1xuICAgICAgICBpZighaXRlbSkge1xuICAgICAgICAgICAgbGV0IGdwZSA9IG5ldyBHZW9QbGF0Zm9ybUVycm9yKGBUeXBlICR7dHlwZX0gaXMgdW5zdXBwb3J0ZWRgLCBcIlVuc3VwcG9ydGVkIFR5cGVcIiwgNDAwKTtcbiAgICAgICAgICAgIC8vIHRoaXMuZXJyb3JTZXJ2aWNlLnNldEVycm9yKGdwZSk7XG4gICAgICAgICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZUJ5VXJsKCdlcnJvcicsIHtza2lwTG9jYXRpb25DaGFuZ2U6ZmFsc2V9KTtcbiAgICAgICAgICAgIHJldHVybiBlbXB0eSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG9mKGl0ZW0pO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5cblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEVycm9yUmVzb2x2ZXIgaW1wbGVtZW50cyBSZXNvbHZlPEVycm9yPiB7XG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSByb3V0ZXI6IFJvdXRlcikge31cbiAgICByZXNvbHZlKCByb3V0ZTogQWN0aXZhdGVkUm91dGVTbmFwc2hvdCwgc3RhdGU6IFJvdXRlclN0YXRlU25hcHNob3QgKTogT2JzZXJ2YWJsZTxFcnJvcj4ge1xuICAgICAgICBsZXQgdHlwZSA9IHJvdXRlLnBhcmFtcy50eXBlO1xuICAgICAgICBsZXQgbXNnID0gXCJBbiBlcnJvciBoYXMgb2NjdXJyZWRcIjtcbiAgICAgICAgaWYoXCJ1bnN1cHBvcnRlZFwiID09PSB0eXBlKVxuICAgICAgICAgICAgbXNnID0gYFR5cGUgJHt0eXBlfSBpcyBub3Qgc3VwcG9ydGVkYDtcbiAgICAgICAgZWxzZSBpZihcIjQwNFwiID09PSB0eXBlKVxuICAgICAgICAgICAgbXNnID0gXCJJdGVtIG5vdCBmb3VuZFwiO1xuICAgICAgICBsZXQgZXJyb3IgPSBuZXcgRXJyb3IobXNnKTtcbiAgICAgICAgLy8gZXJyb3IuZXJyb3IgPSBcIlVuc3VwcG9ydGVkIFR5cGVcIjtcbiAgICAgICAgcmV0dXJuIG9mKGVycm9yKTtcbiAgICB9XG59XG4iXX0=