!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@geoplatform/client"),require("@angular/core"),require("rxjs"),require("@geoplatform/rpm/src/iRPMService"),require("@geoplatform/oauth-ng/angular"),require("@angular/material/dialog"),require("rxjs/operators"),require("@angular/platform-browser"),require("@angular/router"),require("@angular/common"),require("@angular/forms"),require("@angular/material"),require("@ng-bootstrap/ng-bootstrap"),require("@geoplatform/rpm/dist/js/geoplatform.rpm.browser.js")):"function"==typeof define&&define.amd?define("@geoplatform/common",["exports","@geoplatform/client","@angular/core","rxjs","@geoplatform/rpm/src/iRPMService","@geoplatform/oauth-ng/angular","@angular/material/dialog","rxjs/operators","@angular/platform-browser","@angular/router","@angular/common","@angular/forms","@angular/material","@ng-bootstrap/ng-bootstrap","@geoplatform/rpm/dist/js/geoplatform.rpm.browser.js"],t):t(((e=e||self).geoplatform=e.geoplatform||{},e.geoplatform.common={}),e.geoplatform.client,e.ng.core,e.rxjs,e.RPMService,e.geoplatform["oauth-ng"],e.ng.material.dialog,e.rxjs.operators,e.ng.platformBrowser,e.ng.router,e.ng.common,e.ng.forms,e.ng.material,e.ngBootstrap,e.geoplatform.rpm)}(this,(function(e,t,n,r,i,o,s,a,l,c,u,p,g,d,f){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var m=function(e,t){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function h(e,t){function n(){this.constructor=e}m(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function y(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}function b(e,t){return function(n,r){t(n,r,e)}}function v(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function I(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(v(arguments[t]));return e}var S=["error","warn","info","debug"],T=new(function(){function e(){this.level="error",this.setLevel(t.Config.logLevel||t.Config.LOG_LEVEL)}return e.prototype.setLevel=function(e){e&&S.indexOf(e)>=0&&(this.level=e),this.info("Log Level : "+this.level)},e.prototype.isVisible=function(e){return S.indexOf(this.level)>=S.indexOf(e)},e.prototype.log=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=this.toStr(e);i+=n.map((function(e){return t.toStr(e)})).join(""),console.log(i)},e.prototype.debug=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(this.isVisible("debug")){var r="[DEBUG] "+this.toStr(e);this.log.apply(this,I([r],t))}},e.prototype.info=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(this.isVisible("info")){var r="[INFO] "+this.toStr(e);this.log.apply(this,I([r],t))}},e.prototype.warn=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(this.isVisible("warn")){var r="[WARN] "+this.toStr(e);this.log.apply(this,I([r],t))}},e.prototype.error=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r="[ERROR] "+this.toStr(e);this.log.apply(this,I([r],t))},e.prototype.toStr=function(e){return null==e?"":"string"==typeof e?e:JSON.stringify(e)},e}()),C=function(){function e(e){this.authService=e}return e.prototype.ngOnInit=function(){this.init()},e.prototype.ngOnDestroy=function(){this.destroy()},e.prototype.init=function(){var e=this,t={next:function(t){T.debug("AuthenticatedComponent : User changed to "+(t?t.username:"null")),e.user=t,e.onUserChange(e.user)},error:function(e){T.error("Unable to get authenticated user info: "+e.message)},complete:function(){}};this.gpAuthSubscription=this.authService.subscribe(t),this.user=this.authService.getUser(),this.onUserChange(this.user)},e.prototype.destroy=function(){this.gpAuthSubscription&&(this.gpAuthSubscription.unsubscribe(),this.gpAuthSubscription=null),this.user=null,this.authService=null},e.prototype.isAuthenticated=function(){return!!this.user},e.prototype.getUser=function(){return this.user},e.prototype.getAuthToken=function(){return this.authService.getToken()},e.prototype.checkAuth=function(){return this.authService.check()},e.prototype.canUserEdit=function(e){return!!this.user&&(!!this.user.isAuthorized("gp_editor")||this.isAuthorOf(e))},e.prototype.isAuthorOf=function(e){return!(!this.user||!e)&&(e.createdBy&&e.createdBy===this.user.username)},e.prototype.onUserChange=function(e){},e}(),w=["AUTH_TYPE","IDP_BASE_URL","APP_BASE_URL","ALLOW_SSO_LOGIN","APP_ID","ALLOW_IFRAME_LOGIN","FORCE_LOGIN","CALLBACK","LOGIN_URL","LOGOUT_URL","ALLOW_DEV_EDITS"],x=null;function L(e){if(x)return x;var t={},n=window.GeoPlatform;return n&&n.config&&n.config.auth?t=n.config.auth:(t.APP_BASE_URL=e.wpUrl||"",w.forEach((function(n){var r=e[n];void 0!==r&&((~n.indexOf("ALLOW")||~n.indexOf("FORCE"))&&(r=!0===r||"true"===r),t[n]=r)}))),T.info("Configuring OAuth using: "),T.info(t),x=o.ngGpoauthFactory(t)}var A=function(){function e(e){this.observers={},this.authService=L(t.Config),this.rpm=e,this.init()}return e.prototype.init=function(){var e=this;if(this.user$=new r.Subject,this.authService){var t=this.authService.getMessenger().raw();this.gpAuthSubscription=t.subscribe((function(t){switch(T.debug("Received Auth Message: "+t.name),t.name){case"userAuthenticated":e.onUserChange(t.user);break;case"userSignOut":e.onUserChange(null)}})),this.authService.getUser().then((function(t){e.onUserChange(t)}))}},e.prototype.onUserChange=function(e){T.debug("AuthService.onUserChange() : User is "+(e?e.username:"N/A")),this.user=e,this.user$.next(e)},e.prototype.getMessenger=function(){return this.authService?this.authService.getMessenger().raw():null},e.prototype.isAuthenticated=function(){return!!this.user},e.prototype.getUser=function(){return this.user},e.prototype.getToken=function(){return this.authService?this.authService.getJWT():null},e.prototype.check=function(){var e=this;return this.authService?this.authService.checkWithClient().then((function(t){return e.authService.getUser()})).then((function(t){return setTimeout((function(){e.onUserChange(t)}),100),t})):Promise.resolve(null)},e.prototype.login=function(){this.authService.login()},e.prototype.logout=function(){this.authService.logout()},e.prototype.subscribe=function(e){return this.user$.subscribe(e)},e.prototype.dispose=function(){this.gpAuthSubscription&&(this.gpAuthSubscription.unsubscribe(),this.gpAuthSubscription=null),this.user=null,this.user$=null,this.observers=null,this.authService=null},e.ctorParameters=function(){return[{type:void 0,decorators:[{type:n.Inject,args:[i.RPMService]}]}]},e.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new e(n.ɵɵinject(i.RPMService))},token:e,providedIn:"root"}),e=y([n.Injectable({providedIn:"root"}),b(0,n.Inject(i.RPMService))],e)}(),O=function(e){function r(n){var r=e.call(this,n)||this;return r.idpBaseUrl=t.Config.IDP_BASE_URL||"https://accounts.geoplatform.gov",r.user=null,r}return h(r,e),r.prototype.ngOnInit=function(){e.prototype.ngOnInit.call(this)},r.prototype.ngOnDestroy=function(){e.prototype.ngOnDestroy.call(this)},r.prototype.onUserChange=function(t){e.prototype.onUserChange.call(this,t),T.debug("LoginButton.onUserChange() : User is "+(t?t.username:"null")),this.user=t},r.prototype.login=function(){this.authService.login()},r.prototype.logout=function(){this.authService.logout()},r.ctorParameters=function(){return[{type:A}]},r=y([n.Component({selector:"gp-login-button",template:'\n    <div class="btn-account btn-group">\n        \x3c!-- not logged in yet --\x3e\n        <a class="btn-login btn btn-link" (click)="login()" *ngIf="!user">Sign In</a>\n\n        \x3c!-- logged in --\x3e\n        <button type="button" class="btn-login btn btn-link dropdown-toggle" data-toggle="dropdown"\n            aria-expanded="false" *ngIf="user">\n            <span class="fas fa-user"></span>\n            <span class="d-xs-none">{{user?.name}}</span>\n            <span class="caret"></span>\n        </button>\n        <div class="dropdown-menu dropdown-menu-right" role="menu" *ngIf="user">\n            <div class="o-account-details">\n                <div class="o-account-details__avatar">\n                    <span class="fas fa-user"></span>\n                </div>\n                <div class="flex-1">\n                    <div class="a-heading">\n                        {{user?.name}}\n                        <small><em>({{user?.username}})</em></small>\n                    </div>\n                    <div class="u-text--sm">{{user?.email}}</div>\n                    <div class="u-text--sm">{{user?.org}}</div>\n                </div>\n            </div>\n            <div class="d-flex flex-justify-around u-mg-top--sm">\n                <a class="btn btn-sm btn-link" target="_blank" href="{{idpBaseUrl}}/profile">\n                    <span class="fas fa-pencil-alt"></span> Edit Profile\n                </a>\n                <a class="btn btn-sm btn-link" target="_blank" href="{{idpBaseUrl}}/updatepw">\n                    <span class="fas fa-key"></span> Change Password\n                </a>\n            </div>\n            <div class="u-mg-top--sm">\n                <a class="btn-logout btn btn-light btn-block" (click)="logout()">\n                    <span class="fas fa-power-off"></span> Sign Out\n                </a>\n            </div>\n        </div>\n    </div>\n    ',styles:["\n        .btn-login.btn-link {\n            padding: .375em .75em;\n            border-right: none;\n            margin: 0 0.5em;\n            font-weight: 700;\n        }\n        .btn-login.btn-link:hover {\n            background-color: #fff;\n            text-decoration: none;\n            color: #333;\n        }\n        .o-account-details {\n            display: flex;\n            justify-content: space-between;\n            align-items: stretch;\n            margin-top: -0.5em;\n            padding: 1em;\n            background: #185b8a;\n            color: #fff;\n        }\n        .o-account-details__avatar {\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            font-size: 6em;\n            margin-right: 0.25em;\n            padding-top: 10px;\n            width: 100px;\n            height: 100px;\n            overflow: hidden;\n            background: #fff;\n            color: #777;\n            border-radius: 100%;\n        }\n        .dropdown-menu .btn.btn-link {\n            display: inline-block;\n            padding: 0.375rem 0.75rem;\n            border-right: none;\n        }\n        .dropdown-menu .btn.btn-link:after {\n            content: '';\n        }\n        .btn.btn-logout {\n            padding: 0.375rem 0.75rem;\n            margin-bottom: -0.5em;\n        }\n        "]})],r)}(C),E=function(){function e(e){this.authService=e,this.showLoginModal=!1,this.forceLogin=t.Config.FORCE_LOGIN}return e.prototype.ngOnInit=function(){var e=this;this.authService&&this.authService.getMessenger().subscribe((function(t){switch(T.debug("LoginModal received auth message: "+t.name),t.name){case"auth:requireLogin":e.showLoginModal=!0;break;case"userAuthenticated":case"iframe:userAuthenticated":e.showLoginModal=!1,e.authService.onUserChange(t.user)}}))},e.prototype.ngOnDestroy=function(){this.showLoginModal=!1},e.prototype.cancel=function(){this.showLoginModal=!1},e.ctorParameters=function(){return[{type:A}]},e=y([n.Component({selector:"gp-login-modal",template:'<div class="gpLoginCover" *ngIf="showLoginModal">\n    <button class="btn btn-danger gpLoginCancelIframe pull-right" *ngIf="!forceLogin" (click)="cancel()">\n        <span class="fas fa-times-circle"></span> Cancel\n    </button>\n    <div class="gpLoginWindow" *ngIf="showLoginModal">\n        <iframe id="gpLoginIFrame" src="/login?redirect_url=${encodeURIComponent(`${window.location.origin}/auth/loading?cachebuster=${(new Date()).getTime()}`)}&cachebuster=${(new Date()).getTime()}"></iframe>\n    </div>\n</div>\n',styles:["\n        .gpLoginCover {\n            position: absolute;\n            top: 0;\n            left: 0;\n            bottom: 0;\n            right: 0;\n            background: rgba(0,0,0,0.6);\n            z-index: 5000;\n            width: 100vw;\n            height: 100vh;\n        }\n\n        .gpLoginCancelIframe {\n          z-index: 5001;\n          position: absolute;\n          right: 0px;\n        }\n\n        .gpLoginWindow {\n          top: 100px;\n          height: 60%;\n          width: 75%;\n          margin: 0 auto;\n          position: relative;\n          z-index: 5001;\n        \tborder: 5px solid #cccccc;\n          border-radius: 10px;\n        }\n\n        .gpLoginWindow iframe {\n          width: 100%;\n          height: 100%\n        }\n\n        .gpLoginWindow .btn-cancel {\n          color: white;\n          background-color: red;\n        }\n\n        .gpLoginWindow .btn {\n          display: inline-block;\n          padding: 6px 12px;\n          margin-bottom: 0;\n          font-size: 14px;\n          font-weight: 400;\n          line-height: 1.42857143;\n          text-align: center;\n          white-space: nowrap;\n          vertical-align: middle;\n          -ms-touch-action: manipulation;\n          touch-action: manipulation;\n          cursor: pointer;\n          -webkit-user-select: none;\n          -moz-user-select: none;\n          -ms-user-select: none;\n          user-select: none;\n          background-image: none;\n          border: 1px solid transparent;\n          border-radius: 4px;\n        }\n    "]})],e)}(),k=function(){function e(e,t){var n=this;this.dialogRef=e,this.data=t,this.currentPage=0,this.totalSuggested=0,this.subject=new r.Subject,this.query=t.query.clone().page(this.currentPage),this.subject.pipe(a.debounceTime(300),a.distinctUntilChanged()).subscribe((function(e){n.filterValues(e)}))}return e.prototype.onNoClick=function(){this.dialogRef.close()},e.prototype.onTermChange=function(e,t){!0===t?this.filterValues(e):this.subject.next(e)},e.prototype.filterValues=function(e){var t=this;if(this.termQuery=e,!e)return this.suggested=[],void(this.totalSuggested=0);this.query.q(e),this.isLoading=!0,this.data.service.search(this.query).then((function(e){var n=e.results;t.suggested=n,t.totalSuggested=e.totalResults})).catch((function(e){})).finally((function(){t.isLoading=!1}))},e.prototype.addValue=function(e){this.isSelected(e)?this.removeValue(e):this.data.selected.push(e)},e.prototype.removeValue=function(e){var t=-1;this.data.selected.forEach((function(n,r){n.id===e.id&&(t=r)})),t>=0&&this.data.selected.splice(t,1)},e.prototype.isSelected=function(e){return this.data.selected.length>0&&!!this.data.selected.find((function(t){return t.id===e.id}))},e.prototype.onPageChange=function(e){this.currentPage!==e-1&&(this.query.page(e-1),this.filterValues(this.termQuery))},e.prototype.getSubHeading=function(e){var t=e[this.data.subHeading];return this.getLabelFrom(t)},e.prototype.getLabelFrom=function(e){var t=this;return null==e?"":Array.isArray(e)?e.map((function(e){return t.getLabelFrom(e)})).join(", "):"object"==typeof e&&(e.label||e.title||e.prefLabel)?e.label||e.title||e.prefLabel:""},e.ctorParameters=function(){return[{type:s.MatDialogRef},{type:void 0,decorators:[{type:n.Inject,args:[s.MAT_DIALOG_DATA]}]}]},e=y([n.Component({selector:"gp-list-select-dialog",template:'<h5 mat-dialog-title>Find Items to Select</h5>\n<div mat-dialog-content>\n    <mat-form-field appearance="outline">\n        <mat-label>\n            <mat-icon><span class="fas fa-search"></span></mat-icon>\n            Search\n        </mat-label>\n        <input matInput\n            [(ngModel)]="termQuery" (ngModelChange)="onTermChange($event)"\n            placeholder="Enter keywords to find recommended values">\n        <span matSuffix *ngIf="termQuery?.length" (click)="onTermChange(null, true)"\n            class="fas fa-times t-fg--gray-md">\n        </span>\n    </mat-form-field>\n\n    <div class="d-flex flex-justify-between flex-align-stretch">\n\n        <div style="flex: 1 0 49%; margin-right: 1%;">\n            <div class="a-heading">\n                Recommendations ({{totalSuggested||0}})\n                <span *ngIf="isLoading" class="fas fa-spinner fa-spin"></span>\n            </div>\n            <div class="m-list-section">\n                <div class="list-group">\n                    <em *ngIf="!suggested?.length">Enter keywords above to receive suggested values to use.</em>\n                    <div *ngFor="let item of suggested" class="list-group-item"\n                        (click)="addValue(item)" [ngClass]="{\'active\':isSelected(item)}">\n                        <a>\n                            <span gpIcon [item]="item"></span>\n                            {{item.label||item.title||item.prefLabel}}\n                        </a>\n                        <div *ngIf="data.subHeading" class="u-text--sm t-fg--gray-md">\n                            {{getSubHeading(item)}}\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class="u-text--sm  u-mg-top--md" *ngIf="totalSuggested>0">\n                <ngb-pagination [collectionSize]="totalSuggested"\n                    [pageSize]="12" [maxSize]="2" [size]="\'sm\'"\n                    [rotate]="true" [(page)]="currentPage"\n                    (pageChange)="onPageChange($event)">\n                </ngb-pagination>\n            </div>\n        </div>\n        <div style="flex: 1 0 50%">\n            <div class="a-heading">Selected ({{data?.selected?.length||0}})</div>\n            <div class="m-list-section">\n                <div class="list-group">\n                    <em *ngIf="!data.selected?.length">No values selected.</em>\n                    <div *ngFor="let item of data?.selected" class="list-group-item">\n                        <span class="fas fa-times t-fg--danger" (click)="removeValue(item)"></span>&nbsp;\n                        <a>\n                            <span gpIcon [item]="item"></span>\n                            {{item.label||item.title||item.prefLabel||"Untitled Item"}}\n                        </a>\n                        <div *ngIf="data.subHeading" class="u-text--sm t-fg--gray-md">\n                            {{getSubHeading(item)}}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n</div>\n<div mat-dialog-actions class="d-flex flex-justify-end flex-align-center">\n    <button type="button" mat-flat-button (click)="onNoClick()">Cancel</button>\n    <button type="button" mat-flat-button color="primary" [mat-dialog-close]="data.selected">Ok</button>\n</div>\n',styles:[":host .mat-form-field{width:100%}"]}),b(1,n.Inject(s.MAT_DIALOG_DATA))],e)}(),M=function(){function e(e,t){switch(this.dialogRef=e,this.data=t,t.type){case"error":this.className="danger";break;case"warn":this.className="warning";break;case"info":this.className="info"}}return e.prototype.close=function(){this.dialogRef.close()},e.prototype.getIconClass=function(){switch(this.data.type){case"error":return"fas fa-exclamation-circle";case"warn":return"fas fa-exclamation-triangle";case"info":return"fas fa-info-circle"}return""},e.ctorParameters=function(){return[{type:s.MatDialogRef},{type:void 0,decorators:[{type:n.Inject,args:[s.MAT_DIALOG_DATA]}]}]},y([n.HostBinding("class")],e.prototype,"className",void 0),e=y([n.Component({selector:"gp-message-dialog",template:'<div class="a-heading" mat-dialog-title>\n    <span [attr.class]="getIconClass()"></span>\n    {{data.label || "Message"}}\n</div>\n<div mat-dialog-content>\n    {{data.message}}\n</div>\n<div mat-dialog-actions class="d-flex flex-justify-end flex-align-center">\n    <button type="button" mat-flat-button (click)="close()">Dismiss</button>\n</div>\n',styles:[":host.danger .mat-dialog-title{color:#d53c37}:host.warning .mat-dialog-title{color:#b35d29}:host.info .mat-dialog-title{color:#007fa4}"]}),b(1,n.Inject(s.MAT_DIALOG_DATA))],e)}(),P=function(){function e(e){this.el=e,this.themed=!0}return e.prototype.ngOnInit=function(){if(this.item){var e=this.item.type.toLowerCase().replace(/^[a-z]+\:/,"");e="icon-"+e,this.themed&&(e+=" is-themed"),this.el.nativeElement.className=e}},e.ctorParameters=function(){return[{type:n.ElementRef}]},y([n.Input()],e.prototype,"item",void 0),y([n.Input()],e.prototype,"themed",void 0),e=y([n.Directive({selector:"[gpIcon]"})],e)}(),R=function(){function e(){this.appName="Application",this.class="o-header",this.portalUrl=t.Config.portalUrl||"https://www.geoplatform.gov"}return y([n.Input()],e.prototype,"appName",void 0),y([n.HostBinding("class")],e.prototype,"class",void 0),e=y([n.Component({selector:"gp-app-header",template:'<div class="o-header__primary" role="banner">\n    <h1 class="a-brand">\n        <a href="{{portalUrl}}">\n            <img src="/assets/favicon.png" style="vertical-align:top;">\n            GeoPlatform.gov\n        </a>\n        &nbsp;\n        {{appName}}\n    </h1>\n    <nav class="a-nav" role="navigation" aria-label="top-level navigation links">\n        <ng-content select="[menu]"></ng-content>\n        <gp-login-button role="menuitem">Sign In</gp-login-button>\n    </nav>\n</div>\n',styles:[".o-header .o-header__primary{padding:1em 1.5em}.o-header .o-header__primary .a-nav a{font-weight:700;border-right:none;padding:.375em .75em}.o-header .o-header__primary .a-nav a.active{border-bottom:1px solid #185b8a}"]})],e)}(),j=[t.ItemTypes.DATASET,t.ItemTypes.SERVICE,t.ItemTypes.LAYER,t.ItemTypes.MAP,t.ItemTypes.GALLERY,t.ItemTypes.COMMUNITY,t.ItemTypes.APPLICATION,t.ItemTypes.TOPIC,t.ItemTypes.WEBSITE],U=function(){function e(){}return e.isAsset=function(e){if(!e)return!1;var t=null;return"string"==typeof e?t=e:e.type&&(t=e.type),t&&j.indexOf(t)>=0},e.getIcon=function(e){var n="dataset";switch(e.type){case t.ItemTypes.CONTACT:n="vcard";break;default:n=e.type.replace(/^[a-z]+\:/i,"").toLowerCase()}return"icon-"+n},e.getLabel=function(e){if(!e||!e.type)return"Unknown type";switch(e.type){case t.ItemTypes.ORGANIZATION:return e.label||e.name||"Un-titled resource";case t.ItemTypes.CONCEPT:case t.ItemTypes.CONCEPT_SCHEME:return e.label||e.prefLabel||"Un-titled resource";case t.ItemTypes.CONTACT:var n=e.fullName||"",r=e.positionTitle||"",i=e.orgName||"",o=n+(n.length?" - ":"")+r+(r.length?" - ":"")+i;return o.length||(o=e.email||"Untitled Contact"),o;default:return e.label||e.title||"Un-titled resource"}},e.getTypeLabel=function(e){if(!e)return"Unknown Resource Type";var n=null;if("string"==typeof e)n=e;else{if(!e.type)return null;n=e.type}switch(n){case t.ItemTypes.DATASET:case t.ItemTypes.SERVICE:case t.ItemTypes.ORGANIZATION:case t.ItemTypes.CONCEPT:return n.replace(/^[a-z]+\:/i,"");case t.ItemTypes.CONCEPT_SCHEME:return"Concept Scheme";case t.ItemTypes.WEBSITE:return"Website";case t.ItemTypes.CONTACT:return"Contact";default:return n}},e.getTypeKey=function(e){if(!e)return null;var n=null;if("string"==typeof e)n=e;else{if(!e.type)return null;n=e.type}switch(n){case t.ItemTypes.GALLERY:return"galleries";case t.ItemTypes.COMMUNITY:return"communities";case t.ItemTypes.CONTACT:return"contacts";default:return n.replace(/^[a-z]+\:/i,"").toLowerCase()+"s"}},e.determineIconType=function(e){return"/assets/icons/"+e.replace(/^[a-z]+\:/i,"").toLowerCase()+".svg"},e.getItemDetailsUrl=function(e){return e&&e.type&&e.id?t.Config.portalUrl+"/resources/"+this.getTypeKey(e)+"/"+e.id:null},e=y([n.Injectable()],e)}(),_=function(){function e(){this.external=!1}return e.prototype.ngOnInit=function(){},e.prototype.hasIcon=function(){return!0},e.prototype.getIcon=function(){return U.getIcon(this.item)},e.prototype.getLabel=function(){return U.getLabel(this.item)},e.prototype.getType=function(){return U.getTypeKey(this.item)},e.prototype.getIconClass=function(){var e=U.getTypeLabel(this.item);return"Contact"===e&&(e="vcard"),"Product"===e&&(e="imageproduct"),"icon-"+e.toLowerCase()},y([n.Input()],e.prototype,"item",void 0),y([n.Input()],e.prototype,"icon",void 0),y([n.Input()],e.prototype,"external",void 0),e=y([n.Component({selector:"gp-resource-link",template:'<a routerLink="/view/{{item?.id}}">\n    <span *ngIf="hasIcon()" class="a-icon {{getIconClass()}}"></span>\n    {{getLabel()}}\n</a>\n',styles:[""]})],e)}(),N=function(){function e(){this.onEvent=new n.EventEmitter}return e.prototype.ngOnInit=function(){},e.prototype.ngOnChanges=function(e){},e.prototype.clear=function(){this.onEvent.emit({name:"selected:clear"})},e.prototype.remove=function(e){},y([n.Input()],e.prototype,"selected",void 0),y([n.Output()],e.prototype,"onEvent",void 0),e=y([n.Component({selector:"gp-selected-items",template:'<div class="o-selected-items">\n\n    <div class="list-group list-group-sm u-text--sm">\n\n        <div *ngIf="!selected || !selected.length" class="list-group-item">\n            <div class="t-fg--gray-md t-text--italic">Nothing selected</div>\n        </div>\n\n        <div *ngFor="let item of selected"\n            class="list-group-item d-flex flex-justify-between flex-align-center">\n            <div class="flex-1">\n                <span class="icon-{{item.type.toLowerCase()}} is-themed"></span>\n                {{item.label}}\n            </div>\n            <button type="button" class="btn btn-link u-mg-left--sm" (click)="remove(item)">\n                <span class="fas fa-times-circle t-fg--danger"></span>\n            </button>\n        </div>\n\n    </div>\n\n    <div class="list-group list-group-sm u-text--sm u-mg-top--md">\n\n        <ng-content select="[actions]"></ng-content>\n\n        <div class="list-group-item d-flex flex-justify-between flex-align-center"\n            [ngClass]="{\'is-faded\':!selected?.length}"\n            (click)="clear()">\n            <div class="flex-1">Clear Selections</div>\n            <button type="button" class="btn btn-link">\n                <span class="fas fa-times-circle t-fg--danger"></span>\n            </button>\n        </div>\n    </div>\n\n</div>\n',styles:[""]})],e)}(),D=function(){function e(){this.fallback="/assets/img-404.png"}return e.prototype.onImgError=function(){this.src=this.fallback},e.prototype.onImgLoad=function(){this.className="is-image-loaded"},y([n.Input()],e.prototype,"src",void 0),y([n.Input()],e.prototype,"fallback",void 0),y([n.HostBinding("class")],e.prototype,"className",void 0),e=y([n.Directive({selector:"img[fallback]",host:{"(error)":"onImgError()","(load)":"onImgLoad()","[src]":"src"}})],e)}(),B=function(){function e(e){this.sanitizer=e}return e.prototype.ngOnInit=function(){},e.prototype.getThumbnailUrl=function(){return this.item.thumbnail&&this.item.thumbnail.url?this.item.thumbnail.url:t.Config.ualUrl+"/api/items/"+this.item.id+"/thumbnail"},e.prototype.getBackgroundImage=function(){if(!this.item||!this.item.thumbnail)return this.getFallbackBackgroundImage();var e=this.item.thumbnail,t=e.mediaType||"image/png";if(e.contentData){var n=e.contentData;return this.sanitizer.bypassSecurityTrustStyle("url(data:"+t+";base64,"+n+")")}},e.prototype.getFallbackBackgroundImage=function(){return"url("+this.getFallbackUrl()+")"},e.prototype.isEmpty=function(){return!this.item||!this.item.thumbnail||!this.item.thumbnail.url&&!this.item.thumbnail.contentData},e.prototype.hasURL=function(){return this.item.thumbnail&&!!this.item.thumbnail.url},e.prototype.hasContentData=function(){return this.item.thumbnail&&!!this.item.thumbnail.contentData&&!this.item.thumbnail.url},e.prototype.getFallbackUrl=function(){return t.Config.ualUrl+"/api/items/"+this.item.id+"/thumbnail"},e.ctorParameters=function(){return[{type:l.DomSanitizer}]},y([n.Input()],e.prototype,"item",void 0),e=y([n.Component({selector:"gp-item-thumbnail",template:'<div class="m-thumbnail" style="position:relative">\n\n    \x3c!-- fallback is to use SVG for item type as its thumbnail --\x3e\n    <div *ngIf="isEmpty()" class="is-16x9 is-fallback">\n        <div\n            [style.background-size]="\'contain\'"\n            [style.background-repeat]="\'no-repeat\'"\n            [style.background-position]="\'50% 0\'"\n            [style.background-image]="getFallbackBackgroundImage()">\n        </div>\n    </div>\n\n    \x3c!-- if there is a thumbnail with URL --\x3e\n    <img *ngIf="hasURL()" src="{{item.thumbnail.url}}" fallback="{{getFallbackUrl()}}">\n\n    \x3c!-- if there is a thumbnail with base64 data --\x3e\n    <div *ngIf="hasContentData()" class="is-16x9">\n        <img\n            [style.background-size]="\'contain\'"\n            [style.background-repeat]="\'no-repeat\'"\n            [style.background-image]="getBackgroundImage()">\n    </div>\n\n</div>\n',styles:[".m-thumbnail img{max-width:100%}"]})],e)}(),G=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.label=n,o.code=r,o.item=i,o}return h(t,e),Object.defineProperty(t.prototype,"label",{get:function(){return this._label},set:function(e){this._label=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"code",{get:function(){return this._code},set:function(e){this._code=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"item",{get:function(){return this._item},set:function(e){this._item=e},enumerable:!0,configurable:!0}),t.from=function(e){if(e instanceof t)return e;var n=new t(e.message);return n.label="An error occurred",n.code=500,n},t}(Error),F=function(){function e(){this.updateSubject=new r.BehaviorSubject(null),this.error$=this.updateSubject.asObservable()}return e.prototype.setError=function(e){var t=G.from(e);this.updateSubject.next(t)},e=y([n.Injectable()],e)}(),q={CLOSE:Symbol("Close"),OPEN:Symbol("Open"),RESET:Symbol("Reset"),SELECT:Symbol("Select"),SELECT_NONE:Symbol("SelectNone"),QUERY:Symbol("Query"),ADDED:Symbol("Added"),REMOVED:Symbol("Removed"),CHANGED:Symbol("Changed"),ERROR:Symbol("Error")},V=function(){function e(e,t){this.options={},this.type=e,t&&Object.assign(this.options,t)}return e.prototype.getType=function(){return this.type},e.prototype.getOptions=function(){return this.options},e}(),z={PUBLIC:"public",PRIVATE:"private"},W={SUBMITTED:"submitted"};function H(e,t){return Object.assign({type:e,uri:null,label:"New Item",description:"This item needs a description",resourceTypes:[],createdBy:null,lastModifiedBy:null},t||{})}function $(e,t){return H(e,Object.assign({keywords:[],alternateTitles:[],purpose:null,themes:[],contacts:[],publishers:[],contributors:[],distributions:[],classifiers:{},landingPage:null,status:W.SUBMITTED,visibility:z.PUBLIC,identifiers:[],extent:{minx:-179,miny:-89,maxx:179,maxy:89},temporal:{startDate:null,endDate:null},statistics:{numViews:0,numLikes:0},usedBy:[],related:[],rights:[]},t||{}))}function Y(e,t){e&&t&&(null!==e[t]&&void 0!==e[t]&&void 0!==e[t]||(e[t]=[]))}function Q(e,t){e&&t&&void 0===e[t]&&(e[t]=null)}var Z,K=function(){function e(){}return e.create=function(e){switch(e){case t.ItemTypes.MAP:return $(t.ItemTypes.MAP,{layers:[],baseLayer:null,annotations:{},thumbnail:{label:null,url:null,contentData:null,width:0,height:0}});case t.ItemTypes.LAYER:return r=n?[n]:[],$(t.ItemTypes.LAYER,{subLayers:[],parentLayer:null,services:r,layerName:null,layerType:null,legend:null});case t.ItemTypes.SERVICE:return $(t.ItemTypes.SERVICE,{datasets:[],serviceType:null,href:null});case t.ItemTypes.DATASET:return $(t.ItemTypes.DATASET,{services:[]});case t.ItemTypes.GALLERY:return $(t.ItemTypes.GALLERY,{items:[]});case t.ItemTypes.COMMUNITY:return $(t.ItemTypes.COMMUNITY);case t.ItemTypes.CONCEPT:return H(t.ItemTypes.CONCEPT,{scheme:null});case t.ItemTypes.CONCEPT_SCHEME:return H(t.ItemTypes.CONCEPT_SCHEME);case t.ItemTypes.ORGANIZATION:return H(t.ItemTypes.ORGANIZATION,{subOrgOf:null});case t.ItemTypes.CONTACT:return H(t.ItemTypes.CONTACT,{fullName:null,email:null,tel:null,fax:null,address:{street1:null,street2:null,city:null,state:null,zip:null}});default:return null}var n,r},e.fix=function(e){Y(e,"resourceTypes"),U.isAsset(e)&&(Y(e,"keywords"),Y(e,"alternateTitles"),Y(e,"themes"),Y(e,"contacts"),Y(e,"publishers"),Y(e,"contributors"),Y(e,"distributions"),Y(e,"identifiers"),Y(e,"usedBy"),Y(e,"related"),Y(e,"accessRights"),Q(e,"purpose"),Q(e,"landingPage"),Q(e,"status"),Q(e,"visibility"),e.temporal||(e.temporal={startDate:null,endDate:null}),e.extent||(e.extent={minx:-179,miny:-89,maxx:179,maxy:89}))},e}(),J=function(){function e(){}return e.prototype.transform=function(e,t,n){var r=isNaN(n)||n>e.length?e.length:n;return e.slice(0,r).map((function(e){return e[t]})).join(" ")},e=y([n.Pipe({name:"arrayedItems"})],e)}(),X=function(){function e(){}return e.prototype.transform=function(e,t,n){if(e&&e.length>t){var r=isNaN(n)?0:n;return r>0&&(t+=r),e.slice(r,t)}return e},e=y([n.Pipe({name:"limitTo"})],e)}(),ee=function(){function e(){}return e.prototype.transform=function(e,t){return e.sort((function(e,n){return e[t]>n[t]?-1:1}))},e=y([n.Pipe({name:"sortBy"})],e)}(),te=function(){function e(){}return e.prototype.transform=function(e){if(!e||"string"!=typeof e||0===e.length)return e;var t=e,n=e.indexOf(":");return~n&&(t=e.substring(n+1)),"VCard"===t&&(t="Contact"),t},e=y([n.Pipe({name:"friendlyType"})],e)}(),ne=function(){function e(){}return e.prototype.transform=function(e){if(!e||"string"!=typeof e||!e.length)return"Untitled";var t=e.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/_/g," ").trim();return t.charAt(0).toUpperCase()+t.slice(1)},e=y([n.Pipe({name:"fixLabel"})],e)}(),re=function(){function e(e,t){this.service=e,this.trackingService=t}return e.prototype.resolve=function(e,n){var i=this,o=e.paramMap.get("id"),s={},a=e.paramMap.get("version");return a&&(s.version=a),this.service.get(o,s).then((function(e){if(i.trackingService){var n=t.TrackingEventFactory(t.TrackingTypes.VIEWED,e);i.trackingService.logEvent(n)}return e})).catch((function(e){return r.of(e)}))},e.ctorParameters=function(){return[{type:void 0,decorators:[{type:n.Inject,args:[t.ItemService]}]},{type:void 0,decorators:[{type:n.Inject,args:[t.TrackingService]}]}]},e=y([n.Injectable(),b(0,n.Inject(t.ItemService)),b(1,n.Inject(t.TrackingService))],e)}(),ie=function(){function e(){}return e.prototype.resolve=function(e,t){var n=e.paramMap.get("version");return Promise.resolve(n||null)},e=y([n.Injectable()],e)}(),oe=function(){function e(e){this.router=e}return e.prototype.resolve=function(e,t){var n=e.params.type,i=K.create(n);if(i)return r.of(i);new G("Type "+n+" is unsupported","Unsupported Type",400);return this.router.navigateByUrl("error",{skipLocationChange:!1}),r.empty()},e.ctorParameters=function(){return[{type:c.Router}]},e=y([n.Injectable()],e)}(),se=function(){function e(e){this.router=e}return e.prototype.resolve=function(e,t){var n=e.params.type,i="An error has occurred";"unsupported"===n?i="Type "+n+" is not supported":"404"===n&&(i="Item not found");var o=new Error(i);return r.of(o)},e.ctorParameters=function(){return[{type:c.Router}]},e=y([n.Injectable()],e)}(),ae=function(){function e(e){this.service=e,this.selected=[],this.subject=new r.Subject,this.subject$=this.subject.asObservable()}return e.prototype.setQuery=function(e){this.query=e?e.clone():new t.Query,this.subject.next({query:this.query.clone()})},e.prototype.getQuery=function(){return this.query.clone()},e.prototype.getResults=function(){return this.results},e.prototype.search=function(e){var t=this;e&&this.setQuery(e),this.service.search(this.query).then((function(e){T.debug("SearchService.search() - "+e.totalResults+" results found"),t.results=e,t.subject.next({results:e})})).catch((function(e){T.error(e.message)}))},e.prototype.select=function(e){var t=this;if(Array.isArray(e))return e.forEach((function(e){return t._toggleItem(e,!1)})),void this.subject.next({selected:this.selected});this._toggleItem(e,!0)},e.prototype._toggleItem=function(e,t){var n=this;if(e&&e.id){var r=this.selected.findIndex((function(t){return t.id===e.id}));if(r>=0)return this.selected.splice(r,1),void(t&&this.subject.next({selected:this.selected}));this.service.get(e.id).then((function(e){n.selected.push(e),n.selected.sort((function(e,t){return e.label>t.label?1:-1})),t&&n.subject.next({selected:n.selected})})).catch((function(e){T.error("SearchService.select() - Error encountered fetching selected item's details: "+e.message)}))}},e.prototype.isSelected=function(e){return this.selected.length&&e&&e.id&&this.selected.findIndex((function(t){return t.id===e.id}))>=0},e.prototype.hasSelected=function(){return this.selected&&this.selected.length>0},e.prototype.getSelected=function(){return this.selected},e.prototype.clearSelected=function(){this.selected=[],this.subject.next({selected:this.selected})},e.prototype.subscribe=function(e){var t={next:function(t){null!=t&&(t.query&&e.onQueryChange(t.query),t.results&&e.onResultsChange(t.results),t.selected&&e.onSelectedChange(t.selected))},error:function(e){console.log("[ERROR] "+e.message)},complete:function(){}};return this.subject$.subscribe(t)},e.ctorParameters=function(){return[{type:void 0,decorators:[{type:n.Inject,args:[t.ItemService]}]}]},e=y([n.Injectable(),b(0,n.Inject(t.ItemService))],e)}();function le(e){return Z||(Z=new t.TrackingService({provider:e})),Z}var ce=f.RPMServiceFactory(),ue=le,pe=function(){function e(){}return e=y([n.NgModule({imports:[c.RouterModule,u.CommonModule,p.FormsModule,g.MatInputModule,g.MatButtonModule,g.MatIconModule,g.MatDialogModule,d.NgbModule],exports:[k,M,D,B,N,_,O,E,R,J,X,ee,te,ne,P],declarations:[k,M,D,B,N,_,O,E,R,J,X,ee,te,ne,P],providers:[A,se,re,oe,ie,F,U,ae,{provide:i.RPMService,useValue:ce},{provide:t.TrackingService,useFactory:ue,deps:[i.RPMService]}],entryComponents:[k,M]})],e)}();e.AppAuthService=A,e.ArrayedItemsPipe=J,e.AuthenticatedComponent=C,e.DefaultSortOptions=[{value:"_score,desc",label:"Relevance"},{value:"modified,desc",label:"Most Recently Modified"},{value:"modified,asc",label:"Least Recently Modified"},{value:"label,asc",label:"Title [A-Z]"},{value:"label,desc",label:"Title [Z-A]"},{value:"reliability,asc",label:"Reliability"}],e.ErrorResolver=se,e.EventTypes=q,e.FixLabelPipe=ne,e.FriendlyTypePipe=te,e.GeoPlatformCommonModule=pe,e.GeoPlatformCommonVersion="1.0.0",e.GeoPlatformError=G,e.GeoPlatformErrorService=F,e.GeoPlatformIconDirective=P,e.HeaderComponent=R,e.ImageFallbackDirective=D,e.ItemFactory=K,e.ItemHelper=U,e.ItemResolver=re,e.LimitToPipe=X,e.ListSelectDialog=k,e.LoginButtonComponent=O,e.LoginModalComponent=E,e.MapTypes={GeoPlatform:{label:"GeoPlatform Map",uri:"http://www.geoplatform.gov/ont/openmap/GeoplatformMap"},AGOL:{label:"AGOL Web Map",uri:"http://www.geoplatform.gov/ont/openmap/AGOLMap"},WMS:{label:"WMS Map",uri:"http://www.geoplatform.gov/ont/openmap/WMSMap"},MapBox:{label:"Map Box Map",uri:"http://www.geoplatform.gov/ont/openmap/MapBoxMap"}},e.MessageDialog=M,e.NewItemResolver=oe,e.ResourceLinkComponent=_,e.SearchEvent=V,e.SearchService=ae,e.SelectedItemsComponent=N,e.SortByPipe=ee,e.ThumbnailComponent=B,e.TrackingServiceFactory=le,e.VersionResolver=ie,e.authServiceFactory=L,e.logger=T,e.ɵ0=ce,e.ɵ1=ue,e.ɵa=k,e.ɵb=M,e.ɵc=D,e.ɵd=B,e.ɵe=N,e.ɵf=_,e.ɵg=O,e.ɵh=E,e.ɵi=R,e.ɵj=P,e.ɵk=A,e.ɵl=ae,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=geoplatform-common.umd.min.js.map